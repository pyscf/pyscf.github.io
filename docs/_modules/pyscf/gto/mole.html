
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pyscf.gto.mole &#8212; PySCF</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=92fd9be5" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/pyscf-pst.css?v=ed6b5f64" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=dfec817d"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pyscf/gto/mole';</script>
    <link rel="icon" href="../../../_static/favicon-32x32.png"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="2.7" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo-64x64.png" class="logo__image only-light" alt=""/>
    <img src="../../../_static/logo-64x64.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">PySCF</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../contributor/index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../about.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../news.html">
    News
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyscf/pyscf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../contributor/index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../about.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../news.html">
    News
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyscf/pyscf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    
    <li class="breadcrumb-item"><a href="../../pyscf.html" class="nav-link">pyscf</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">pyscf.gto.mole</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for pyscf.gto.mole</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># Copyright 2014-2021 The PySCF Developers. All Rights Reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Mole class and helper functions to handle parameters and attributes for GTO</span>
<span class="sd">integrals. This module serves the interface to the integral library libcint.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">scipy.special</span>
<span class="kn">import</span> <span class="nn">scipy.linalg</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">lib</span>
<span class="kn">from</span> <span class="nn">pyscf.lib</span> <span class="kn">import</span> <span class="n">param</span>
<span class="kn">from</span> <span class="nn">pyscf.data</span> <span class="kn">import</span> <span class="n">elements</span>
<span class="kn">from</span> <span class="nn">pyscf.lib</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">pyscf.gto</span> <span class="kn">import</span> <span class="n">cmd_args</span>
<span class="kn">from</span> <span class="nn">pyscf.gto</span> <span class="kn">import</span> <span class="n">basis</span>
<span class="kn">from</span> <span class="nn">pyscf.gto</span> <span class="kn">import</span> <span class="n">moleintor</span>
<span class="kn">from</span> <span class="nn">pyscf.gto.eval_gto</span> <span class="kn">import</span> <span class="n">eval_gto</span>
<span class="kn">from</span> <span class="nn">pyscf.gto.ecp</span> <span class="kn">import</span> <span class="n">core_configuration</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">__config__</span>

<span class="kn">from</span> <span class="nn">pyscf.data.elements</span> <span class="kn">import</span> <span class="n">ELEMENTS</span><span class="p">,</span> <span class="n">ELEMENTS_PROTON</span><span class="p">,</span> \
        <span class="n">_rm_digit</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">_symbol</span><span class="p">,</span> <span class="n">_std_symbol</span><span class="p">,</span> <span class="n">_atom_symbol</span><span class="p">,</span> <span class="n">is_ghost_atom</span><span class="p">,</span> \
        <span class="n">_std_symbol_without_ghost</span>

<span class="kn">from</span> <span class="nn">pyscf.lib.exceptions</span> <span class="kn">import</span> <span class="n">BasisNotFoundError</span><span class="p">,</span> <span class="n">PointGroupSymmetryError</span>
<span class="kn">import</span> <span class="nn">warnings</span>


<span class="c1"># for _atm, _bas, _env</span>
<span class="n">CHARGE_OF</span>  <span class="o">=</span> <span class="mi">0</span>
<span class="n">PTR_COORD</span>  <span class="o">=</span> <span class="mi">1</span>
<span class="n">NUC_MOD_OF</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">PTR_ZETA</span>   <span class="o">=</span> <span class="mi">3</span>
<span class="n">PTR_FRAC_CHARGE</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">PTR_RADIUS</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">ATM_SLOTS</span>  <span class="o">=</span> <span class="mi">6</span>
<span class="n">ATOM_OF</span>    <span class="o">=</span> <span class="mi">0</span>
<span class="n">ANG_OF</span>     <span class="o">=</span> <span class="mi">1</span>
<span class="n">NPRIM_OF</span>   <span class="o">=</span> <span class="mi">2</span>
<span class="n">NCTR_OF</span>    <span class="o">=</span> <span class="mi">3</span>
<span class="n">RADI_POWER</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># for ECP</span>
<span class="n">KAPPA_OF</span>   <span class="o">=</span> <span class="mi">4</span>
<span class="n">SO_TYPE_OF</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># for ECP</span>
<span class="n">PTR_EXP</span>    <span class="o">=</span> <span class="mi">5</span>
<span class="n">PTR_COEFF</span>  <span class="o">=</span> <span class="mi">6</span>
<span class="n">BAS_SLOTS</span>  <span class="o">=</span> <span class="mi">8</span>
<span class="c1"># pointer to env</span>
<span class="n">PTR_EXPCUTOFF</span>   <span class="o">=</span> <span class="mi">0</span>
<span class="n">PTR_COMMON_ORIG</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">PTR_RINV_ORIG</span>   <span class="o">=</span> <span class="mi">4</span>
<span class="n">PTR_RINV_ZETA</span>   <span class="o">=</span> <span class="mi">7</span>
<span class="n">PTR_RANGE_OMEGA</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">PTR_F12_ZETA</span>    <span class="o">=</span> <span class="mi">9</span>
<span class="n">PTR_GTG_ZETA</span>    <span class="o">=</span> <span class="mi">10</span>
<span class="n">NGRIDS</span>          <span class="o">=</span> <span class="mi">11</span>
<span class="n">PTR_GRIDS</span>       <span class="o">=</span> <span class="mi">12</span>
<span class="n">AS_RINV_ORIG_ATOM</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">AS_ECPBAS_OFFSET</span> <span class="o">=</span> <span class="mi">18</span>
<span class="n">AS_NECPBAS</span>      <span class="o">=</span> <span class="mi">19</span>
<span class="n">PTR_ENV_START</span>   <span class="o">=</span> <span class="mi">20</span>
<span class="c1"># parameters from libcint</span>
<span class="n">NUC_POINT</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">NUC_GAUSS</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># nucleus with fractional charges. It can be used to mimic MM particles</span>
<span class="n">NUC_FRAC_CHARGE</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">NUC_ECP</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># atoms with pseudo potential</span>

<span class="n">BASE</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="s1">&#39;BASE&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">NORMALIZE_GTO</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="s1">&#39;NORMALIZE_GTO&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">DISABLE_EVAL</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="s1">&#39;DISABLE_EVAL&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">ARGPARSE</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="s1">&#39;ARGPARSE&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="M">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.M">[docs]</a>
<span class="k">def</span> <span class="nf">M</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;This is a shortcut to build up Mole object.</span>

<span class="sd">    Args: Same to :func:`Mole.build`</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; from pyscf import gto</span>
<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 0 0; F 0 0 1&#39;, basis=&#39;6-31g&#39;)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mol</span></div>


<div class="viewcode-block" id="gaussian_int">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.gaussian_int">[docs]</a>
<span class="k">def</span> <span class="nf">gaussian_int</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;int_0^inf x^n exp(-alpha x^2) dx&#39;&#39;&#39;</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.5</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">alpha</span><span class="o">**</span><span class="n">n1</span><span class="p">)</span></div>


<div class="viewcode-block" id="gto_norm">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.gto_norm">[docs]</a>
<span class="k">def</span> <span class="nf">gto_norm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">expnt</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Normalized factor for GTO radial part   :math:`g=r^l e^{-\alpha r^2}`</span>

<span class="sd">    .. math::</span>

<span class="sd">        \frac{1}{\sqrt{\int g^2 r^2 dr}}</span>
<span class="sd">        = \sqrt{\frac{2^{2l+3} (l+1)! (2a)^{l+1.5}}{(2l+2)!\sqrt{\pi}}}</span>

<span class="sd">    Ref: H. B. Schlegel and M. J. Frisch, Int. J. Quant.  Chem., 54(1995), 83-87.</span>

<span class="sd">    Args:</span>
<span class="sd">        l (int):</span>
<span class="sd">            angular momentum</span>
<span class="sd">        expnt :</span>
<span class="sd">            exponent :math:`\alpha`</span>

<span class="sd">    Returns:</span>
<span class="sd">        normalization factor</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; print(gto_norm(0, 1))</span>
<span class="sd">    2.5264751109842591</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1">#f = 2**(2*l+3) * math.factorial(l+1) * (2*expnt)**(l+1.5) \</span>
        <span class="c1">#        / (math.factorial(2*l+2) * math.sqrt(math.pi))</span>
        <span class="c1">#return math.sqrt(f)</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gaussian_int</span><span class="p">(</span><span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">expnt</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;l should be &gt;= 0&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="cart2sph">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.cart2sph">[docs]</a>
<span class="k">def</span> <span class="nf">cart2sph</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">c_tensor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalized</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Cartesian to real spherical transformation matrix</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        normalized :</span>
<span class="sd">            How the Cartesian GTOs are normalized.  &#39;sp&#39; means the s and p</span>
<span class="sd">            functions are normalized (this is the convention used by libcint</span>
<span class="sd">            library).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nf</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
    <span class="k">if</span> <span class="n">c_tensor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">c_tensor</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c_tensor</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">c_tensor</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">normalized</span> <span class="o">==</span> <span class="s1">&#39;sp&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c_tensor</span>
        <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c_tensor</span> <span class="o">*</span> <span class="mf">0.282094791773878143</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c_tensor</span> <span class="o">*</span> <span class="mf">0.488602511902919921</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="mi">15</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="n">l</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">ngrid</span> <span class="o">=</span> <span class="n">c_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">c2sph</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ngrid</span><span class="p">,</span><span class="n">nd</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">libcgto</span><span class="o">.</span><span class="n">CINTc2s_ket_sph</span>
        <span class="n">fn</span><span class="p">(</span><span class="n">c2sph</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">ngrid</span><span class="p">),</span>
           <span class="n">c_tensor</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">c2sph</span></div>


<div class="viewcode-block" id="cart2spinor_kappa">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.cart2spinor_kappa">[docs]</a>
<span class="k">def</span> <span class="nf">cart2spinor_kappa</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalized</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Cartesian to spinor transformation matrix for kappa</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        normalized :</span>
<span class="sd">            How the Cartesian GTOs are normalized.  &#39;sp&#39; means the s and p</span>
<span class="sd">            functions are normalized (this is the convention used by libcint</span>
<span class="sd">            library).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="n">l</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">kappa</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">kappa</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="n">l</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="n">l</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="n">nf</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
    <span class="n">c2smat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="n">nd</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="n">cmat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">libcgto</span><span class="o">.</span><span class="n">CINTc2s_ket_spinor_sf1</span>
    <span class="n">fn</span><span class="p">(</span><span class="n">c2smat</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span>
       <span class="n">c2smat</span><span class="p">[</span><span class="n">nf</span><span class="p">:]</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span>
       <span class="n">cmat</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span>
       <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">nf</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">nf</span><span class="p">),</span>
       <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">kappa</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">normalized</span> <span class="o">!=</span> <span class="s1">&#39;sp&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">c2smat</span> <span class="o">*=</span> <span class="mf">0.282094791773878143</span>
        <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">c2smat</span> <span class="o">*=</span> <span class="mf">0.488602511902919921</span>
    <span class="c1"># c2smat[0] is the transformation for spin up</span>
    <span class="c1"># c2smat[1] is the transformation for spin down</span>
    <span class="n">c2smat</span> <span class="o">=</span> <span class="n">c2smat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">nf</span><span class="p">,</span><span class="n">nd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">c2smat</span></div>

<span class="n">cart2j_kappa</span> <span class="o">=</span> <span class="n">cart2spinor_kappa</span>

<div class="viewcode-block" id="cart2spinor_l">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.cart2spinor_l">[docs]</a>
<span class="k">def</span> <span class="nf">cart2spinor_l</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">normalized</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Cartesian to spinor transformation matrix for angular moment l</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        normalized :</span>
<span class="sd">            How the Cartesian GTOs are normalized.  &#39;sp&#39; means the s and p</span>
<span class="sd">            functions are normalized (this is the convention used by libcint</span>
<span class="sd">            library).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">cart2spinor_kappa</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">normalized</span><span class="p">)</span></div>

<span class="n">cart2j_l</span> <span class="o">=</span> <span class="n">cart2spinor_l</span>

<div class="viewcode-block" id="sph2spinor_kappa">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.sph2spinor_kappa">[docs]</a>
<span class="k">def</span> <span class="nf">sph2spinor_kappa</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Real spherical to spinor transformation matrix for kappa&#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">pyscf.symm.sph</span> <span class="kn">import</span> <span class="n">sph2spinor</span>
    <span class="n">ua</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">sph2spinor</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">ua</span> <span class="o">=</span> <span class="n">ua</span><span class="p">[:,</span><span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">ub</span><span class="p">[:,</span><span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">kappa</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">kappa</span>
        <span class="n">ua</span> <span class="o">=</span> <span class="n">ua</span><span class="p">[:,:</span><span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">ub</span><span class="p">[:,:</span><span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ua</span><span class="p">,</span> <span class="n">ub</span></div>


<div class="viewcode-block" id="sph2spinor_l">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.sph2spinor_l">[docs]</a>
<span class="k">def</span> <span class="nf">sph2spinor_l</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Real spherical to spinor transformation matrix for angular moment l&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">sph2spinor_kappa</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span></div>


<div class="viewcode-block" id="ao_rotation_matrix">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.ao_rotation_matrix">[docs]</a>
<span class="k">def</span> <span class="nf">ao_rotation_matrix</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">orientation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Matrix u to rotate AO basis to a new orientation.</span>

<span class="sd">    atom_new_coords = mol.atom_coords().dot(orientation.T)</span>
<span class="sd">    new_AO = u * mol.AO</span>
<span class="sd">    new_orbitals_coef = u.dot(orbitals_coef)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">pyscf.symm.basis</span> <span class="kn">import</span> <span class="n">_momentum_rotation_matrices</span>
    <span class="n">Ds</span> <span class="o">=</span> <span class="n">_momentum_rotation_matrices</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">orientation</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">u</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">Ds</span><span class="p">[</span><span class="n">l</span><span class="p">]]</span> <span class="o">*</span> <span class="n">nc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">block_diag</span><span class="p">(</span><span class="o">*</span><span class="n">u</span><span class="p">)</span></div>


<div class="viewcode-block" id="atom_types">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.atom_types">[docs]</a>
<span class="k">def</span> <span class="nf">atom_types</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">magmom</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;symmetry inequivalent atoms&#39;&#39;&#39;</span>
    <span class="n">atmgroup</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ia</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;GHOST&#39;</span> <span class="ow">in</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="o">+</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">:]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">atmgroup</span><span class="p">:</span>
            <span class="n">atmgroup</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">basis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">atmgroup</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ia</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stdsymb</span> <span class="o">=</span> <span class="n">_std_symbol</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stdsymb</span> <span class="ow">in</span> <span class="n">basis</span> <span class="ow">and</span> <span class="n">basis</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">basis</span><span class="p">[</span><span class="n">stdsymb</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">stdsymb</span> <span class="ow">in</span> <span class="n">atmgroup</span><span class="p">:</span>
                        <span class="n">atmgroup</span><span class="p">[</span><span class="n">stdsymb</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">atmgroup</span><span class="p">[</span><span class="n">stdsymb</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ia</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">atmgroup</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ia</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">stdsymb</span> <span class="ow">in</span> <span class="n">atmgroup</span><span class="p">:</span>
                <span class="n">atmgroup</span><span class="p">[</span><span class="n">stdsymb</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">atmgroup</span><span class="p">[</span><span class="n">stdsymb</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ia</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">magmom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">atmgroup_new</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="s1">&#39;o&#39;</span><span class="p">}</span>
        <span class="n">magmom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">magmom</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">atmgroup</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">uniq_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">magmom</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniq_mag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uniq_mag</span><span class="p">):</span>
                    <span class="n">subgrp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">idx</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">magmom</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="n">mag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="n">mag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">suffix</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Magmom should be chosen from [-1, 0, 1], but </span><span class="si">%s</span><span class="s2"> is given&quot;</span> <span class="o">%</span> <span class="n">mag</span><span class="p">)</span>
                    <span class="n">atmgroup_new</span><span class="p">[</span><span class="n">elem</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="p">[</span><span class="n">mag</span><span class="p">]]</span> <span class="o">=</span> <span class="n">subgrp</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">atmgroup_new</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">atmgroup</span> <span class="o">=</span> <span class="n">atmgroup_new</span>
    <span class="k">return</span> <span class="n">atmgroup</span></div>



<div class="viewcode-block" id="format_atom">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.format_atom">[docs]</a>
<span class="k">def</span> <span class="nf">format_atom</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="s1">&#39;UNIT&#39;</span><span class="p">,</span> <span class="s1">&#39;Ang&#39;</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert the input :attr:`Mole.atom` to the internal data format.</span>
<span class="sd">    Including, changing the nuclear charge to atom symbol, converting the</span>
<span class="sd">    coordinates to AU, rotate and shift the molecule.</span>
<span class="sd">    If the :attr:`~Mole.atom` is a string, it takes &quot;;&quot; and &quot;\\n&quot;</span>
<span class="sd">    for the mark to separate atoms;  &quot;,&quot; and arbitrary length of blank space</span>
<span class="sd">    to separate the individual terms for an atom.  Blank line will be ignored.</span>

<span class="sd">    Args:</span>
<span class="sd">        atoms : list or str</span>
<span class="sd">            the same to :attr:`Mole.atom`</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        origin : ndarray</span>
<span class="sd">            new axis origin.</span>
<span class="sd">        axes : ndarray</span>
<span class="sd">            (new_x, new_y, new_z), new coordinates</span>
<span class="sd">        unit : str or number</span>
<span class="sd">            If unit is one of strings (B, b, Bohr, bohr, AU, au), the coordinates</span>
<span class="sd">            of the input atoms are the atomic unit;  If unit is one of strings</span>
<span class="sd">            (A, a, Angstrom, angstrom, Ang, ang), the coordinates are in the</span>
<span class="sd">            unit of angstrom;  If a number is given, the number are considered</span>
<span class="sd">            as the Bohr value (in angstrom), which should be around 0.53.</span>
<span class="sd">            Set unit=1 if wishing to preserve the unit of the coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        &quot;atoms&quot; in the internal format. The internal format is</span>
<span class="sd">            | atom = [[atom1, (x, y, z)],</span>
<span class="sd">            |         [atom2, (x, y, z)],</span>
<span class="sd">            |         ...</span>
<span class="sd">            |         [atomN, (x, y, z)]]</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; gto.format_atom(&#39;9,0,0,0; h@1 0 0 1&#39;, origin=(1,1,1))</span>
<span class="sd">    [[&#39;F&#39;, [-1.0, -1.0, -1.0]], [&#39;H@1&#39;, [-1.0, -1.0, 0.0]]]</span>
<span class="sd">    &gt;&gt;&gt; gto.format_atom([&#39;9,0,0,0&#39;, (1, (0, 0, 1))], origin=(1,1,1))</span>
<span class="sd">    [[&#39;F&#39;, [-1.0, -1.0, -1.0]], [&#39;H&#39;, [-1, -1, 0]]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">str2atm</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dat</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">DISABLE_EVAL</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Failed to parse geometry </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">])))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Coordinates error in </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_atom_symbol</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">coords</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># The input atoms points to a geometry file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">atoms</span> <span class="o">=</span> <span class="n">fromfile</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Failed to parse geometry file  </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">atoms</span><span class="p">)</span>
                <span class="k">raise</span>

        <span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">fmt_atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">atoms</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dat</span> <span class="ow">and</span> <span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>
                <span class="n">fmt_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fmt_atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">fmt_atoms</span> <span class="o">=</span> <span class="n">from_zmatrix</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmt_atoms</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt_atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">str2atm</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fmt_atoms</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fmt_atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>
                    <span class="n">fmt_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str2atm</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                    <span class="n">fmt_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">_atom_symbol</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fmt_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">_atom_symbol</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fmt_atoms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_au</span><span class="p">(</span><span class="n">unit</span><span class="p">):</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">param</span><span class="o">.</span><span class="n">BOHR</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">unit</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">fmt_atoms</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ix,kx-&gt;ki&#39;</span><span class="p">,</span> <span class="n">axes</span> <span class="o">*</span> <span class="n">unit</span><span class="p">,</span> <span class="n">c</span> <span class="o">-</span> <span class="n">origin</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">fmt_atoms</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span></div>


<span class="c1">#TODO: sort exponents</span>
<div class="viewcode-block" id="format_basis">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.format_basis">[docs]</a>
<span class="k">def</span> <span class="nf">format_basis</span><span class="p">(</span><span class="n">basis_tab</span><span class="p">,</span> <span class="n">sort_basis</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert the input :attr:`Mole.basis` to the internal data format.</span>

<span class="sd">    ``{ atom: [(l, ((-exp, c_1, c_2, ..),</span>
<span class="sd">                    (-exp, c_1, c_2, ..))),</span>
<span class="sd">               (l, ((-exp, c_1, c_2, ..),</span>
<span class="sd">                    (-exp, c_1, c_2, ..)))], ... }``</span>

<span class="sd">    Args:</span>
<span class="sd">        basis_tab : dict</span>
<span class="sd">            Similar to :attr:`Mole.basis`, it **cannot** be a str</span>

<span class="sd">    Returns:</span>
<span class="sd">        Formatted :attr:`~Mole.basis`</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; gto.format_basis({&#39;H&#39;:&#39;sto-3g&#39;, &#39;H^2&#39;: &#39;3-21g&#39;})</span>
<span class="sd">    {&#39;H&#39;: [[0,</span>
<span class="sd">        [3.4252509099999999, 0.15432897000000001],</span>
<span class="sd">        [0.62391373000000006, 0.53532813999999995],</span>
<span class="sd">        [0.16885539999999999, 0.44463454000000002]]],</span>
<span class="sd">     &#39;H^2&#39;: [[0,</span>
<span class="sd">        [5.4471780000000001, 0.15628500000000001],</span>
<span class="sd">        [0.82454700000000003, 0.90469100000000002]],</span>
<span class="sd">        [0, [0.18319199999999999, 1.0]]]}</span>

<span class="sd">    &gt;&gt;&gt; gto.format_basis({&#39;H&#39;:&#39;gth-szv&#39;})</span>
<span class="sd">    {&#39;H&#39;: [[0,</span>
<span class="sd">        (8.3744350009, -0.0283380461),</span>
<span class="sd">        (1.8058681460, -0.1333810052),</span>
<span class="sd">        (0.4852528328, -0.3995676063),</span>
<span class="sd">        (0.1658236932, -0.5531027541)]]}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">basis_converter</span> <span class="o">=</span> <span class="n">_generate_basis_converter</span><span class="p">()</span>
    <span class="n">fmt_basis</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atom</span><span class="p">,</span> <span class="n">atom_basis</span> <span class="ow">in</span> <span class="n">basis_tab</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">_atom_symbol</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="n">_basis</span> <span class="o">=</span> <span class="n">basis_converter</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="n">atom_basis</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_basis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BasisNotFoundError</span><span class="p">(</span><span class="s1">&#39;Basis not found for  </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">symb</span><span class="p">)</span>

        <span class="c1"># Sort basis according to angular momentum. This is important for method</span>
        <span class="c1"># decontract_basis, which assumes that basis functions with the same</span>
        <span class="c1"># angular momentum are grouped together. Related to issue #1620 #1770</span>
        <span class="k">if</span> <span class="n">sort_basis</span><span class="p">:</span>
            <span class="n">_basis</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">_basis</span> <span class="k">if</span> <span class="n">b</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">fmt_basis</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span> <span class="o">=</span> <span class="n">_basis</span>
    <span class="k">return</span> <span class="n">fmt_basis</span></div>


<span class="k">def</span> <span class="nf">_generate_basis_converter</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">nparray_to_list</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="n">val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nparray_to_list</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">basis_name</span><span class="p">,</span> <span class="n">symb</span><span class="p">):</span>
        <span class="n">unc</span> <span class="o">=</span> <span class="n">basis_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;unc&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unc</span><span class="p">:</span>
            <span class="n">basis_name</span> <span class="o">=</span> <span class="n">basis_name</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s1">&#39;gth&#39;</span> <span class="ow">in</span> <span class="n">basis_name</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pyscf.pbc.gto.basis</span> <span class="kn">import</span> <span class="n">load</span> <span class="k">as</span> <span class="n">pbc_basis_load</span>
            <span class="n">_basis</span> <span class="o">=</span> <span class="n">pbc_basis_load</span><span class="p">(</span><span class="n">basis_name</span><span class="p">,</span> <span class="n">symb</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_basis</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">basis_name</span><span class="p">,</span> <span class="n">symb</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unc</span><span class="p">:</span>
            <span class="n">_basis</span> <span class="o">=</span> <span class="n">uncontracted_basis</span><span class="p">(</span><span class="n">_basis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_basis</span>

    <span class="k">def</span> <span class="nf">converter</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="n">raw_basis</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_basis</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">_basis</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">raw_basis</span><span class="p">,</span> <span class="n">_std_symbol_without_ghost</span><span class="p">(</span><span class="n">symb</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">raw_basis</span><span class="p">)</span>
              <span class="c1"># The first element is the basis of internal format</span>
              <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_basis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="nb">int</span><span class="p">))):</span>
            <span class="n">stdsymb</span> <span class="o">=</span> <span class="n">_std_symbol_without_ghost</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span>
            <span class="n">_basis</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rawb</span> <span class="ow">in</span> <span class="n">raw_basis</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rawb</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">_basis</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">rawb</span><span class="p">,</span> <span class="n">stdsymb</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_basis</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">nparray_to_list</span><span class="p">(</span><span class="n">rawb</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_basis</span> <span class="o">=</span> <span class="n">nparray_to_list</span><span class="p">(</span><span class="n">raw_basis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_basis</span>
    <span class="k">return</span> <span class="n">converter</span>

<div class="viewcode-block" id="uncontracted_basis">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.uncontracted_basis">[docs]</a>
<span class="k">def</span> <span class="nf">uncontracted_basis</span><span class="p">(</span><span class="n">_basis</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Uncontract internal format _basis</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; gto.uncontract(gto.load(&#39;sto3g&#39;, &#39;He&#39;))</span>
<span class="sd">    [[0, [6.36242139, 1]], [0, [1.158923, 1]], [0, [0.31364979, 1]]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">MAXL</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">ubasis_raw</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAXL</span><span class="p">)]</span>
    <span class="n">ubasis_exp</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAXL</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">_basis</span><span class="p">:</span>
        <span class="n">angl</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">kappa</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;For basis with kappa != 0, the uncontract basis might be wrong. &#39;</span>
                          <span class="s1">&#39;Please double check the resultant attribute mol._basis&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">coeffs</span><span class="p">:</span>
                <span class="n">ubasis_raw</span><span class="p">[</span><span class="n">angl</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">angl</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">ubasis_exp</span><span class="p">[</span><span class="n">angl</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">coeffs</span><span class="p">:</span>
                <span class="n">ubasis_raw</span><span class="p">[</span><span class="n">angl</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">angl</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">ubasis_exp</span><span class="p">[</span><span class="n">angl</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Check linear dependency</span>
    <span class="n">ubasis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAXL</span><span class="p">):</span>
        <span class="n">basis_l</span> <span class="o">=</span> <span class="n">ubasis_raw</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">basis_l</span><span class="p">:</span>
            <span class="n">es</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ubasis_exp</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
            <span class="c1"># Remove duplicated primitive basis functions</span>
            <span class="n">es</span><span class="p">,</span> <span class="n">e_idx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">es</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
            <span class="c1"># from large exponent to small exponent</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">e_idx</span><span class="p">):</span>
                <span class="n">ubasis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basis_l</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ubasis</span></div>

<span class="n">uncontract</span> <span class="o">=</span> <span class="n">uncontracted_basis</span>
<span class="n">contract</span> <span class="o">=</span> <span class="n">contracted_basis</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">to_general_contraction</span>

<div class="viewcode-block" id="to_uncontracted_cartesian_basis">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.to_uncontracted_cartesian_basis">[docs]</a>
<span class="k">def</span> <span class="nf">to_uncontracted_cartesian_basis</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Decontract the basis of a Mole or a Cell.  Returns a Mole (Cell) object</span>
<span class="sd">    with uncontracted Cartesian basis and a list of coefficients that</span>
<span class="sd">    transform the uncontracted basis to the original basis. Each element in</span>
<span class="sd">    the coefficients list corresponds to one shell of the original Mole (Cell).</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;Ne&#39;, basis=&#39;ccpvdz&#39;)</span>
<span class="sd">    &gt;&gt;&gt; pmol, ctr_coeff = mol.to_uncontracted_cartesian_basis()</span>
<span class="sd">    &gt;&gt;&gt; c = scipy.linalg.block_diag(*ctr_coeff)</span>
<span class="sd">    &gt;&gt;&gt; s = reduce(numpy.dot, (c.T, pmol.intor(&#39;int1e_ovlp&#39;), c))</span>
<span class="sd">    &gt;&gt;&gt; abs(s-mol.intor(&#39;int1e_ovlp&#39;)).max()</span>
<span class="sd">    0.0</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">decontract_basis</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">to_cart</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="decontract_basis">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.decontract_basis">[docs]</a>
<span class="k">def</span> <span class="nf">decontract_basis</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_cart</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Decontract the basis of a Mole or a Cell.  Returns a Mole (Cell) object</span>
<span class="sd">    with the uncontracted basis environment and a list of coefficients that</span>
<span class="sd">    transform the uncontracted basis to the original basis. Each element in</span>
<span class="sd">    the coefficients list corresponds to one shell of the original Mole (Cell).</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        atoms: list or str</span>
<span class="sd">            Atoms on which the basis to be decontracted. By default, all basis</span>
<span class="sd">            are decontracted</span>
<span class="sd">        to_cart: bool</span>
<span class="sd">            Decontract basis and transfer to Cartesian basis</span>
<span class="sd">        aggregate: bool</span>
<span class="sd">            Whether to aggregate the transformation coefficients into a giant</span>
<span class="sd">            transformation matrix</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;Ne&#39;, basis=&#39;ccpvdz&#39;)</span>
<span class="sd">    &gt;&gt;&gt; pmol, ctr_coeff = mol.decontract_basis()</span>
<span class="sd">    &gt;&gt;&gt; c = scipy.linalg.block_diag(*ctr_coeff)</span>
<span class="sd">    &gt;&gt;&gt; s = reduce(numpy.dot, (c.T, pmol.intor(&#39;int1e_ovlp&#39;), c))</span>
<span class="sd">    &gt;&gt;&gt; abs(s-mol.intor(&#39;int1e_ovlp&#39;)).max()</span>
<span class="sd">    0.0</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">pmol</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Some input basis may be segmented basis from a general contracted set.</span>
    <span class="c1"># This may lead to duplicated pGTOs. First contract all basis to remove</span>
    <span class="c1"># duplicated primitive functions.</span>
    <span class="n">bas_exps</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_exps</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_to_full_contraction</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">bas_idx</span><span class="p">):</span>
        <span class="n">es</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">bas_exps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bas_idx</span><span class="p">])</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">e_idx</span><span class="p">,</span> <span class="n">rev_idx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">es</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">aggregate</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">block_diag</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">_libcint_ctr_coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bas_idx</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">e_idx</span><span class="p">):</span>
                <span class="n">cs_new</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">e_idx</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">cs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rev_idx</span><span class="p">):</span>
                    <span class="n">cs_new</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">es</span> <span class="o">=</span> <span class="n">es</span><span class="p">[</span><span class="n">e_idx</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">cs_new</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">yield</span> <span class="n">es</span><span class="p">,</span> <span class="n">cs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">e_idx</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Duplicated pGTOs across shells&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bas_idx</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">bas_exps</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mol</span><span class="o">.</span><span class="n">_libcint_ctr_coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="n">_bas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">env</span> <span class="o">=</span> <span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
    <span class="n">contr_coeff</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pexp</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>

    <span class="n">lmax</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ANG_OF</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">cart</span><span class="p">:</span>
        <span class="n">c2s</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">((</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">to_cart</span><span class="p">:</span>
        <span class="n">c2s</span> <span class="o">=</span> <span class="p">[</span><span class="n">cart2sph</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">normalized</span><span class="o">=</span><span class="s1">&#39;sp&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">pmol</span><span class="o">.</span><span class="n">cart</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c2s</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

    <span class="n">aoslices</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">aoslice_by_atom</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ia</span><span class="p">,</span> <span class="p">(</span><span class="n">ib0</span><span class="p">,</span> <span class="n">ib1</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">aoslices</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">ib0</span> <span class="o">==</span> <span class="n">ib1</span><span class="p">:</span> <span class="c1"># No basis on atom ia</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">to_apply</span> <span class="o">=</span> <span class="p">((</span><span class="n">atoms</span> <span class="o">==</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_pure_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">))</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="n">atoms</span> <span class="o">==</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="n">to_apply</span> <span class="o">=</span> <span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">atom_pure_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">)</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">)</span> <span class="ow">or</span>
                            <span class="p">(</span><span class="n">ia</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">to_apply</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">to_apply</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ib0</span><span class="p">,</span> <span class="n">ib1</span><span class="p">):</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;pi,xm-&gt;pxim&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nc</span><span class="p">),</span> <span class="n">c2s</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
                    <span class="n">contr_coeff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nc</span> <span class="o">*</span> <span class="n">c2s</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">_bas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">ib0</span><span class="p">:</span><span class="n">ib1</span><span class="p">])</span>
                <span class="k">continue</span>

        <span class="n">lmax</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">ib0</span><span class="p">:</span><span class="n">ib1</span><span class="p">,</span><span class="n">ANG_OF</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">bas_idx</span> <span class="o">=</span> <span class="n">ib0</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">ib0</span><span class="p">:</span><span class="n">ib1</span><span class="p">,</span><span class="n">ANG_OF</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bas_idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">bas_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">bas_idx</span><span class="p">)</span> <span class="o">!=</span> <span class="n">bas_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Discontinuous bases of same angular momentum&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">mol_exps</span><span class="p">,</span> <span class="n">b_coeff</span> <span class="ow">in</span> <span class="n">_to_full_contraction</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">bas_idx</span><span class="p">):</span>
                <span class="n">nprim</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">b_coeff</span><span class="o">.</span><span class="n">shape</span>
                <span class="n">bs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nprim</span><span class="p">,</span> <span class="n">BAS_SLOTS</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                <span class="n">bs</span><span class="p">[:,</span><span class="n">ATOM_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">ia</span>
                <span class="n">bs</span><span class="p">[:,</span><span class="n">ANG_OF</span> <span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
                <span class="n">bs</span><span class="p">[:,</span><span class="n">NCTR_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs</span><span class="p">[:,</span><span class="n">NPRIM_OF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">bs</span><span class="p">[:,</span><span class="n">PTR_EXP</span><span class="p">]</span> <span class="o">=</span> <span class="n">pexp</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nprim</span><span class="p">)</span>
                <span class="n">bs</span><span class="p">[:,</span><span class="n">PTR_COEFF</span><span class="p">]</span> <span class="o">=</span> <span class="n">pexp</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nprim</span><span class="p">,</span> <span class="n">nprim</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="n">gto_norm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">mol_exps</span><span class="p">)</span>
                <span class="n">env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mol_exps</span><span class="p">)</span>
                <span class="n">env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span>
                <span class="n">pexp</span> <span class="o">+=</span> <span class="n">nprim</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="n">_bas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>

                <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;pi,p,xm-&gt;pxim&#39;</span><span class="p">,</span> <span class="n">b_coeff</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">norm</span><span class="p">,</span> <span class="n">c2s</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
                <span class="n">contr_coeff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nprim</span> <span class="o">*</span> <span class="n">c2s</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">pmol</span><span class="o">.</span><span class="n">_bas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">_bas</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">pmol</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">aggregate</span><span class="p">:</span>
        <span class="n">contr_coeff</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">block_diag</span><span class="p">(</span><span class="o">*</span><span class="n">contr_coeff</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pmol</span><span class="p">,</span> <span class="n">contr_coeff</span></div>


<div class="viewcode-block" id="format_ecp">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.format_ecp">[docs]</a>
<span class="k">def</span> <span class="nf">format_ecp</span><span class="p">(</span><span class="n">ecp_tab</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Convert the input :attr:`ecp` (dict) to the internal data format::</span>

<span class="sd">      { atom: (nelec,  # core electrons</span>
<span class="sd">               ((l,  # l=-1 for UL, l&gt;=0 for Ul to indicate |l&gt;&lt;l|</span>
<span class="sd">                 (((exp_1, c_1),  # for r^0</span>
<span class="sd">                   (exp_2, c_2),</span>
<span class="sd">                   ...),</span>
<span class="sd">                  ((exp_1, c_1),  # for r^1</span>
<span class="sd">                   (exp_2, c_2),</span>
<span class="sd">                   ...),</span>
<span class="sd">                  ((exp_1, c_1),  # for r^2</span>
<span class="sd">                   ...))))),</span>
<span class="sd">       ...}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fmt_ecp</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atom</span><span class="p">,</span> <span class="n">atom_ecp</span> <span class="ow">in</span> <span class="n">ecp_tab</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">_atom_symbol</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom_ecp</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">stdsymb</span> <span class="o">=</span> <span class="n">_std_symbol_without_ghost</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span>
            <span class="n">ecp_dat</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">load_ecp</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">atom_ecp</span><span class="p">),</span> <span class="n">stdsymb</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ecp_dat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ecp_dat</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1">#raise BasisNotFoundError(&#39;ECP not found for  %s&#39; % symb)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ECP </span><span class="si">%s</span><span class="s1"> not found for  </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">atom_ecp</span><span class="p">,</span> <span class="n">symb</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmt_ecp</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecp_dat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt_ecp</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_ecp</span>
    <span class="k">return</span> <span class="n">fmt_ecp</span></div>


<div class="viewcode-block" id="format_pseudo">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.format_pseudo">[docs]</a>
<span class="k">def</span> <span class="nf">format_pseudo</span><span class="p">(</span><span class="n">pseudo_tab</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Convert the input :attr:`pseudo` (dict) to the internal data format::</span>

<span class="sd">       { atom: ( (nelec_s, nele_p, nelec_d, ...),</span>
<span class="sd">                rloc, nexp, (cexp_1, cexp_2, ..., cexp_nexp),</span>
<span class="sd">                nproj_types,</span>
<span class="sd">                (r1, nproj1, ( (hproj1[1,1], hproj1[1,2], ..., hproj1[1,nproj1]),</span>
<span class="sd">                               (hproj1[2,1], hproj1[2,2], ..., hproj1[2,nproj1]),</span>
<span class="sd">                               ...</span>
<span class="sd">                               (hproj1[nproj1,1], hproj1[nproj1,2], ...        ) )),</span>
<span class="sd">                (r2, nproj2, ( (hproj2[1,1], hproj2[1,2], ..., hproj2[1,nproj1]),</span>
<span class="sd">                ... ) )</span>
<span class="sd">                )</span>
<span class="sd">        ... }</span>

<span class="sd">    Args:</span>
<span class="sd">        pseudo_tab : dict</span>
<span class="sd">            Similar to :attr:`pseudo` (a dict), it **cannot** be a str</span>

<span class="sd">    Returns:</span>
<span class="sd">        Formatted :attr:`pseudo`</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; pbc.format_pseudo({&#39;H&#39;:&#39;gth-blyp&#39;, &#39;He&#39;: &#39;gth-pade&#39;})</span>
<span class="sd">    {&#39;H&#39;: [[1],</span>
<span class="sd">        0.2, 2, [-4.19596147, 0.73049821], 0],</span>
<span class="sd">     &#39;He&#39;: [[2],</span>
<span class="sd">        0.2, 2, [-9.1120234, 1.69836797], 0]}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">pyscf.pbc.gto.pseudo</span> <span class="kn">import</span> <span class="n">load</span>
    <span class="n">fmt_pseudo</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atom</span><span class="p">,</span> <span class="n">atom_pp</span> <span class="ow">in</span> <span class="n">pseudo_tab</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">_symbol</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom_pp</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">stdsymb</span> <span class="o">=</span> <span class="n">_std_symbol_without_ghost</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span>
            <span class="n">fmt_pseudo</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">atom_pp</span><span class="p">,</span> <span class="n">stdsymb</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt_pseudo</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_pp</span>
    <span class="k">return</span> <span class="n">fmt_pseudo</span></div>


<span class="c1"># transform etb to basis format</span>
<div class="viewcode-block" id="expand_etb">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.expand_etb">[docs]</a>
<span class="k">def</span> <span class="nf">expand_etb</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Generate the exponents of even tempered basis for :attr:`Mole.basis`.</span>
<span class="sd">    .. math::</span>

<span class="sd">        e = e^{-\alpha * \beta^{i-1}} for i = 1 .. n</span>

<span class="sd">    Args:</span>
<span class="sd">        l : int</span>
<span class="sd">            Angular momentum</span>
<span class="sd">        n : int</span>
<span class="sd">            Number of GTOs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Formatted :attr:`~Mole.basis`</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; gto.expand_etb(1, 3, 1.5, 2)</span>
<span class="sd">    [[1, [6.0, 1]], [1, [3.0, 1]], [1, [1.5, 1]]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">l</span><span class="p">,</span> <span class="p">[</span><span class="n">alpha</span><span class="o">*</span><span class="n">beta</span><span class="o">**</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))]</span></div>

<div class="viewcode-block" id="expand_etbs">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.expand_etbs">[docs]</a>
<span class="k">def</span> <span class="nf">expand_etbs</span><span class="p">(</span><span class="n">etbs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Generate even tempered basis.  See also :func:`expand_etb`</span>

<span class="sd">    Args:</span>
<span class="sd">        etbs = [(l, n, alpha, beta), (l, n, alpha, beta),...]</span>

<span class="sd">    Returns:</span>
<span class="sd">        Formatted :attr:`~Mole.basis`</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; gto.expand_etbs([(0, 2, 1.5, 2.), (1, 2, 1, 2.)])</span>
<span class="sd">    [[0, [6.0, 1]], [0, [3.0, 1]], [1, [1., 1]], [1, [2., 1]]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lib</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="n">expand_etb</span><span class="p">(</span><span class="o">*</span><span class="n">etb</span><span class="p">)</span> <span class="k">for</span> <span class="n">etb</span> <span class="ow">in</span> <span class="n">etbs</span><span class="p">])</span></div>

<span class="n">etbs</span> <span class="o">=</span> <span class="n">expand_etbs</span>

<span class="c1"># concatenate two mol</span>
<div class="viewcode-block" id="conc_env">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.conc_env">[docs]</a>
<span class="k">def</span> <span class="nf">conc_env</span><span class="p">(</span><span class="n">atm1</span><span class="p">,</span> <span class="n">bas1</span><span class="p">,</span> <span class="n">env1</span><span class="p">,</span> <span class="n">atm2</span><span class="p">,</span> <span class="n">bas2</span><span class="p">,</span> <span class="n">env2</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Concatenate two Mole&#39;s integral parameters.  This function can be used</span>
<span class="sd">    to construct the environment for cross integrals like</span>

<span class="sd">    .. math::</span>

<span class="sd">        \langle \mu | \nu \rangle, \mu \in mol1, \nu \in mol2</span>

<span class="sd">    Returns:</span>
<span class="sd">        Concatenated atm, bas, env</span>

<span class="sd">    Examples:</span>
<span class="sd">        Compute the overlap between H2 molecule and O atom</span>

<span class="sd">    &gt;&gt;&gt; mol1 = gto.M(atom=&#39;H 0 1 0; H 0 0 1&#39;, basis=&#39;sto3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mol2 = gto.M(atom=&#39;O 0 0 0&#39;, basis=&#39;sto3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; atm3, bas3, env3 = gto.conc_env(mol1._atm, mol1._bas, mol1._env,</span>
<span class="sd">    ...                                 mol2._atm, mol2._bas, mol2._env)</span>
<span class="sd">    &gt;&gt;&gt; gto.moleintor.getints(&#39;int1e_ovlp_sph&#39;, atm3, bas3, env3, range(2), range(2,5))</span>
<span class="sd">    [[ 0.04875181  0.44714688  0.          0.37820346  0.        ]</span>
<span class="sd">     [ 0.04875181  0.44714688  0.          0.          0.37820346]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">off</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">env1</span><span class="p">)</span>
    <span class="n">natm_off</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atm1</span><span class="p">)</span>
    <span class="n">atm2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">atm2</span><span class="p">)</span>
    <span class="n">bas2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">bas2</span><span class="p">)</span>
    <span class="n">atm2</span><span class="p">[:,</span><span class="n">PTR_COORD</span><span class="p">]</span> <span class="o">+=</span> <span class="n">off</span>
    <span class="n">atm2</span><span class="p">[:,</span><span class="n">PTR_ZETA</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">off</span>
    <span class="n">bas2</span><span class="p">[:,</span><span class="n">ATOM_OF</span>  <span class="p">]</span> <span class="o">+=</span> <span class="n">natm_off</span>
    <span class="n">bas2</span><span class="p">[:,</span><span class="n">PTR_EXP</span>  <span class="p">]</span> <span class="o">+=</span> <span class="n">off</span>
    <span class="n">bas2</span><span class="p">[:,</span><span class="n">PTR_COEFF</span><span class="p">]</span> <span class="o">+=</span> <span class="n">off</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">atm1</span><span class="p">,</span><span class="n">atm2</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">bas1</span><span class="p">,</span><span class="n">bas2</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">env1</span><span class="p">,</span><span class="n">env2</span><span class="p">)))</span></div>


<div class="viewcode-block" id="conc_mol">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.conc_mol">[docs]</a>
<span class="k">def</span> <span class="nf">conc_mol</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Concatenate two Mole objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_built</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="s1">&#39;Warning: object </span><span class="si">%s</span><span class="s1"> not initialized. Initializing </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">mol1</span><span class="p">,</span> <span class="n">mol1</span><span class="p">)</span>
        <span class="n">mol1</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_built</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mol2</span><span class="p">,</span> <span class="s1">&#39;Warning: object </span><span class="si">%s</span><span class="s1"> not initialized. Initializing </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">mol2</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span>
        <span class="n">mol2</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

    <span class="n">mol3</span> <span class="o">=</span> <span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">_built</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">mol3</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">mol3</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="n">mol3</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> \
            <span class="n">conc_env</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span>
                     <span class="n">mol2</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>
    <span class="n">off</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>
    <span class="n">natm_off</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_atm</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mol3</span><span class="o">.</span><span class="n">_ecpbas</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_ecpbas</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ecpbas2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">)</span>
        <span class="n">ecpbas2</span><span class="p">[:,</span><span class="n">ATOM_OF</span>  <span class="p">]</span> <span class="o">+=</span> <span class="n">natm_off</span>
        <span class="n">ecpbas2</span><span class="p">[:,</span><span class="n">PTR_EXP</span>  <span class="p">]</span> <span class="o">+=</span> <span class="n">off</span>
        <span class="n">ecpbas2</span><span class="p">[:,</span><span class="n">PTR_COEFF</span><span class="p">]</span> <span class="o">+=</span> <span class="n">off</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mol3</span><span class="o">.</span><span class="n">_ecpbas</span> <span class="o">=</span> <span class="n">ecpbas2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mol3</span><span class="o">.</span><span class="n">_ecpbas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">mol1</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">,</span> <span class="n">ecpbas2</span><span class="p">))</span>

    <span class="n">mol3</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">verbose</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">output</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">max_memory</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">charge</span> <span class="o">+</span> <span class="n">mol2</span><span class="o">.</span><span class="n">charge</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">spin</span> <span class="o">-</span> <span class="n">mol2</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">symmetry_subgroup</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">cart</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">cart</span> <span class="ow">and</span> <span class="n">mol2</span><span class="o">.</span><span class="n">cart</span>

    <span class="n">mol3</span><span class="o">.</span><span class="n">_atom</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_atom</span> <span class="o">+</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_atom</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">mol3</span><span class="o">.</span><span class="n">_atom</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;Bohr&#39;</span>

    <span class="n">mol3</span><span class="o">.</span><span class="n">_basis</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">_basis</span><span class="p">)</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">_basis</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_basis</span><span class="p">)</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">_pseudo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">_pseudo</span><span class="p">)</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">_pseudo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_pseudo</span><span class="p">)</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">_ecp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">_ecp</span><span class="p">)</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">_ecp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_ecp</span><span class="p">)</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">_pseudo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">_pseudo</span><span class="p">)</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">_pseudo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_pseudo</span><span class="p">)</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">mol3</span><span class="o">.</span><span class="n">_basis</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">ecp</span> <span class="o">=</span> <span class="n">mol3</span><span class="o">.</span><span class="n">_ecp</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">pseudo</span> <span class="o">=</span> <span class="n">mol3</span><span class="o">.</span><span class="n">_pseudo</span>

    <span class="n">mol3</span><span class="o">.</span><span class="n">nucprop</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">nucprop</span><span class="p">)</span>
    <span class="n">mol3</span><span class="o">.</span><span class="n">nucprop</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">nucprop</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mol3</span></div>


<span class="c1"># &lt;bas-of-mol1|intor|bas-of-mol2&gt;</span>
<div class="viewcode-block" id="intor_cross">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.intor_cross">[docs]</a>
<span class="k">def</span> <span class="nf">intor_cross</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;1-electron integrals from two molecules like</span>

<span class="sd">    .. math::</span>

<span class="sd">        \langle \mu | intor | \nu \rangle, \mu \in mol1, \nu \in mol2</span>

<span class="sd">    Args:</span>
<span class="sd">        intor : str</span>
<span class="sd">            Name of the 1-electron integral, such as int1e_ovlp_sph (spherical overlap),</span>
<span class="sd">            int1e_nuc_cart (cartesian nuclear attraction), int1e_ipovlp_spinor</span>
<span class="sd">            (spinor overlap gradients), etc.  Ref to :func:`getints` for the</span>
<span class="sd">            full list of available 1-electron integral names</span>
<span class="sd">        mol1, mol2:</span>
<span class="sd">            :class:`Mole` objects</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        comp : int</span>
<span class="sd">            Components of the integrals, e.g. int1e_ipovlp_sph has 3 components</span>
<span class="sd">        grids : ndarray</span>
<span class="sd">            Coordinates of grids for the int1e_grids integrals</span>

<span class="sd">    Returns:</span>
<span class="sd">        ndarray of 1-electron integrals, can be either 2-dim or 3-dim, depending on comp</span>

<span class="sd">    Examples:</span>
<span class="sd">        Compute the overlap between H2 molecule and O atom</span>

<span class="sd">    &gt;&gt;&gt; mol1 = gto.M(atom=&#39;H 0 1 0; H 0 0 1&#39;, basis=&#39;sto3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mol2 = gto.M(atom=&#39;O 0 0 0&#39;, basis=&#39;sto3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.intor_cross(&#39;int1e_ovlp_sph&#39;, mol1, mol2)</span>
<span class="sd">    [[ 0.04875181  0.44714688  0.          0.37820346  0.        ]</span>
<span class="sd">     [ 0.04875181  0.44714688  0.          0.          0.37820346]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nbas1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_bas</span><span class="p">)</span>
    <span class="n">nbas2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">_bas</span><span class="p">)</span>
    <span class="n">atmc</span><span class="p">,</span> <span class="n">basc</span><span class="p">,</span> <span class="n">envc</span> <span class="o">=</span> <span class="n">conc_env</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span>
                                <span class="n">mol2</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;_grids&#39;</span> <span class="ow">in</span> <span class="n">intor</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">grids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">envc</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">envc</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">envc</span><span class="p">[</span><span class="n">NGRIDS</span><span class="p">]</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">envc</span><span class="p">[</span><span class="n">PTR_GRIDS</span><span class="p">]</span> <span class="o">=</span> <span class="n">envc</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">grids</span><span class="o">.</span><span class="n">size</span>

    <span class="n">shls_slice</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nbas1</span><span class="p">,</span> <span class="n">nbas1</span><span class="p">,</span> <span class="n">nbas1</span><span class="o">+</span><span class="n">nbas2</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">intor</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_sph&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">intor</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cint&#39;</span><span class="p">)</span> <span class="ow">or</span>
        <span class="n">intor</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_spinor&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">intor</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_cart&#39;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">getints</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="n">atmc</span><span class="p">,</span> <span class="n">basc</span><span class="p">,</span> <span class="n">envc</span><span class="p">,</span> <span class="n">shls_slice</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mol1</span><span class="o">.</span><span class="n">cart</span> <span class="o">==</span> <span class="n">mol2</span><span class="o">.</span><span class="n">cart</span><span class="p">:</span>
        <span class="n">intor</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_add_suffix</span><span class="p">(</span><span class="n">intor</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">getints</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="n">atmc</span><span class="p">,</span> <span class="n">basc</span><span class="p">,</span> <span class="n">envc</span><span class="p">,</span> <span class="n">shls_slice</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mol1</span><span class="o">.</span><span class="n">cart</span><span class="p">:</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">getints</span><span class="p">(</span><span class="n">intor</span><span class="o">+</span><span class="s1">&#39;_cart&#39;</span><span class="p">,</span> <span class="n">atmc</span><span class="p">,</span> <span class="n">basc</span><span class="p">,</span> <span class="n">envc</span><span class="p">,</span> <span class="n">shls_slice</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">mol2</span><span class="o">.</span><span class="n">cart2sph_coeff</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">getints</span><span class="p">(</span><span class="n">intor</span><span class="o">+</span><span class="s1">&#39;_cart&#39;</span><span class="p">,</span> <span class="n">atmc</span><span class="p">,</span> <span class="n">basc</span><span class="p">,</span> <span class="n">envc</span><span class="p">,</span> <span class="n">shls_slice</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">cart2sph_coeff</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span></div>


<span class="c1"># append (charge, pointer to coordinates, nuc_mod) to _atm</span>
<div class="viewcode-block" id="make_atm_env">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.make_atm_env">[docs]</a>
<span class="k">def</span> <span class="nf">make_atm_env</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nuclear_model</span><span class="o">=</span><span class="n">NUC_POINT</span><span class="p">,</span> <span class="n">nucprop</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert the internal format :attr:`Mole._atom` to the format required</span>
<span class="sd">    by ``libcint`` integrals</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nuc_charge</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">nuclear_model</span> <span class="o">==</span> <span class="n">NUC_POINT</span><span class="p">:</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">nuclear_model</span> <span class="o">==</span> <span class="n">NUC_GAUSS</span><span class="p">:</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="n">dyall_nuc_mod</span><span class="p">(</span><span class="n">nuc_charge</span><span class="p">,</span> <span class="n">nucprop</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># callable(nuclear_model)</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="n">nuclear_model</span><span class="p">(</span><span class="n">nuc_charge</span><span class="p">,</span> <span class="n">nucprop</span><span class="p">)</span>
        <span class="n">nuclear_model</span> <span class="o">=</span> <span class="n">NUC_GAUSS</span>

    <span class="n">_env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zeta</span><span class="p">))</span>
    <span class="n">_atm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">_atm</span><span class="p">[</span><span class="n">CHARGE_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuc_charge</span>
    <span class="n">_atm</span><span class="p">[</span><span class="n">PTR_COORD</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span>
    <span class="n">_atm</span><span class="p">[</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclear_model</span>
    <span class="n">_atm</span><span class="p">[</span><span class="n">PTR_ZETA</span> <span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">_atm</span><span class="p">,</span> <span class="n">_env</span></div>


<span class="c1"># append (atom, l, nprim, nctr, kappa, ptr_exp, ptr_coeff, 0) to bas</span>
<span class="c1"># absorb normalization into GTO contraction coefficients</span>
<div class="viewcode-block" id="make_bas_env">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.make_bas_env">[docs]</a>
<span class="k">def</span> <span class="nf">make_bas_env</span><span class="p">(</span><span class="n">basis_add</span><span class="p">,</span> <span class="n">atom_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert :attr:`Mole.basis` to the argument ``bas`` for ``libcint`` integrals</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_bas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_env</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">basis_add</span><span class="p">:</span>
        <span class="n">angl</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">angl</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: integral library does not support basis &#39;</span>
                             <span class="s1">&#39;with angular momentum &gt; 14</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">kappa</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">b_coeff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kappa</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">b_coeff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">es</span> <span class="o">=</span> <span class="n">b_coeff</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">b_coeff</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">nprim</span><span class="p">,</span> <span class="n">nctr</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;pi,p-&gt;pi&#39;</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">gto_norm</span><span class="p">(</span><span class="n">angl</span><span class="p">,</span> <span class="n">es</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">NORMALIZE_GTO</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">_nomalize_contracted_ao</span><span class="p">(</span><span class="n">angl</span><span class="p">,</span> <span class="n">es</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>

        <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">es</span><span class="p">)</span>
        <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">ptr_exp</span> <span class="o">=</span> <span class="n">ptr</span>
        <span class="n">ptr_coeff</span> <span class="o">=</span> <span class="n">ptr_exp</span> <span class="o">+</span> <span class="n">nprim</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="n">ptr_coeff</span> <span class="o">+</span> <span class="n">nprim</span> <span class="o">*</span> <span class="n">nctr</span>
        <span class="n">_bas</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atom_id</span><span class="p">,</span> <span class="n">angl</span><span class="p">,</span> <span class="n">nprim</span><span class="p">,</span> <span class="n">nctr</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">ptr_exp</span><span class="p">,</span> <span class="n">ptr_coeff</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">_env</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">_env</span><span class="p">)</span> <span class="c1"># flatten nested lists</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_bas</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">BAS_SLOTS</span><span class="p">),</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_env</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">double</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">_nomalize_contracted_ao</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">es</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
    <span class="c1">#ee = numpy.empty((nprim,nprim))</span>
    <span class="c1">#for i in range(nprim):</span>
    <span class="c1">#    for j in range(i+1):</span>
    <span class="c1">#        ee[i,j] = ee[j,i] = gaussian_int(angl*2+2, es[i]+es[j])</span>
    <span class="c1">#s1 = 1/numpy.sqrt(numpy.einsum(&#39;pi,pq,qi-&gt;i&#39;, cs, ee, cs))</span>
    <span class="n">ee</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">es</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ee</span> <span class="o">=</span> <span class="n">gaussian_int</span><span class="p">(</span><span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">ee</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;pi,pq,qi-&gt;i&#39;</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">cs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;pi,i-&gt;pi&#39;</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>

<div class="viewcode-block" id="make_env">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.make_env">[docs]</a>
<span class="k">def</span> <span class="nf">make_env</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">pre_env</span><span class="o">=</span><span class="p">[],</span> <span class="n">nucmod</span><span class="o">=</span><span class="p">{},</span> <span class="n">nucprop</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Generate the input arguments for ``libcint`` library based on internal</span>
<span class="sd">    format :attr:`Mole._atom` and :attr:`Mole._basis`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_atm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_bas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_env</span> <span class="o">=</span> <span class="p">[</span><span class="n">pre_env</span><span class="p">]</span>
    <span class="n">ptr_env</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pre_env</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ia</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">stdsymb</span> <span class="o">=</span> <span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ia</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">nucprop</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">nucprop</span><span class="p">[</span><span class="n">ia</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">nucprop</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">nucprop</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">nucprop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stdsymb</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">nuclear_model</span> <span class="o">=</span> <span class="n">NUC_POINT</span>
        <span class="k">if</span> <span class="n">nucmod</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nucmod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nuclear_model</span> <span class="o">=</span> <span class="n">NUC_POINT</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucmod</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">)):</span>
                <span class="n">nuclear_model</span> <span class="o">=</span> <span class="n">_parse_nuc_mod</span><span class="p">(</span><span class="n">nucmod</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ia</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">nucmod</span><span class="p">:</span>
                <span class="n">nuclear_model</span> <span class="o">=</span> <span class="n">_parse_nuc_mod</span><span class="p">(</span><span class="n">nucmod</span><span class="p">[</span><span class="n">ia</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">nucmod</span><span class="p">:</span>
                <span class="n">nuclear_model</span> <span class="o">=</span> <span class="n">_parse_nuc_mod</span><span class="p">(</span><span class="n">nucmod</span><span class="p">[</span><span class="n">symb</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">stdsymb</span> <span class="ow">in</span> <span class="n">nucmod</span><span class="p">:</span>
                <span class="n">nuclear_model</span> <span class="o">=</span> <span class="n">_parse_nuc_mod</span><span class="p">(</span><span class="n">nucmod</span><span class="p">[</span><span class="n">stdsymb</span><span class="p">])</span>
        <span class="n">atm0</span><span class="p">,</span> <span class="n">env0</span> <span class="o">=</span> <span class="n">make_atm_env</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">ptr_env</span><span class="p">,</span> <span class="n">nuclear_model</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
        <span class="n">ptr_env</span> <span class="o">=</span> <span class="n">ptr_env</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">env0</span><span class="p">)</span>
        <span class="n">_atm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atm0</span><span class="p">)</span>
        <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env0</span><span class="p">)</span>

    <span class="n">_basdic</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">symb</span><span class="p">,</span> <span class="n">basis_add</span> <span class="ow">in</span> <span class="n">basis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">bas0</span><span class="p">,</span> <span class="n">env0</span> <span class="o">=</span> <span class="n">make_bas_env</span><span class="p">(</span><span class="n">basis_add</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ptr_env</span><span class="p">)</span>
        <span class="n">ptr_env</span> <span class="o">=</span> <span class="n">ptr_env</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">env0</span><span class="p">)</span>
        <span class="n">_basdic</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span> <span class="o">=</span> <span class="n">bas0</span>
        <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ia</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">puresymb</span> <span class="o">=</span> <span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">_basdic</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">_basdic</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">puresymb</span> <span class="ow">in</span> <span class="n">_basdic</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">_basdic</span><span class="p">[</span><span class="n">puresymb</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">symb</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;X-&#39;</span><span class="p">:</span>
                <span class="n">symb</span> <span class="o">=</span> <span class="n">symb</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">elif</span> <span class="n">symb</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;GHOST-&#39;</span><span class="p">:</span>
                <span class="n">symb</span> <span class="o">=</span> <span class="n">symb</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span>
            <span class="n">puresymb</span> <span class="o">=</span> <span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">_basdic</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">_basdic</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">puresymb</span> <span class="ow">in</span> <span class="n">_basdic</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">_basdic</span><span class="p">[</span><span class="n">puresymb</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: Basis not found for atom </span><span class="si">%d</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ia</span><span class="p">,</span> <span class="n">symb</span><span class="p">))</span>
                <span class="k">continue</span>
        <span class="n">b</span><span class="p">[:,</span><span class="n">ATOM_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">ia</span>
        <span class="n">_bas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_atm</span><span class="p">:</span>
        <span class="n">_atm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">_atm</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ATM_SLOTS</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_atm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">ATM_SLOTS</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_bas</span><span class="p">:</span>
        <span class="n">_bas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">_bas</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">BAS_SLOTS</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_bas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">BAS_SLOTS</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">_env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">_env</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_atm</span><span class="p">,</span> <span class="n">_bas</span><span class="p">,</span> <span class="n">_env</span></div>


<div class="viewcode-block" id="make_ecp_env">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.make_ecp_env">[docs]</a>
<span class="k">def</span> <span class="nf">make_ecp_env</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">_atm</span><span class="p">,</span> <span class="n">ecp</span><span class="p">,</span> <span class="n">pre_env</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Generate the input arguments _ecpbas for ECP integrals</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_env</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ptr_env</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pre_env</span><span class="p">)</span>

    <span class="n">_ecpdic</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">symb</span><span class="p">,</span> <span class="n">ecp_add</span> <span class="ow">in</span> <span class="n">ecp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ecp0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nelec</span> <span class="o">=</span> <span class="n">ecp_add</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">lb</span> <span class="ow">in</span> <span class="n">ecp_add</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">rorder</span><span class="p">,</span> <span class="n">bi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lb</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">bi</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                    <span class="n">nexp</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="n">ec</span><span class="o">.</span><span class="n">shape</span>
                    <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">ptr_exp</span><span class="p">,</span> <span class="n">ptr_coeff</span> <span class="o">=</span> <span class="n">ptr_env</span><span class="p">,</span> <span class="n">ptr_env</span> <span class="o">+</span> <span class="n">nexp</span>
                    <span class="n">ecp0</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">lb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nexp</span><span class="p">,</span> <span class="n">rorder</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                 <span class="n">ptr_exp</span><span class="p">,</span> <span class="n">ptr_coeff</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="n">ptr_env</span> <span class="o">+=</span> <span class="n">nexp</span> <span class="o">*</span> <span class="mi">2</span>

                    <span class="k">if</span> <span class="n">ncol</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># Has SO-ECP</span>
                        <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ec</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">ptr_coeff</span><span class="p">,</span> <span class="n">ptr_env</span> <span class="o">=</span> <span class="n">ptr_env</span><span class="p">,</span> <span class="n">ptr_env</span> <span class="o">+</span> <span class="n">nexp</span>
                        <span class="n">ecp0</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">lb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nexp</span><span class="p">,</span> <span class="n">rorder</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                     <span class="n">ptr_exp</span><span class="p">,</span> <span class="n">ptr_coeff</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">_ecpdic</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nelec</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ecp0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

    <span class="n">_ecpbas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">_ecpdic</span><span class="p">:</span>
        <span class="n">_atm</span> <span class="o">=</span> <span class="n">_atm</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ia</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_atom</span><span class="p">):</span>
            <span class="n">symb</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">_ecpdic</span><span class="p">:</span>
                <span class="n">ecp0</span> <span class="o">=</span> <span class="n">_ecpdic</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_ecpdic</span><span class="p">:</span>
                <span class="n">ecp0</span> <span class="o">=</span> <span class="n">_ecpdic</span><span class="p">[</span><span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ecp0</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">ecp0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_atm</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">CHARGE_OF</span> <span class="p">]</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span> <span class="o">-</span> <span class="n">ecp0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">_atm</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">NUC_ECP</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">ecp0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">BAS_SLOTS</span><span class="p">)</span>
                <span class="n">b</span><span class="p">[:,</span><span class="n">ATOM_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">ia</span>
                <span class="n">_ecpbas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_ecpbas</span><span class="p">:</span>
        <span class="n">_ecpbas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">_ecpbas</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">_env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">pre_env</span><span class="p">]</span> <span class="o">+</span> <span class="n">_env</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_ecpbas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">BAS_SLOTS</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">_env</span> <span class="o">=</span> <span class="n">pre_env</span>
    <span class="k">return</span> <span class="n">_atm</span><span class="p">,</span> <span class="n">_ecpbas</span><span class="p">,</span> <span class="n">_env</span></div>


<div class="viewcode-block" id="tot_electrons">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.tot_electrons">[docs]</a>
<span class="k">def</span> <span class="nf">tot_electrons</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Total number of electrons for the given molecule</span>

<span class="sd">    Returns:</span>
<span class="sd">        electron number in integer</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 1 0; C 0 0 1&#39;, charge=1)</span>
<span class="sd">    &gt;&gt;&gt; mol.tot_electrons()</span>
<span class="sd">    6</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">_atm</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">nelectron</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_charges</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">mol</span><span class="o">.</span><span class="n">_atom</span><span class="p">:</span>
        <span class="n">nelectron</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">charge</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">_atom</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nelectron</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">charge</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">format_atom</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span><span class="p">))</span>
    <span class="n">nelectron</span> <span class="o">-=</span> <span class="n">mol</span><span class="o">.</span><span class="n">charge</span>
    <span class="n">nelectron_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">nelectron</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nelectron</span> <span class="o">-</span> <span class="n">nelectron_int</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-4</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;Found fractional number of electrons </span><span class="si">%f</span><span class="s1">. Round it to </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">nelectron</span><span class="p">,</span> <span class="n">nelectron_int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nelectron_int</span></div>


<div class="viewcode-block" id="copy">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.copy">[docs]</a>
<span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Deepcopy of the given :class:`Mole` object</span>

<span class="sd">    Some attributes are shared between the original and copied objects.</span>
<span class="sd">    Deepcopy is utilized here to ensure that operations on the copied object do</span>
<span class="sd">    not affect the original object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Avoid copy.copy(mol) for shallow copy because copy.copy automatically</span>
    <span class="c1"># calls __copy__, __reduce__, __getstate__, __setstate__ methods</span>
    <span class="n">newmol</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">deep</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">newmol</span>

    <span class="kn">import</span> <span class="nn">copy</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_atm</span>    <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_atm</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_bas</span>    <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_env</span>    <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_ecpbas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">)</span>

    <span class="n">newmol</span><span class="o">.</span><span class="n">atom</span>    <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_atom</span>   <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_atom</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">basis</span>   <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_basis</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_basis</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">ecp</span>     <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">ecp</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_ecp</span>    <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_ecp</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">pseudo</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">pseudo</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_pseudo</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_pseudo</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">magmom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">newmol</span><span class="o">.</span><span class="n">magmom</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">magmom</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newmol</span></div>


<div class="viewcode-block" id="pack">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.pack">[docs]</a>
<span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Pack the input args of :class:`Mole` to a dict.</span>

<span class="sd">    Note this function only pack the input arguments (not the entire Mole</span>
<span class="sd">    class).  Modifications to mol._atm, mol._bas, mol._env are not tracked.</span>
<span class="sd">    Use :func:`dumps` to serialize the entire Mole object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mdic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;atom&#39;</span>    <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span>
            <span class="s1">&#39;unit&#39;</span>    <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span>
            <span class="s1">&#39;basis&#39;</span>   <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span>
            <span class="s1">&#39;charge&#39;</span>  <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
            <span class="s1">&#39;spin&#39;</span>    <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">spin</span><span class="p">,</span>
            <span class="s1">&#39;symmetry&#39;</span><span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span><span class="p">,</span>
            <span class="s1">&#39;nucmod&#39;</span>  <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">nucmod</span><span class="p">,</span>
            <span class="s1">&#39;nucprop&#39;</span> <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">nucprop</span><span class="p">,</span>
            <span class="s1">&#39;ecp&#39;</span>     <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">ecp</span><span class="p">,</span>
            <span class="s1">&#39;pseudo&#39;</span>  <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">pseudo</span><span class="p">,</span>
            <span class="s1">&#39;_nelectron&#39;</span><span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">_nelectron</span><span class="p">,</span>
            <span class="s1">&#39;magmom&#39;</span>  <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span>
            <span class="s1">&#39;verbose&#39;</span> <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">verbose</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">mdic</span></div>

<div class="viewcode-block" id="unpack">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.unpack">[docs]</a>
<span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="n">moldic</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Unpack a dict which is packed by :func:`pack`, to generate the input</span>
<span class="sd">    arguments for :class:`Mole` object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">moldic</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mol</span></div>



<div class="viewcode-block" id="dumps">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.dumps">[docs]</a>
<span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Serialize Mole object to a JSON formatted str.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">exclude_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="s1">&#39;_keys&#39;</span><span class="p">,</span> <span class="s1">&#39;_ctx_lock&#39;</span><span class="p">,</span>
                    <span class="c1"># Constructing in function loads</span>
                    <span class="s1">&#39;symm_orb&#39;</span><span class="p">,</span> <span class="s1">&#39;irrep_id&#39;</span><span class="p">,</span> <span class="s1">&#39;irrep_name&#39;</span><span class="p">}</span>
    <span class="c1"># FIXME: nparray and kpts for cell objects may need to be excluded</span>
    <span class="n">nparray_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_atm&#39;</span><span class="p">,</span> <span class="s1">&#39;_bas&#39;</span><span class="p">,</span> <span class="s1">&#39;_env&#39;</span><span class="p">,</span> <span class="s1">&#39;_ecpbas&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_symm_orig&#39;</span><span class="p">,</span> <span class="s1">&#39;_symm_axes&#39;</span><span class="p">}</span>

    <span class="n">moldic</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">exclude_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">moldic</span><span class="p">:</span>
            <span class="k">del</span> <span class="p">(</span><span class="n">moldic</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nparray_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">moldic</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">moldic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">moldic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">moldic</span><span class="p">[</span><span class="s1">&#39;atom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
    <span class="n">moldic</span><span class="p">[</span><span class="s1">&#39;basis&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
    <span class="n">moldic</span><span class="p">[</span><span class="s1">&#39;ecp&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">ecp</span><span class="p">)</span>
    <span class="n">moldic</span><span class="p">[</span><span class="s1">&#39;pseudo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">pseudo</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">moldic</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">skip_value</span><span class="p">(</span><span class="n">dic</span><span class="p">):</span>
            <span class="n">dic1</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))):</span>
                    <span class="n">dic1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="n">dic1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>   <span class="c1"># Should I recursively skip_vaule?</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
                    <span class="n">dic1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">dic1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">skip_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span><span class="p">(</span><span class="s1">&#39;Function mol.dumps drops attribute </span><span class="si">%s</span><span class="s1"> because &#39;</span>
                          <span class="s1">&#39;it is not JSON-serializable&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dic1</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">skip_value</span><span class="p">(</span><span class="n">moldic</span><span class="p">),</span> <span class="n">skipkeys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="loads">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.loads">[docs]</a>
<span class="k">def</span> <span class="nf">loads</span><span class="p">(</span><span class="n">molstr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Deserialize a str containing a JSON document to a Mole object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># the numpy function array is used by eval function</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>  <span class="c1"># noqa</span>
    <span class="n">moldic</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">molstr</span><span class="p">)</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">moldic</span><span class="p">)</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">basis</span><span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">ecp</span>  <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">ecp</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;pseudo&#39;</span> <span class="ow">in</span> <span class="n">moldic</span><span class="p">:</span>
        <span class="c1"># backward compatibility with old dumps function, which does not have</span>
        <span class="c1"># the pseudo attribute</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">pseudo</span>  <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">pseudo</span><span class="p">)</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">_atm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">_ecpbas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="c1"># Objects related to symmetry cannot be serialized by dumps function.</span>
    <span class="c1"># Recreate it manually</span>
    <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span> <span class="ow">and</span> <span class="n">mol</span><span class="o">.</span><span class="n">_symm_orig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">symm</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">_symm_orig</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_symm_orig</span><span class="p">)</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">_symm_axes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_symm_axes</span><span class="p">)</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">symm_orb</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">irrep_id</span> <span class="o">=</span> \
                <span class="n">symm</span><span class="o">.</span><span class="n">symm_adapted_basis</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">groupname</span><span class="p">,</span>
                                        <span class="n">mol</span><span class="o">.</span><span class="n">_symm_orig</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">_symm_axes</span><span class="p">)</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">irrep_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">symm</span><span class="o">.</span><span class="n">irrep_id2name</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">groupname</span><span class="p">,</span> <span class="n">ir</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">irrep_id</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span> <span class="ow">and</span> <span class="n">mol</span><span class="o">.</span><span class="n">symm_orb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Backward compatibility. To load symm_orb from chkfile of pyscf-1.6</span>
        <span class="c1"># and earlier.</span>
        <span class="n">symm_orb</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># decompress symm_orb</span>
        <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">symm_orb</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="c1"># backward compatibility for chkfile of pyscf-1.4 in which val</span>
                <span class="c1"># is an array of real floats. In pyscf-1.5, val can be a list</span>
                <span class="c1"># of list, to include the imaginary part</span>
                <span class="n">val_real</span><span class="p">,</span> <span class="n">val_imag</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val_real</span><span class="p">,</span> <span class="n">val_imag</span> <span class="o">=</span> <span class="n">val</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">val_imag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">c</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val_real</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val_real</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val_imag</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
                <span class="n">c</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">symm_orb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">symm_orb</span> <span class="o">=</span> <span class="n">symm_orb</span>

    <span class="k">return</span> <span class="n">mol</span></div>



<div class="viewcode-block" id="len_spinor">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.len_spinor">[docs]</a>
<span class="k">def</span> <span class="nf">len_spinor</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;The number of spinor associated with given angular momentum and kappa.  If kappa is 0,</span>
<span class="sd">    return 4l+2</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">kappa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span></div>


<div class="viewcode-block" id="len_cart">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.len_cart">[docs]</a>
<span class="k">def</span> <span class="nf">len_cart</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;The number of Cartesian function associated with given angular momentum.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="npgto_nr">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.npgto_nr">[docs]</a>
<span class="k">def</span> <span class="nf">npgto_nr</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">cart</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Total number of primitive spherical GTOs for the given :class:`Mole` object&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">cart</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cart</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">cart</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ANG_OF</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cart</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">NPRIM_OF</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">NPRIM_OF</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>

<div class="viewcode-block" id="nao_nr">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.nao_nr">[docs]</a>
<span class="k">def</span> <span class="nf">nao_nr</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">cart</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Total number of contracted GTOs for the given :class:`Mole` object&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">cart</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cart</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">cart</span>
    <span class="k">if</span> <span class="n">cart</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">nao_cart</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ANG_OF</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">NCTR_OF</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>

<div class="viewcode-block" id="nao_cart">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.nao_cart">[docs]</a>
<span class="k">def</span> <span class="nf">nao_cart</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Total number of contracted cartesian GTOs for the given :class:`Mole` object&#39;&#39;&#39;</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ANG_OF</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">NCTR_OF</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>


<span class="c1"># nao_id0:nao_id1 corresponding to bas_id0:bas_id1</span>
<div class="viewcode-block" id="nao_nr_range">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.nao_nr_range">[docs]</a>
<span class="k">def</span> <span class="nf">nao_nr_range</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">bas_id0</span><span class="p">,</span> <span class="n">bas_id1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Lower and upper boundary of contracted spherical basis functions associated</span>
<span class="sd">    with the given shell range</span>

<span class="sd">    Args:</span>
<span class="sd">        mol :</span>
<span class="sd">            :class:`Mole` object</span>
<span class="sd">        bas_id0 : int</span>
<span class="sd">            start shell id</span>
<span class="sd">        bas_id1 : int</span>
<span class="sd">            stop shell id</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple of start basis function id and the stop function id</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;O 0 0 0; C 0 0 1&#39;, basis=&#39;6-31g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.nao_nr_range(mol, 2, 4)</span>
<span class="sd">    (2, 6)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ao_loc</span> <span class="o">=</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">make_loc</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:</span><span class="n">bas_id1</span><span class="p">],</span> <span class="s1">&#39;sph&#39;</span><span class="p">)</span>
    <span class="n">nao_id0</span> <span class="o">=</span> <span class="n">ao_loc</span><span class="p">[</span><span class="n">bas_id0</span><span class="p">]</span>
    <span class="n">nao_id1</span> <span class="o">=</span> <span class="n">ao_loc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">nao_id0</span><span class="p">,</span> <span class="n">nao_id1</span></div>


<div class="viewcode-block" id="nao_2c">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.nao_2c">[docs]</a>
<span class="k">def</span> <span class="nf">nao_2c</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Total number of contracted spinor GTOs for the given :class:`Mole` object&#39;&#39;&#39;</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ANG_OF</span><span class="p">]</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">KAPPA_OF</span><span class="p">]</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">NCTR_OF</span><span class="p">]</span>
    <span class="n">dims</span><span class="p">[</span><span class="n">kappa</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">kappa</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">kappa</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">NCTR_OF</span><span class="p">]</span>
    <span class="n">dims</span><span class="p">[</span><span class="n">kappa</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">kappa</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">kappa</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span><span class="n">NCTR_OF</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dims</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>


<span class="c1"># nao_id0:nao_id1 corresponding to bas_id0:bas_id1</span>
<div class="viewcode-block" id="nao_2c_range">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.nao_2c_range">[docs]</a>
<span class="k">def</span> <span class="nf">nao_2c_range</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">bas_id0</span><span class="p">,</span> <span class="n">bas_id1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Lower and upper boundary of contracted spinor basis functions associated</span>
<span class="sd">    with the given shell range</span>

<span class="sd">    Args:</span>
<span class="sd">        mol :</span>
<span class="sd">            :class:`Mole` object</span>
<span class="sd">        bas_id0 : int</span>
<span class="sd">            start shell id, 0-based</span>
<span class="sd">        bas_id1 : int</span>
<span class="sd">            stop shell id, 0-based</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple of start basis function id and the stop function id</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;O 0 0 0; C 0 0 1&#39;, basis=&#39;6-31g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.nao_2c_range(mol, 2, 4)</span>
<span class="sd">    (4, 12)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ao_loc</span> <span class="o">=</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">make_loc</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:</span><span class="n">bas_id1</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">nao_id0</span> <span class="o">=</span> <span class="n">ao_loc</span><span class="p">[</span><span class="n">bas_id0</span><span class="p">]</span>
    <span class="n">nao_id1</span> <span class="o">=</span> <span class="n">ao_loc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">nao_id0</span><span class="p">,</span> <span class="n">nao_id1</span></div>


<div class="viewcode-block" id="ao_loc_nr">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.ao_loc_nr">[docs]</a>
<span class="k">def</span> <span class="nf">ao_loc_nr</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">cart</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Offset of every shell in the spherical basis function spectrum</span>

<span class="sd">    Returns:</span>
<span class="sd">        list, each entry is the corresponding start basis function id</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;O 0 0 0; C 0 0 1&#39;, basis=&#39;6-31g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.ao_loc_nr(mol)</span>
<span class="sd">    [0, 1, 2, 3, 6, 9, 10, 11, 12, 15, 18]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">cart</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cart</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">cart</span>
    <span class="k">if</span> <span class="n">cart</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">make_loc</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="s1">&#39;cart&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">make_loc</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="s1">&#39;sph&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ao_loc_2c">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.ao_loc_2c">[docs]</a>
<span class="k">def</span> <span class="nf">ao_loc_2c</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Offset of every shell in the spinor basis function spectrum</span>

<span class="sd">    Returns:</span>
<span class="sd">        list, each entry is the corresponding start id of spinor function</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;O 0 0 0; C 0 0 1&#39;, basis=&#39;6-31g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.ao_loc_2c(mol)</span>
<span class="sd">    [0, 2, 4, 6, 12, 18, 20, 22, 24, 30, 36]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">make_loc</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="s1">&#39;spinor&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="time_reversal_map">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.time_reversal_map">[docs]</a>
<span class="k">def</span> <span class="nf">time_reversal_map</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;The index to map the spinor functions and its time reversal counterpart.</span>
<span class="sd">    The returned indices have positive or negative values.  For the i-th basis function,</span>
<span class="sd">    if the returned j = idx[i] &lt; 0, it means :math:`T|i\rangle = -|j\rangle`,</span>
<span class="sd">    otherwise :math:`T|i\rangle = |j\rangle`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">tao</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">ANG_OF</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">b</span><span class="p">[</span><span class="n">KAPPA_OF</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">djs</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="n">KAPPA_OF</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">djs</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">djs</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,)</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">NCTR_OF</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">dj</span> <span class="ow">in</span> <span class="n">djs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">tao</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">dj</span> <span class="o">-</span> <span class="n">m</span><span class="p">))</span>
                        <span class="n">tao</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">i</span> <span class="o">+</span> <span class="n">dj</span> <span class="o">-</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="n">dj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">NCTR_OF</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">dj</span> <span class="ow">in</span> <span class="n">djs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">tao</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">i</span> <span class="o">+</span> <span class="n">dj</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span>
                        <span class="n">tao</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">dj</span> <span class="o">-</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="n">dj</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tao</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span></div>



<span class="n">CHECK_GEOM</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="s1">&#39;gto_mole_check_geom&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="classical_coulomb_energy">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.classical_coulomb_energy">[docs]</a>
<span class="k">def</span> <span class="nf">classical_coulomb_energy</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">charges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Compute nuclear repulsion energy (AU) or static Coulomb energy</span>

<span class="sd">    Returns</span>
<span class="sd">        float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">charges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">charges</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_charges</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">charges</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="n">inter_distance</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
    <span class="n">rr</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">diag_indices_from</span><span class="p">(</span><span class="n">rr</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1e200</span>
    <span class="k">if</span> <span class="n">CHECK_GEOM</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">rr</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">):</span>
        <span class="n">raise_err</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">atm_idx</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">rr</span><span class="o">&lt;</span><span class="mf">1e-5</span><span class="p">):</span>
            <span class="c1"># Only raise error if atoms with charge != 0 have the same coordinates</span>
            <span class="k">if</span> <span class="n">charges</span><span class="p">[</span><span class="n">atm_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">charges</span><span class="p">[</span><span class="n">atm_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;Atoms </span><span class="si">%s</span><span class="s1"> have the same coordinates&#39;</span><span class="p">,</span> <span class="n">atm_idx</span><span class="p">)</span>
                <span class="n">raise_err</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># At least one of the atoms is a ghost atom; suppress divide by 0 warning</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rr</span><span class="p">[</span><span class="n">atm_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atm_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1e200</span>
        <span class="k">if</span> <span class="n">raise_err</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Ill geometry&#39;</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i,ij,j-&gt;&#39;</span><span class="p">,</span> <span class="n">charges</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">rr</span><span class="p">,</span> <span class="n">charges</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.5</span>
    <span class="k">return</span> <span class="n">e</span></div>


<span class="n">energy_nuc</span> <span class="o">=</span> <span class="n">classical_coulomb_energy</span>

<div class="viewcode-block" id="inter_distance">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.inter_distance">[docs]</a>
<span class="k">def</span> <span class="nf">inter_distance</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inter-particle distance array</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">coords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">coords</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_coords</span><span class="p">()</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">rr</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">diag_indices_from</span><span class="p">(</span><span class="n">rr</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">rr</span></div>


<div class="viewcode-block" id="sph_labels">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.sph_labels">[docs]</a>
<span class="k">def</span> <span class="nf">sph_labels</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">BASE</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Labels for spherical GTO functions</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        fmt : str or bool</span>
<span class="sd">        if fmt is boolean, it controls whether to format the labels and the</span>
<span class="sd">        default format is &quot;%d%3s %s%-4s&quot;.  if fmt is string, the string will</span>
<span class="sd">        be used as the print format.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of [(atom-id, symbol-str, nl-str, str-of-real-spherical-notation]</span>
<span class="sd">        or formatted strings based on the argument &quot;fmt&quot;</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 0 0; Cl 0 0 1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.sph_labels(mol)</span>
<span class="sd">    [(0, &#39;H&#39;, &#39;1s&#39;, &#39;&#39;), (1, &#39;Cl&#39;, &#39;1s&#39;, &#39;&#39;), (1, &#39;Cl&#39;, &#39;2s&#39;, &#39;&#39;), (1, &#39;Cl&#39;, &#39;3s&#39;, &#39;&#39;),</span>
<span class="sd">     (1, &#39;Cl&#39;, &#39;2p&#39;, &#39;x&#39;), (1, &#39;Cl&#39;, &#39;2p&#39;, &#39;y&#39;), (1, &#39;Cl&#39;, &#39;2p&#39;, &#39;z&#39;), (1, &#39;Cl&#39;, &#39;3p&#39;, &#39;x&#39;),</span>
<span class="sd">     (1, &#39;Cl&#39;, &#39;3p&#39;, &#39;y&#39;), (1, &#39;Cl&#39;, &#39;3p&#39;, &#39;z&#39;)]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_atom</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">strl</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ANGULAR</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
        <span class="n">nelec_ecp</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_nelec_core</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nelec_ecp</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">shl_start</span> <span class="o">=</span> <span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coreshl</span> <span class="o">=</span> <span class="n">core_configuration</span><span class="p">(</span><span class="n">nelec_ecp</span><span class="p">,</span> <span class="n">atom_symbol</span><span class="o">=</span><span class="n">_std_symbol</span><span class="p">(</span><span class="n">symb</span><span class="p">))</span>
            <span class="n">shl_start</span> <span class="o">=</span> <span class="n">coreshl</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nc</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shl_start</span><span class="p">,</span> <span class="n">shl_start</span><span class="o">+</span><span class="n">nc</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ia</span><span class="o">+</span><span class="n">base</span><span class="p">,</span> <span class="n">symb</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">strl</span><span class="p">),</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">REAL_SPHERIC</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">l</span><span class="o">+</span><span class="n">m</span><span class="p">])))</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">label</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s%-4s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">label</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">label</span></div>

<span class="n">spheric_labels</span> <span class="o">=</span> <span class="n">spherical_labels</span> <span class="o">=</span> <span class="n">sph_labels</span>

<div class="viewcode-block" id="cart_labels">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.cart_labels">[docs]</a>
<span class="k">def</span> <span class="nf">cart_labels</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">BASE</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Labels of Cartesian GTO functions</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        fmt : str or bool</span>
<span class="sd">        if fmt is boolean, it controls whether to format the labels and the</span>
<span class="sd">        default format is &quot;%d%3s %s%-4s&quot;.  if fmt is string, the string will</span>
<span class="sd">        be used as the print format.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of [(atom-id, symbol-str, nl-str, str-of-xyz-notation)]</span>
<span class="sd">        or formatted strings based on the argument &quot;fmt&quot;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">cartxyz</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ANG_OF</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">l</span><span class="o">-</span><span class="n">x</span><span class="o">-</span><span class="n">y</span>
                <span class="n">xyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;y&#39;</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="s1">&#39;z&#39;</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
        <span class="n">cartxyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="n">count</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">)):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_atom</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">strl</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ANGULAR</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
        <span class="n">nelec_ecp</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_nelec_core</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nelec_ecp</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">shl_start</span> <span class="o">=</span> <span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coreshl</span> <span class="o">=</span> <span class="n">core_configuration</span><span class="p">(</span><span class="n">nelec_ecp</span><span class="p">,</span> <span class="n">atom_symbol</span><span class="o">=</span><span class="n">_std_symbol</span><span class="p">(</span><span class="n">symb</span><span class="p">))</span>
            <span class="n">shl_start</span> <span class="o">=</span> <span class="n">coreshl</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nc</span>
        <span class="n">ncart</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shl_start</span><span class="p">,</span> <span class="n">shl_start</span><span class="o">+</span><span class="n">nc</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncart</span><span class="p">):</span>
                <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ia</span><span class="o">+</span><span class="n">base</span><span class="p">,</span> <span class="n">symb</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">strl</span><span class="p">),</span> <span class="n">cartxyz</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">m</span><span class="p">]))</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">label</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%d%3s</span><span class="s1"> </span><span class="si">%s%-4s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">label</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">label</span></div>


<div class="viewcode-block" id="ao_labels">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.ao_labels">[docs]</a>
<span class="k">def</span> <span class="nf">ao_labels</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">BASE</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Labels of AO basis functions</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        fmt : str or bool</span>
<span class="sd">            if fmt is boolean, it controls whether to format the labels and the</span>
<span class="sd">            default format is &quot;%d%3s %s%-4s&quot;.  if fmt is string, the string will</span>
<span class="sd">            be used as the print format.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of [(atom-id, symbol-str, nl-str, str-of-AO-notation)]</span>
<span class="sd">        or formatted strings based on the argument &quot;fmt&quot;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">cart</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mol</span><span class="o">.</span><span class="n">cart_labels</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mol</span><span class="o">.</span><span class="n">sph_labels</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span></div>


<div class="viewcode-block" id="spinor_labels">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.spinor_labels">[docs]</a>
<span class="k">def</span> <span class="nf">spinor_labels</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">BASE</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Labels of spinor GTO functions</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_atom</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_kappa</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">strl</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ANGULAR</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
        <span class="n">nelec_ecp</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_nelec_core</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nelec_ecp</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">shl_start</span> <span class="o">=</span> <span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coreshl</span> <span class="o">=</span> <span class="n">core_configuration</span><span class="p">(</span><span class="n">nelec_ecp</span><span class="p">,</span> <span class="n">atom_symbol</span><span class="o">=</span><span class="n">_std_symbol</span><span class="p">(</span><span class="n">symb</span><span class="p">))</span>
            <span class="n">shl_start</span> <span class="o">=</span> <span class="n">coreshl</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nc</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shl_start</span><span class="p">,</span> <span class="n">shl_start</span><span class="o">+</span><span class="n">nc</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">kappa</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ia</span><span class="o">+</span><span class="n">base</span><span class="p">,</span> <span class="n">symb</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d%s%d</span><span class="s1">/2&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">strl</span><span class="p">,</span> <span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                  <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/2&#39;</span><span class="o">%</span><span class="n">m</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">kappa</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ia</span><span class="o">+</span><span class="n">base</span><span class="p">,</span> <span class="n">symb</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d%s%d</span><span class="s1">/2&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">strl</span><span class="p">,</span> <span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                  <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/2&#39;</span><span class="o">%</span><span class="n">m</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">label</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">,</span><span class="si">%-5s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">label</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">label</span></div>


<div class="viewcode-block" id="search_ao_label">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.search_ao_label">[docs]</a>
<span class="k">def</span> <span class="nf">search_ao_label</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Find the index of the AO basis function based on the given ao_label</span>

<span class="sd">    Args:</span>
<span class="sd">        ao_label : string or a list of strings</span>
<span class="sd">            The regular expression pattern to match the orbital labels</span>
<span class="sd">            returned by mol.ao_labels()</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of index for the AOs that matches the given ao_label RE pattern</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 0 0; Cl 0 0 1&#39;, basis=&#39;ccpvtz&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mol.search_ao_label(&#39;Cl.*p&#39;)</span>
<span class="sd">    [19 20 21 22 23 24 25 26 27 28 29 30]</span>
<span class="sd">    &gt;&gt;&gt; mol.search_ao_label(&#39;Cl 2p&#39;)</span>
<span class="sd">    [19 20 21]</span>
<span class="sd">    &gt;&gt;&gt; mol.search_ao_label([&#39;Cl.*d&#39;, &#39;Cl 4p&#39;])</span>
<span class="sd">    [25 26 27 31 32 33 34 35 36 37 38 39 40]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_aolabels2baslst</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_aolabels2baslst</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">aolabels_or_baslst</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">BASE</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">aolabels_or_baslst</span><span class="p">):</span>
        <span class="n">baslst</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">ao_labels</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">))</span>
                  <span class="k">if</span> <span class="n">aolabels_or_baslst</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aolabels_or_baslst</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">aolabels</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; +&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">aolabels_or_baslst</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">aolabels</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">aolabels</span><span class="p">)</span>
        <span class="n">baslst</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">ao_labels</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">))</span>
                  <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">aolabels</span><span class="p">,</span> <span class="n">s</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">aolabels_or_baslst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aolabels_or_baslst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">aolabels</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; +&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">aolabels_or_baslst</span><span class="p">]</span>
        <span class="n">baslst</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">ao_labels</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">))</span>
                  <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">aolabels</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">baslst</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">base</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aolabels_or_baslst</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">baslst</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<div class="viewcode-block" id="search_shell_id">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.search_shell_id">[docs]</a>
<span class="k">def</span> <span class="nf">search_shell_id</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Search the first basis/shell id (**not** the basis function id) which</span>
<span class="sd">    matches the given atom-id and angular momentum</span>

<span class="sd">    Args:</span>
<span class="sd">        atm_id : int</span>
<span class="sd">            atom id, 0-based</span>
<span class="sd">        l : int</span>
<span class="sd">            angular momentum</span>

<span class="sd">    Returns:</span>
<span class="sd">        basis id, 0-based.  If not found, return None</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 0 0; Cl 0 0 1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mol.search_shell_id(1, 1) # Cl p shell</span>
<span class="sd">    4</span>
<span class="sd">    &gt;&gt;&gt; mol.search_shell_id(1, 2) # Cl d shell</span>
<span class="sd">    None</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">)):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_atom</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ia</span> <span class="o">==</span> <span class="n">atm_id</span> <span class="ow">and</span> <span class="n">l1</span> <span class="o">==</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ib</span></div>


<div class="viewcode-block" id="search_ao_nr">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.search_ao_nr">[docs]</a>
<span class="k">def</span> <span class="nf">search_ao_nr</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">atmshell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Search the first basis function id (**not** the shell id) which matches</span>
<span class="sd">    the given atom-id, angular momentum magnetic angular momentum, principal shell.</span>

<span class="sd">    Args:</span>
<span class="sd">        atm_id : int</span>
<span class="sd">            atom id, 0-based</span>
<span class="sd">        l : int</span>
<span class="sd">            angular momentum</span>
<span class="sd">        m : int</span>
<span class="sd">            magnetic angular momentum</span>
<span class="sd">        atmshell : int</span>
<span class="sd">            principal quantum number</span>

<span class="sd">    Returns:</span>
<span class="sd">        basis function id, 0-based.  If not found, return None</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 0 0; Cl 0 0 1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mol.search_ao_nr(1, 1, -1, 3) # Cl 3px</span>
<span class="sd">    7</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ibf</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">)):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_atom</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">cart</span><span class="p">:</span>
            <span class="n">degen</span> <span class="o">=</span> <span class="p">(</span><span class="n">l1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">l1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">degen</span> <span class="o">=</span> <span class="n">l1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ia</span> <span class="o">==</span> <span class="n">atm_id</span> <span class="ow">and</span> <span class="n">l1</span> <span class="o">==</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atmshell</span> <span class="o">&gt;</span> <span class="n">nc</span><span class="o">+</span><span class="n">l1</span><span class="p">:</span>
                <span class="n">atmshell</span> <span class="o">=</span> <span class="n">atmshell</span> <span class="o">-</span> <span class="n">nc</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ibf</span> <span class="o">+</span> <span class="p">(</span><span class="n">atmshell</span><span class="o">-</span><span class="n">l1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">degen</span> <span class="o">+</span> <span class="p">(</span><span class="n">l1</span><span class="o">+</span><span class="n">m</span><span class="p">)</span>
        <span class="n">ibf</span> <span class="o">+=</span> <span class="n">degen</span> <span class="o">*</span> <span class="n">nc</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Required AO not found&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="search_ao_r">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.search_ao_r">[docs]</a>
<span class="k">def</span> <span class="nf">search_ao_r</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">atmshell</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;TODO&#39;</span><span class="p">)</span></div>

<span class="c1">#TODO:    ibf = 0</span>
<span class="c1">#TODO:    for ib in range(len(mol._bas)):</span>
<span class="c1">#TODO:        ia = mol.bas_atom(ib)</span>
<span class="c1">#TODO:        l1 = mol.bas_angular(ib)</span>
<span class="c1">#TODO:        nc = mol.bas_nctr(ib)</span>
<span class="c1">#TODO:        k = mol.bas_kappa(bas_id)</span>
<span class="c1">#TODO:        degen = len_spinor(l1, k)</span>
<span class="c1">#TODO:        if ia == atm_id and l1 == l and k == kappa:</span>
<span class="c1">#TODO:            if atmshell &gt; nc+l1:</span>
<span class="c1">#TODO:                atmshell = atmshell - nc</span>
<span class="c1">#TODO:            else:</span>
<span class="c1">#TODO:                return ibf + (atmshell-l1-1)*degen + (degen+m)</span>
<span class="c1">#TODO:        ibf += degen</span>

<div class="viewcode-block" id="offset_2c_by_atom">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.offset_2c_by_atom">[docs]</a>
<span class="k">def</span> <span class="nf">offset_2c_by_atom</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;2-component AO offset for each atom.  Return a list, each item</span>
<span class="sd">    of the list gives (start-shell-id, stop-shell-id, start-AO-id, stop-AO-id)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">aoslice_by_atom</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">ao_loc_2c</span><span class="p">())</span></div>


<div class="viewcode-block" id="aoslice_by_atom">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.aoslice_by_atom">[docs]</a>
<span class="k">def</span> <span class="nf">aoslice_by_atom</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ao_loc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;AO offsets for each atom.  Return a list, each item of the list gives</span>
<span class="sd">    (start-shell-id, stop-shell-id, start-AO-id, stop-AO-id)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ao_loc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ao_loc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">ao_loc_nr</span><span class="p">()</span>

    <span class="n">aorange</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">natm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">aorange</span>

    <span class="n">bas_atom</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ATOM_OF</span><span class="p">]</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bas_atom</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">bas_atom</span><span class="p">[</span><span class="mi">1</span><span class="p">:])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">natm</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">aorange</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">shell_start</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">)</span>
        <span class="n">aorange</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">shell_end</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Some atoms miss basis</span>
        <span class="n">shell_start</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">shell_start</span><span class="p">[:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">shell_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">shell_start</span><span class="p">[</span><span class="n">bas_atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">shell_start</span><span class="p">[</span><span class="n">bas_atom</span><span class="p">[</span><span class="n">delimiter</span><span class="p">]]</span> <span class="o">=</span> <span class="n">delimiter</span>

        <span class="n">shell_end</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">shell_end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">shell_end</span><span class="p">[</span><span class="n">bas_atom</span><span class="p">[</span><span class="n">delimiter</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">delimiter</span>
        <span class="n">shell_end</span><span class="p">[</span><span class="n">bas_atom</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nbas</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">shell_start</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">shell_start</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">shell_end</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">shell_end</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">aorange</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">shell_start</span>
    <span class="n">aorange</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">shell_end</span>
    <span class="n">aorange</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ao_loc</span><span class="p">[</span><span class="n">shell_start</span><span class="p">]</span>
    <span class="n">aorange</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">ao_loc</span><span class="p">[</span><span class="n">shell_end</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">aorange</span></div>

<span class="n">offset_nr_by_atom</span> <span class="o">=</span> <span class="n">aoslice_by_atom</span>

<div class="viewcode-block" id="same_basis_set">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.same_basis_set">[docs]</a>
<span class="k">def</span> <span class="nf">same_basis_set</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Check whether two molecules use the same basis sets.</span>
<span class="sd">    The two molecules can have different geometry.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">atomtypes1</span> <span class="o">=</span> <span class="n">atom_types</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_atom</span><span class="p">,</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_basis</span><span class="p">)</span>
    <span class="n">atomtypes2</span> <span class="o">=</span> <span class="n">atom_types</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">_atom</span><span class="p">,</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_basis</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">atomtypes1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">atomtypes2</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">atomtypes1</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atomtypes1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atomtypes2</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_basis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_basis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="same_mol">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.same_mol">[docs]</a>
<span class="k">def</span> <span class="nf">same_mol</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">cmp_basis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_chiral</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Compare the two molecules whether they have the same structure.</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        tol : float</span>
<span class="sd">            In Bohr</span>
<span class="sd">        cmp_basis : bool</span>
<span class="sd">            Whether to compare basis functions for the two molecules</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">symm</span>

    <span class="k">if</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_atom</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">!=</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_atom</span><span class="o">.</span><span class="fm">__len__</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">chg1</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_atm</span><span class="p">[:,</span><span class="n">CHARGE_OF</span><span class="p">]</span>
    <span class="n">chg2</span> <span class="o">=</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_atm</span><span class="p">[:,</span><span class="n">CHARGE_OF</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">chg1</span><span class="p">)</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">chg2</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">cmp_basis</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">same_basis_set</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">finger</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">chgs</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;z,zr-&gt;r&#39;</span><span class="p">,</span> <span class="n">chgs</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span> <span class="o">/</span> <span class="n">chgs</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">inertia_moment</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">chgs</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>
        <span class="c1"># Divid im by chgs.sum(), to normalize im. Otherwise the input tol may</span>
        <span class="c1"># not reflect the actual deviation.</span>
        <span class="n">im</span> <span class="o">/=</span> <span class="n">chgs</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">w</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coord</span><span class="o">-</span><span class="n">center</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">r</span>

    <span class="n">coord1</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">atom_coords</span><span class="p">()</span>
    <span class="n">coord2</span> <span class="o">=</span> <span class="n">mol2</span><span class="o">.</span><span class="n">atom_coords</span><span class="p">()</span>
    <span class="n">w1</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">finger</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">chg1</span><span class="p">,</span> <span class="n">coord1</span><span class="p">)</span>
    <span class="n">w2</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">finger</span><span class="p">(</span><span class="n">mol2</span><span class="p">,</span> <span class="n">chg2</span><span class="p">,</span> <span class="n">coord2</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">tol</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">rotate_xy</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                              <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                              <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]])</span>
    <span class="n">rotate_yz</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                              <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                              <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="mf">1.</span><span class="p">]])</span>
    <span class="n">rotate_zx</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                              <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                              <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="mf">1.</span><span class="p">]])</span>

    <span class="k">def</span> <span class="nf">inspect</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">r2</span><span class="p">):</span>
        <span class="n">place</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tol</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">symm</span><span class="o">.</span><span class="n">argsort_coords</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">place</span><span class="p">)</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="n">z2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">r2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">rot</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rotate_xy</span><span class="p">,</span> <span class="n">rotate_yz</span><span class="p">,</span> <span class="n">rotate_zx</span><span class="p">):</span>
            <span class="n">r1new</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">symm</span><span class="o">.</span><span class="n">argsort_coords</span><span class="p">(</span><span class="n">r1new</span><span class="p">,</span> <span class="n">place</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">z1</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="n">z2</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">r1new</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">r2</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">tol</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">chg1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">chg2</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">ignore_chiral</span> <span class="ow">and</span> <span class="n">inspect</span><span class="p">(</span><span class="n">chg1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">chg2</span><span class="p">,</span> <span class="o">-</span><span class="n">r2</span><span class="p">)))</span></div>

<span class="n">is_same_mol</span> <span class="o">=</span> <span class="n">same_mol</span>

<div class="viewcode-block" id="chiral_mol">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.chiral_mol">[docs]</a>
<span class="k">def</span> <span class="nf">chiral_mol</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Detect whether the given molecule is chiral molecule or two molecules</span>
<span class="sd">    are chiral isomers.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">mol2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mol2</span> <span class="o">=</span> <span class="n">mol1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ptr_coord</span> <span class="o">=</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_atm</span><span class="p">[:,</span><span class="n">PTR_COORD</span><span class="p">]</span>
        <span class="n">mol2</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr_coord</span>  <span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">mol2</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr_coord</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">mol2</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr_coord</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="n">same_mol</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">,</span> <span class="n">ignore_chiral</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">same_mol</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">,</span> <span class="n">ignore_chiral</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></div>


<div class="viewcode-block" id="inertia_moment">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.inertia_moment">[docs]</a>
<span class="k">def</span> <span class="nf">inertia_moment</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_mass_list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">coords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_coords</span><span class="p">()</span>
    <span class="n">mass_center</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i,ij-&gt;j&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span><span class="o">/</span><span class="n">mass</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span> <span class="o">-</span> <span class="n">mass_center</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i,ij,ik-&gt;jk&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">im</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span> <span class="o">-</span> <span class="n">im</span>
    <span class="k">return</span> <span class="n">im</span></div>


<div class="viewcode-block" id="atom_mass_list">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.atom_mass_list">[docs]</a>
<span class="k">def</span> <span class="nf">atom_mass_list</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">isotope_avg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;A list of mass for all atoms in the molecule</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        isotope_avg : boolean</span>
<span class="sd">            Whether to use the isotope average mass as the atomic mass</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">isotope_avg</span><span class="p">:</span>
        <span class="n">mass_table</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">MASSES</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mass_table</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">ISOTOPE_MAIN</span>

    <span class="n">nucprop</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nucprop</span>
    <span class="k">if</span> <span class="n">nucprop</span><span class="p">:</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">):</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_charge</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
            <span class="n">symb</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
            <span class="n">stdsymb</span> <span class="o">=</span> <span class="n">_std_symbol</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ia</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">nucprop</span><span class="p">:</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="n">nucprop</span><span class="p">[</span><span class="n">ia</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">nucprop</span><span class="p">:</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="n">nucprop</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="n">nucprop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stdsymb</span><span class="p">,</span> <span class="p">{})</span>

            <span class="n">mass</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mass&#39;</span><span class="p">,</span> <span class="n">mass_table</span><span class="p">[</span><span class="n">z</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#mass = [mass_table[z] for z in mol.atom_charges()]</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">):</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">))</span>
            <span class="n">mass</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass_table</span><span class="p">[</span><span class="n">z</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span></div>


<div class="viewcode-block" id="condense_to_shell">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.condense_to_shell">[docs]</a>
<span class="k">def</span> <span class="nf">condense_to_shell</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">compressor</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;The given matrix is first partitioned to blocks, based on AO shell as</span>
<span class="sd">    delimiter. Then call compressor function to abstract each block.</span>

<span class="sd">    Args:</span>
<span class="sd">        compressor: string or function</span>
<span class="sd">            if compressor is a string, its value can be  sum, max, min, abssum,</span>
<span class="sd">            absmax, absmin, norm</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ao_loc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">ao_loc_nr</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">compressor</span><span class="p">):</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">i0</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ao_loc</span><span class="p">[:</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">j0</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ao_loc</span><span class="p">[:</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">]):</span>
                <span class="n">abstract</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">compressor</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">ao_loc</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">j0</span><span class="p">:</span><span class="n">ao_loc</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">condense</span><span class="p">(</span><span class="n">compressor</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">ao_loc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">abstract</span></div>


<div class="viewcode-block" id="get_overlap_cond">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.get_overlap_cond">[docs]</a>
<span class="k">def</span> <span class="nf">get_overlap_cond</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">shls_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Overlap magnitudes measured by -log(overlap) between two shells</span>

<span class="sd">    Args:</span>
<span class="sd">        mol : an instance of :class:`Mole`</span>

<span class="sd">    Returns:</span>
<span class="sd">        2D mask array of shape (nbas,nbas)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nbas</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nbas</span>
    <span class="k">if</span> <span class="n">shls_slice</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shls_slice</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nbas</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nbas</span><span class="p">)</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbas</span><span class="p">,</span> <span class="n">nbas</span><span class="p">))</span>
    <span class="n">moleintor</span><span class="o">.</span><span class="n">libcgto</span><span class="o">.</span><span class="n">GTOoverlap_cond</span><span class="p">(</span>
        <span class="n">cond</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)(</span><span class="o">*</span><span class="n">shls_slice</span><span class="p">),</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">_atm</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">),</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">nbas</span><span class="p">),</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">cond</span></div>



<div class="viewcode-block" id="tostring">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.tostring">[docs]</a>
<span class="k">def</span> <span class="nf">tostring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert molecular geometry to a string of the required format.</span>

<span class="sd">    Supported output formats:</span>
<span class="sd">        | raw: Each line is  &lt;symbol&gt; &lt;x&gt; &lt;y&gt; &lt;z&gt;</span>
<span class="sd">        | xyz: XYZ cartesian coordinates format</span>
<span class="sd">        | zmat: Z-matrix format</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span> <span class="ow">or</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;raw&#39;</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_coords</span><span class="p">()</span> <span class="o">*</span> <span class="n">param</span><span class="o">.</span><span class="n">BOHR</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;XYZ from PySCF&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">):</span>
            <span class="n">symb</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_pure_symbol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-4s</span><span class="s1"> </span><span class="si">%14.5f</span><span class="s1"> </span><span class="si">%14.5f</span><span class="s1"> </span><span class="si">%14.5f</span><span class="s1">&#39;</span> <span class="o">%</span>
                          <span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;zmat&#39;</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_coords</span><span class="p">()</span> <span class="o">*</span> <span class="n">param</span><span class="o">.</span><span class="n">BOHR</span>
        <span class="n">zmat</span> <span class="o">=</span> <span class="n">cart2zmat</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zmat</span><span class="p">):</span>
            <span class="n">symb</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_pure_symbol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-4s</span><span class="s1">   </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="tofile">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.tofile">[docs]</a>
<span class="k">def</span> <span class="nf">tofile</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Write molecular geometry to a file of the required format.</span>

<span class="sd">    Supported output formats:</span>
<span class="sd">        | raw: Each line is  &lt;symbol&gt; &lt;x&gt; &lt;y&gt; &lt;z&gt;</span>
<span class="sd">        | xyz: XYZ cartesian coordinates format</span>
<span class="sd">        | zmat: Z-matrix format</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Guess format based on filename</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">tostring</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span></div>


<div class="viewcode-block" id="fromfile">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.fromfile">[docs]</a>
<span class="k">def</span> <span class="nf">fromfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Read molecular geometry from a file</span>
<span class="sd">    (in testing)</span>

<span class="sd">    Supported formats:</span>
<span class="sd">        | raw: Each line is  &lt;symbol&gt; &lt;x&gt; &lt;y&gt; &lt;z&gt;</span>
<span class="sd">        | xyz: XYZ cartesian coordinates format</span>
<span class="sd">        | zmat: Z-matrix format</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Guess format based on filename</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;zmat&#39;</span><span class="p">,</span> <span class="s1">&#39;sdf&#39;</span><span class="p">):</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;raw&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fromstring</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="nb">format</span><span class="p">)</span></div>



<div class="viewcode-block" id="fromstring">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.fromstring">[docs]</a>
<span class="k">def</span> <span class="nf">fromstring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;xyz&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert the string of the specified format to internal format</span>
<span class="sd">    (in testing)</span>

<span class="sd">    Supported formats:</span>
<span class="sd">        | raw: Each line is  &lt;symbol&gt; &lt;x&gt; &lt;y&gt; &lt;z&gt;</span>
<span class="sd">        | xyz: XYZ cartesian coordinates format</span>
<span class="sd">        | zmat: Z-matrix format</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;zmat&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">from_zmatrix</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span><span class="p">:</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">natm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">natm</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;sdf&#39;</span><span class="p">:</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">natoms</span><span class="p">,</span> <span class="n">nbonds</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">4</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">natoms</span><span class="p">)]:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;raw&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">string</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="is_au">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.is_au">[docs]</a>
<span class="k">def</span> <span class="nf">is_au</span><span class="p">(</span><span class="n">unit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Return whether the unit is recognized as A.U. or not</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">unit</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;AU&#39;</span><span class="p">))</span></div>


<span class="c1">#</span>
<span class="c1"># MoleBase handles three layers of basis data: input, internal format, libcint arguments.</span>
<span class="c1"># The relationship of the three layers are</span>
<span class="c1">#    .atom (input) &lt;=&gt;  ._atom (for python) &lt;=&gt; ._atm (for libcint)</span>
<span class="c1">#   .basis (input) &lt;=&gt; ._basis (for python) &lt;=&gt; ._bas (for libcint)</span>
<span class="c1"># input layer does not talk to libcint directly.  Data are held in python</span>
<span class="c1"># internal format layer.  Most of methods defined in this class only operates</span>
<span class="c1"># on the internal format.  Exceptions are make_env, make_atm_env, make_bas_env,</span>
<span class="c1"># set_common_orig_, set_rinv_orig_ which are used to manipulate the libcint arguments.</span>
<span class="c1">#</span>
<div class="viewcode-block" id="MoleBase">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase">[docs]</a>
<span class="k">class</span> <span class="nc">MoleBase</span><span class="p">(</span><span class="n">lib</span><span class="o">.</span><span class="n">StreamObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Basic class to hold molecular structure, integrals and global options</span>

<span class="sd">    Attributes:</span>
<span class="sd">        verbose : int</span>
<span class="sd">            Print level</span>
<span class="sd">        output : str or None</span>
<span class="sd">            Output file, default is None which dumps msg to sys.stdout</span>
<span class="sd">        max_memory : int, float</span>
<span class="sd">            Allowed memory in MB</span>
<span class="sd">        charge : int</span>
<span class="sd">            Charge of molecule. It affects the electron numbers</span>
<span class="sd">        spin : int or None</span>
<span class="sd">            2S, num. alpha electrons - num. beta electrons to control</span>
<span class="sd">            multiplicity. If spin = None is set, multiplicity will be guessed</span>
<span class="sd">            based on the neutral molecule.</span>
<span class="sd">        symmetry : bool or str</span>
<span class="sd">            Whether to use symmetry.  When this variable is set to True, the</span>
<span class="sd">            molecule will be rotated and the highest rotation axis will be</span>
<span class="sd">            placed z-axis.</span>
<span class="sd">            If a string is given as the name of point group, the given point</span>
<span class="sd">            group symmetry will be used.  Note that the input molecular</span>
<span class="sd">            coordinates will not be changed in this case.</span>
<span class="sd">        symmetry_subgroup : str</span>
<span class="sd">            subgroup</span>

<span class="sd">        atom : list or str</span>
<span class="sd">            To define molecular structure.  The internal format is</span>

<span class="sd">            | atom = [[atom1, (x, y, z)],</span>
<span class="sd">            |         [atom2, (x, y, z)],</span>
<span class="sd">            |         ...</span>
<span class="sd">            |         [atomN, (x, y, z)]]</span>

<span class="sd">        unit : str</span>
<span class="sd">            Angstrom or Bohr</span>
<span class="sd">        basis : dict or str</span>
<span class="sd">            To define basis set.</span>
<span class="sd">        nucmod : dict or str or [function(nuc_charge, nucprop) =&gt; zeta]</span>
<span class="sd">            Nuclear model.  0 or None means point nuclear model.  Other</span>
<span class="sd">            values will enable Gaussian nuclear model.  If a function is</span>
<span class="sd">            assigned to this attribute, the function will be called to</span>
<span class="sd">            generate the nuclear charge distribution value &quot;zeta&quot; and the</span>
<span class="sd">            relevant nuclear model will be set to Gaussian model.</span>
<span class="sd">            Default is point nuclear model.</span>
<span class="sd">        nucprop : dict</span>
<span class="sd">            Nuclear properties (like g-factor &#39;g&#39;, quadrupole moments &#39;Q&#39;).</span>
<span class="sd">            It is needed by pyscf.prop module and submodules.</span>
<span class="sd">        cart : boolean</span>
<span class="sd">            Using Cartesian GTO basis and integrals (6d,10f,15g)</span>
<span class="sd">        magmom : list</span>
<span class="sd">            Collinear spin of each atom. Default is [0,]*natm</span>

<span class="sd">        ** Following attributes are generated by :func:`Mole.build` **</span>

<span class="sd">        stdout : file object</span>
<span class="sd">            Default is sys.stdout if :attr:`Mole.output` is not set</span>
<span class="sd">        topgroup : str</span>
<span class="sd">            Point group of the system.</span>
<span class="sd">        groupname : str</span>
<span class="sd">            The supported subgroup of the point group. It can be one of SO3,</span>
<span class="sd">            Dooh, Coov, D2h, C2h, C2v, D2, Cs, Ci, C2, C1</span>
<span class="sd">        nelectron : int</span>
<span class="sd">            sum of nuclear charges - :attr:`Mole.charge`</span>
<span class="sd">        symm_orb : a list of numpy.ndarray</span>
<span class="sd">            Symmetry adapted basis.  Each element is a set of symm-adapted orbitals</span>
<span class="sd">            for one irreducible representation.  The list index does **not** correspond</span>
<span class="sd">            to the id of irreducible representation.</span>
<span class="sd">        irrep_id : a list of int</span>
<span class="sd">            Each element is one irreducible representation id associated with the basis</span>
<span class="sd">            stored in symm_orb.  One irrep id stands for one irreducible representation</span>
<span class="sd">            symbol.  The irrep symbol and the relevant id are defined in</span>
<span class="sd">            :attr:`symm.param.IRREP_ID_TABLE`</span>
<span class="sd">        irrep_name : a list of str</span>
<span class="sd">            Each element is one irreducible representation symbol associated with the basis</span>
<span class="sd">            stored in symm_orb.  The irrep symbols are defined in</span>
<span class="sd">            :attr:`symm.param.IRREP_ID_TABLE`</span>
<span class="sd">        _built : bool</span>
<span class="sd">            To label whether :func:`Mole.build` has been called.  It is to</span>
<span class="sd">            ensure certain functions being initialized only once.</span>
<span class="sd">        _basis : dict</span>
<span class="sd">            like :attr:`Mole.basis`, the internal format which is returned from the</span>
<span class="sd">            parser :func:`format_basis`</span>

<span class="sd">        ** Following attributes are arguments used by ``libcint`` library **</span>

<span class="sd">        _atm :</span>
<span class="sd">            :code:`[[charge, ptr-of-coord, nuc-model, ptr-zeta, 0, 0], [...]]`</span>
<span class="sd">            each element represents one atom</span>
<span class="sd">        natm :</span>
<span class="sd">            number of atoms</span>
<span class="sd">        _bas :</span>
<span class="sd">            :code:`[[atom-id, angular-momentum, num-primitive-GTO, num-contracted-GTO, 0, ptr-of-exps, ptr-of-contract-coeff, 0], [...]]`</span>
<span class="sd">            each element represents one shell</span>
<span class="sd">        nbas :</span>
<span class="sd">            number of shells</span>
<span class="sd">        _env :</span>
<span class="sd">            list of floats to store the coordinates, GTO exponents, contract-coefficients</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = Mole(atom=&#39;H^2 0 0 0; H 0 0 1.1&#39;, basis=&#39;sto3g&#39;).build()</span>
<span class="sd">    &gt;&gt;&gt; print(mol.atom_symbol(0))</span>
<span class="sd">    H^2</span>
<span class="sd">    &gt;&gt;&gt; print(mol.atom_pure_symbol(0))</span>
<span class="sd">    H</span>
<span class="sd">    &gt;&gt;&gt; print(mol.nao_nr())</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; print(mol.intor(&#39;int1e_ovlp_sph&#39;))</span>
<span class="sd">    [[ 0.99999999  0.43958641]</span>
<span class="sd">     [ 0.43958641  0.99999999]]</span>
<span class="sd">    &gt;&gt;&gt; mol.charge = 1</span>
<span class="sd">    &gt;&gt;&gt; mol.build()</span>
<span class="sd">    &lt;class &#39;pyscf.gto.mole.Mole&#39;&gt; has no attributes Charge</span>
<span class="sd">    &#39;&#39;&#39;</span>  <span class="c1"># noqa: E501</span>

    <span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">max_memory</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">MAX_MEMORY</span>

    <span class="n">verbose</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="s1">&#39;VERBOSE&#39;</span><span class="p">,</span> <span class="n">logger</span><span class="o">.</span><span class="n">NOTE</span><span class="p">)</span>

    <span class="c1"># the unit (angstrom/bohr) of the coordinates defined by the input self.atom</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="s1">&#39;UNIT&#39;</span><span class="p">,</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>

    <span class="c1"># Whether to hold everything in memory</span>
    <span class="n">incore_anyway</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="s1">&#39;INCORE_ANYWAY&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Using cartesian GTO (6d,10f,15g)</span>
    <span class="n">cart</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="s1">&#39;gto_mole_Mole_cart&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># 2j == nelec_alpha - nelec_beta</span>
    <span class="n">symmetry</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">symmetry_subgroup</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Store the keys appeared in the module.  It is used to check misinput attributes</span>
    <span class="n">_keys</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="s1">&#39;incore_anyway&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="s1">&#39;max_memory&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cart&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;spin&#39;</span><span class="p">,</span> <span class="s1">&#39;symmetry&#39;</span><span class="p">,</span> <span class="s1">&#39;symmetry_subgroup&#39;</span><span class="p">,</span>
        <span class="s1">&#39;atom&#39;</span><span class="p">,</span> <span class="s1">&#39;basis&#39;</span><span class="p">,</span> <span class="s1">&#39;nucmod&#39;</span><span class="p">,</span> <span class="s1">&#39;ecp&#39;</span><span class="p">,</span> <span class="s1">&#39;nucprop&#39;</span><span class="p">,</span> <span class="s1">&#39;magmom&#39;</span><span class="p">,</span> <span class="s1">&#39;pseudo&#39;</span><span class="p">,</span>
        <span class="s1">&#39;groupname&#39;</span><span class="p">,</span> <span class="s1">&#39;topgroup&#39;</span><span class="p">,</span> <span class="s1">&#39;symm_orb&#39;</span><span class="p">,</span> <span class="s1">&#39;irrep_id&#39;</span><span class="p">,</span> <span class="s1">&#39;irrep_name&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.atom = [(symb/nuc_charge, (coord(Angstrom):0.,0.,0.)), ...]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># self.basis = {atom_type/nuc_charge: [l, kappa, (expnt, c_1, c_2,..),..]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;sto-3g&#39;</span>
        <span class="c1"># self.nucmod = {atom_symbol: nuclear_model, atom_id: nuc_mod}, atom_id is 1-based</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nucmod</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># self.ecp = {atom_symbol: [[l, (r_order, expnt, c),...]]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Nuclear property. self.nucprop = {atom_symbol: {key: value}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nucprop</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Collinear spin of each atom. self.magmom = [0, ...]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magmom</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudo</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1">##################################################</span>
<span class="c1"># don&#39;t modify the following private variables, they are not input options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">PTR_ENV_START</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ecpbas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span> <span class="o">=</span> <span class="s1">&#39;C1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span> <span class="o">=</span> <span class="s1">&#39;C1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symm_orb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irrep_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irrep_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_symm_orig</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_symm_axes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nelectron</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nao</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enuc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atom</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ecp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pseudo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_built</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Some methods modify ._env. These method are executed in the context</span>
        <span class="c1"># _TemporaryMoleContext which is protected by the _ctx_lock.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ctx_lock</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">natm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nbas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nelec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nelectron</span>
        <span class="n">nalpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">ne</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">nbeta</span> <span class="o">=</span> <span class="n">nalpha</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">nalpha</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">nbeta</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nalpha</span> <span class="o">+</span> <span class="n">nbeta</span> <span class="o">!=</span> <span class="n">ne</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Electron number </span><span class="si">%d</span><span class="s1"> and spin </span><span class="si">%d</span><span class="s1"> are not consistent</span><span class="se">\n</span><span class="s1">&#39;</span>
                               <span class="s1">&#39;Note mol.spin = 2S = Nalpha - Nbeta, not 2S+1&#39;</span> <span class="o">%</span>
                               <span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">nalpha</span><span class="p">,</span> <span class="n">nbeta</span>
    <span class="nd">@nelec</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">nelec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">neleca_nelecb</span><span class="p">):</span>
        <span class="n">neleca</span><span class="p">,</span> <span class="n">nelecb</span> <span class="o">=</span> <span class="n">neleca_nelecb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nelectron</span> <span class="o">=</span> <span class="n">neleca</span> <span class="o">+</span> <span class="n">nelecb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="n">neleca</span> <span class="o">-</span> <span class="n">nelecb</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nelectron</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nelectron</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tot_electrons</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nelectron</span>
    <span class="nd">@nelectron</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">nelectron</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nelectron</span> <span class="o">=</span> <span class="n">n</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">multiplicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nd">@multiplicity</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">multiplicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Spin quantum number. multiplicity = ms*2+1&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">*</span> <span class="mf">.5</span>
    <span class="nd">@ms</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">enuc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;nuclear repulsion energy&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enuc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enuc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_nuc</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enuc</span>
    <span class="nd">@enuc</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">enuc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enuc</span> <span class="o">=</span> <span class="n">x</span>

    <span class="n">copy</span> <span class="o">=</span> <span class="n">copy</span>

    <span class="n">pack</span> <span class="o">=</span> <span class="n">pack</span>

<div class="viewcode-block" id="MoleBase.unpack">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.unpack">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@lib</span><span class="o">.</span><span class="n">with_doc</span><span class="p">(</span><span class="n">unpack</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">moldic</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unpack</span><span class="p">(</span><span class="n">moldic</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.unpack_">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.unpack_">[docs]</a>
    <span class="nd">@lib</span><span class="o">.</span><span class="n">with_doc</span><span class="p">(</span><span class="n">unpack</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unpack_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">moldic</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">moldic</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="n">dumps</span> <span class="o">=</span> <span class="n">dumps</span>

<div class="viewcode-block" id="MoleBase.loads">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.loads">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@lib</span><span class="o">.</span><span class="n">with_doc</span><span class="p">(</span><span class="n">loads</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">loads</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">molstr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">loads</span><span class="p">(</span><span class="n">molstr</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.loads_">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.loads_">[docs]</a>
    <span class="nd">@lib</span><span class="o">.</span><span class="n">with_doc</span><span class="p">(</span><span class="n">loads</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">loads_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molstr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loads</span><span class="p">(</span><span class="n">molstr</span><span class="p">)</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="c1"># when pickling, serialize as a JSON-formatted string</span>
    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">dumps</span>
    <span class="n">__setstate__</span> <span class="o">=</span> <span class="n">loads_</span>

<div class="viewcode-block" id="MoleBase.build">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.build">[docs]</a>
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parse_arg</span><span class="o">=</span><span class="n">ARGPARSE</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">atom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nucmod</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ecp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pseudo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">charge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">symmetry_subgroup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">cart</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">magmom</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Setup molecule and initialize some control parameters.  Whenever you</span>
<span class="sd">        change the value of the attributes of :class:`Mole`, you need call</span>
<span class="sd">        this function to refresh the internal data of Mole.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            dump_input : bool</span>
<span class="sd">                whether to dump the contents of input file in the output file</span>
<span class="sd">            parse_arg : bool</span>
<span class="sd">                whether to read the sys.argv and overwrite the relevant parameters</span>
<span class="sd">            verbose : int</span>
<span class="sd">                Print level.  If given, overwrite :attr:`Mole.verbose`</span>
<span class="sd">            output : str or None</span>
<span class="sd">                Output file.  If given, overwrite :attr:`Mole.output`</span>
<span class="sd">            max_memory : int, float</span>
<span class="sd">                Allowd memory in MB.  If given, overwrite :attr:`Mole.max_memory`</span>
<span class="sd">            atom : list or str</span>
<span class="sd">                To define molecular structure.</span>
<span class="sd">            basis : dict or str</span>
<span class="sd">                To define basis set.</span>
<span class="sd">            nucmod : dict or str</span>
<span class="sd">                Nuclear model.  If given, overwrite :attr:`Mole.nucmod`</span>
<span class="sd">            charge : int</span>
<span class="sd">                Charge of molecule. It affects the electron numbers</span>
<span class="sd">                If given, overwrite :attr:`Mole.charge`</span>
<span class="sd">            spin : int</span>
<span class="sd">                2S, num. alpha electrons - num. beta electrons to control</span>
<span class="sd">                multiplicity. If setting spin = None , multiplicity will be</span>
<span class="sd">                guessed based on the neutral molecule.</span>
<span class="sd">                If given, overwrite :attr:`Mole.spin`</span>
<span class="sd">            symmetry : bool or str</span>
<span class="sd">                Whether to use symmetry.  If given a string of point group</span>
<span class="sd">                name, the given point group symmetry will be used.</span>
<span class="sd">            magmom : list</span>
<span class="sd">                Collinear spin of each atom. Default is [0.0,]*natm</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dump_input</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Assigning the first argument </span><span class="si">%s</span><span class="s1"> to mol.atom</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                             <span class="n">dump_input</span><span class="p">)</span>
            <span class="n">dump_input</span><span class="p">,</span> <span class="n">atom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dump_input</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span>
        <span class="k">if</span> <span class="n">max_memory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="n">max_memory</span>
        <span class="k">if</span> <span class="n">atom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">atom</span>
        <span class="k">if</span> <span class="n">basis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="k">if</span> <span class="n">nucmod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucmod</span> <span class="o">=</span> <span class="n">nucmod</span>
        <span class="k">if</span> <span class="n">ecp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecp</span> <span class="o">=</span> <span class="n">ecp</span>
        <span class="k">if</span> <span class="n">pseudo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudo</span> <span class="o">=</span> <span class="n">pseudo</span>
        <span class="k">if</span> <span class="n">charge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">charge</span>
        <span class="k">if</span> <span class="n">spin</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="n">spin</span>
        <span class="k">if</span> <span class="n">symmetry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">symmetry</span>
        <span class="k">if</span> <span class="n">symmetry_subgroup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_subgroup</span> <span class="o">=</span> <span class="n">symmetry_subgroup</span>
        <span class="k">if</span> <span class="n">cart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cart</span> <span class="o">=</span> <span class="n">cart</span>
        <span class="k">if</span> <span class="n">magmom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">magmom</span> <span class="o">=</span> <span class="n">magmom</span>

        <span class="k">if</span> <span class="n">parse_arg</span><span class="p">:</span>
            <span class="n">_update_from_cmdargs_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># avoid opening output file twice</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="c1"># StringIO() does not have attribute &#39;name&#39;</span>
            <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="n">logger</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;overwrite output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;output file: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;/dev/null&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="n">logger</span><span class="o">.</span><span class="n">WARN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_sanity</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_atom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="n">uniq_atoms</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atom</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">:</span>
            <span class="n">_basis</span> <span class="o">=</span> <span class="n">_parse_default_basis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span> <span class="n">uniq_atoms</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_basis</span><span class="p">(</span><span class="n">_basis</span><span class="p">)</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[:</span><span class="n">PTR_ENV_START</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">make_env</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucmod</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">nucprop</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudo</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ecp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudo</span> <span class="o">=</span> <span class="n">classify_ecp_pseudo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudo</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecp</span><span class="p">:</span>
            <span class="c1"># Unless explicitly input, ECP should not be assigned to ghost atoms</span>
            <span class="n">atoms_wo_ghost</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">uniq_atoms</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_ghost_atom</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
            <span class="n">_ecp</span> <span class="o">=</span> <span class="n">_parse_default_basis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ecp</span><span class="p">,</span> <span class="n">atoms_wo_ghost</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ecp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_ecp</span><span class="p">(</span><span class="n">_ecp</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ecp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">make_ecp_env</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ecp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudo</span><span class="p">:</span>
            <span class="c1"># Unless explicitly input, PP should not be assigned to ghost atoms</span>
            <span class="n">atoms_wo_ghost</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">uniq_atoms</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_ghost_atom</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
            <span class="n">_pseudo</span> <span class="o">=</span> <span class="n">_parse_default_basis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudo</span><span class="p">,</span> <span class="n">atoms_wo_ghost</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pseudo</span> <span class="o">=</span> <span class="n">_pseudo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_pseudo</span><span class="p">(</span><span class="n">_pseudo</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_pseudo</span><span class="p">:</span>
                <span class="n">conflicts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_pseudo</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ecp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">conflicts</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Pseudo potential for atoms </span><span class="si">%s</span><span class="s1"> are defined &#39;</span>
                                       <span class="s1">&#39;in both .ecp and .pseudo.&#39;</span> <span class="o">%</span> <span class="nb">list</span><span class="p">(</span><span class="n">conflicts</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">ia</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom</span><span class="p">):</span>
                    <span class="n">symb</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">symb</span> <span class="ow">in</span> <span class="n">_pseudo</span> <span class="ow">and</span>
                        <span class="c1"># skip ghost atoms</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">_pseudo</span><span class="p">[</span><span class="n">symb</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">%</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Access self.nelec in which the code checks whether the spin and</span>
            <span class="c1"># number of electrons are consistent.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nelec</span>

        <span class="c1"># reset nuclear energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enuc</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">magmom</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magmom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">natm</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magmom</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">natm</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;len(magmom) != natm. Set magmom to zero&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magmom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">natm</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magmom</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magmom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">magmom</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magmom</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
            <span class="c1">#don&#39;t check for unrestricted calcs.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mol.magmom is set incorrectly.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_symmetry</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">dump_input</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_built</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="n">logger</span><span class="o">.</span><span class="n">NOTE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_input</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="n">logger</span><span class="o">.</span><span class="n">DEBUG3</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;arg.atm = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;arg.bas = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;arg.env = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ecpbas  = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_built</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="n">kernel</span> <span class="o">=</span> <span class="n">build</span>

    <span class="k">def</span> <span class="nf">_build_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update symmetry related attributes: topgroup, groupname, _symm_orig,</span>
<span class="sd">        _symm_axes, irrep_id, irrep_name, symm_orb</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">symm</span>

        <span class="c1"># TODO: Consider ECP info in point group symmetry initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">symm</span><span class="o">.</span><span class="n">detect_symm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">symm</span><span class="o">.</span><span class="n">std_symb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">))</span>
            <span class="n">groupname</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">axes</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">symm</span><span class="o">.</span><span class="n">TOLERANCE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">symm</span><span class="o">.</span><span class="n">check_symm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span><span class="p">):</span>
                    <span class="c1"># Try to use original axes (issue #1209)</span>
                    <span class="n">groupname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span>
                    <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Unable to to identify input symmetry using original axes.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Different symmetry axes will be used.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">groupname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">groupname</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">symm</span><span class="o">.</span><span class="n">as_subgroup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">PointGroupSymmetryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PointGroupSymmetryError</span><span class="p">(</span>
                        <span class="s1">&#39;Unable to identify input symmetry </span><span class="si">%s</span><span class="s1">. Try symmetry=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">))</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">groupname</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">symm</span><span class="o">.</span><span class="n">as_subgroup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_subgroup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_symm_orig</span> <span class="o">=</span> <span class="n">orig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_symm_axes</span> <span class="o">=</span> <span class="n">axes</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cart</span> <span class="ow">and</span> <span class="n">groupname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Dooh&#39;</span><span class="p">,</span> <span class="s1">&#39;Coov&#39;</span><span class="p">,</span> <span class="s1">&#39;SO3&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">groupname</span> <span class="o">==</span> <span class="s1">&#39;Coov&#39;</span><span class="p">:</span>
                <span class="n">groupname</span><span class="p">,</span> <span class="n">lgroup</span> <span class="o">=</span> <span class="s1">&#39;C2v&#39;</span><span class="p">,</span> <span class="n">groupname</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">groupname</span><span class="p">,</span> <span class="n">lgroup</span> <span class="o">=</span> <span class="s1">&#39;D2h&#39;</span><span class="p">,</span> <span class="n">groupname</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;This version does not support symmetry </span><span class="si">%s</span><span class="s1"> &#39;</span>
                        <span class="s1">&#39;for cartesian GTO basis. Its subgroup </span><span class="si">%s</span><span class="s1"> is used&#39;</span><span class="p">,</span>
                        <span class="n">lgroup</span><span class="p">,</span> <span class="n">groupname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span> <span class="o">=</span> <span class="n">groupname</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">symm_orb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">irrep_id</span> <span class="o">=</span> \
                <span class="n">symm</span><span class="o">.</span><span class="n">symm_adapted_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupname</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irrep_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">symm</span><span class="o">.</span><span class="n">irrep_id2name</span><span class="p">(</span><span class="n">groupname</span><span class="p">,</span> <span class="n">ir</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">irrep_id</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="n">format_atom</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">format_atom</span><span class="p">)</span>
    <span class="n">format_basis</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">format_basis</span><span class="p">)</span>
    <span class="n">format_pseudo</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">format_pseudo</span><span class="p">)</span>
    <span class="n">format_ecp</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">format_ecp</span><span class="p">)</span>
    <span class="n">expand_etb</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">expand_etb</span><span class="p">)</span>
    <span class="n">expand_etbs</span> <span class="o">=</span> <span class="n">etbs</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">expand_etbs</span><span class="p">)</span>

<div class="viewcode-block" id="MoleBase.make_env">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.make_env">[docs]</a>
    <span class="nd">@lib</span><span class="o">.</span><span class="n">with_doc</span><span class="p">(</span><span class="n">make_env</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">make_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">pre_env</span><span class="o">=</span><span class="p">[],</span> <span class="n">nucmod</span><span class="o">=</span><span class="p">{},</span> <span class="n">nucprop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nucprop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nucprop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucprop</span>
        <span class="k">return</span> <span class="n">make_env</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">pre_env</span><span class="p">,</span> <span class="n">nucmod</span><span class="p">,</span> <span class="n">nucprop</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.make_atm_env">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.make_atm_env">[docs]</a>
    <span class="nd">@lib</span><span class="o">.</span><span class="n">with_doc</span><span class="p">(</span><span class="n">make_atm_env</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">make_atm_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nucmod</span><span class="o">=</span><span class="n">NUC_POINT</span><span class="p">,</span> <span class="n">nucprop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nucprop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nucprop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucprop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="n">make_atm_env</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">nucmod</span><span class="p">,</span> <span class="n">nucprop</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.make_bas_env">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.make_bas_env">[docs]</a>
    <span class="nd">@lib</span><span class="o">.</span><span class="n">with_doc</span><span class="p">(</span><span class="n">make_bas_env</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">make_bas_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basis_add</span><span class="p">,</span> <span class="n">atom_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">make_bas_env</span><span class="p">(</span><span class="n">basis_add</span><span class="p">,</span> <span class="n">atom_id</span><span class="p">,</span> <span class="n">ptr</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.make_ecp_env">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.make_ecp_env">[docs]</a>
    <span class="nd">@lib</span><span class="o">.</span><span class="n">with_doc</span><span class="p">(</span><span class="n">make_ecp_env</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">make_ecp_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_atm</span><span class="p">,</span> <span class="n">_ecp</span><span class="p">,</span> <span class="n">pre_env</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">if</span> <span class="n">_ecp</span><span class="p">:</span>
            <span class="n">_atm</span><span class="p">,</span> <span class="n">_ecpbas</span><span class="p">,</span> <span class="n">_env</span> <span class="o">=</span> <span class="n">make_ecp_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_atm</span><span class="p">,</span> <span class="n">_ecp</span><span class="p">,</span> <span class="n">pre_env</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_atm</span><span class="p">,</span> <span class="n">_ecpbas</span><span class="p">,</span> <span class="n">_env</span> <span class="o">=</span> <span class="n">_atm</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">BAS_SLOTS</span><span class="p">)),</span> <span class="n">pre_env</span>
        <span class="k">return</span> <span class="n">_atm</span><span class="p">,</span> <span class="n">_ecpbas</span><span class="p">,</span> <span class="n">_env</span></div>


    <span class="n">tot_electrons</span> <span class="o">=</span> <span class="n">tot_electrons</span>

<div class="viewcode-block" id="MoleBase.gto_norm">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.gto_norm">[docs]</a>
    <span class="nd">@lib</span><span class="o">.</span><span class="n">with_doc</span><span class="p">(</span><span class="n">gto_norm</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">gto_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">expnt</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">gto_norm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">expnt</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.dump_input">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.dump_input">[docs]</a>
    <span class="k">def</span> <span class="nf">dump_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">__main__</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">__main__</span><span class="p">,</span> <span class="s1">&#39;__file__&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__main__</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>
                <span class="n">finput</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#INFO: **** input file is </span><span class="si">%s</span><span class="s1"> ****</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">finput</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#INFO: ******************** input file end ********************</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">finput</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;input file does not exist&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lib</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">format_sys_info</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;PYSCF&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[ENV] </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="n">logger</span><span class="o">.</span><span class="n">DEBUG2</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">__config__</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;__&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[CONFIG] </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                                      <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="n">key</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">conf_file</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__config__</span><span class="p">,</span> <span class="s1">&#39;conf_file&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[CONFIG] conf_file </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">conf_file</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] verbose = </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="n">logger</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] max_memory = </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_memory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] num. atoms = </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">natm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] num. electrons = </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nelectron</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] charge = </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] spin (= nelec alpha-beta = 2S) = </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] symmetry </span><span class="si">%s</span><span class="s1"> subgroup </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                          <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_subgroup</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] Mole.unit = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cart</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] Cartesian GTO integrals (6d 10f)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] Symbol           X                Y                Z      unit&#39;</span>
                          <span class="s1">&#39;          X                Y                Z       unit  Magmom</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ia</span><span class="p">,</span><span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom</span><span class="p">):</span>
            <span class="n">coorda</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">x</span> <span class="o">*</span> <span class="n">param</span><span class="o">.</span><span class="n">BOHR</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">coordb</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">magmom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">magmom</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT]</span><span class="si">%3d</span><span class="s1"> </span><span class="si">%-4s</span><span class="s1"> </span><span class="si">%16.12f</span><span class="s1"> </span><span class="si">%16.12f</span><span class="s1"> </span><span class="si">%16.12f</span><span class="s1"> AA  &#39;</span>
                              <span class="s1">&#39;</span><span class="si">%16.12f</span><span class="s1"> </span><span class="si">%16.12f</span><span class="s1"> </span><span class="si">%16.12f</span><span class="s1"> Bohr  </span><span class="si">%4.1f</span><span class="se">\n</span><span class="s1">&#39;</span>
                              <span class="o">%</span> <span class="p">((</span><span class="n">ia</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">_symbol</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">coorda</span> <span class="o">+</span> <span class="n">coordb</span> <span class="o">+</span> <span class="p">(</span><span class="n">magmom</span><span class="p">,)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucmod</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nucmod</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">)):</span>
                <span class="n">nucatms</span> <span class="o">=</span> <span class="p">[</span><span class="n">_symbol</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atom</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nucatms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucmod</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] Gaussian nuclear model for atoms </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                              <span class="n">nucatms</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucprop</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] nucprop </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucprop</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="n">logger</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] ---------------- BASIS SET ---------------- </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] l, kappa, [nprim/nctr], &#39;</span>
                              <span class="s1">&#39;expnt,             c_1 c_2 ...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">atom</span><span class="p">,</span> <span class="n">basis_set</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">atom</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">basis_set</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="n">kappa</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">b_coeff</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">kappa</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">b_coeff</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">nprim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_coeff</span><span class="p">)</span>
                    <span class="n">nctr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">nprim</span> <span class="o">&lt;</span> <span class="n">nctr</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;num. primitives smaller than num. contracted basis&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[INPUT] </span><span class="si">%d</span><span class="s1">   </span><span class="si">%2d</span><span class="s1">    [</span><span class="si">%-5d</span><span class="s1">/</span><span class="si">%-4d</span><span class="s1">]  &#39;</span>
                                      <span class="o">%</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nprim</span><span class="p">,</span> <span class="n">nctr</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b_coeff</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-15.12g</span><span class="s1">  &#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">32</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">%-15.12g</span><span class="s1">  &#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%4.12g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nuclear repulsion = </span><span class="si">%.15g</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enuc</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;point group symmetry = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;point group symmetry = </span><span class="si">%s</span><span class="s1">, use subgroup </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;symmetry origin: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symm_orig</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;symmetry axis x: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symm_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;symmetry axis y: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symm_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;symmetry axis z: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symm_axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symm_orb</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;num. orbitals of irrep </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">irrep_name</span><span class="p">[</span><span class="n">ir</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">symm_orb</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;number of shells = </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbas</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;number of NR pGTOs = </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npgto_nr</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;number of NR cGTOs = </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;basis = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ecp = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecp</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="n">logger</span><span class="o">.</span><span class="n">DEBUG2</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">)):</span>
                <span class="n">exps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_exp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;bas </span><span class="si">%d</span><span class="s1">, expnt(s) = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exps</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;CPU time: </span><span class="si">%12.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">logger</span><span class="o">.</span><span class="n">process_clock</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="MoleBase.set_common_origin">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.set_common_origin">[docs]</a>
    <span class="k">def</span> <span class="nf">set_common_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Update common origin for integrals of dipole, rxp etc.</span>
<span class="sd">        **Note** the unit of the coordinates needs to be Bohr</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.set_common_origin(0)</span>
<span class="sd">        &gt;&gt;&gt; mol.set_common_origin((1,0,0))</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_COMMON_ORIG</span><span class="p">:</span><span class="n">PTR_COMMON_ORIG</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="n">set_common_orig</span> <span class="o">=</span> <span class="n">set_common_origin</span>
    <span class="n">set_common_orig_</span> <span class="o">=</span> <span class="n">set_common_orig</span>    <span class="c1"># for backward compatibility</span>
    <span class="n">set_common_origin_</span> <span class="o">=</span> <span class="n">set_common_orig</span>  <span class="c1"># for backward compatibility</span>

<div class="viewcode-block" id="MoleBase.with_common_origin">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.with_common_origin">[docs]</a>
    <span class="k">def</span> <span class="nf">with_common_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Return a temporary mol context which has the rquired common origin.</span>
<span class="sd">        The required common origin has no effects out of the temporary context.</span>
<span class="sd">        See also :func:`mol.set_common_origin`</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; with mol.with_common_origin((1,0,0)):</span>
<span class="sd">        ...     mol.intor(&#39;int1e_r&#39;, comp=3)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">coord0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_COMMON_ORIG</span><span class="p">:</span><span class="n">PTR_COMMON_ORIG</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TemporaryMoleContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_common_origin</span><span class="p">,</span> <span class="p">(</span><span class="n">coord</span><span class="p">,),</span> <span class="p">(</span><span class="n">coord0</span><span class="p">,))</span></div>

    <span class="n">with_common_orig</span> <span class="o">=</span> <span class="n">with_common_origin</span>

<div class="viewcode-block" id="MoleBase.set_rinv_origin">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.set_rinv_origin">[docs]</a>
    <span class="k">def</span> <span class="nf">set_rinv_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Update origin for operator :math:`\frac{1}{|r-R_O|}`.</span>
<span class="sd">        **Note** the unit is Bohr</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.set_rinv_origin(0)</span>
<span class="sd">        &gt;&gt;&gt; mol.set_rinv_origin((0,1,0))</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RINV_ORIG</span><span class="p">:</span><span class="n">PTR_RINV_ORIG</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="n">set_rinv_orig</span> <span class="o">=</span> <span class="n">set_rinv_origin</span>
    <span class="n">set_rinv_orig_</span> <span class="o">=</span> <span class="n">set_rinv_orig</span>    <span class="c1"># for backward compatibility</span>
    <span class="n">set_rinv_origin_</span> <span class="o">=</span> <span class="n">set_rinv_orig</span>  <span class="c1"># for backward compatibility</span>

<div class="viewcode-block" id="MoleBase.with_rinv_origin">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.with_rinv_origin">[docs]</a>
    <span class="k">def</span> <span class="nf">with_rinv_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Return a temporary mol context which has the rquired origin of 1/r</span>
<span class="sd">        operator.  The required origin has no effects out of the temporary</span>
<span class="sd">        context.  See also :func:`mol.set_rinv_origin`</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; with mol.with_rinv_origin((1,0,0)):</span>
<span class="sd">        ...     mol.intor(&#39;int1e_rinv&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">coord0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RINV_ORIG</span><span class="p">:</span><span class="n">PTR_RINV_ORIG</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TemporaryMoleContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_rinv_origin</span><span class="p">,</span> <span class="p">(</span><span class="n">coord</span><span class="p">,),</span> <span class="p">(</span><span class="n">coord0</span><span class="p">,))</span></div>

    <span class="n">with_rinv_orig</span> <span class="o">=</span> <span class="n">with_rinv_origin</span>

<div class="viewcode-block" id="MoleBase.set_range_coulomb">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.set_range_coulomb">[docs]</a>
    <span class="k">def</span> <span class="nf">set_range_coulomb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">omega</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Switch on range-separated Coulomb operator for **all** 2e integrals</span>

<span class="sd">        Args:</span>
<span class="sd">            omega : double</span>

<span class="sd">                | = 0 : Regular electron repulsion integral</span>
<span class="sd">                | &gt; 0 : Long-range operator  erf(omega r12) / r12</span>
<span class="sd">                | &lt; 0 : Short-range operator  erfc(omega r12) /r12</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">omega</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RANGE_OMEGA</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega</span></div>

    <span class="n">set_range_coulomb_</span> <span class="o">=</span> <span class="n">set_range_coulomb</span>  <span class="c1"># for backward compatibility</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">omega</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RANGE_OMEGA</span><span class="p">]</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span><span class="o">.</span><span class="n">setter</span><span class="p">(</span><span class="n">set_range_coulomb</span><span class="p">)</span>

<div class="viewcode-block" id="MoleBase.with_range_coulomb">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.with_range_coulomb">[docs]</a>
    <span class="k">def</span> <span class="nf">with_range_coulomb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">omega</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Return a temporary mol context which sets the required parameter</span>
<span class="sd">        omega for range-separated Coulomb operator.</span>
<span class="sd">        If omega = None, return the context for regular Coulomb integrals.</span>
<span class="sd">        See also :func:`mol.set_range_coulomb`</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; with mol.with_range_coulomb(omega=1.5):</span>
<span class="sd">        ...     mol.intor(&#39;int2e&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">omega</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">nullcontext</span><span class="p">()</span>
        <span class="n">omega0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RANGE_OMEGA</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TemporaryMoleContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_range_coulomb</span><span class="p">,</span> <span class="p">(</span><span class="n">omega</span><span class="p">,),</span> <span class="p">(</span><span class="n">omega0</span><span class="p">,))</span></div>


<div class="viewcode-block" id="MoleBase.with_long_range_coulomb">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.with_long_range_coulomb">[docs]</a>
    <span class="k">def</span> <span class="nf">with_long_range_coulomb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">omega</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Return a temporary mol context for long-range part of</span>
<span class="sd">        range-separated Coulomb operator.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">omega</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">nullcontext</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_range_coulomb</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span></div>


<div class="viewcode-block" id="MoleBase.with_short_range_coulomb">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.with_short_range_coulomb">[docs]</a>
    <span class="k">def</span> <span class="nf">with_short_range_coulomb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">omega</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Return a temporary mol context for short-range part of</span>
<span class="sd">        range-separated Coulomb operator.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">omega</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">nullcontext</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_range_coulomb</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span></div>


<div class="viewcode-block" id="MoleBase.set_f12_zeta">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.set_f12_zeta">[docs]</a>
    <span class="k">def</span> <span class="nf">set_f12_zeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zeta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Set zeta for YP exp(-zeta r12)/r12 or STG exp(-zeta r12) type integrals</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_F12_ZETA</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeta</span></div>


<div class="viewcode-block" id="MoleBase.set_nuc_mod">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.set_nuc_mod">[docs]</a>
    <span class="k">def</span> <span class="nf">set_nuc_mod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">zeta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Change the nuclear charge distribution of the given atom ID.  The charge</span>
<span class="sd">        distribution is defined as: rho(r) = nuc_charge * Norm * exp(-zeta * r^2).</span>
<span class="sd">        This function can **only** be called after .build() method is executed.</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; for ia in range(mol.natm):</span>
<span class="sd">        ...     zeta = gto.filatov_nuc_mod(mol.atom_charge(ia))</span>
<span class="sd">        ...     mol.set_nuc_mod(ia, zeta)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">PTR_ZETA</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeta</span>
        <span class="k">if</span> <span class="n">zeta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">NUC_POINT</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">NUC_GAUSS</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="n">set_nuc_mod_</span> <span class="o">=</span> <span class="n">set_nuc_mod</span>  <span class="c1"># for backward compatibility</span>

<div class="viewcode-block" id="MoleBase.set_rinv_zeta">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.set_rinv_zeta">[docs]</a>
    <span class="k">def</span> <span class="nf">set_rinv_zeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zeta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Assume the charge distribution on the &quot;rinv_origin&quot;.  zeta is the parameter</span>
<span class="sd">        to control the charge distribution: rho(r) = Norm * exp(-zeta * r^2).</span>
<span class="sd">        **Be careful** when call this function. It affects the behavior of</span>
<span class="sd">        int1e_rinv_* functions.  Make sure to set it back to 0 after using it!</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RINV_ZETA</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeta</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="n">set_rinv_zeta_</span> <span class="o">=</span> <span class="n">set_rinv_zeta</span>  <span class="c1"># for backward compatibility</span>

<div class="viewcode-block" id="MoleBase.with_rinv_zeta">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.with_rinv_zeta">[docs]</a>
    <span class="k">def</span> <span class="nf">with_rinv_zeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zeta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Return a temporary mol context which has the rquired Gaussian charge</span>
<span class="sd">        distribution placed at &quot;rinv_origin&quot;: rho(r) = Norm * exp(-zeta * r^2).</span>
<span class="sd">        See also :func:`mol.set_rinv_zeta`</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; with mol.with_rinv_zeta(zeta=1.5), mol.with_rinv_origin((1.,0,0)):</span>
<span class="sd">        ...     mol.intor(&#39;int1e_rinv&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">zeta0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RINV_ZETA</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TemporaryMoleContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_rinv_zeta</span><span class="p">,</span> <span class="p">(</span><span class="n">zeta</span><span class="p">,),</span> <span class="p">(</span><span class="n">zeta0</span><span class="p">,))</span></div>


<div class="viewcode-block" id="MoleBase.with_rinv_at_nucleus">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.with_rinv_at_nucleus">[docs]</a>
    <span class="k">def</span> <span class="nf">with_rinv_at_nucleus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Return a temporary mol context in which the rinv operator (1/r) is</span>
<span class="sd">        treated like the Coulomb potential of a Gaussian charge distribution</span>
<span class="sd">        rho(r) = Norm * exp(-zeta * r^2) at the place of the input atm_id.</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; with mol.with_rinv_at_nucleus(3):</span>
<span class="sd">        ...     mol.intor(&#39;int1e_rinv&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">PTR_ZETA</span><span class="p">]]</span>
        <span class="n">rinv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_coord</span><span class="p">(</span><span class="n">atm_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zeta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">AS_RINV_ORIG_ATOM</span><span class="p">]</span> <span class="o">=</span> <span class="n">atm_id</span>  <span class="c1"># required by ecp gradients</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_rinv_origin</span><span class="p">(</span><span class="n">rinv</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">AS_RINV_ORIG_ATOM</span><span class="p">]</span> <span class="o">=</span> <span class="n">atm_id</span>  <span class="c1"># required by ecp gradients</span>
            <span class="n">rinv0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RINV_ORIG</span><span class="p">:</span><span class="n">PTR_RINV_ORIG</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">zeta0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RINV_ZETA</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">set_rinv</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RINV_ZETA</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RINV_ORIG</span><span class="p">:</span><span class="n">PTR_RINV_ORIG</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TemporaryMoleContext</span><span class="p">(</span><span class="n">set_rinv</span><span class="p">,</span> <span class="p">(</span><span class="n">zeta</span><span class="p">,</span><span class="n">rinv</span><span class="p">),</span> <span class="p">(</span><span class="n">zeta0</span><span class="p">,</span><span class="n">rinv0</span><span class="p">))</span></div>

    <span class="n">with_rinv_as_nucleus</span> <span class="o">=</span> <span class="n">with_rinv_at_nucleus</span>  <span class="c1"># For backward compatibility</span>

<div class="viewcode-block" id="MoleBase.with_integral_screen">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.with_integral_screen">[docs]</a>
    <span class="k">def</span> <span class="nf">with_integral_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Return a temporary mol context which has the required integral</span>
<span class="sd">        screen threshold</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This calls the default cutoff settings in cint library</span>
            <span class="n">expcutoff</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expcutoff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">threshold</span><span class="p">))</span>
        <span class="n">expcutoff0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_EXPCUTOFF</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">set_cutoff</span><span class="p">(</span><span class="n">cut</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_EXPCUTOFF</span><span class="p">]</span> <span class="o">=</span> <span class="n">cut</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TemporaryMoleContext</span><span class="p">(</span><span class="n">set_cutoff</span><span class="p">,</span> <span class="p">(</span><span class="n">expcutoff</span><span class="p">,),</span> <span class="p">(</span><span class="n">expcutoff0</span><span class="p">,))</span></div>


<div class="viewcode-block" id="MoleBase.set_geom_">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.set_geom_">[docs]</a>
    <span class="k">def</span> <span class="nf">set_geom_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms_or_coords</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Update geometry</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">unit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="k">if</span> <span class="n">symmetry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">symmetry</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms_or_coords</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">_atom</span><span class="p">],</span>
                                <span class="n">atoms_or_coords</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">atoms_or_coords</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms_or_coords</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">symmetry</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">is_au</span><span class="p">(</span><span class="n">unit</span><span class="p">):</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">param</span><span class="o">.</span><span class="n">BOHR</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">unit</span>

            <span class="n">mol</span><span class="o">.</span><span class="n">_atom</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">_atom</span><span class="p">],</span>
                                 <span class="p">(</span><span class="n">atoms_or_coords</span> <span class="o">*</span> <span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
            <span class="n">ptr</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">_atm</span><span class="p">[:,</span><span class="n">PTR_COORD</span><span class="p">]</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span> <span class="o">*</span> <span class="n">atoms_or_coords</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span> <span class="o">*</span> <span class="n">atoms_or_coords</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span> <span class="o">*</span> <span class="n">atoms_or_coords</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">symmetry</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># reset nuclear energy</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">enuc</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;New geometry&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ia</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_atom</span><span class="p">):</span>
                <span class="n">coorda</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">x</span> <span class="o">*</span> <span class="n">param</span><span class="o">.</span><span class="n">BOHR</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">coordb</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="n">coorda</span> <span class="o">+</span> <span class="n">coordb</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39; </span><span class="si">%3d</span><span class="s1"> </span><span class="si">%-4s</span><span class="s1"> </span><span class="si">%16.12f</span><span class="s1"> </span><span class="si">%16.12f</span><span class="s1"> </span><span class="si">%16.12f</span><span class="s1"> AA  &#39;</span>
                            <span class="s1">&#39;</span><span class="si">%16.12f</span><span class="s1"> </span><span class="si">%16.12f</span><span class="s1"> </span><span class="si">%16.12f</span><span class="s1"> Bohr</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                            <span class="n">ia</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">),</span> <span class="o">*</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mol</span></div>


<div class="viewcode-block" id="MoleBase.update">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.update">[docs]</a>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chkfile</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_from_chk</span><span class="p">(</span><span class="n">chkfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="MoleBase.update_from_chk">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.update_from_chk">[docs]</a>
    <span class="k">def</span> <span class="nf">update_from_chk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chkfile</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">chkfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh5</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">fh5</span><span class="p">[</span><span class="s1">&#39;mol&#39;</span><span class="p">][()])</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="MoleBase.has_ecp">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.has_ecp">[docs]</a>
    <span class="k">def</span> <span class="nf">has_ecp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Whether pseudo potential is used in the system.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pseudo</span></div>


<div class="viewcode-block" id="MoleBase.has_ecp_soc">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.has_ecp_soc">[docs]</a>
    <span class="k">def</span> <span class="nf">has_ecp_soc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Whether spin-orbit coupling is enabled in ECP.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">[:,</span><span class="n">SO_TYPE_OF</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span></div>



<div class="viewcode-block" id="MoleBase.atom_symbol">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.atom_symbol">[docs]</a>
    <span class="k">def</span> <span class="nf">atom_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;For the given atom id, return the input symbol (without striping special characters)</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H^2 0 0 0; H 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_symbol(0)</span>
<span class="sd">        H^2</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">_symbol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom</span><span class="p">[</span><span class="n">atm_id</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="MoleBase.atom_pure_symbol">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.atom_pure_symbol">[docs]</a>
    <span class="k">def</span> <span class="nf">atom_pure_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;For the given atom id, return the standard symbol (striping special characters)</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H^2 0 0 0; H 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_symbol(0)</span>
<span class="sd">        H</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">_std_symbol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom</span><span class="p">[</span><span class="n">atm_id</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;A list of elements in the molecule&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_pure_symbol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">natm</span><span class="p">)]</span>

<div class="viewcode-block" id="MoleBase.atom_charge">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.atom_charge">[docs]</a>
    <span class="k">def</span> <span class="nf">atom_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Nuclear effective charge of the given atom id</span>
<span class="sd">        Note &quot;atom_charge /= charge(atom_symbol)&quot; when ECP is enabled.</span>
<span class="sd">        Number of electrons screened by ECP can be obtained by charge(atom_symbol)-atom_charge</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_charge(1)</span>
<span class="sd">        17</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">!=</span> <span class="n">NUC_FRAC_CHARGE</span><span class="p">:</span>
            <span class="c1"># regular QM atoms</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">CHARGE_OF</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># MM atoms with fractional charges</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">PTR_FRAC_CHARGE</span><span class="p">]]</span></div>


<div class="viewcode-block" id="MoleBase.atom_charges">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.atom_charges">[docs]</a>
    <span class="k">def</span> <span class="nf">atom_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;np.asarray([mol.atom_charge(i) for i in range(mol.natm)])&#39;&#39;&#39;</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[:,</span><span class="n">CHARGE_OF</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[:,</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">==</span> <span class="n">NUC_FRAC_CHARGE</span><span class="p">):</span>
            <span class="c1"># Create the integer nuclear charges first then replace the MM</span>
            <span class="c1"># particles with the MM charges that saved in _env[PTR_FRAC_CHARGE]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[:,</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">==</span> <span class="n">NUC_FRAC_CHARGE</span>
            <span class="c1"># MM fractional charges can be positive or negative</span>
            <span class="n">z</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">PTR_FRAC_CHARGE</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">z</span></div>


<div class="viewcode-block" id="MoleBase.atom_nelec_core">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.atom_nelec_core">[docs]</a>
    <span class="k">def</span> <span class="nf">atom_nelec_core</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Number of core electrons for pseudo potential.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">charge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">atm_id</span><span class="p">))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_charge</span><span class="p">(</span><span class="n">atm_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.atom_coord">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.atom_coord">[docs]</a>
    <span class="k">def</span> <span class="nf">atom_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Bohr&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Coordinates (ndarray) of the given atom id</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_coord(1)</span>
<span class="sd">        [ 0.          0.          2.07869874]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">PTR_COORD</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_au</span><span class="p">(</span><span class="n">unit</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="p">:</span><span class="n">ptr</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">param</span><span class="o">.</span><span class="n">BOHR</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="p">:</span><span class="n">ptr</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="MoleBase.atom_coords">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.atom_coords">[docs]</a>
    <span class="k">def</span> <span class="nf">atom_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Bohr&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;np.asarray([mol.atom_coord(i) for i in range(mol.natm)])&#39;&#39;&#39;</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[:,</span><span class="n">PTR_COORD</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ptr</span><span class="p">,</span><span class="n">ptr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ptr</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_au</span><span class="p">(</span><span class="n">unit</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">*=</span> <span class="n">param</span><span class="o">.</span><span class="n">BOHR</span>
        <span class="k">return</span> <span class="n">c</span></div>


    <span class="n">atom_mass_list</span> <span class="o">=</span> <span class="n">atom_mass_list</span>

<div class="viewcode-block" id="MoleBase.atom_nshells">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.atom_nshells">[docs]</a>
    <span class="k">def</span> <span class="nf">atom_nshells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Number of basis/shells of the given atom</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_nshells(1)</span>
<span class="sd">        5</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ATOM_OF</span><span class="p">]</span> <span class="o">==</span> <span class="n">atm_id</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>


<div class="viewcode-block" id="MoleBase.atom_shell_ids">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.atom_shell_ids">[docs]</a>
    <span class="k">def</span> <span class="nf">atom_shell_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;A list of the shell-ids of the given atom</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_shell_ids(1)</span>
<span class="sd">        [3, 4, 5, 6, 7]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ATOM_OF</span><span class="p">]</span> <span class="o">==</span> <span class="n">atm_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoleBase.bas_coord">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.bas_coord">[docs]</a>
    <span class="k">def</span> <span class="nf">bas_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Coordinates (ndarray) associated with the given basis id</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_coord(1)</span>
<span class="sd">        [ 0.          0.          2.07869874]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">atm_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_atom</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">PTR_COORD</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="p">:</span><span class="n">ptr</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="MoleBase.bas_atom">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.bas_atom">[docs]</a>
    <span class="k">def</span> <span class="nf">bas_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;The atom (0-based id) that the given basis sits on</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_atom(7)</span>
<span class="sd">        1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">ATOM_OF</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="MoleBase.bas_angular">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.bas_angular">[docs]</a>
    <span class="k">def</span> <span class="nf">bas_angular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;The angular momentum associated with the given basis</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_atom(7)</span>
<span class="sd">        2</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">ANG_OF</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="MoleBase.bas_nctr">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.bas_nctr">[docs]</a>
    <span class="k">def</span> <span class="nf">bas_nctr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;The number of contracted GTOs for the given shell</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_atom(3)</span>
<span class="sd">        3</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">NCTR_OF</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="MoleBase.bas_nprim">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.bas_nprim">[docs]</a>
    <span class="k">def</span> <span class="nf">bas_nprim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;The number of primitive GTOs for the given shell</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_atom(3)</span>
<span class="sd">        11</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">NPRIM_OF</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="MoleBase.bas_kappa">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.bas_kappa">[docs]</a>
    <span class="k">def</span> <span class="nf">bas_kappa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Kappa (if l &lt; j, -l-1, else l) of the given shell</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_kappa(3)</span>
<span class="sd">        0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">KAPPA_OF</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="MoleBase.bas_exp">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.bas_exp">[docs]</a>
    <span class="k">def</span> <span class="nf">bas_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;exponents (ndarray) of the given shell</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_kappa(0)</span>
<span class="sd">        [ 13.01     1.962    0.4446]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nprim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_nprim</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">PTR_EXP</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="p">:</span><span class="n">ptr</span><span class="o">+</span><span class="n">nprim</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="MoleBase.bas_exps">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.bas_exps">[docs]</a>
    <span class="k">def</span> <span class="nf">bas_exps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;exponents of all basis</span>
<span class="sd">        return [mol.bas_exp(i) for i in range(self.nbas)]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nprims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">NPRIM_OF</span><span class="p">]</span>
        <span class="n">pexps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">PTR_EXP</span><span class="p">]</span>
        <span class="n">exps</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pexps</span><span class="p">,</span> <span class="n">pexps</span> <span class="o">+</span> <span class="n">nprims</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">exps</span></div>


    <span class="k">def</span> <span class="nf">_libcint_ctr_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
        <span class="n">nprim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_nprim</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">nctr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">PTR_COEFF</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="p">:</span><span class="n">ptr</span><span class="o">+</span><span class="n">nprim</span><span class="o">*</span><span class="n">nctr</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nctr</span><span class="p">,</span><span class="n">nprim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<div class="viewcode-block" id="MoleBase.bas_ctr_coeff">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.bas_ctr_coeff">[docs]</a>
    <span class="k">def</span> <span class="nf">bas_ctr_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Contract coefficients (ndarray) of the given shell</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.M(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_ctr_coeff(0)</span>
<span class="sd">        [[ 10.03400444]</span>
<span class="sd">         [  4.1188704 ]</span>
<span class="sd">         [  1.53971186]]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">es</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_exp</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_libcint_ctr_coeff</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;pi,p-&gt;pi&#39;</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">gto_norm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">es</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cs</span></div>


<div class="viewcode-block" id="MoleBase.bas_len_spinor">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.bas_len_spinor">[docs]</a>
    <span class="k">def</span> <span class="nf">bas_len_spinor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;The number of spinor associated with given basis</span>
<span class="sd">        If kappa is 0, return 4l+2</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_kappa</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">len_spinor</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.bas_len_cart">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.bas_len_cart">[docs]</a>
    <span class="k">def</span> <span class="nf">bas_len_cart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;The number of Cartesian function associated with given basis</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">len_cart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">ANG_OF</span><span class="p">])</span></div>


    <span class="n">npgto_nr</span> <span class="o">=</span> <span class="n">npgto_nr</span>

    <span class="n">nao_nr</span> <span class="o">=</span> <span class="n">nao_nr</span>
    <span class="n">nao_2c</span> <span class="o">=</span> <span class="n">nao_2c</span>
    <span class="n">nao_cart</span> <span class="o">=</span> <span class="n">nao_cart</span>

    <span class="n">nao_nr_range</span> <span class="o">=</span> <span class="n">nao_nr_range</span>
    <span class="n">nao_2c_range</span> <span class="o">=</span> <span class="n">nao_2c_range</span>

    <span class="n">ao_loc_nr</span> <span class="o">=</span> <span class="n">ao_loc_nr</span>
    <span class="n">ao_loc_2c</span> <span class="o">=</span> <span class="n">ao_loc_2c</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nao</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nao</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nao</span>
    <span class="nd">@nao</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">nao</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nao</span> <span class="o">=</span> <span class="n">x</span>

    <span class="n">ao_loc</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">ao_loc_nr</span><span class="p">)</span>

    <span class="n">tmap</span> <span class="o">=</span> <span class="n">time_reversal_map</span> <span class="o">=</span> <span class="n">time_reversal_map</span>

<div class="viewcode-block" id="MoleBase.intor">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.intor">[docs]</a>
    <span class="k">def</span> <span class="nf">intor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intor</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hermi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">aosym</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">shls_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Integral generator.</span>

<span class="sd">        Args:</span>
<span class="sd">            intor : str</span>
<span class="sd">                Name of the 1e or 2e AO integrals.  Ref to :func:`getints` for the</span>
<span class="sd">                complete list of available 1-electron integral names</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            comp : int</span>
<span class="sd">                Components of the integrals, e.g. int1e_ipovlp_sph has 3 components.</span>
<span class="sd">            hermi : int</span>
<span class="sd">                Symmetry of the integrals</span>

<span class="sd">                | 0 : no symmetry assumed (default)</span>
<span class="sd">                | 1 : hermitian</span>
<span class="sd">                | 2 : anti-hermitian</span>

<span class="sd">            shls_slice : 4-element, 6-element or 8-element tuple</span>
<span class="sd">                Label the start-stop shells for each index in the integral.</span>
<span class="sd">                For example, the 8-element tuple for the 2-electron integral</span>
<span class="sd">                tensor (ij|kl) = intor(&#39;int2e&#39;) are specified as</span>
<span class="sd">                (ish_start, ish_end, jsh_start, jsh_end, ksh_start, ksh_end, lsh_start, lsh_end)</span>
<span class="sd">            grids : ndarray</span>
<span class="sd">                Coordinates of grids for the int1e_grids integrals</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray of 1-electron integrals, can be either 2-dim or 3-dim, depending on comp</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; H 0 0 1.1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.intor(&#39;int1e_ipnuc_sph&#39;, comp=3) # &lt;nabla i | V_nuc | j&gt;</span>
<span class="sd">        [[[ 0.          0.        ]</span>
<span class="sd">          [ 0.          0.        ]]</span>
<span class="sd">         [[ 0.          0.        ]</span>
<span class="sd">          [ 0.          0.        ]]</span>
<span class="sd">         [[ 0.10289944  0.48176097]</span>
<span class="sd">          [-0.48176097 -0.10289944]]]</span>
<span class="sd">        &gt;&gt;&gt; mol.intor(&#39;int1e_nuc_spinor&#39;)</span>
<span class="sd">        [[-1.69771092+0.j  0.00000000+0.j -0.67146312+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -1.69771092+0.j  0.00000000+0.j -0.67146312+0.j]</span>
<span class="sd">         [-0.67146312+0.j  0.00000000+0.j -1.69771092+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -0.67146312+0.j  0.00000000+0.j -1.69771092+0.j]]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_built</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Warning: intor envs of </span><span class="si">%s</span><span class="s1"> not initialized.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="c1"># FIXME: Whether to check _built and call build?  ._bas and .basis</span>
            <span class="c1"># may not be consistent. calling .build() may leads to wrong intor env.</span>
            <span class="c1">#self.build(False, False)</span>
        <span class="n">intor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_suffix</span><span class="p">(</span><span class="n">intor</span><span class="p">)</span>
        <span class="n">bas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span>
        <span class="k">if</span> <span class="s1">&#39;ECP&#39;</span> <span class="ow">in</span> <span class="n">intor</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ecp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">bas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">))</span>
            <span class="n">env</span><span class="p">[</span><span class="n">AS_ECPBAS_OFFSET</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">)</span>
            <span class="n">env</span><span class="p">[</span><span class="n">AS_NECPBAS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">shls_slice</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">shls_slice</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbas</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbas</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;_grids&#39;</span> <span class="ow">in</span> <span class="n">intor</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">grids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="n">env</span><span class="p">[</span><span class="n">NGRIDS</span><span class="p">]</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">env</span><span class="p">[</span><span class="n">PTR_GRIDS</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">grids</span><span class="o">.</span><span class="n">size</span>
        <span class="k">return</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">getints</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">bas</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span>
                                 <span class="n">shls_slice</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">hermi</span><span class="p">,</span> <span class="n">aosym</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_add_suffix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intor</span><span class="p">,</span> <span class="n">cart</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">intor</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;cint&#39;</span> <span class="ow">or</span>
                <span class="n">intor</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s1">&#39;_sph&#39;</span><span class="p">,</span> <span class="s1">&#39;_cart&#39;</span><span class="p">,</span> <span class="s1">&#39;_spinor&#39;</span><span class="p">,</span> <span class="s1">&#39;_ssc&#39;</span><span class="p">))):</span>
            <span class="k">if</span> <span class="n">cart</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cart</span>
            <span class="k">if</span> <span class="n">cart</span><span class="p">:</span>
                <span class="n">intor</span> <span class="o">=</span> <span class="n">intor</span> <span class="o">+</span> <span class="s1">&#39;_cart&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">intor</span> <span class="o">=</span> <span class="n">intor</span> <span class="o">+</span> <span class="s1">&#39;_sph&#39;</span>
        <span class="k">return</span> <span class="n">intor</span>

<div class="viewcode-block" id="MoleBase.intor_symmetric">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.intor_symmetric">[docs]</a>
    <span class="k">def</span> <span class="nf">intor_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intor</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;One-electron integral generator. The integrals are assumed to be hermitian</span>

<span class="sd">        Args:</span>
<span class="sd">            intor : str</span>
<span class="sd">                Name of the 1-electron integral.  Ref to :func:`getints` for the</span>
<span class="sd">                complete list of available 1-electron integral names</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            comp : int</span>
<span class="sd">                Components of the integrals, e.g. int1e_ipovlp_sph has 3 components.</span>
<span class="sd">            grids : ndarray</span>
<span class="sd">                Coordinates of grids for the int1e_grids integrals</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray of 1-electron integrals, can be either 2-dim or 3-dim, depending on comp</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; H 0 0 1.1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.intor_symmetric(&#39;int1e_nuc_spinor&#39;)</span>
<span class="sd">        [[-1.69771092+0.j  0.00000000+0.j -0.67146312+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -1.69771092+0.j  0.00000000+0.j -0.67146312+0.j]</span>
<span class="sd">         [-0.67146312+0.j  0.00000000+0.j -1.69771092+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -0.67146312+0.j  0.00000000+0.j -1.69771092+0.j]]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">aosym</span><span class="o">=</span><span class="s1">&#39;s4&#39;</span><span class="p">,</span> <span class="n">grids</span><span class="o">=</span><span class="n">grids</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.intor_asymmetric">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.intor_asymmetric">[docs]</a>
    <span class="k">def</span> <span class="nf">intor_asymmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intor</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;One-electron integral generator. The integrals are assumed to be anti-hermitian</span>

<span class="sd">        Args:</span>
<span class="sd">            intor : str</span>
<span class="sd">                Name of the 1-electron integral.  Ref to :func:`getints` for the</span>
<span class="sd">                complete list of available 1-electron integral names</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            comp : int</span>
<span class="sd">                Components of the integrals, e.g. int1e_ipovlp has 3 components.</span>
<span class="sd">            grids : ndarray</span>
<span class="sd">                Coordinates of grids for the int1e_grids integrals</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray of 1-electron integrals, can be either 2-dim or 3-dim, depending on comp</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; H 0 0 1.1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.intor_asymmetric(&#39;int1e_nuc_spinor&#39;)</span>
<span class="sd">        [[-1.69771092+0.j  0.00000000+0.j  0.67146312+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -1.69771092+0.j  0.00000000+0.j  0.67146312+0.j]</span>
<span class="sd">         [-0.67146312+0.j  0.00000000+0.j -1.69771092+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -0.67146312+0.j  0.00000000+0.j -1.69771092+0.j]]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">aosym</span><span class="o">=</span><span class="s1">&#39;a4&#39;</span><span class="p">,</span> <span class="n">grids</span><span class="o">=</span><span class="n">grids</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.intor_by_shell">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.intor_by_shell">[docs]</a>
    <span class="nd">@lib</span><span class="o">.</span><span class="n">with_doc</span><span class="p">(</span><span class="n">moleintor</span><span class="o">.</span><span class="n">getints_by_shell</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">intor_by_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intor</span><span class="p">,</span> <span class="n">shells</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">intor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_suffix</span><span class="p">(</span><span class="n">intor</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;ECP&#39;</span> <span class="ow">in</span> <span class="n">intor</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ecp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">bas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">AS_ECPBAS_OFFSET</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">AS_NECPBAS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ecpbas</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span>
        <span class="k">return</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">getints_by_shell</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="n">shells</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">bas</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span></div>


    <span class="n">eval_ao</span> <span class="o">=</span> <span class="n">eval_gto</span> <span class="o">=</span> <span class="n">eval_gto</span>

    <span class="n">energy_nuc</span> <span class="o">=</span> <span class="n">energy_nuc</span>
<div class="viewcode-block" id="MoleBase.get_enuc">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.get_enuc">[docs]</a>
    <span class="k">def</span> <span class="nf">get_enuc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enuc</span></div>


<div class="viewcode-block" id="MoleBase.get_ao_indices">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.get_ao_indices">[docs]</a>
    <span class="k">def</span> <span class="nf">get_ao_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_list</span><span class="p">,</span> <span class="n">ao_loc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate (dis-continued) AO indices for basis specified in bas_list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ao_loc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ao_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ao_loc</span>
        <span class="k">return</span> <span class="n">lib</span><span class="o">.</span><span class="n">locs_to_indices</span><span class="p">(</span><span class="n">ao_loc</span><span class="p">,</span> <span class="n">bas_list</span><span class="p">)</span></div>


    <span class="n">sph_labels</span> <span class="o">=</span> <span class="n">spheric_labels</span> <span class="o">=</span> <span class="n">sph_labels</span>
    <span class="n">cart_labels</span> <span class="o">=</span> <span class="n">cart_labels</span>
    <span class="n">ao_labels</span> <span class="o">=</span> <span class="n">ao_labels</span>

    <span class="n">spinor_labels</span> <span class="o">=</span> <span class="n">spinor_labels</span>

    <span class="n">search_ao_label</span> <span class="o">=</span> <span class="n">search_ao_label</span>

<div class="viewcode-block" id="MoleBase.search_shell_id">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.search_shell_id">[docs]</a>
    <span class="k">def</span> <span class="nf">search_shell_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">search_shell_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span></div>


    <span class="n">search_ao_nr</span> <span class="o">=</span> <span class="n">search_ao_nr</span>
    <span class="n">search_ao_r</span> <span class="o">=</span> <span class="n">search_ao_r</span>

    <span class="n">aoslice_by_atom</span> <span class="o">=</span> <span class="n">aoslice_nr_by_atom</span> <span class="o">=</span> <span class="n">offset_ao_by_atom</span> <span class="o">=</span> <span class="n">offset_nr_by_atom</span> <span class="o">=</span> <span class="n">aoslice_by_atom</span>
    <span class="n">aoslice_2c_by_atom</span> <span class="o">=</span> <span class="n">offset_2c_by_atom</span> <span class="o">=</span> <span class="n">offset_2c_by_atom</span>

    <span class="n">condense_to_shell</span> <span class="o">=</span> <span class="n">condense_to_shell</span>
    <span class="n">get_overlap_cond</span> <span class="o">=</span> <span class="n">get_overlap_cond</span>

    <span class="n">to_uncontracted_cartesian_basis</span> <span class="o">=</span> <span class="n">to_uncontracted_cartesian_basis</span>
    <span class="n">decontract_basis</span> <span class="o">=</span> <span class="n">decontract_basis</span>

    <span class="n">ao_rotation_matrix</span> <span class="o">=</span> <span class="n">ao_rotation_matrix</span>

<div class="viewcode-block" id="MoleBase.cart2sph_coeff">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.cart2sph_coeff">[docs]</a>
    <span class="k">def</span> <span class="nf">cart2sph_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalized</span><span class="o">=</span><span class="s1">&#39;sp&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Transformation matrix that transforms Cartesian GTOs to spherical</span>
<span class="sd">        GTOs for all basis functions</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            normalized : string or boolean</span>
<span class="sd">                How the Cartesian GTOs are normalized.  Except s and p functions,</span>
<span class="sd">                Cartesian GTOs do not have the universal normalization coefficients</span>
<span class="sd">                for the different components of the same shell.  The value of this</span>
<span class="sd">                argument can be one of &#39;sp&#39;, &#39;all&#39;, None.  &#39;sp&#39; means the Cartesian s</span>
<span class="sd">                and p basis are normalized.  &#39;all&#39; means all Cartesian functions are</span>
<span class="sd">                normalized.  None means none of the Cartesian functions are normalized.</span>
<span class="sd">                The default value &#39;sp&#39; is the convention used by libcint library.</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 0 0; F 0 0 1&#39;, basis=&#39;ccpvtz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; c = mol.cart2sph_coeff()</span>
<span class="sd">        &gt;&gt;&gt; s0 = mol.intor(&#39;int1e_ovlp_sph&#39;)</span>
<span class="sd">        &gt;&gt;&gt; s1 = c.T.dot(mol.intor(&#39;int1e_ovlp_cart&#39;)).dot(c)</span>
<span class="sd">        &gt;&gt;&gt; print(abs(s1-s0).sum())</span>
<span class="sd">        &gt;&gt;&gt; 4.58676826646e-15</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">c2s_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">cart2sph</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">normalized</span><span class="o">=</span><span class="n">normalized</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)]</span>
        <span class="n">c2s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">ib</span><span class="p">)):</span>
                <span class="n">c2s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c2s_l</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">block_diag</span><span class="p">(</span><span class="o">*</span><span class="n">c2s</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.sph2spinor_coeff">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.sph2spinor_coeff">[docs]</a>
    <span class="k">def</span> <span class="nf">sph2spinor_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Transformation matrix that transforms real-spherical GTOs to spinor</span>
<span class="sd">        GTOs for all basis functions</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 0 0; F 0 0 1&#39;, basis=&#39;ccpvtz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ca, cb = mol.sph2spinor_coeff()</span>
<span class="sd">        &gt;&gt;&gt; s0 = mol.intor(&#39;int1e_ovlp_spinor&#39;)</span>
<span class="sd">        &gt;&gt;&gt; s1 = ca.conj().T.dot(mol.intor(&#39;int1e_ovlp_sph&#39;)).dot(ca)</span>
<span class="sd">        &gt;&gt;&gt; s1+= cb.conj().T.dot(mol.intor(&#39;int1e_ovlp_sph&#39;)).dot(cb)</span>
<span class="sd">        &gt;&gt;&gt; print(abs(s1-s0).max())</span>
<span class="sd">        &gt;&gt;&gt; 6.66133814775e-16</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">pyscf.symm</span> <span class="kn">import</span> <span class="n">sph</span>
        <span class="k">return</span> <span class="n">sph</span><span class="o">.</span><span class="n">sph2spinor_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="MoleBase.apply">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.MoleBase.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lib</span><span class="o">.</span><span class="n">StreamObject</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;First argument of .apply method must be a &#39;</span>
                            <span class="s1">&#39;function/class or a name (string) of a method.&#39;</span><span class="p">)</span></div>


    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">_TemporaryMoleContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">args_bak</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Almost every method depends on the Mole environment. Ensure the</span>
<span class="sd">        modification in temporary environment being thread safe</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">haslock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctx_lock</span>
        <span class="k">if</span> <span class="n">haslock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctx_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctx_lock</span><span class="p">:</span>
            <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args_bak</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">haslock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ctx_lock</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="Mole">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.Mole">[docs]</a>
<span class="k">class</span> <span class="nc">Mole</span><span class="p">(</span><span class="n">MoleBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;A Mole object to hold the basic information of a molecule.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="fm">__add__</span> <span class="o">=</span> <span class="n">conc_mol</span>
    <span class="n">inertia_moment</span> <span class="o">=</span> <span class="n">inertia_moment</span>
    <span class="n">tostring</span> <span class="o">=</span> <span class="n">tostring</span>
    <span class="n">tofile</span> <span class="o">=</span> <span class="n">tofile</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">MoleBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

<div class="viewcode-block" id="Mole.fromstring">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.Mole.fromstring">[docs]</a>
    <span class="k">def</span> <span class="nf">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;xyz&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Update the Mole object based on the input geometry string&#39;&#39;&#39;</span>
        <span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_atom</span><span class="p">(</span><span class="n">fromstring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">format</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_geom_</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Angstrom&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;sdf&#39;</span> <span class="ow">and</span> <span class="s1">&#39;M  CHG&#39;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="c1">#FIXME self.charge = 0</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Mole.fromfile">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.Mole.fromfile">[docs]</a>
    <span class="k">def</span> <span class="nf">fromfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Update the Mole object based on the input geometry file&#39;&#39;&#39;</span>
        <span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_atom</span><span class="p">(</span><span class="n">fromfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_geom_</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Angstrom&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;sdf&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;To support accessing methods (mol.HF, mol.KS, mol.CCSD, mol.CASSCF, ...)</span>
<span class="sd">        from Mole object.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>  <span class="c1"># Skip private attributes and Python builtins</span>
            <span class="c1"># https://bugs.python.org/issue45985</span>
            <span class="c1"># https://github.com/python/cpython/issues/103936</span>
            <span class="c1"># @property and __getattr__ conflicts. As a temporary fix, call</span>
            <span class="c1"># object.__getattribute__ method to re-raise AttributeError</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="c1"># Import all available modules. Some methods are registered to other</span>
        <span class="c1"># classes/modules when importing modules in __all__.</span>
        <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">__all__</span>  <span class="c1"># noqa</span>
        <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span><span class="p">,</span> <span class="n">dft</span>

        <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="p">(</span><span class="n">scf</span><span class="p">,</span> <span class="n">dft</span><span class="p">):</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;TD&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;TDHF&#39;</span><span class="p">,</span> <span class="s1">&#39;TDA&#39;</span><span class="p">):</span>
                <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">HF</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mf</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">KS</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">xc</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;TD&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">xc</span> <span class="ow">in</span> <span class="n">dft</span><span class="o">.</span><span class="n">XC</span><span class="p">:</span>
                    <span class="n">mf</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;TDDFT&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;CI&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;CC&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;CAS&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;MP&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">HF</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="c1"># Initialize SCF object for post-SCF methods if applicable</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">method</span>

<div class="viewcode-block" id="Mole.ao2mo">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.Mole.ao2mo">[docs]</a>
    <span class="k">def</span> <span class="nf">ao2mo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mo_coeffs</span><span class="p">,</span> <span class="n">erifile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataname</span><span class="o">=</span><span class="s1">&#39;eri_mo&#39;</span><span class="p">,</span> <span class="n">intor</span><span class="o">=</span><span class="s1">&#39;int2e&#39;</span><span class="p">,</span>
              <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Integral transformation for arbitrary orbitals and arbitrary</span>
<span class="sd">        integrals.  See more detailed documentation in func:`ao2mo.kernel`.</span>

<span class="sd">        Args:</span>
<span class="sd">            mo_coeffs (an np array or a list of arrays) : A matrix of orbital</span>
<span class="sd">                coefficients if it is a numpy ndarray, or four sets of orbital</span>
<span class="sd">                coefficients, corresponding to the four indices of (ij|kl).</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            erifile (str or h5py File or h5py Group object) : The file/object</span>
<span class="sd">                to store the transformed integrals.  If not given, the return</span>
<span class="sd">                value is an array (in memory) of the transformed integrals.</span>
<span class="sd">            dataname : str</span>
<span class="sd">                *Note* this argument is effective if erifile is given.</span>
<span class="sd">                The dataset name in the erifile (ref the hierarchy of HDF5 format</span>
<span class="sd">                http://www.hdfgroup.org/HDF5/doc1.6/UG/09_Groups.html).  By assigning</span>
<span class="sd">                different dataname, the existed integral file can be reused.  If</span>
<span class="sd">                the erifile contains the specified dataname, the old integrals</span>
<span class="sd">                will be replaced by the new one under the key dataname.</span>
<span class="sd">            intor (str) : integral name Name of the 2-electron integral.  Ref</span>
<span class="sd">                to :func:`getints_by_shell`</span>
<span class="sd">                for the complete list of available 2-electron integral names</span>

<span class="sd">        Returns:</span>
<span class="sd">            An array of transformed integrals if erifile is not given.</span>
<span class="sd">            Otherwise, return the file/fileobject if erifile is assigned.</span>


<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; import pyscf</span>
<span class="sd">        &gt;&gt;&gt; mol = pyscf.M(atom=&#39;O 0 0 0; H 0 1 0; H 0 0 1&#39;, basis=&#39;sto3g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mo1 = numpy.random.random((mol.nao_nr(), 10))</span>
<span class="sd">        &gt;&gt;&gt; mo2 = numpy.random.random((mol.nao_nr(), 8))</span>

<span class="sd">        &gt;&gt;&gt; eri1 = mol.ao2mo(mo1)</span>
<span class="sd">        &gt;&gt;&gt; print(eri1.shape)</span>
<span class="sd">        (55, 55)</span>

<span class="sd">        &gt;&gt;&gt; eri1 = mol.ao2mo(mo1, compact=False)</span>
<span class="sd">        &gt;&gt;&gt; print(eri1.shape)</span>
<span class="sd">        (100, 100)</span>

<span class="sd">        &gt;&gt;&gt; eri1 = mol.ao2mo(eri, (mo1,mo2,mo2,mo2))</span>
<span class="sd">        &gt;&gt;&gt; print(eri1.shape)</span>
<span class="sd">        (80, 36)</span>

<span class="sd">        &gt;&gt;&gt; eri1 = mol.ao2mo(eri, (mo1,mo2,mo2,mo2), erifile=&#39;water.h5&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">ao2mo</span>
        <span class="k">return</span> <span class="n">ao2mo</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mo_coeffs</span><span class="p">,</span> <span class="n">erifile</span><span class="p">,</span> <span class="n">dataname</span><span class="p">,</span> <span class="n">intor</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mole.to_cell">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.Mole.to_cell">[docs]</a>
    <span class="k">def</span> <span class="nf">to_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Put a molecule in a cell with periodic boundary conditions</span>

<span class="sd">        Args:</span>
<span class="sd">            a : (3,3) ndarray</span>
<span class="sd">                Lattice primitive vectors. Each row is a lattice vector</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">pyscf.pbc.gto</span> <span class="kn">import</span> <span class="n">Cell</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">()</span>
        <span class="n">cell</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="n">dimension</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cell</span></div>
</div>


<span class="k">def</span> <span class="nf">_parse_default_basis</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">uniq_atoms</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="c1"># default basis for all atoms</span>
        <span class="n">_basis</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="n">basis</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">uniq_atoms</span><span class="p">}</span>
    <span class="k">elif</span> <span class="s1">&#39;default&#39;</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
        <span class="n">default_basis</span> <span class="o">=</span> <span class="n">basis</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>
        <span class="n">_basis</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="n">default_basis</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">uniq_atoms</span><span class="p">}</span>
        <span class="n">_basis</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">_basis</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_basis</span> <span class="o">=</span> <span class="n">basis</span>
    <span class="k">return</span> <span class="n">_basis</span>

<span class="k">def</span> <span class="nf">_parse_nuc_mod</span><span class="p">(</span><span class="n">str_or_int_or_fn</span><span class="p">):</span>
    <span class="n">nucmod</span> <span class="o">=</span> <span class="n">NUC_POINT</span>
    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">str_or_int_or_fn</span><span class="p">):</span>
        <span class="n">nucmod</span> <span class="o">=</span> <span class="n">str_or_int_or_fn</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">str_or_int_or_fn</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span>
          <span class="n">str_or_int_or_fn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span><span class="p">):</span> <span class="c1"># &#39;gauss_nuc&#39;</span>
        <span class="n">nucmod</span> <span class="o">=</span> <span class="n">NUC_GAUSS</span>
    <span class="k">elif</span> <span class="n">str_or_int_or_fn</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">nucmod</span> <span class="o">=</span> <span class="n">NUC_GAUSS</span>
    <span class="k">return</span> <span class="n">nucmod</span>

<span class="k">def</span> <span class="nf">_update_from_cmdargs_</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Detect whether in Ipython shell</span>
        <span class="n">__IPYTHON__</span>  <span class="c1"># noqa: F821</span>
        <span class="k">return</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">mol</span><span class="o">.</span><span class="n">_built</span><span class="p">:</span> <span class="c1"># parse cmdline args only once</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="n">cmd_args</span><span class="o">.</span><span class="n">cmd_args</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">max_memory</span><span class="p">:</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">max_memory</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span>


<div class="viewcode-block" id="from_zmatrix">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.from_zmatrix">[docs]</a>
<span class="k">def</span> <span class="nf">from_zmatrix</span><span class="p">(</span><span class="n">atomstr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;&gt;&gt;&gt; a = &quot;&quot;&quot;H</span>
<span class="sd">    H 1 2.67247631453057</span>
<span class="sd">    H 1 4.22555607338457 2 50.7684795164077</span>
<span class="sd">    H 1 2.90305235726773 2 79.3904651036893 3 6.20854462618583&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; for x in zmat2cart(a): print(x)</span>
<span class="sd">    [&#39;H&#39;, array([ 0.,  0.,  0.])]</span>
<span class="sd">    [&#39;H&#39;, array([ 2.67247631,  0.        ,  0.        ])]</span>
<span class="sd">    [&#39;H&#39;, array([ 2.67247631,  0.        ,  3.27310166])]</span>
<span class="sd">    [&#39;H&#39;, array([ 0.53449526,  0.30859098,  2.83668811])]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">pyscf.symm</span> <span class="kn">import</span> <span class="n">rotation_mat</span>
    <span class="n">atomstr</span> <span class="o">=</span> <span class="n">atomstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">symbols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">coord</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">min_items_per_line</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">line_id</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atomstr</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>
            <span class="n">rawd</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawd</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_items_per_line</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Zmatrix format error at L</span><span class="si">%d</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line_id</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>

            <span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawd</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
                <span class="n">min_items_per_line</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">DISABLE_EVAL</span><span class="p">:</span>
                    <span class="n">coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="nb">eval</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
                <span class="n">min_items_per_line</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">DISABLE_EVAL</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="n">rawd</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
                <span class="n">bonda</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">bond</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">anga</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">ang</span>   <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
                <span class="k">assert</span> <span class="p">(</span><span class="n">ang</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">v1</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">anga</span><span class="p">]</span> <span class="o">-</span> <span class="n">coord</span><span class="p">[</span><span class="n">bonda</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">v1</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">vecn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># on z</span>
                    <span class="n">vecn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">))</span>
                <span class="n">rmat</span> <span class="o">=</span> <span class="n">rotation_mat</span><span class="p">(</span><span class="n">vecn</span><span class="p">,</span> <span class="n">ang</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rmat</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">bond</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">))</span>
                <span class="n">coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="n">bonda</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
                <span class="n">min_items_per_line</span> <span class="o">=</span> <span class="mi">7</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">DISABLE_EVAL</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="n">rawd</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
                <span class="n">bonda</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">bond</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">anga</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">ang</span>   <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
                <span class="k">assert</span> <span class="p">(</span><span class="n">ang</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ang</span> <span class="o">&lt;=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="n">v1</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">anga</span><span class="p">]</span> <span class="o">-</span> <span class="n">coord</span><span class="p">[</span><span class="n">bonda</span><span class="p">]</span>
                <span class="n">v1</span> <span class="o">/=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ang</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">*</span> <span class="n">bond</span>
                <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">ang</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">v1</span> <span class="o">*</span> <span class="n">bond</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">diha</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">dih</span>   <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
                    <span class="n">v2</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">diha</span><span class="p">]</span> <span class="o">-</span> <span class="n">coord</span><span class="p">[</span><span class="n">anga</span><span class="p">]</span>
                    <span class="n">vecn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="o">-</span><span class="n">v1</span><span class="p">)</span>
                    <span class="n">vecn_norm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vecn</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">vecn_norm</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">v1</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="n">vecn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)))</span>
                        <span class="k">else</span><span class="p">:</span> <span class="c1"># on z</span>
                            <span class="n">vecn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">))</span>
                        <span class="n">rmat</span> <span class="o">=</span> <span class="n">rotation_mat</span><span class="p">(</span><span class="n">vecn</span><span class="p">,</span> <span class="n">ang</span><span class="p">)</span>
                        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rmat</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="n">bond</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rmat</span> <span class="o">=</span> <span class="n">rotation_mat</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="o">-</span><span class="n">dih</span><span class="p">)</span>
                        <span class="n">vecn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rmat</span><span class="p">,</span> <span class="n">vecn</span><span class="p">)</span> <span class="o">/</span> <span class="n">vecn_norm</span>
                        <span class="n">rmat</span> <span class="o">=</span> <span class="n">rotation_mat</span><span class="p">(</span><span class="n">vecn</span><span class="p">,</span> <span class="n">ang</span><span class="p">)</span>
                        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rmat</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="n">bond</span>
                <span class="n">coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="n">bonda</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">_atom_symbol</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">],</span> <span class="n">coord</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">atoms</span></div>

<span class="n">zmat2cart</span> <span class="o">=</span> <span class="n">zmat</span> <span class="o">=</span> <span class="n">from_zmatrix</span>

<div class="viewcode-block" id="cart2zmat">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.cart2zmat">[docs]</a>
<span class="k">def</span> <span class="nf">cart2zmat</span><span class="p">(</span><span class="n">coord</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;&gt;&gt;&gt; c = numpy.array((</span>
<span class="sd">    (0.000000000000,  1.889726124565,  0.000000000000),</span>
<span class="sd">    (0.000000000000,  0.000000000000, -1.889726124565),</span>
<span class="sd">    (1.889726124565, -1.889726124565,  0.000000000000),</span>
<span class="sd">    (1.889726124565,  0.000000000000,  1.133835674739)))</span>
<span class="sd">    &gt;&gt;&gt; print(cart2zmat(c))</span>
<span class="sd">    1</span>
<span class="sd">    1 2.67247631453057</span>
<span class="sd">    1 4.22555607338457 2 50.7684795164077</span>
<span class="sd">    1 2.90305235726773 2 79.3904651036893 3 6.20854462618583</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">zstr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">zstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nr1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
        <span class="n">zstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;1 </span><span class="si">%.15g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nr1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nr2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nr1</span><span class="o">*</span><span class="n">nr2</span><span class="p">))</span>
        <span class="n">zstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;1 </span><span class="si">%.15g</span><span class="s1"> 2 </span><span class="si">%.15g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nr2</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">o0</span><span class="p">,</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">3</span><span class="p">:]):</span>
            <span class="n">r0</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="n">o0</span>
            <span class="n">nr0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r0</span><span class="p">)</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="n">o1</span> <span class="o">-</span> <span class="n">o0</span>
            <span class="n">nr1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span><span class="n">r1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nr0</span><span class="o">*</span><span class="n">nr1</span><span class="p">))</span>
            <span class="n">b0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">)</span>
            <span class="n">nb0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b0</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nb0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">:</span> <span class="c1"># o0, o1, c in line</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">zstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> </span><span class="si">%.15g</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%.15g</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%.15g</span><span class="s1">&#39;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">nr0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">a1</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">a2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">o2</span><span class="o">-</span><span class="n">o0</span><span class="p">,</span> <span class="n">r1</span><span class="p">)</span>
                <span class="n">nb1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nb1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">:</span>  <span class="c1"># o0 o1 o2 in line</span>
                    <span class="n">a2</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">zstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> </span><span class="si">%.15g</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%.15g</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%.15g</span><span class="s1">&#39;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">nr0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">a1</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">a2</span><span class="p">))</span>
                    <span class="n">o2</span> <span class="o">=</span> <span class="n">c</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">k</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b0</span><span class="p">),</span> <span class="n">r1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">a2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nb0</span><span class="o">*</span><span class="n">nb1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">a2</span> <span class="o">=-</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nb0</span><span class="o">*</span><span class="n">nb1</span><span class="p">))</span>
                    <span class="n">zstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> </span><span class="si">%.15g</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%.15g</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%.15g</span><span class="s1">&#39;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">nr0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">a1</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">a2</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zstr</span><span class="p">)</span></div>


<div class="viewcode-block" id="dyall_nuc_mod">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.dyall_nuc_mod">[docs]</a>
<span class="k">def</span> <span class="nf">dyall_nuc_mod</span><span class="p">(</span><span class="n">nuc_charge</span><span class="p">,</span> <span class="n">nucprop</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Generate the nuclear charge distribution parameter zeta</span>
<span class="sd">    rho(r) = nuc_charge * Norm * exp(-zeta * r^2)</span>

<span class="sd">    Ref. L. Visscher and K. Dyall, At. Data Nucl. Data Tables, 67, 207 (1997)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="n">nucprop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mass&#39;</span><span class="p">,</span> <span class="n">elements</span><span class="o">.</span><span class="n">ISOTOPE_MAIN</span><span class="p">[</span><span class="n">nuc_charge</span><span class="p">])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.836</span> <span class="o">*</span> <span class="n">mass</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.570</span><span class="p">)</span> <span class="o">/</span> <span class="mf">52917.7249</span>
    <span class="n">zeta</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">zeta</span></div>


<div class="viewcode-block" id="filatov_nuc_mod">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.filatov_nuc_mod">[docs]</a>
<span class="k">def</span> <span class="nf">filatov_nuc_mod</span><span class="p">(</span><span class="n">nuc_charge</span><span class="p">,</span> <span class="n">nucprop</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Generate the nuclear charge distribution parameter zeta</span>
<span class="sd">    rho(r) = nuc_charge * Norm * exp(-zeta * r^2)</span>

<span class="sd">    Ref. M. Filatov and D. Cremer, Theor. Chem. Acc. 108, 168 (2002)</span>
<span class="sd">         M. Filatov and D. Cremer, Chem. Phys. Lett. 351, 259 (2002)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">LIGHT_SPEED</span>
    <span class="n">nuc_charge</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">nuc_charge</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.263188</span><span class="o">*</span><span class="n">nuc_charge</span> <span class="o">+</span> <span class="mf">106.016974</span> <span class="o">+</span> <span class="mf">138.985999</span><span class="o">/</span><span class="n">nuc_charge</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">zeta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">zeta</span></div>


<div class="viewcode-block" id="fakemol_for_charges">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.fakemol_for_charges">[docs]</a>
<span class="k">def</span> <span class="nf">fakemol_for_charges</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">expnt</span><span class="o">=</span><span class="mf">1e16</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Construct a fake Mole object that holds the charges on the given</span>
<span class="sd">    coordinates (coords).  The shape of the charge can be a normal</span>
<span class="sd">    distribution with the Gaussian exponent (expnt).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nbas</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">expnt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">expnt</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">fakeatm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbas</span><span class="p">,</span><span class="n">ATM_SLOTS</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">fakebas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbas</span><span class="p">,</span><span class="n">BAS_SLOTS</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">fakeenv</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">PTR_ENV_START</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="n">PTR_ENV_START</span>
    <span class="n">fakeatm</span><span class="p">[:,</span><span class="n">PTR_COORD</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">ptr</span><span class="o">+</span><span class="n">nbas</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">fakeenv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">ptr</span> <span class="o">+=</span> <span class="n">nbas</span><span class="o">*</span><span class="mi">3</span>
    <span class="n">fakebas</span><span class="p">[:,</span><span class="n">ATOM_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nbas</span><span class="p">)</span>
    <span class="n">fakebas</span><span class="p">[:,</span><span class="n">NPRIM_OF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">fakebas</span><span class="p">[:,</span><span class="n">NCTR_OF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">expnt</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">expnt</span> <span class="o">=</span> <span class="n">expnt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># approximate point charge with gaussian distribution exp(-1e16*r^2)</span>
        <span class="n">fakebas</span><span class="p">[:,</span><span class="n">PTR_EXP</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span>
        <span class="n">fakebas</span><span class="p">[:,</span><span class="n">PTR_COEFF</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">fakeenv</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">expnt</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">gaussian_int</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">expnt</span><span class="p">))])</span>
        <span class="n">ptr</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">expnt</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">nbas</span>
        <span class="c1"># approximate point charge with gaussian distribution exp(-expnt*r^2)</span>
        <span class="n">fakebas</span><span class="p">[:,</span><span class="n">PTR_EXP</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nbas</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">fakebas</span><span class="p">[:,</span><span class="n">PTR_COEFF</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nbas</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">gaussian_int</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">expnt</span><span class="p">))</span>
        <span class="n">fakeenv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">expnt</span><span class="p">,</span> <span class="n">coeff</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

    <span class="n">fakemol</span> <span class="o">=</span> <span class="n">Mole</span><span class="p">()</span>
    <span class="n">fakemol</span><span class="o">.</span><span class="n">_atm</span> <span class="o">=</span> <span class="n">fakeatm</span>
    <span class="n">fakemol</span><span class="o">.</span><span class="n">_bas</span> <span class="o">=</span> <span class="n">fakebas</span>
    <span class="n">fakemol</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">fakeenv</span><span class="p">)</span>
    <span class="n">fakemol</span><span class="o">.</span><span class="n">_built</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">fakemol</span></div>


<div class="viewcode-block" id="fakemol_for_cgtf_charge">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.fakemol_for_cgtf_charge">[docs]</a>
<span class="k">def</span> <span class="nf">fakemol_for_cgtf_charge</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">expnt</span><span class="o">=</span><span class="mf">1e16</span><span class="p">,</span> <span class="n">contr_coeff</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Constructs a &quot;fake&quot; Mole object that has a Gaussian charge</span>
<span class="sd">    distribution at the specified coordinate (coord).  The charge</span>
<span class="sd">    can be given as a linear combination of Gaussians with</span>
<span class="sd">    exponents expnt and contraction coefficients contr_coeff.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="n">coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">expnt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">expnt</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">contr_coeff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">contr_coeff</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">fakeatm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">ATM_SLOTS</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">fakebas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">BAS_SLOTS</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">fakeenv</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">PTR_ENV_START</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="n">PTR_ENV_START</span>
    <span class="n">fakeatm</span><span class="p">[:,</span><span class="n">PTR_COORD</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">ptr</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">fakeenv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">ptr</span> <span class="o">+=</span> <span class="mi">3</span>
    <span class="n">fakebas</span><span class="p">[:,</span><span class="n">ATOM_OF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">#numpy.arange(nbas)</span>
    <span class="n">fakebas</span><span class="p">[:,</span><span class="n">NPRIM_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">contr_coeff</span><span class="o">.</span><span class="n">size</span>
    <span class="n">fakebas</span><span class="p">[:,</span><span class="n">NCTR_OF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">expnt</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">expnt</span> <span class="o">=</span> <span class="n">expnt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fakebas</span><span class="p">[:,</span><span class="n">PTR_EXP</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span>
        <span class="n">fakebas</span><span class="p">[:,</span><span class="n">PTR_COEFF</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">fakeenv</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">expnt</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">gaussian_int</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">expnt</span><span class="p">))])</span>
        <span class="n">ptr</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">expnt</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">contr_coeff</span><span class="o">.</span><span class="n">size</span>
        <span class="n">fakebas</span><span class="p">[:,</span><span class="n">PTR_EXP</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span>
        <span class="n">fakebas</span><span class="p">[:,</span><span class="n">PTR_COEFF</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span> <span class="o">+</span> <span class="n">contr_coeff</span><span class="o">.</span><span class="n">size</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">contr_coeff</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">gaussian_int</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">expnt</span><span class="p">))</span>
        <span class="n">fakeenv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">expnt</span><span class="p">,</span> <span class="n">coeff</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

    <span class="n">fakemol</span> <span class="o">=</span> <span class="n">Mole</span><span class="p">()</span>
    <span class="n">fakemol</span><span class="o">.</span><span class="n">_atm</span> <span class="o">=</span> <span class="n">fakeatm</span>
    <span class="n">fakemol</span><span class="o">.</span><span class="n">_bas</span> <span class="o">=</span> <span class="n">fakebas</span>
    <span class="n">fakemol</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">fakeenv</span><span class="p">)</span>
    <span class="n">fakemol</span><span class="o">.</span><span class="n">_built</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">fakemol</span></div>


<div class="viewcode-block" id="classify_ecp_pseudo">
<a class="viewcode-back" href="../../../pyscf_api_docs/pyscf.gto.html#pyscf.gto.mole.classify_ecp_pseudo">[docs]</a>
<span class="k">def</span> <span class="nf">classify_ecp_pseudo</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">ecp</span><span class="p">,</span> <span class="n">pp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check whether ecp keywords are presented in pp and whether pp keywords are</span>
<span class="sd">    presented in ecp.  The return (ecp, pp) should have only the ecp keywords and</span>
<span class="sd">    pp keywords in each dict.</span>
<span class="sd">    The &quot;misplaced&quot; ecp/pp keywords have the lowest priority. E.g., if an atom</span>
<span class="sd">    is defined in ecp, the same ecp atom found in pp does NOT replace the</span>
<span class="sd">    definition in ecp, and vise versa.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="n">ecp</span><span class="p">,</span> <span class="n">pp_alias</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ecp</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">basis</span><span class="o">.</span><span class="n">_format_pseudo_name</span><span class="p">(</span><span class="n">ecp</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pp_alias</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{},</span> <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ecp</span><span class="p">)}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ecp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">ecp_as_pp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ecp</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">ecp</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="n">basis</span><span class="o">.</span><span class="n">_format_pseudo_name</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pp_alias</span><span class="p">):</span>
                    <span class="n">ecp_as_pp</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ecp_as_pp</span><span class="p">:</span>
                <span class="n">ecp_left</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ecp</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ecp_as_pp</span><span class="p">:</span>
                    <span class="n">ecp_left</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">ecp_left</span><span class="p">,</span> <span class="n">ecp_as_pp</span>
        <span class="k">return</span> <span class="n">ecp</span><span class="p">,</span> <span class="p">{}</span>
    <span class="n">ecp_left</span><span class="p">,</span> <span class="n">ecp_as_pp</span> <span class="o">=</span> <span class="n">classify</span><span class="p">(</span><span class="n">ecp</span><span class="p">,</span> <span class="n">basis</span><span class="o">.</span><span class="n">PP_ALIAS</span><span class="p">)</span>
    <span class="n">pp_left</span> <span class="p">,</span> <span class="n">pp_as_ecp</span> <span class="o">=</span> <span class="n">classify</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="n">basis</span><span class="o">.</span><span class="n">ALIAS</span><span class="p">)</span>

    <span class="c1"># ecp = ecp_left + pp_as_ecp</span>
    <span class="c1"># pp = pp_left + ecp_as_pp</span>
    <span class="n">ecp</span> <span class="o">=</span> <span class="n">ecp_left</span>
    <span class="k">if</span> <span class="n">pp_as_ecp</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ecp_left</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># If ecp is a str, all atoms have ecp definition.</span>
        <span class="c1"># The misplaced ecp has no effects.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;pseudo-potentials keywords for </span><span class="si">%s</span><span class="s1"> found in .ecp&#39;</span><span class="p">,</span>
                    <span class="n">pp_as_ecp</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">ecp_left</span><span class="p">:</span>
            <span class="n">pp_as_ecp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ecp_left</span><span class="p">)</span>
        <span class="n">ecp</span> <span class="o">=</span> <span class="n">pp_as_ecp</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">pp_left</span>
    <span class="k">if</span> <span class="n">ecp_as_pp</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pp_left</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;ECP keywords for </span><span class="si">%s</span><span class="s1"> found in .pseudo&#39;</span><span class="p">,</span>
                    <span class="n">ecp_as_pp</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">pp_left</span><span class="p">:</span>
            <span class="n">ecp_as_pp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pp_left</span><span class="p">)</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">ecp_as_pp</span>
    <span class="k">return</span> <span class="n">ecp</span><span class="p">,</span> <span class="n">pp</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, The PySCF Developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>