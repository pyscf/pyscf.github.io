
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>pyscf.mcscf &#8212; PySCF</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/pyscf.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon-32x32.png"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=pyscf data-md-color-accent=pyscf>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#_modules/pyscf/mcscf" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../index.html" title="PySCF"
           class="md-header-nav__button md-logo">
          
              <img src="../../_static/pyscf-logo-white.svg" height="26"
                   alt="PySCF logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">PySCF 2.0</span>
          <span class="md-header-nav__topic"> pyscf.mcscf </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../"versions.json"",
        target_loc = "../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">Home</a></li>
            
            <li class="md-tabs__item"><a href="../../install.html" class="md-tabs__link">Install</a></li>
            
            <li class="md-tabs__item"><a href="../../quickstart.html" class="md-tabs__link">Quickstart</a></li>
            
            <li class="md-tabs__item"><a href="../../user.html" class="md-tabs__link">User Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../develop.html" class="md-tabs__link">Developer Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../pyscf_api_docs/modules.html" class="md-tabs__link">API</a></li>
            
            <li class="md-tabs__item"><a href="../../about.html" class="md-tabs__link">About</a></li>
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Module code</a></li>
          <li class="md-tabs__item"><a href="../pyscf.html" class="md-tabs__link">pyscf</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../index.html" title="PySCF" class="md-nav__button md-logo">
      
        <img src="../../_static/pyscf-logo-white.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../index.html"
       title="PySCF">PySCF 2.0</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../../install.html" class="md-nav__link">Install</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../quickstart.html" class="md-nav__link">Quickstart</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../user.html" class="md-nav__link">User Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../pyscf_api_docs/pyscf.html" class="md-nav__link">API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../about.html" class="md-nav__link">About</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
  <ul class="md-nav__list" data-md-scrollfix="">
    

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <h1 id="modules-pyscf-mcscf--page-root">Source code for pyscf.mcscf</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># Copyright 2014-2018 The PySCF Developers. All Rights Reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the "License");</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">'''CASCI and CASSCF</span>

<span class="sd">When using results of this code for publications, please cite the following paper:</span>
<span class="sd">"A general second order complete active space self-consistent-field solver for large-scale systems", Q. Sun, J. Yang, and G. K.-L. Chan, Chem. Phys. Lett. 683, 291 (2017).</span>

<span class="sd">Simple usage::</span>

<span class="sd">    &gt;&gt;&gt; from pyscf import gto, scf, mcscf</span>
<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom='N 0 0 0; N 0 0 1', basis='ccpvdz', verbose=0)</span>
<span class="sd">    &gt;&gt;&gt; mf = scf.RHF(mol).run()</span>
<span class="sd">    &gt;&gt;&gt; mc = mcscf.CASCI(mf, 6, 6)</span>
<span class="sd">    &gt;&gt;&gt; mc.kernel()[0]</span>
<span class="sd">    -108.980200816243354</span>
<span class="sd">    &gt;&gt;&gt; mc = mcscf.CASSCF(mf, 6, 6)</span>
<span class="sd">    &gt;&gt;&gt; mc.kernel()[0]</span>
<span class="sd">    -109.044401882238134</span>
<span class="sd">    &gt;&gt;&gt; mc = mcscf.CASSCF(mf, 4, 4)</span>
<span class="sd">    &gt;&gt;&gt; cas_list = [5,6,8,9] # pick orbitals for CAS space, 1-based indices</span>
<span class="sd">    &gt;&gt;&gt; mo = mcscf.sort_mo(mc, mf.mo_coeff, cas_list)</span>
<span class="sd">    &gt;&gt;&gt; mc.kernel(mo)[0]</span>
<span class="sd">    -109.007378939813691</span>

<span class="sd">:func:`mcscf.CASSCF` or :func:`mcscf.CASCI` returns a proper instance of CASSCF/CASCI class.</span>
<span class="sd">There are some parameters to control the CASSCF/CASCI method.</span>

<span class="sd">    verbose : int</span>
<span class="sd">        Print level.  Default value equals to :class:`Mole.verbose`.</span>
<span class="sd">    max_memory : float or int</span>
<span class="sd">        Allowed memory in MB.  Default value equals to :class:`Mole.max_memory`.</span>
<span class="sd">    ncas : int</span>
<span class="sd">        Active space size.</span>
<span class="sd">    nelecas : tuple of int</span>
<span class="sd">        Active (nelec_alpha, nelec_beta)</span>
<span class="sd">    ncore : int or tuple of int</span>
<span class="sd">        Core electron number.  In UHF-CASSCF, it's a tuple to indicate the different core eletron numbers.</span>
<span class="sd">    natorb : bool</span>
<span class="sd">        Whether to restore the natural orbital during CASSCF optimization. Default is not.</span>
<span class="sd">    canonicalization : bool</span>
<span class="sd">        Whether to canonicalize orbitals.  Default is True.</span>
<span class="sd">    fcisolver : an instance of :class:`FCISolver`</span>
<span class="sd">        The pyscf.fci module provides several FCISolver for different scenario.  Generally,</span>
<span class="sd">        fci.direct_spin1.FCISolver can be used for all RHF-CASSCF.  However, a proper FCISolver</span>
<span class="sd">        can provide better performance and better numerical stability.  One can either use</span>
<span class="sd">        :func:`fci.solver` function to pick the FCISolver by the program or manually assigen</span>
<span class="sd">        the FCISolver to this attribute, e.g.</span>

<span class="sd">        &gt;&gt;&gt; from pyscf import fci</span>
<span class="sd">        &gt;&gt;&gt; mc = mcscf.CASSCF(mf, 4, 4)</span>
<span class="sd">        &gt;&gt;&gt; mc.fcisolver = fci.solver(mol, singlet=True)</span>
<span class="sd">        &gt;&gt;&gt; mc.fcisolver = fci.direct_spin1.FCISolver(mol)</span>

<span class="sd">        You can control FCISolver by setting e.g.::</span>

<span class="sd">            &gt;&gt;&gt; mc.fcisolver.max_cycle = 30</span>
<span class="sd">            &gt;&gt;&gt; mc.fcisolver.conv_tol = 1e-7</span>

<span class="sd">        For more details of the parameter for FCISolver, See :mod:`fci`.</span>

<span class="sd">        By replacing this fcisolver, you can easily use the CASCI/CASSCF solver</span>
<span class="sd">        with other FCI replacements,  such as DMRG, QMC.  See :mod:`dmrgscf` and</span>
<span class="sd">        :mod:`fciqmcscf`.</span>

<span class="sd">The Following attributes are used for CASSCF</span>

<span class="sd">    conv_tol : float</span>
<span class="sd">        Converge threshold.  Default is 1e-7</span>
<span class="sd">    conv_tol_grad : float</span>
<span class="sd">        Converge threshold for CI gradients and orbital rotation gradients.</span>
<span class="sd">        Default is 1e-4</span>
<span class="sd">    max_stepsize : float</span>
<span class="sd">        The step size for orbital rotation.  Small step size is prefered.</span>
<span class="sd">        Default is 0.03.  </span>
<span class="sd">        (NOTE although the default step size is small enough for many systems,</span>
<span class="sd">        it happens that the orbital optimizor crosses the barriar of local</span>
<span class="sd">        minimum and converge to the neighbour solution, e.g. the CAS(4,4) for</span>
<span class="sd">        C2H4 in the test files.  In these systems, adjusting max_stepsize,</span>
<span class="sd">        max_ci_stepsize and max_cycle_micro, max_cycle_micro_inner and</span>
<span class="sd">        ah_start_tol may be helpful)</span>

<span class="sd">        &gt;&gt;&gt; mc = mcscf.CASSCF(mf, 6, 6)</span>
<span class="sd">        &gt;&gt;&gt; mc.max_stepsize = .01</span>
<span class="sd">        &gt;&gt;&gt; mc.max_cycle_micro = 1</span>
<span class="sd">        &gt;&gt;&gt; mc.max_cycle_macro = 100</span>
<span class="sd">        &gt;&gt;&gt; mc.max_cycle_micro_inner = 1</span>
<span class="sd">        &gt;&gt;&gt; mc.ah_start_tol = 1e-6</span>

<span class="sd">    max_ci_stepsize : float</span>
<span class="sd">        The max size for approximate CI updates.  The approximate updates are</span>
<span class="sd">        used in 1-step algorithm, to estimate the change of CI wavefunction wrt</span>
<span class="sd">        the orbital rotation.  Small step size is prefered.  Default is 0.01.</span>
<span class="sd">    max_cycle_macro : int</span>
<span class="sd">        Max number of macro iterations.  Default is 50.</span>
<span class="sd">    max_cycle_micro : int</span>
<span class="sd">        Max number of micro iterations in each macro iteration.  Depending on</span>
<span class="sd">        systems, increasing this value might reduce the total macro</span>
<span class="sd">        iterations.  Generally, 2 - 3 steps should be enough.  Default is 2.</span>
<span class="sd">    max_cycle_micro_inner : int</span>
<span class="sd">        Max number of steps for the orbital rotations allowed for the augmented</span>
<span class="sd">        hessian solver.  It can affect the actual size of orbital rotation.</span>
<span class="sd">        Even with a small max_stepsize, a few max_cycle_micro_inner can</span>
<span class="sd">        accumulate the rotation and leads to a significant change of the CAS</span>
<span class="sd">        space.  Depending on systems, increasing this value migh reduce the</span>
<span class="sd">        total number of macro iterations.  The value between 2 - 8 is preferred.</span>
<span class="sd">        Default is 4.</span>
<span class="sd">    frozen : int or list</span>
<span class="sd">        If integer is given, the inner-most orbitals are excluded from optimization.</span>
<span class="sd">        Given the orbital indices (0-based) in a list, any doubly occupied core</span>
<span class="sd">        orbitals, active orbitals and external orbitals can be frozen.</span>
<span class="sd">    ah_level_shift : float, for AH solver.</span>
<span class="sd">        Level shift for the Davidson diagonalization in AH solver.  Default is 0.</span>
<span class="sd">    ah_conv_tol : float, for AH solver.</span>
<span class="sd">        converge threshold for Davidson diagonalization in AH solver.  Default is 1e-8.</span>
<span class="sd">    ah_max_cycle : float, for AH solver.</span>
<span class="sd">        Max number of iterations allowd in AH solver.  Default is 20.</span>
<span class="sd">    ah_lindep : float, for AH solver.</span>
<span class="sd">        Linear dependence threshold for AH solver.  Default is 1e-16.</span>
<span class="sd">    ah_start_tol : flat, for AH solver.</span>
<span class="sd">        In AH solver, the orbital rotation is started without completely solving the AH problem.</span>
<span class="sd">        This value is to control the start point. Default is 1e-4.</span>
<span class="sd">    ah_start_cycle : int, for AH solver.</span>
<span class="sd">        In AH solver, the orbital rotation is started without completely solving the AH problem.</span>
<span class="sd">        This value is to control the start point. Default is 3.</span>

<span class="sd">        ``ah_conv_tol``, ``ah_max_cycle``, ``ah_lindep``, ``ah_start_tol`` and ``ah_start_cycle``</span>
<span class="sd">        can affect the accuracy and performance of CASSCF solver.  Lower</span>
<span class="sd">        ``ah_conv_tol`` and ``ah_lindep`` can improve the accuracy of CASSCF</span>
<span class="sd">        optimization, but slow down the performance.</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; from pyscf import gto, scf, mcscf</span>
<span class="sd">        &gt;&gt;&gt; mol = gto.M(atom='N 0 0 0; N 0 0 1', basis='ccpvdz', verbose=0)</span>
<span class="sd">        &gt;&gt;&gt; mf = scf.UHF(mol)</span>
<span class="sd">        &gt;&gt;&gt; mf.scf()</span>
<span class="sd">        &gt;&gt;&gt; mc = mcscf.CASSCF(mf, 6, 6)</span>
<span class="sd">        &gt;&gt;&gt; mc.conv_tol = 1e-10</span>
<span class="sd">        &gt;&gt;&gt; mc.ah_conv_tol = 1e-5</span>
<span class="sd">        &gt;&gt;&gt; mc.kernel()</span>
<span class="sd">        -109.044401898486001</span>
<span class="sd">        &gt;&gt;&gt; mc.ah_conv_tol = 1e-10</span>
<span class="sd">        &gt;&gt;&gt; mc.kernel()</span>
<span class="sd">        -109.044401887945668</span>

<span class="sd">    chkfile : str</span>
<span class="sd">        Checkpoint file to save the intermediate orbitals during the CASSCF optimization.</span>
<span class="sd">        Default is the checkpoint file of mean field object.</span>


<span class="sd">Saved results</span>

<span class="sd">    e_tot : float</span>
<span class="sd">        Total MCSCF energy (electronic energy plus nuclear repulsion)</span>
<span class="sd">    ci : ndarray</span>
<span class="sd">        CAS space FCI coefficients</span>
<span class="sd">    converged : bool, for CASSCF only</span>
<span class="sd">        It indicates CASSCF optimization converged or not.</span>
<span class="sd">    mo_energy: ndarray,</span>
<span class="sd">        Diagonal elements of general Fock matrix</span>
<span class="sd">    mo_coeff : ndarray, for CASSCF only</span>
<span class="sd">        Optimized CASSCF orbitals coefficients</span>
<span class="sd">        Note the orbitals are NOT natural orbitals by default.  There are two</span>
<span class="sd">        inbuilt methods to convert the mo_coeff to natural orbitals.</span>
<span class="sd">        1. Set .natorb attribute.  It can be used before calculation.</span>
<span class="sd">        2. call .cas_natorb_ method after the calculation to in-place convert the orbitals</span>
<span class="sd">'''</span>


<span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">mc1step</span>
<span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">mc1step_symm</span>
<span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">casci</span>
<span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">casci_symm</span>
<span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">addons</span>
<span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">ucasci</span>
<span class="n">casci_uhf</span> <span class="o">=</span> <span class="n">ucasci</span>  <span class="c1"># for backward compatibility</span>
<span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">umc1step</span>
<span class="n">mc1step_uhf</span> <span class="o">=</span> <span class="n">umc1step</span>  <span class="c1"># for backward compatibility</span>
<span class="kn">from</span> <span class="nn">pyscf.mcscf.addons</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">chkfile</span>

<div class="viewcode-block" id="CASSCF"><a class="viewcode-back" href="../../pyscf_api_docs/pyscf.mcscf.html#pyscf.mcscf.CASSCF">[docs]</a><span class="k">def</span> <span class="nf">CASSCF</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">mf_or_mol</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">scf</span><span class="o">.</span><span class="n">uhf</span><span class="o">.</span><span class="n">UHF</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">convert_to_rhf</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="s1">'with_df'</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DFCASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">,</span> <span class="n">frozen</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mf</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span><span class="p">:</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">mc1step_symm</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">,</span> <span class="n">frozen</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">mc1step</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">,</span> <span class="n">frozen</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mc</span></div>

<span class="n">RCASSCF</span> <span class="o">=</span> <span class="n">CASSCF</span>


<div class="viewcode-block" id="CASCI"><a class="viewcode-back" href="../../pyscf_api_docs/pyscf.mcscf.html#pyscf.mcscf.CASCI">[docs]</a><span class="k">def</span> <span class="nf">CASCI</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">mf_or_mol</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">scf</span><span class="o">.</span><span class="n">uhf</span><span class="o">.</span><span class="n">UHF</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">convert_to_rhf</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="s1">'with_df'</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DFCASCI</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mf</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span><span class="p">:</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">casci_symm</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">casci</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mc</span></div>

<span class="n">RCASCI</span> <span class="o">=</span> <span class="n">CASCI</span>


<div class="viewcode-block" id="UCASCI"><a class="viewcode-back" href="../../pyscf_api_docs/pyscf.mcscf.html#pyscf.mcscf.UCASCI">[docs]</a><span class="k">def</span> <span class="nf">UCASCI</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">mf_or_mol</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">scf</span><span class="o">.</span><span class="n">uhf</span><span class="o">.</span><span class="n">UHF</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">convert_to_uhf</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">remove_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mc</span> <span class="o">=</span> <span class="n">ucasci</span><span class="o">.</span><span class="n">UCASCI</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mc</span></div>


<div class="viewcode-block" id="UCASSCF"><a class="viewcode-back" href="../../pyscf_api_docs/pyscf.mcscf.html#pyscf.mcscf.UCASSCF">[docs]</a><span class="k">def</span> <span class="nf">UCASSCF</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">mf_or_mol</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">scf</span><span class="o">.</span><span class="n">uhf</span><span class="o">.</span><span class="n">UHF</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">convert_to_uhf</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">remove_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mc</span> <span class="o">=</span> <span class="n">umc1step</span><span class="o">.</span><span class="n">UCASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">,</span> <span class="n">frozen</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mc</span></div>

<div class="viewcode-block" id="newton"><a class="viewcode-back" href="../../pyscf_api_docs/pyscf.mcscf.html#pyscf.mcscf.newton">[docs]</a><span class="k">def</span> <span class="nf">newton</span><span class="p">(</span><span class="n">mc</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mc</span><span class="o">.</span><span class="n">newton</span><span class="p">()</span></div>


<span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">df</span>
<div class="viewcode-block" id="DFCASSCF"><a class="viewcode-back" href="../../pyscf_api_docs/pyscf.mcscf.html#pyscf.mcscf.DFCASSCF">[docs]</a><span class="k">def</span> <span class="nf">DFCASSCF</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">auxbasis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ncore</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">frozen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">mf_or_mol</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">scf</span><span class="o">.</span><span class="n">uhf</span><span class="o">.</span><span class="n">UHF</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">convert_to_rhf</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">remove_df</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mf</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span><span class="p">:</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">mc1step_symm</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">,</span> <span class="n">frozen</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">mc1step</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">,</span> <span class="n">frozen</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">density_fit</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">auxbasis</span><span class="p">)</span></div>

<div class="viewcode-block" id="DFCASCI"><a class="viewcode-back" href="../../pyscf_api_docs/pyscf.mcscf.html#pyscf.mcscf.DFCASCI">[docs]</a><span class="k">def</span> <span class="nf">DFCASCI</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">auxbasis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ncore</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">,</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mf_or_mol</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">mf_or_mol</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">scf</span><span class="o">.</span><span class="n">uhf</span><span class="o">.</span><span class="n">UHF</span><span class="p">):</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">convert_to_rhf</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">remove_df</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mf</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span><span class="p">:</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">casci_symm</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">casci</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">density_fit</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">auxbasis</span><span class="p">)</span></div>

<span class="n">approx_hessian</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">approx_hessian</span>

<div class="viewcode-block" id="density_fit"><a class="viewcode-back" href="../../pyscf_api_docs/pyscf.mcscf.html#pyscf.mcscf.density_fit">[docs]</a><span class="k">def</span> <span class="nf">density_fit</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">auxbasis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mc</span><span class="o">.</span><span class="n">density_fit</span><span class="p">(</span><span class="n">auxbasis</span><span class="p">,</span> <span class="n">with_df</span><span class="p">)</span></div>

</pre></div>

          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2015-2021, The PySCF Developers.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>