
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>2.1. Self-consistent field (SCF) methods &#8212; PySCF 1.7.5 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/material.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="author" title="About these documents" href="../../about/" />
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="2.2. Density functional theory (DFT)" href="../dft/" />
    <link rel="prev" title="2. Theoretical methods" href="../" /> 
  
   
  
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=yellow>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#theory/scf" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../" title="PySCF 1.7.5 documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">PySCF</span>
          <span class="md-header-nav__topic"> 2.1. Self-consistent field (SCF) methods </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search/" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <script src="../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../"versions.json"",
        target_loc = "../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../../" class="md-tabs__link">PySCF 1.7.5 documentation</a></li>
            
            <li class="md-tabs__item"><a href="../../install/" class="md-tabs__link">Install</a></li>
            
            <li class="md-tabs__item"><a href="../" class="md-tabs__link">User Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../modules/" class="md-tabs__link">Developer Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../api_docs/modules/" class="md-tabs__link">API Docs</a></li>
            
            <li class="md-tabs__item"><a href="../../blog_wrapper/" class="md-tabs__link">Blog</a></li>
            
            <li class="md-tabs__item"><a href="../../about/" class="md-tabs__link">About</a></li>
          <li class="md-tabs__item"><a href="../" class="md-tabs__link"><span class="section-number">2. </span>Theoretical methods</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../" title="PySCF 1.7.5 documentation" class="md-nav__button md-logo">
      
        <img src="../../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../"
       title="PySCF 1.7.5 documentation">PySCF</a>
  </label>
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../../install/" class="md-nav__link">1. Install</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../" class="md-nav__link">2. User Guide</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> 2.1. Self-consistent field (SCF) methods </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">2.1. Self-consistent field (SCF) methods</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#theory-scf--page-root" class="md-nav__link">2.1. Self-consistent field (SCF) methods</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">2.1.1. Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#theory" class="md-nav__link">2.1.2. Theory</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#periodic-boundary-conditions" class="md-nav__link">2.1.2.1. Periodic boundary conditions</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#initial-guess" class="md-nav__link">2.1.3. Initial guess</a>
        </li>
        <li class="md-nav__item"><a href="#accelerating-scf-convergence" class="md-nav__link">2.1.4. Accelerating SCF convergence</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#direct-inversion-in-the-iterative-subspace-diis" class="md-nav__link">2.1.4.1. Direct Inversion in the Iterative Subspace (DIIS)</a>
        </li>
        <li class="md-nav__item"><a href="#co-iterative-augmented-hessian-ciah-second-order-scf-solver-sun2016co" class="md-nav__link">2.1.4.2. Co-iterative augmented hessian (CIAH) second order SCF solver <span class="xref cite">sun2016co</span></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#level-shifting-and-smearing" class="md-nav__link">2.1.5. Level shifting and smearing</a>
        </li>
        <li class="md-nav__item"><a href="#stability-analysis" class="md-nav__link">2.1.6. Stability analysis</a>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">2.1.7. References</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/theory/scf.rst.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../dft/" class="md-nav__link">2.2. Density functional theory (DFT)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mp/" class="md-nav__link">2.3. Møller-Plesset perturbation theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../gw/" class="md-nav__link">2.4. GW method</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../ci/" class="md-nav__link">2.5. Configuration interaction (CI)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../cc/" class="md-nav__link">2.6. Coupled cluster (CC)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../adc/" class="md-nav__link">2.7. Algebraic diagrammatic construction (ADC) scheme</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mcscf/" class="md-nav__link">2.8. Multi-configurational self-consistent field (MCSCF)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../tddft/" class="md-nav__link">2.9. Time-dependent density functional theory (TDDFT)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../rt/" class="md-nav__link">2.10. Real-time time-dependent density functional theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../eomcc/" class="md-nav__link">2.11. Equation-of-motion coupled cluster (EOM-CC)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../pbc/" class="md-nav__link">2.12. Periodic boundary conditions</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../modules/" class="md-nav__link">3. Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../blog_wrapper/" class="md-nav__link">4. Blog</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../about/" class="md-nav__link">5. About</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#theory-scf--page-root" class="md-nav__link">2.1. Self-consistent field (SCF) methods</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">2.1.1. Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#theory" class="md-nav__link">2.1.2. Theory</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#periodic-boundary-conditions" class="md-nav__link">2.1.2.1. Periodic boundary conditions</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#initial-guess" class="md-nav__link">2.1.3. Initial guess</a>
        </li>
        <li class="md-nav__item"><a href="#accelerating-scf-convergence" class="md-nav__link">2.1.4. Accelerating SCF convergence</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#direct-inversion-in-the-iterative-subspace-diis" class="md-nav__link">2.1.4.1. Direct Inversion in the Iterative Subspace (DIIS)</a>
        </li>
        <li class="md-nav__item"><a href="#co-iterative-augmented-hessian-ciah-second-order-scf-solver-sun2016co" class="md-nav__link">2.1.4.2. Co-iterative augmented hessian (CIAH) second order SCF solver <span class="xref cite">sun2016co</span></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#level-shifting-and-smearing" class="md-nav__link">2.1.5. Level shifting and smearing</a>
        </li>
        <li class="md-nav__item"><a href="#stability-analysis" class="md-nav__link">2.1.6. Stability analysis</a>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">2.1.7. References</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/theory/scf.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
             <div class="section" id="self-consistent-field-scf-methods">
<span id="theory-scf"></span><h1><span class="section-number">2.1. </span>Self-consistent field (SCF) methods<a class="headerlink" href="#self-consistent-field-scf-methods" title="Permalink to this headline">¶</a></h1>
<p><em>Modules</em>: <a class="reference internal" href="../../modules/scf/#scf"><span class="std std-ref">scf</span></a>, <a class="reference internal" href="../../modules/pbc/scf/#pbc-scf"><span class="std std-ref">pbc.scf</span></a>, <a class="reference internal" href="../../modules/soscf/#soscf"><span class="std std-ref">soscf</span></a></p>
<div class="section" id="introduction">
<h2><span class="section-number">2.1.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In self-consistent field (SCF) methods, the electron interactions are treated in a mean-field way.
Here, the SCF methods include both Hartree-Fock (HF) theory and Kohn-Sham (KS) density functional theory (DFT).
This Chapter summarizes the general SCF capabilities of PySCF.
For more details specific to DFT, see <a class="reference internal" href="../dft/#theory-dft"><span class="std std-numref">Section 2.2</span></a>.</p>
<p>A minimal example of using the SCF module is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;H 0 0 0; F 0 0 1.1&#39;</span><span class="p">,</span>  <span class="c1"># in Angstrom</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;ccpvdz&#39;</span><span class="p">,</span>
    <span class="n">symmetry</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">HF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>This will run a HF calculation for the hydrogen fluoride molecule using the default SCF settings.</p>
</div>
<div class="section" id="theory">
<h2><span class="section-number">2.1.2. </span>Theory<a class="headerlink" href="#theory" title="Permalink to this headline">¶</a></h2>
<p>In HF and KS-DFT methods, the ground-state wavefunction is approximated by a single Slater determinant,</p>
<div class="math notranslate nohighlight">
\[\begin{split}|\Phi_0\rangle = \frac{1}{\sqrt{N!}}
\begin{vmatrix}
\psi_1(\mathbf{r}_1) &amp;\psi_2(\mathbf{r}_1) &amp;\dots  &amp;\psi_N(\mathbf{r}_1)\\
\psi_1(\mathbf{r}_2) &amp;\psi_2(\mathbf{r}_2) &amp;\dots  &amp;\psi_N(\mathbf{r}_2)\\
\vdots               &amp;\vdots               &amp;\ddots &amp;\vdots\\
\psi_1(\mathbf{r}_N) &amp;\psi_2(\mathbf{r}_N) &amp;\dots  &amp;\psi_N(\mathbf{r}_N)
\end{vmatrix} \;,\end{split}\]</div>
<p>where the molecular orbitals (MO) <span class="math notranslate nohighlight">\(|\psi_i\rangle\)</span> are obtained by solving the Hartree-Fock equtions:</p>
<div class="math notranslate nohighlight">
\[\hat{F}|\psi_i\rangle = \varepsilon_i |\psi_i\rangle \;.\]</div>
<p>The Fock operator <span class="math notranslate nohighlight">\(\hat{F}\)</span>, when represented within the atomic orbital (AO) basis, has the following form
(in a spin unrestricted formalism):</p>
<div class="math notranslate nohighlight">
\[F_{\mu\nu}^{\alpha} = h_{\mu\nu} + J_{\mu\nu} - K_{\mu\nu}^{\alpha} \;,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[h_{\mu\nu} = \left( \mu | \hat{T} |\nu \right) + \left( \mu | \hat{V}_{nuc} |\nu \right) \;,\]</div>
<p>usually called the core Hamiltonian, is the sum of kinetic energy operator and nuclear attraction operator, and</p>
<div class="math notranslate nohighlight">
\[J_{\mu\nu} = \sum_{\lambda\sigma} \left(\mu\nu|\lambda\sigma\right) \left(P_{\lambda\sigma}^{\alpha}+P_{\lambda\sigma}^{\beta}\right)\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[K_{\mu\nu}^{\alpha} = \sum_{\lambda\sigma} \left(\mu\lambda|\nu\sigma\right) P_{\lambda\sigma}^{\alpha}\]</div>
<p>define the Coulomb and exchange operators, respectively.
In the equations above, <span class="math notranslate nohighlight">\(\mathbf{P}\)</span> labels the density matrix:</p>
<div class="math notranslate nohighlight">
\[P_{\mu\nu}^{\alpha} = \sum_{i\in occ} C_{\mu i}^{\alpha} C_{i\nu}^{\alpha\dagger} \;,\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{C}\)</span> represents the MO coefficients:</p>
<div class="math notranslate nohighlight">
\[|\psi^{\alpha}\rangle  = \sum_{\mu} |\mu\rangle C_{\mu i}^{\alpha} \;.\]</div>
<p>Within the AO representation, the Hartree-Fock equations reduce to the Roothaan-Hall or Pople-Nesbet <span id="id1">[<span>pople1954self</span>]</span> equations:</p>
<div class="math notranslate nohighlight">
\[\mathbf{F}^{\alpha} \mathbf{C}^{\alpha} = \boldsymbol{\varepsilon}^{\alpha} \mathbf{S} \mathbf{C}^{\alpha} \;,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[S_{\mu\nu} = \left( \mu | \nu \right)\]</div>
<p>is the AO overlap matrix.
Note that as the Coulomb and exchange operators depend on the electron density,
solving the Hartree-Fock equation is a nonlinear procedure,
which requires iteratively updating the MOs and the Fock operator until reaching self-consistency.
Finally, with the converged MOs or density matrix, one may compute various ground-state properties.
For example, the ground-state electronic energy is expressed as</p>
<div class="math notranslate nohighlight">
\[E_{\rm HF} = \frac{1}{2} \left\{{\rm Tr}[\mathbf{h}(\mathbf{P}^{\alpha}+\mathbf{P}^{\beta})]
           + {\rm Tr}(\mathbf{F}^{\alpha}\mathbf{P}^{\alpha}) + {\rm Tr}(\mathbf{F}^{\beta}\mathbf{P}^{\beta}) \right\} \;.\]</div>
<div class="section" id="periodic-boundary-conditions">
<h3><span class="section-number">2.1.2.1. </span>Periodic boundary conditions<a class="headerlink" href="#periodic-boundary-conditions" title="Permalink to this headline">¶</a></h3>
<p>PySCF also alows the user to perform SCF calculations for solids.
With crystalline Gaussian-type AOs as the underlying single-partial basis (see <a class="reference internal" href="../pbc/gto/#theory-pbc-gto"><span class="std std-numref">Section 2.12.1</span></a>),
the molecular SCF code can be easily adapted to the cases where periodic boundary conditions (PBCs)
are applied. Instead of solving only one set of Roothaan-Hall or Pople-Nesbet equtions for molecules,
it is now necessary to solve them for each k point for solids:</p>
<div class="math notranslate nohighlight">
\[\mathbf{F}(\mathbf{k}) \mathbf{C}(\mathbf{k}) = \boldsymbol{\varepsilon}(\mathbf{k}) \mathbf{S}(\mathbf{k}) \mathbf{C}(\mathbf{k}) \;,\]</div>
<p>where the Fock matrix is defined (within the restricted formalism) as</p>
<div class="math notranslate nohighlight">
\[\mathbf{F}(\mathbf{k}) = \mathbf{T}(\mathbf{k}) + \mathbf{V}^{\rm PP}(\mathbf{k})
+\mathbf{J}(\mathbf{k}) - \frac{1}{2} \mathbf{K}(\mathbf{k}) + \mathbf{V}^{L+J}(\mathbf{k}) \;.\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\mathbf{V}^{\rm PP}\)</span> denotes the pseudopotential contribution and
<span class="math notranslate nohighlight">\(\mathbf{V}^{L+J}\)</span> deals with the divergence of local pseudopotential and Hartree potential (see below).</p>
<p>The one-electron overlap, kinetic energy, and local pseudopotential integrals
are evaluated through numerical integrations on the real-space grid according to</p>
<div class="math notranslate nohighlight">
\[S_{\mu\nu}(\mathbf{k}) = \int_\Omega d\mathbf{r} \phi_{\mu\mathbf{k}}^{*}(\mathbf{r}) \phi_{\nu\mathbf{k}}(\mathbf{r}) \;,\]</div>
<div class="math notranslate nohighlight">
\[T_{\mu\nu}(\mathbf{k}) = -\frac{1}{2} \int_\Omega d\mathbf{r} \phi_{\mu\mathbf{k}}^{*}(\mathbf{r})
\boldsymbol{\nabla}_{\mathbf{r}}^2 \phi_{\nu\mathbf{k}}(\mathbf{r}) \;,\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[V_{\mu\nu}^{\rm L-PP}(\mathbf{k}) = \int_\Omega d\mathbf{r} \phi_{\mu\mathbf{k}}^{*}(\mathbf{r})
v^{\rm L-PP}(\mathbf{r}) \phi_{\nu\mathbf{k}}(\mathbf{r}) \;,\]</div>
<p>where <span class="math notranslate nohighlight">\(\Omega\)</span> labels the unit cell volume.
The non-local part of the pseudopotential is computed in the reciprocal space:</p>
<div class="math notranslate nohighlight">
\[V_{\mu\nu}^{\rm NL-PP}(\mathbf{k}) = \Omega \sum_{\mathbf{G},\mathbf{G}'} \phi_{\mu\mathbf{k}}^{*}(\mathbf{G})
v^{\rm NL-PP}(\mathbf{k}+\mathbf{G}, \mathbf{k}+\mathbf{G}') \phi_{\nu\mathbf{k}}(\mathbf{G}') \;,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[v^{\rm NL-PP}(\mathbf{k}+\mathbf{G}, \mathbf{k}+\mathbf{G}') = \frac{1}{\Omega} \int d\mathbf{r} \int d\mathbf{r}'
e^{-i(\mathbf{k}+\mathbf{G})\cdot\mathbf{r}} v^{\rm NL-PP}(\mathbf{r},\mathbf{r}')
e^{ i(\mathbf{k}+\mathbf{G}^{'})\cdot\mathbf{r}'} \;.\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The way that the pseudopotential integrals are computed differs in different density fitting schemes and for different
pseudopotentials. Interested readers should refer to <a class="reference internal" href="../pbc/df/#theory-pbc-df"><span class="std std-numref">Section 2.12.2</span></a> and <a class="reference internal" href="../pbc/pp/#theory-pbc-pp"><span class="std std-numref">Section 2.12.3</span></a>.</p>
</div>
<p>The Coulomb and exchange matrices are defined similarly as</p>
<div class="math notranslate nohighlight">
\[J_{\mu\nu}(\mathbf{k}) = \int_{\Omega} d\mathbf{r} \phi_{\mu\mathbf{k}}^{*}(\mathbf{r}) v_{\rm H}(\mathbf{r}) \phi_{\nu\mathbf{k}}(\mathbf{r}) \;,\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[K_{\mu\nu}(\mathbf{k}) = \int_{\Omega} d\mathbf{r} \int d\mathbf{r}' \phi_{\mu\mathbf{k}}^{*}(\mathbf{r})
\frac{\rho(\mathbf{r}, \mathbf{r}')}{|\mathbf{r}-\mathbf{r}'|} \phi_{\nu\mathbf{k}}(\mathbf{r}') \;.\]</div>
<p>Here <span class="math notranslate nohighlight">\(v_{\rm H}\)</span> is the Hartree potential</p>
<div class="math notranslate nohighlight">
\[v_{\rm H}(\mathbf{r}) = \frac{4\pi}{\Omega} \sum_{\mathbf{G}\neq \mathbf{0}} \frac{\rho(\mathbf{G})}{G^2} e^{i\mathbf{G}\cdot\mathbf{r}} \;,\]</div>
<p>and <span class="math notranslate nohighlight">\(\rho(\mathbf{r}, \mathbf{r}')\)</span> is the density matrix</p>
<div class="math notranslate nohighlight">
\[\rho(\mathbf{r}, \mathbf{r}') =  \sum_{\mathbf{k}} w_{\mathbf{k}} \sum_{\lambda\sigma} P_{\lambda\sigma}(\mathbf{k})
\phi_{\lambda\mathbf{k}}(\mathbf{r}) \phi_{\sigma\mathbf{k}}^{*}(\mathbf{r}') \;,\]</div>
<p>where <span class="math notranslate nohighlight">\(w_{\mathbf{k}}\)</span> represents the weight of each k point.</p>
<p>Note that the local part of the pseudopotential and the Hartree potential diverge at <span class="math notranslate nohighlight">\(G=0\)</span>;
however, their sum is not, which leads to the <span class="math notranslate nohighlight">\(V^{\rm L+J}\)</span> term (for charge neutral unit cell):</p>
<div class="math notranslate nohighlight">
\[V_{\mu\nu}^{\rm L+J} (\mathbf{k})  = \frac{S_{\mu\nu}}{\Omega}
\int d\mathbf{r} \left(v^{\rm L-PP}(\mathbf{r}) + \sum_{\alpha} \frac{Z_{\alpha}e^2}{r} \right) \;,\]</div>
<p>where <span class="math notranslate nohighlight">\(Z_{\alpha}\)</span> denotes the nuclear charge of the <span class="math notranslate nohighlight">\(\alpha\)</span>-th atom.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For details about how to compute the Coulomb (J)
and exchange (K) integrals, see <a class="reference internal" href="../pbc/df/#theory-pbc-df"><span class="std std-numref">Section 2.12.2</span></a>.</p>
</div>
<p>Finally, the total electronic energy differs from the molecular case only by a k-point summation:</p>
<div class="math notranslate nohighlight">
\[E_{\rm HF} = \sum_{\mathbf{k}} w_{\mathbf{k}} E_{\rm HF}(\mathbf{k}) \;,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[E_{\rm HF}(\mathbf{k}) = \frac{1}{2} \left\{ {\rm Tr}\left[\mathbf{h}(\mathbf{k}) (\mathbf{P}^{\alpha}(\mathbf{k})+\mathbf{P}^{\beta}(\mathbf{k}))\right]
           + {\rm Tr}\left[\mathbf{F}^{\alpha}(\mathbf{k}) \mathbf{P}^{\alpha}(\mathbf{k})\right]
           + {\rm Tr}\left[\mathbf{F}^{\beta}(\mathbf{k}) \mathbf{P}^{\beta}(\mathbf{k})\right] \right\} \;.\]</div>
</div>
</div>
<div class="section" id="initial-guess">
<h2><span class="section-number">2.1.3. </span>Initial guess<a class="headerlink" href="#initial-guess" title="Permalink to this headline">¶</a></h2>
<p>As the Roothaan-Hall and Pople-Nesbet equations are solved iteratively,
an initial guess for the MOs or the density matrices must be supplied.
Poor initial guess may cause slow convergence or even divergence of the procedure.
Furthermore, when treating magnetic or open-shell systems,
the initial guess must be carefully chosen in order to get the correct state.</p>
<p>There are several options available in PySCF for selecting the initial guess to solve the
SCF problem. One can set the attribute <code class="xref py py-attr docutils literal notranslate"><span class="pre">mf.init_guess</span></code>
to the following values to generate the initial guess in different ways:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'minao'</span></code> (default)</p>
<blockquote>
<div><p>The initial guess density matrix is first generated based on the atomic natural orbital (ANO) basis
<span id="id2">[<span>widmark1990density</span><span>roos2004relativistic</span><span>roos2004main</span><span>roos2005new</span><span>roos2005new_a</span><span>roos2008new</span>]</span>,
then projected onto the basis set used for the SCF calculation.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'hcore'</span></code></p>
<blockquote>
<div><p>The core Hamiltonian is diagonalized to get the initial MOs.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'atom'</span></code></p>
<blockquote>
<div><p>The initial guess density matrix is from the superposition of atomic HF
density matrix. Commonly know as the ‘SAD’ method.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'chk'</span></code></p>
<blockquote>
<div><p>Read the existing SCF results from the checkpoint file, then the density matrix is projected onto the
basis set used for the new SCF calculation.</p>
</div></blockquote>
</li>
</ul>
<p>Alternatively, the user could manually set the initial guess density matrix for an SCF calculation
by using the <code class="docutils literal notranslate"><span class="pre">'dm0'</span></code> argument.
For example, the followings script first computes the HF density matrix for <span class="math notranslate nohighlight">\(\rm Cr^{6+}\)</span> cation,
which is then used as the initial guess for the HF calculation of <span class="math notranslate nohighlight">\(\rm Cr\)</span> atom.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># use cation to produce initial guess</span>
<span class="c1">#</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
    <span class="n">symmetry</span> <span class="o">=</span> <span class="s1">&#39;D2h&#39;</span><span class="p">,</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Cr&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">],</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;cc-pvdz&#39;</span><span class="p">,</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">dm1</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">()</span>

<span class="n">mol</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">dm0</span><span class="o">=</span><span class="n">dm1</span><span class="p">)</span>
</pre></div>
</div>
<p>More examples can be found in
<a class="reference download internal" download="" href="../../_downloads/7db983b4c7af0e0965fd71eaf5e9c8b2/15-initial_guess.py"><code class="xref download docutils literal notranslate"><span class="pre">examples/scf/15-initial_guess.py</span></code></a>.</p>
</div>
<div class="section" id="accelerating-scf-convergence">
<h2><span class="section-number">2.1.4. </span>Accelerating SCF convergence<a class="headerlink" href="#accelerating-scf-convergence" title="Permalink to this headline">¶</a></h2>
<div class="section" id="direct-inversion-in-the-iterative-subspace-diis">
<h3><span class="section-number">2.1.4.1. </span>Direct Inversion in the Iterative Subspace (DIIS)<a class="headerlink" href="#direct-inversion-in-the-iterative-subspace-diis" title="Permalink to this headline">¶</a></h3>
<p>At convergence of an SCF calcuation, one should expect the density matrix commute with
the Fock matrix:</p>
<div class="math notranslate nohighlight">
\[\mathbf{SPF} - \mathbf{FPS} = \mathbf{0} \;.\]</div>
<p>Prior to convergence, it is possible to define an error vector as</p>
<div class="math notranslate nohighlight">
\[\mathbf{e}_i \equiv \mathbf{S}\mathbf{P}_i\mathbf{F}_i - \mathbf{F}_i\mathbf{P}_i\mathbf{S} \;,\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{F}_i\)</span> is a linear combination of the Fock matrices in the previous SCF cycles:</p>
<div class="math notranslate nohighlight">
\[\mathbf{F}_i = \sum_{k=i-L}^{i-1} c_k \mathbf{F}_k \;,\]</div>
<p><span class="math notranslate nohighlight">\(\mathbf{P}_i\)</span> is obtained by diagonalizing <span class="math notranslate nohighlight">\(\mathbf{F}_i\)</span>, and
<span class="math notranslate nohighlight">\(L\)</span> is the size of the DIIS subspace, which can be modified by setting the <code class="xref py py-attr docutils literal notranslate"><span class="pre">mf.diis_space</span></code> attribute
(the default size is 8).
The DIIS method <span id="id3">[<span>pulay1980convergence</span><span>pulay1982improved</span>]</span>
minimizes the square of the error vector
with respect to the DIIS coefficients <span class="math notranslate nohighlight">\(c_k\)</span>
under the constraint that <span class="math notranslate nohighlight">\(\sum_k c_k = 1\)</span>.
The Euler–Lagrange equation of such a constrained minimization problem reads:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left(
\begin{array}{cccc}
\mathbf{e}_1\cdot\mathbf{e}_1  &amp;\dots  &amp;\mathbf{e}_1\cdot\mathbf{e}_L  &amp;1      \\
\vdots                         &amp;\ddots &amp;\vdots                         &amp;\vdots \\
\mathbf{e}_L\cdot\mathbf{e}_1  &amp;\dots  &amp;\mathbf{e}_L\cdot\mathbf{e}_L  &amp;1      \\
1                              &amp;\dots  &amp;1                              &amp;0
\end{array}
\right) \left(
\begin{array}{c}
c_1    \\
\vdots \\
c_{L}  \\
\lambda
\end{array}
\right) = \left(
\begin{array}{c}
0       \\
\vdots  \\
0       \\
1
\end{array}
\right)\end{split}\]</div>
<p>PySCF also implements two other similar DIIS algorithms,
namely, EDIIS <span id="id4">[<span>kudin2002black</span>]</span> and ADIIS <span id="id5">[<span>hu2010accelerating</span>]</span>.
Interested readers should refer to the reference.
An example of selecting different DIIS schemes can be found in
<a class="reference download internal" download="" href="../../_downloads/9e2c5975983ce36d128ffe4f431d1c93/24-tune_diis.py"><code class="xref download docutils literal notranslate"><span class="pre">examples/scf/24-tune_diis.py</span></code></a></p>
</div>
<div class="section" id="co-iterative-augmented-hessian-ciah-second-order-scf-solver-sun2016co">
<h3><span class="section-number">2.1.4.2. </span>Co-iterative augmented hessian (CIAH) second order SCF solver <span id="id6">[<span>sun2016co</span>]</span><a class="headerlink" href="#co-iterative-augmented-hessian-ciah-second-order-scf-solver-sun2016co" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="level-shifting-and-smearing">
<h2><span class="section-number">2.1.5. </span>Level shifting and smearing<a class="headerlink" href="#level-shifting-and-smearing" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="stability-analysis">
<h2><span class="section-number">2.1.6. </span>Stability analysis<a class="headerlink" href="#stability-analysis" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="references">
<h2><span class="section-number">2.1.7. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<span class="target" id="id7"></span></div>
</div>

<div class="section">
   
</div>

          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="../" title="2. Theoretical methods"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> <span class="section-number">2. </span>Theoretical methods </span>
              </div>
            </a>
          
          
            <a href="../dft/" title="2.2. Density functional theory (DFT)"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> <span class="section-number">2.2. </span>Density functional theory (DFT) </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2021, James E. T. Smith.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>