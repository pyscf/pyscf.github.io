
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>2.16.3. Density fitting for crystalline calculations &#8212; PySCF 1.7.5.2 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/material.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../../../_static/favicon-32x32.png"/>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <link rel="next" title="2.16.4. Mixing PBC and molecular modules" href="../mix_mol/" />
    <link rel="prev" title="2.16.2. SCF and DFT methods" href="../scf/" /> 
  
   
  
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=amber>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#user/pbc/df" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../" title="PySCF 1.7.5.2 documentation"
           class="md-header-nav__button md-logo">
          
              <img src="../../../_static/pyscf-logo-white.svg" height="26"
                   alt="PySCF 1.7.5.2 documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">PySCF 1.7.5.2</span>
          <span class="md-header-nav__topic"> 2.16.3. Density fitting for crystalline calculations </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../../search/" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../../"versions.json"",
        target_loc = "../../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../../../" class="md-tabs__link">Home</a></li>
            
            <li class="md-tabs__item"><a href="../../../install/" class="md-tabs__link">Install</a></li>
            
            <li class="md-tabs__item"><a href="../../" class="md-tabs__link">User Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../../develop/" class="md-tabs__link">Developer Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../../api_docs/modules/" class="md-tabs__link">API Docs</a></li>
            
            <li class="md-tabs__item"><a href="../../../blog_wrapper/" class="md-tabs__link">Blog</a></li>
            
            <li class="md-tabs__item"><a href="../../../about/" class="md-tabs__link">About</a></li>
          <li class="md-tabs__item"><a href="../../" class="md-tabs__link"><span class="section-number">2. </span>User guide</a></li>
          <li class="md-tabs__item"><a href="../" class="md-tabs__link"><span class="section-number">2.16. </span>Periodic boundary conditions</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../" title="PySCF 1.7.5.2 documentation" class="md-nav__button md-logo">
      
        <img src="../../../_static/pyscf-logo-white.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../../"
       title="PySCF 1.7.5.2 documentation">PySCF 1.7.5.2</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../../../install/" class="md-nav__link">1. Install</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../" class="md-nav__link">2. User Guide</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../../gto/" class="md-nav__link">2.1. Molecular structure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../scf/" class="md-nav__link">2.2. Self-consistent field (SCF) methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../dft/" class="md-nav__link">2.3. Density functional theory (DFT)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../mp/" class="md-nav__link">2.4. Second-Order Møller–Plesset Perturbation Theory (MP2)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../gw/" class="md-nav__link">2.5. GW approximation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../ci/" class="md-nav__link">2.6. Configuration interaction (CISD and FCI)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../cc/" class="md-nav__link">2.7. Coupled-cluster theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../adc/" class="md-nav__link">2.8. Algebraic diagrammatic construction (ADC) scheme</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../mcscf/" class="md-nav__link">2.9. Multi-configuration self-consistent field (MCSCF)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../tddft/" class="md-nav__link">2.10. Time-dependent Hartree-Fock and Density Functional Theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../rt/" class="md-nav__link">2.11. Real-time time-dependent density functional theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../solvent/" class="md-nav__link">2.12. Solvation models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../qmmm/" class="md-nav__link">2.13. QM/MM methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../x2c/" class="md-nav__link">2.14. Relativistic calculations</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../df/" class="md-nav__link">2.15. Density fitting</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../" class="md-nav__link">2.16. Periodic boundary conditions</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../develop/" class="md-nav__link">3. Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../../blog_wrapper/" class="md-nav__link">4. Blog</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#user-pbc-df--page-root" class="md-nav__link">2.16.3. Density fitting for crystalline calculations</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">2.16.3.1. Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#using-df-in-periodic-calculations" class="md-nav__link">2.16.3.2. Using DF in periodic calculations</a>
        </li>
        <li class="md-nav__item"><a href="#controlling-df-error" class="md-nav__link">2.16.3.3. Controlling DF error</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#fftdf" class="md-nav__link">2.16.3.3.1. FFTDF</a>
        </li>
        <li class="md-nav__item"><a href="#gdf" class="md-nav__link">2.16.3.3.2. GDF</a>
        </li>
        <li class="md-nav__item"><a href="#mdf" class="md-nav__link">2.16.3.3.3. MDF</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#saving-and-reusing-df-integrals" class="md-nav__link">2.16.3.4. Saving and reusing DF integrals</a>
        </li>
        <li class="md-nav__item"><a href="#choice-of-df-methods" class="md-nav__link">2.16.3.5. Choice of DF methods</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#type-of-calculations" class="md-nav__link">2.16.3.5.1. Type of calculations</a>
        </li>
        <li class="md-nav__item"><a href="#required-accuracy" class="md-nav__link">2.16.3.5.2. Required accuracy</a>
        </li>
        <li class="md-nav__item"><a href="#computational-resources" class="md-nav__link">2.16.3.5.3. Computational resources</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">2.16.3.6. References</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../../_sources/user/pbc/df.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
             <div class="section" id="density-fitting-for-crystalline-calculations">
<span id="user-pbc-df"></span><h1><span class="section-number">2.16.3. </span>Density fitting for crystalline calculations<a class="headerlink" href="#density-fitting-for-crystalline-calculations" title="Permalink to this headline">¶</a></h1>
<p><em>Modules</em>: <a class="reference internal" href="../../df/#module-df" title="df: Density fitting and RI approximation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">df</span></code></a>, <a class="reference internal" href="../../../modules/pbc/df/#module-pbc.df" title="pbc.df: Density fitting and RI approximation with periodic boundary conditions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pbc.df</span></code></a></p>
<div class="section" id="introduction">
<h2><span class="section-number">2.16.3.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Like for molecular calculations, density fitting (DF) is useful to reduce the computational cost of manipulating the electron repulsion integrals (ERIs) in periodic calculations. Currently, PySCF provides three periodic DF methods that are different in the auxiliary basis functions being used.</p>
<ul class="simple">
<li><p>The fast Fourier transform density fitting (<code class="xref py py-class docutils literal notranslate"><span class="pre">FFTDF</span></code>) uses plane waves (PWs) as the auxiliary basis functions. FFTDF is also known as the Gaussian and plane wave (GPW) approach in literature and other software packages. <span id="id1">[<span>VandeVondele05CPC</span><span>Kuhne20JCP</span>]</span></p></li>
<li><p>The Gaussian density fitting (<code class="xref py py-class docutils literal notranslate"><span class="pre">GDF</span></code>) uses Gaussian-type orbitals (GTOs) as the auxiliary basis functions. <span id="id2">[<span>Sun17JCP</span>]</span></p></li>
<li><p>The mixed density fitting (<code class="xref py py-class docutils literal notranslate"><span class="pre">MDF</span></code>) uses both PWs and GTOs as the auxiliary basis functions. <span id="id3">[<span>Sun17JCP</span>]</span></p></li>
</ul>
<p>This section of the user document covers the basic usage of these DF methods in periodic calculations. The recommended choice of DF methods for different applications is also provided. See <span class="xref std std-ref">theory_df</span> for the use of DF in molecular calculations.</p>
</div>
<div class="section" id="using-df-in-periodic-calculations">
<h2><span class="section-number">2.16.3.2. </span>Using DF in periodic calculations<a class="headerlink" href="#using-df-in-periodic-calculations" title="Permalink to this headline">¶</a></h2>
<p>Unlike for molecular calculations, DF is used by default in periodic SCF calculations. For example, initialize a KRHF object uses FFTDF by default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s2">&quot;He 0 0 0&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s2">&quot;6-31g&quot;</span><span class="p">)</span>
<span class="n">kpts</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">make_kpts</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="p">)</span>  <span class="c1"># &lt;pyscf.pbc.df.fft.FFTDF at 0x7feb78373c88&gt;</span>
</pre></div>
</div>
<p>The periodic SCF class also provides methods for using GDF:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span>
</pre></div>
</div>
<p>and MDF:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span><span class="o">.</span><span class="n">mix_density_fit</span><span class="p">()</span>
</pre></div>
</div>
<p>In addition to using the APIs above, the user can also initialize a DF method first and overwrite the attribute <code class="xref py py-attr docutils literal notranslate"><span class="pre">with_df</span></code> of the SCF object. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="kn">import</span> <span class="n">df</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">GDF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">with_df</span> <span class="o">=</span> <span class="n">mydf</span>
</pre></div>
</div>
<p>Once the periodic mean-field calculation is done, the subsequent correlated calculations will automatically use the same DF method to handle ERIs. For example, a MP2 calculation using GDF can be performed as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="o">...</span> <span class="c1"># initialize cell and kpts</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="kn">import</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>         <span class="c1"># perform HF with GDF</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mmp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">KMP2</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mmp</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>        <span class="c1"># perform MP2 with GDF</span>
</pre></div>
</div>
</div>
<div class="section" id="controlling-df-error">
<h2><span class="section-number">2.16.3.3. </span>Controlling DF error<a class="headerlink" href="#controlling-df-error" title="Permalink to this headline">¶</a></h2>
<p>The DF error is introduced by the incompleteness of the finite auxiliary basis used to expand the atomic orbital pair densities. The DF error can often be reduced by increasing the number of auxiliary basis functions being used.</p>
<div class="section" id="fftdf">
<span id="df-err-fftdf"></span><h3><span class="section-number">2.16.3.3.1. </span>FFTDF<a class="headerlink" href="#fftdf" title="Permalink to this headline">¶</a></h3>
<p>FFTDF uses plane waves (PWs) as the auxiliary basis, whose size is determined by <code class="xref py py-attr docutils literal notranslate"><span class="pre">FFTDF.mesh</span></code>, which is set to <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.mesh</span></code> upon initialization. <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.mesh</span></code> is a 1d array-like object of three integer numbers, <code class="docutils literal notranslate"><span class="pre">[nx,</span> <span class="pre">ny,</span> <span class="pre">nz]</span></code>, that defines the number of PWs (or the real-space grid points in the unit cell) for <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(z\)</span> directions, respectively. The total number of PWs being used for FFTDF is hence <code class="docutils literal notranslate"><span class="pre">nx</span> <span class="pre">*</span> <span class="pre">ny</span> <span class="pre">*</span> <span class="pre">nz</span></code>. PySCF determines <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.mesh</span></code> from <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.ke_cutoff</span></code> - the kinetic energy cutoff. By default, <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.ke_cutoff</span></code> is determined by requiring the PW expansion of the most compact atomic orbitals in the basis set to achieve <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.precision</span></code>.</p>
<p>To use a PW basis of size other than the default, the user can either overwrite <code class="xref py py-attr docutils literal notranslate"><span class="pre">FFTDF.mesh</span></code> directly, or change it by changing <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.ke_cutoff</span></code>. An example is provided as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">print_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mesh = [</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">]  (</span><span class="si">%d</span><span class="s2"> PWs)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="o">*</span><span class="n">mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">mesh</span><span class="p">)))</span>

<span class="n">cell</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s2">&quot;He 0 0 0&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s2">&quot;gth-dzvp&quot;</span><span class="p">,</span> <span class="n">pseudo</span><span class="o">=</span><span class="s2">&quot;gth-pade&quot;</span><span class="p">)</span>
<span class="n">kpts</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">make_kpts</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">mydf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">FFTDF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span>
<span class="n">print_mesh</span><span class="p">(</span><span class="n">mydf</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
<span class="c1"># output: mesh = [42, 42, 42]  (74088 PWs)</span>
<span class="n">mydf</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">]</span>
<span class="n">print_mesh</span><span class="p">(</span><span class="n">mydf</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
<span class="c1"># output: mesh = [17, 17, 17]  (4913 PWs)</span>
<span class="n">cell</span><span class="o">.</span><span class="n">ke_cutoff</span> <span class="o">=</span> <span class="mi">60</span>   <span class="c1"># unit: Rydberg</span>
<span class="n">cell</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>          <span class="c1"># rebuild cell to update cell.mesh</span>
<span class="n">mydf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">FFTDF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span>
<span class="n">print_mesh</span><span class="p">(</span><span class="n">mydf</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
<span class="c1"># output: mesh = [14, 14, 14]  (2744 PWs)</span>
</pre></div>
</div>
<p>Note that PySCF’s default for <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.precision</span></code> is relatively conservative (<span class="math notranslate nohighlight">\(10^{-8} E_h\)</span>). This often leads to a <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.ke_cutoff</span></code> higher than the default used by other packages using FFTDF. <span id="id4">[<span>Kuhne20JCP</span>]</span>
For a more cost-effective choice, the user can scan over a series of <code class="xref py py-attr docutils literal notranslate"><span class="pre">mesh</span></code> size (or <code class="xref py py-attr docutils literal notranslate"><span class="pre">ke_cutoff</span></code> values) and monitor the convergence of e.g., the converged SCF energies.</p>
</div>
<div class="section" id="gdf">
<h3><span class="section-number">2.16.3.3.2. </span>GDF<a class="headerlink" href="#gdf" title="Permalink to this headline">¶</a></h3>
<p>GDF uses Gaussian-type orbitals (GTOs) as the auxiliary basis and parallels the <a class="reference internal" href="../../df/#module-df" title="df: Density fitting and RI approximation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">df</span></code></a> module for molecular calculations. We guide the readers to <a class="reference internal" href="../../df/#choice-of-auxbasis"><span class="std std-ref">Choice of auxiliary basis</span></a> for more details on how to choose the auxiliary basis sets for GDF. A GDF-specific example can be found in <a href="#id5"><span class="problematic" id="id6">:source:`examples/pbc/35-gaussian_density_fit.py`</span></a>.</p>
</div>
<div class="section" id="mdf">
<h3><span class="section-number">2.16.3.3.3. </span>MDF<a class="headerlink" href="#mdf" title="Permalink to this headline">¶</a></h3>
<p>MDF uses mixed GTOs and PWs as the fitting basis. The GTO part of the auxiliary basis can be set in the same way as for GDF (again, see <a class="reference internal" href="../../df/#choice-of-auxbasis"><span class="std std-ref">Choice of auxiliary basis</span></a>), while the PW part is similar to FFTDF, i.e., setting either <code class="xref py py-attr docutils literal notranslate"><span class="pre">MDF.mesh</span></code> or <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.ke_cutoff</span></code>. The default size of the PW basis is also relatively conservative, and the user is recommended to conduct a convergence test as mentioned in <a class="reference internal" href="#df-err-fftdf"><span class="std std-ref">FFTDF</span></a>.</p>
</div>
</div>
<div class="section" id="saving-and-reusing-df-integrals">
<h2><span class="section-number">2.16.3.4. </span>Saving and reusing DF integrals<a class="headerlink" href="#saving-and-reusing-df-integrals" title="Permalink to this headline">¶</a></h2>
<p>While FFTDF is implemented in the so-called integral-direct manner and needs no “initialization”, both GDF and MDF pre-compute required integrals and dump them to disk for later use. The APIs for saving and reusing GDF/MDF integrals are the same as in the molecular <a class="reference internal" href="../../df/#module-df" title="df: Density fitting and RI approximation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">df</span></code></a> module; we guide the user to <a class="reference internal" href="../../df/#save-reuse-df-integrals"><span class="std std-ref">Saving and reusing DF integrals</span></a> for a detailed description. An example is provided in <a href="#id7"><span class="problematic" id="id8">:source:`examples/pbc/35-gaussian_density_fit.py`</span></a>.</p>
</div>
<div class="section" id="choice-of-df-methods">
<h2><span class="section-number">2.16.3.5. </span>Choice of DF methods<a class="headerlink" href="#choice-of-df-methods" title="Permalink to this headline">¶</a></h2>
<p>The choice of DF methods depends on the type of applications, the required accuracy, and the available computational resources.</p>
<div class="section" id="type-of-calculations">
<h3><span class="section-number">2.16.3.5.1. </span>Type of calculations<a class="headerlink" href="#type-of-calculations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>For <strong>all-electron</strong> calculations, only GDF and MDF can be used, while FFTDF would require an impractically large PW basis to describe the core orbitals accurately (hydrogen and helium are two exceptions since they don’t have core orbitals).</p></li>
<li><p>For <strong>pseudopotential (PP)</strong>-based calculations, all three DF methods can be used.</p></li>
<li><p>For calculations on <strong>low-dimension</strong> systems (0D, 1D, and 2D), only GDF and MDF can be used. The user needs to specify the dimension by setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.dimension</span></code>.</p></li>
</ul>
</div>
<div class="section" id="required-accuracy">
<h3><span class="section-number">2.16.3.5.2. </span>Required accuracy<a class="headerlink" href="#required-accuracy" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>FFTDF can be regarded “exact” for PP-based calculations within the given AO basis if a sufficiently large PW basis is used.</p></li>
<li><p>GDF has a typical error of <span class="math notranslate nohighlight">\(10^{-5} \sim 10^{-4} E_h\)</span> when using PySCF’s default auxiliary basis. <span id="id9">[<span>Sun17JCP</span><span>Ye20arXiv</span>]</span> This error can be reduced by using a larger auxiliary basis set. <span id="id10">[<span>Ye20arXiv</span>]</span></p></li>
<li><p>MDF is in general more accurate than GDF and comparable to FFTDF if a sufficiently large PW basis is used. The typical error of MDF is <span class="math notranslate nohighlight">\(10^{-6} E_h\)</span> or lower with the default parameters. <span id="id11">[<span>Sun17JCP</span>]</span></p></li>
</ul>
</div>
<div class="section" id="computational-resources">
<h3><span class="section-number">2.16.3.5.3. </span>Computational resources<a class="headerlink" href="#computational-resources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>GDF requires <strong>enough disk space</strong> to hold the pre-computed DF integrals. The size of these integrals grows quickly with the system size and scales as <span class="math notranslate nohighlight">\(O(N_k^2 n_{\mathrm{AO}}^2 n_{\mathrm{aux}})\)</span>, where <span class="math notranslate nohighlight">\(N_k\)</span> is the number of k-points, <span class="math notranslate nohighlight">\(n_{\mathrm{AO}}\)</span> is the number of AOs per unit cell, and <span class="math notranslate nohighlight">\(n_{\mathrm{aux}}\)</span> is the number of auxiliary basis functions per unit cell. Note that for DFT calculations using pure exchange-correlation functionals (LDA and GGA), the storage requirement reduces to <span class="math notranslate nohighlight">\(O(N_k n_{\mathrm{AO}}^2 n_{\mathrm{aux}})\)</span>, which is much more modest.</p></li>
<li><p>FFTDF uses very little disk space but requires <span class="math notranslate nohighlight">\(O(N_k n_{\mathrm{AO}}^2 N_{\mathrm{PW}})\)</span> <strong>memory</strong>, where <span class="math notranslate nohighlight">\(N_{\mathrm{PW}}\)</span> is the size of the PW basis. Despite the modest, linear dependence on <span class="math notranslate nohighlight">\(N_k\)</span>, the memory requirement could be high for systems that require a relatively large PW basis.</p></li>
<li><p>MDF requires both a <span class="math notranslate nohighlight">\(O(N_k^2 n_{\mathrm{AO}}^2 n_{\mathrm{aux}})\)</span> disk space to store pre-computed integrals of the GTO part of the auxiliary basis and a <span class="math notranslate nohighlight">\(O(N_k n_{\mathrm{AO}}^2 N_{\mathrm{PW}})\)</span> memory for the PW part. However, both <span class="math notranslate nohighlight">\(n_{\mathrm{aux}}\)</span> and <span class="math notranslate nohighlight">\(N_{\mathrm{PW}}\)</span> here are smaller than that required by GDF and FFTDF, respectively.</p></li>
</ul>
</div>
</div>
<div class="section" id="references">
<h2><span class="section-number">2.16.3.6. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<span class="target" id="id12"></span></div>
</div>

<div class="section">
   
</div>

          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="../scf/" title="2.16.2. SCF and DFT methods"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> <span class="section-number">2.16.2. </span>SCF and DFT methods </span>
              </div>
            </a>
          
          
            <a href="../mix_mol/" title="2.16.4. Mixing PBC and molecular modules"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> <span class="section-number">2.16.4. </span>Mixing PBC and molecular modules </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2015-2021, The PySCF Developers.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>