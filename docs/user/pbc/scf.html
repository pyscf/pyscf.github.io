
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>SCF and DFT methods &#8212; PySCF</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/pyscf.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    <link rel="shortcut icon" href="../../_static/favicon-32x32.png"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Density fitting for crystalline calculations" href="df.html" />
    <link rel="prev" title="Crystal structure" href="gto.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=pyscf data-md-color-accent=pyscf>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#user/pbc/scf" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../index.html" title="PySCF"
           class="md-header-nav__button md-logo">
          
              <img src="../../_static/pyscf-logo-white.svg" height="26"
                   alt="PySCF logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">PySCF 2.0</span>
          <span class="md-header-nav__topic"> SCF and DFT methods </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../"versions.json"",
        target_loc = "../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">Home</a></li>
            
            <li class="md-tabs__item"><a href="../../install.html" class="md-tabs__link">Install</a></li>
            
            <li class="md-tabs__item"><a href="../../quickstart.html" class="md-tabs__link">Quickstart</a></li>
            
            <li class="md-tabs__item"><a href="../../user.html" class="md-tabs__link">User Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../develop.html" class="md-tabs__link">Developer Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../pyscf_api_docs/modules.html" class="md-tabs__link">API</a></li>
            
            <li class="md-tabs__item"><a href="../../about.html" class="md-tabs__link">About</a></li>
          <li class="md-tabs__item"><a href="../../user.html" class="md-tabs__link">User Guide</a></li>
          <li class="md-tabs__item"><a href="../pbc.html" class="md-tabs__link">Periodic boundary conditions</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../index.html" title="PySCF" class="md-nav__button md-logo">
      
        <img src="../../_static/pyscf-logo-white.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../index.html"
       title="PySCF">PySCF 2.0</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../../install.html" class="md-nav__link">Install</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../quickstart.html" class="md-nav__link">Quickstart</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../user.html" class="md-nav__link">User Guide</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../gto.html" class="md-nav__link">Molecular structure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../scf.html" class="md-nav__link">Self-consistent field (SCF) methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../dft.html" class="md-nav__link">Density functional theory (DFT)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mp.html" class="md-nav__link">Second-order Møller–Plesset perturbation theory (MP2)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../gw.html" class="md-nav__link">GW approximation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../ci.html" class="md-nav__link">Configuration interaction (CISD and FCI)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../cc.html" class="md-nav__link">Coupled-cluster theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../adc.html" class="md-nav__link">Algebraic diagrammatic construction (ADC)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../agf2.html" class="md-nav__link">Auxiliary second-order Green’s function perturbation theory (AGF2)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mcscf.html" class="md-nav__link">Multi-configuration self-consistent field (MCSCF)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mrpt.html" class="md-nav__link">Multi-reference perturbation theory (MRPT)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../tddft.html" class="md-nav__link">Time-dependent Hartree-Fock and density functional theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../solvent.html" class="md-nav__link">Solvation models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../qmmm.html" class="md-nav__link">QM/MM methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../df.html" class="md-nav__link">Density fitting (DF)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../pbc.html" class="md-nav__link">Periodic boundary conditions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../eph.html" class="md-nav__link">Electron-phonon coupling</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../lo.html" class="md-nav__link">Localized orbitals</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sgx.html" class="md-nav__link">Seminumerical exchange (SGX)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../geomopt.html" class="md-nav__link">Geometry optimization</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../pyscf_api_docs/pyscf.html" class="md-nav__link">API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../about.html" class="md-nav__link">About</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#user-pbc-scf--page-root" class="md-nav__link">SCF and DFT methods</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#density-fitting" class="md-nav__link">Density fitting</a>
        </li>
        <li class="md-nav__item"><a href="#finite-size-effects" class="md-nav__link">Finite-size effects</a>
        </li>
        <li class="md-nav__item"><a href="#band-structure-calculations" class="md-nav__link">Band structure calculations</a>
        </li>
        <li class="md-nav__item"><a href="#add-ons" class="md-nav__link">Add-ons</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#linear-dependencies" class="md-nav__link">Linear dependencies</a>
        </li>
        <li class="md-nav__item"><a href="#smearing" class="md-nav__link">Smearing</a>
        </li>
        <li class="md-nav__item"><a href="#stability" class="md-nav__link">Stability</a>
        </li>
        <li class="md-nav__item"><a href="#multigrid" class="md-nav__link">Multigrid</a>
        </li>
        <li class="md-nav__item"><a href="#range-separation-integration" class="md-nav__link">Range-separation integration</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#how-to-choose-integral-scheme" class="md-nav__link">How to choose integral scheme</a>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/user/pbc/scf.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="scf-and-dft-methods">
<span id="user-pbc-scf"></span><h1 id="user-pbc-scf--page-root">SCF and DFT methods<a class="headerlink" href="#user-pbc-scf--page-root" title="Permalink to this headline">¶</a></h1>
<p><em>Modules</em>: <code class="xref py py-mod docutils literal notranslate"><span class="pre">scf</span></code>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">dft</span></code>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">pbc.scf</span></code>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">pbc.dft</span></code></p>
<section id="introduction">
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>PySCF supports periodic Hartree-Fock and density functional theory calculations
with Brillouin zone sampling.  The results of these calculations serve
as input to a variety of periodic post-HF and post-DFT calculations.
A minimal example of a periodic HF calculation on diamond with
a 2x2x2 sampling of the Brillouin zone is shown below.  Note that the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">kpts</span></code> keyword argument must be in physical units (inverse bohr),
which can be easily achieved using the <code class="docutils literal notranslate"><span class="pre">Cell.make_kpts()</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">'''C 0.0000 0.0000 0.0000</span>
<span class="s1">              C 0.8917 0.8917 0.8917'''</span><span class="p">,</span>
    <span class="n">a</span> <span class="o">=</span> <span class="s1">'''0.0000 1.7834 1.7834</span>
<span class="s1">           1.7834 0.0000 1.7834</span>
<span class="s1">           1.7834 1.7834 0.0000'''</span><span class="p">,</span>
    <span class="n">pseudo</span> <span class="o">=</span> <span class="s1">'gth-pade'</span><span class="p">,</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">'gth-szv'</span>
    <span class="p">)</span>

<span class="n">kmf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="o">=</span><span class="n">cell</span><span class="o">.</span><span class="n">make_kpts</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># converged SCF energy = -10.9308552994574</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="gto.html#user-pbc-gto"><span class="std std-ref">Crystal structure</span></a> and <a class="reference internal" href="../pbc.html#user-pbc"><span class="std std-ref">Periodic boundary conditions</span></a> for more details about
the <code class="xref py py-class docutils literal notranslate"><span class="pre">Cell</span></code> object and Brillouin zone sampling.</p>
<p>Various integral schemes have been developed for periodic calculations in PySCF.
A regular periodic calculation can be started with some type of density fitting.
For large systems, multi-grid algorithm (see <span class="xref std std-ref">user_pbc_multigrid</span>) or
range-separation (RS) integral algorithm (see <span class="xref std std-ref">user_pbc_rsjk</span>) can be
considered to reduce the cost of Fock build.
See <span class="xref std std-ref">user_pbc_df_comparison</span> for the comparison of different integral
schemes in periodic calculations.</p>
</section>
<section id="density-fitting">
<h2 id="density-fitting">Density fitting<a class="headerlink" href="#density-fitting" title="Permalink to this headline">¶</a></h2>
<p>The default behavior is to use plane-wave density fitting (FFTDF).
The number of plane-waves used as an auxiliary basis is controlled by kinetic
energy cutoff, which is specified by the <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.ke_cutoff</span></code> parameter.  The
default value of this parameter is chosen to provide many digits of precision in
the ERIs and the subsequent energies.  If reduced precision is tolerable, this
parameter can be set manually, resulting in significant speedups and memory
savings.  For the diamond example above, lowering the kinetic energy cutoff to 100
hartree changes the SCF energy by about 5 microhartree:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cell</span><span class="o">.</span><span class="n">ke_cutoff</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="c1"># in Hartree</span>
<span class="n">cell</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">kmf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># converged SCF energy = -10.9308602914696</span>
</pre></div>
</div>
<p>For many systems, Gaussian density fitting (GDF) is more economical, although it
incurs larger errors than FFTDF.  Periodic GDF can be activated in the same way
as for molecules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kmf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">()</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>If a corresponding auxiliary basis is found for the chosen atomic orbital basis,
it will be used.  Otherwise, an even-tempered Gaussian basis will be used.</p>
<p>See <a class="reference internal" href="df.html#user-pbc-df"><span class="std std-ref">Density fitting for crystalline calculations</span></a> for more details about periodic density fitting.</p>
</section>
<section id="finite-size-effects">
<h2 id="finite-size-effects">Finite-size effects<a class="headerlink" href="#finite-size-effects" title="Permalink to this headline">¶</a></h2>
<p>The long-ranged nature of the Coulomb interaction is responsible for a number of
divergent contributions to the energy.  For charge-neutral unit cells, the
divergence of the nuclear repulsion energy, the electron-nuclear attraction
energy, and the electronic Hartree energy cancel one another.</p>
<p>The nonlocal exact exchange energy exhibits an integrable divergence at
<span class="math notranslate nohighlight">\(G=0\)</span> that is responsible for the leading-order finite-size error of HF
and hybrid DFT calculations <a class="bibtex reference internal" href="#paier2005" id="id1">[1]</a><a class="bibtex reference internal" href="#broqvist2009" id="id2">[2]</a><a class="bibtex reference internal" href="#sundararaman2013" id="id3">[3]</a>.  In
PySCF, this exchange divergence can be addressed in a number of ways using the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">exxdiv</span></code> keyword argument to the mean-field class, with the following
possible values.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'ewald'</span></code> (default)</p>
<p>The <span class="math notranslate nohighlight">\(G=0\)</span> value of the Coulomb potential is the supercell Madelung
constant <a class="bibtex reference internal" href="#paier2005" id="id4">[1]</a><a class="bibtex reference internal" href="#broqvist2009" id="id5">[2]</a><a class="bibtex reference internal" href="#sundararaman2013" id="id6">[3]</a>, which is evaluated by
Ewald summation.  The finite-size error of the exchange energy decays as
<span class="math notranslate nohighlight">\(N_k^{-1}\)</span>, where <span class="math notranslate nohighlight">\(N_k\)</span> is the number of k-points sampled in the
Brillouin zone.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p>
<p>The <span class="math notranslate nohighlight">\(G=0\)</span> value of the Coulomb potential is set to zero.  The
finite-size error of the exchange energy decays slowly as <span class="math notranslate nohighlight">\(N_k^{-1/3}\)</span>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'vcut_sph'</span></code></p>
<p>The Coulomb potential is spherically truncated in real space at a radius equal
to half of the supercell side length <a class="bibtex reference internal" href="#spencer2008" id="id7">[4]</a>.  The finite-size
error of the exchange energy decays as <span class="math notranslate nohighlight">\(\exp(-aN_k^{1/3})\)</span>.  Only
supported with plane-wave density fitting (FFTDF).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'vcut_ws'</span></code></p>
<p>The Coulomb potential is truncated outside of the Wigner-Seitz supercell
<a class="bibtex reference internal" href="#sundararaman2013" id="id8">[3]</a>, which is more appropriate than spherical truncation
for anisotropic cells.  The finite-size error of the exchange energy decays as
<span class="math notranslate nohighlight">\(\exp(-aN_k^{1/3})\)</span>.  Only supported with plane-wave density fitting
(FFTDF).</p>
</li>
</ul>
<p>An example calculation with exchange treated with the spherically truncated
Coulomb potential is shown here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kmf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="o">=</span><span class="n">kpts</span><span class="p">,</span> <span class="n">exxdiv</span><span class="o">=</span><span class="s1">'vcut_sph'</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="band-structure-calculations">
<h2 id="band-structure-calculations">Band structure calculations<a class="headerlink" href="#band-structure-calculations" title="Permalink to this headline">¶</a></h2>
<p>After an SCF calculation has been performed, the band structure can be
calculated non-self-consistently along a k-point path using the
<code class="docutils literal notranslate"><span class="pre">SCF.get_bands(kpts)</span></code> function, where <code class="docutils literal notranslate"><span class="pre">kpts</span></code> is a list of k-points along
which the band structure is desired.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For Hartree-Fock or hybrid DFT, the discontinuity of the exchange potential
at <span class="math notranslate nohighlight">\(G=0\)</span> is problematic for band structure calculations.  Using
<code class="xref py py-attr docutils literal notranslate"><span class="pre">exxdiv='vcut_sph'</span></code> with FFTDF is recommended instead.  Alternatively,
the SCF procedure can be repeated at each k-point, which is much more
expensive but allows the use of any <code class="xref py py-attr docutils literal notranslate"><span class="pre">exxdiv</span></code> or density fitting.</p>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/pbc/09-band_ase.py">examples/pbc/09-band_ase.py</a> for an example DFT band structure
calculation.</p>
</section>
<section id="add-ons">
<h2 id="add-ons">Add-ons<a class="headerlink" href="#add-ons" title="Permalink to this headline">¶</a></h2>
<p>All molecular SCF add-ons are also available for periodic SCF but
must be accessed through the molecular <a class="reference internal" href="../../pyscf_api_docs/pyscf.scf.html#module-pyscf.scf.addons" title="pyscf.scf.addons"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyscf.scf.addons</span></code></a> module.
Here we highlight a few of the most useful add-ons.</p>
<section id="linear-dependencies">
<h3 id="linear-dependencies">Linear dependencies<a class="headerlink" href="#linear-dependencies" title="Permalink to this headline">¶</a></h3>
<p>The dense packing of atoms in solids combined with the use of diffuse
atom-centered basis functions is responsible for frequent linear dependencies.
The linear dependency can be eliminated by Cholesky orthogonalization:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span> <span class="k">as</span> <span class="n">mol_scf</span>
<span class="n">kmf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="o">=</span><span class="n">kpts</span><span class="p">)</span>
<span class="n">kmf</span> <span class="o">=</span> <span class="n">mol_scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">remove_linear_dep_</span><span class="p">(</span><span class="n">kmf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="smearing">
<h3 id="smearing">Smearing<a class="headerlink" href="#smearing" title="Permalink to this headline">¶</a></h3>
<p>For metals or small band gap semiconductors, it can be useful to smear the
orbital occupation numbers away from integer values.  This can improve SCF
convergence and can expedite convergence to the thermodynamic limit with k-point
sampling.  Because this approach assumes a finite electronic temperature, it
yields an entropy and free energy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kmf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="o">=</span><span class="n">kpts</span><span class="p">)</span>
<span class="n">kmf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">smearing_</span><span class="p">(</span><span class="n">kmf</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">'fermi'</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Entropy = </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="n">kmf</span><span class="o">.</span><span class="n">entropy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Free energy = </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="n">kmf</span><span class="o">.</span><span class="n">e_free</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Zero temperature energy = </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="p">((</span><span class="n">kmf</span><span class="o">.</span><span class="n">e_tot</span><span class="o">+</span><span class="n">kmf</span><span class="o">.</span><span class="n">e_free</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>Fermi-Dirac smearing (<code class="xref py py-attr docutils literal notranslate"><span class="pre">method='fermi'</span></code>) and Gaussian smearing
(<code class="xref py py-attr docutils literal notranslate"><span class="pre">method='gauss'</span></code>) are supported.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Because most functions in PySCF assume integer occupations, they may fail if
combined with a mean-field calculation that was performed with smearing.</p>
</div>
</section>
<section id="stability">
<h3 id="stability">Stability<a class="headerlink" href="#stability" title="Permalink to this headline">¶</a></h3>
<p>Periodic SCF solutions can be checked with stability analysis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kmf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">kmf</span><span class="o">.</span><span class="n">stability</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="multigrid">
<h3 id="multigrid">Multigrid<a class="headerlink" href="#multigrid" title="Permalink to this headline">¶</a></h3>
<p>For pure DFT calculations, multi-grid algorithm becomes efficient if the size of
unit cell is relatively large (e.g. more than 10 atoms) or the kinetic energy
cutoff is relatively high (e.g. more than 100k plane waves). This algorithm is
implemented in the <a class="reference internal" href="../../pyscf_api_docs/pyscf.pbc.dft.html#module-pyscf.pbc.dft.multigrid" title="pyscf.pbc.dft.multigrid"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyscf.pbc.dft.multigrid</span></code></a> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.pbc.dft</span> <span class="kn">import</span> <span class="n">multigrid</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">multigrid</span><span class="o">.</span><span class="n">multigrid</span><span class="p">(</span><span class="n">dft</span><span class="o">.</span><span class="n">KRKS</span><span class="p">(</span><span class="n">cell</span><span class="p">))</span>
<span class="n">mf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>More examples can be found</p>
<p>The multi-grid algorithm does not support exact exchange.</p>
</section>
<section id="range-separation-integration">
<h3 id="range-separation-integration">Range-separation integration<a class="headerlink" href="#range-separation-integration" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>This algorithm computes most of the four-center integrals in real space. For small</p>
</div></blockquote>
<p>systems, it is less efficient than most density fitting algorithms. When you
need to handle a huge unit cell, or to compute exact exchange for many k points,
or to use all-electron basis sets, you can consider to invoke this algorithm.
For periodic SCF models, you can call the method <cite>jk_method</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kmf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span><span class="o">.</span><span class="n">jk_method</span><span class="p">(</span><span class="s1">'RS'</span><span class="p">)</span>
<span class="n">kmf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>This algorithm has much smaller memory footprint than density fitting algorithm.
It is also a good choice if your computer does not have enough memory to call
density fitting methods.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The implementation in current release does not support band structure calculations</p>
</div>
</section>
</section>
<section id="how-to-choose-integral-scheme">
<h2 id="how-to-choose-integral-scheme">How to choose integral scheme<a class="headerlink" href="#how-to-choose-integral-scheme" title="Permalink to this headline">¶</a></h2>
<p>In the tables below, we provide a very rough estimation of the capability and
characters for each integral algorithm in typical periodic mean-field
calculations.</p>
<ol class="arabic simple">
<li><p>Number of basis functions for Gamma point calculations</p></li>
</ol>
<table>
<colgroup>
<col style="width: 29%"/>
<col style="width: 36%"/>
<col style="width: 36%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Scheme</p></th>
<th class="head"><p>Pure DFT</p></th>
<th class="head"><p>hybrid DFT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FFTDF</p></td>
<td><p>&lt; 5000</p></td>
<td><p>&lt; 300</p></td>
</tr>
<tr class="row-odd"><td><p>GDF</p></td>
<td><p>&lt; 5000</p></td>
<td><p>&lt; 5000</p></td>
</tr>
<tr class="row-even"><td><p>MDF</p></td>
<td><p>&lt; 5000</p></td>
<td><p>&lt; 2000</p></td>
</tr>
<tr class="row-odd"><td><p>Multi-grid</p></td>
<td><p>100 - 100000</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>RS</p></td>
<td><p>100 - 10000</p></td>
<td><p>100 - 10000</p></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><p>Assuming 100 AOs per unit cell, the number of k-points</p></li>
</ol>
<table>
<colgroup>
<col style="width: 29%"/>
<col style="width: 36%"/>
<col style="width: 36%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Scheme</p></th>
<th class="head"><p>Pure DFT</p></th>
<th class="head"><p>hybrid DFT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FFTDF</p></td>
<td><p>&lt; 2000</p></td>
<td><p>&lt; 10</p></td>
</tr>
<tr class="row-odd"><td><p>GDF</p></td>
<td><p>&lt; 2000</p></td>
<td><p>&lt; 100</p></td>
</tr>
<tr class="row-even"><td><p>MDF</p></td>
<td><p>&lt; 2000</p></td>
<td><p>&lt; 50</p></td>
</tr>
<tr class="row-odd"><td><p>Multi-grid</p></td>
<td><p>5000</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>RS</p></td>
<td><p>1000</p></td>
<td><p>1000</p></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><p>Relative performance for systems of 100 AOs per unit cell, 10 k-points</p></li>
</ol>
<table>
<colgroup>
<col style="width: 29%"/>
<col style="width: 36%"/>
<col style="width: 36%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Scheme</p></th>
<th class="head"><p>Pure DFT</p></th>
<th class="head"><p>hybrid DFT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FFTDF</p></td>
<td><p>1x</p></td>
<td><p>1000x</p></td>
</tr>
<tr class="row-odd"><td><p>GDF</p></td>
<td><p>10x</p></td>
<td><p>100x</p></td>
</tr>
<tr class="row-even"><td><p>MDF</p></td>
<td><p>30x</p></td>
<td><p>300x</p></td>
</tr>
<tr class="row-odd"><td><p>Multi-grid</p></td>
<td><p>1x</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>RS</p></td>
<td><p>100x</p></td>
<td><p>100x</p></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><p>Other metrics</p></li>
</ol>
<table>
<colgroup>
<col style="width: 16%"/>
<col style="width: 20%"/>
<col style="width: 18%"/>
<col style="width: 13%"/>
<col style="width: 19%"/>
<col style="width: 15%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Scheme</p></th>
<th class="head"><p>All-electron</p></th>
<th class="head"><p>Warm-up cost</p></th>
<th class="head"><p>Accuracy</p></th>
<th class="head"><p>Memory cost</p></th>
<th class="head"><p>IO cost</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FFTDF</p></td>
<td><p>Extremely slow</p></td>
<td><p>Low</p></td>
<td><p>High</p></td>
<td><p>Extremely high</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>GDF</p></td>
<td><p>Well supported</p></td>
<td><p>High</p></td>
<td><p>Low</p></td>
<td><p>Moderate</p></td>
<td><p>Huge</p></td>
</tr>
<tr class="row-even"><td><p>MDF</p></td>
<td><p>Well supported</p></td>
<td><p>High</p></td>
<td><p>Medium</p></td>
<td><p>Moderate</p></td>
<td><p>Huge</p></td>
</tr>
<tr class="row-odd"><td><p>Multi-grid</p></td>
<td><p>Limited cases</p></td>
<td><p>Low</p></td>
<td><p>High</p></td>
<td><p>High</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>RS</p></td>
<td><p>Well supported</p></td>
<td><p>Low</p></td>
<td><p>High</p></td>
<td><p>Low</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="references">
<h2 id="references">References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p id="bibtex-bibliography-user/pbc/scf-0"><dl class="bibtex citation">
<dt class="bibtex label" id="paier2005"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id4">2</a>)</span></dt>
<dd><p>Joachim Paier, Robin Hirschl, Martijn Marsman, and Georg Kresse. The perdew–burke–ernzerhof exchange-correlation functional applied to the g2-1 test set using a plane-wave basis set. <em>J. Chem. Phys.</em>, 122(23):234102, 2005. <a class="reference external" href="https://doi.org/10.1063/1.1926272">doi:10.1063/1.1926272</a>.</p>
</dd>
<dt class="bibtex label" id="broqvist2009"><span class="brackets">2</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id5">2</a>)</span></dt>
<dd><p>Peter Broqvist, Audrius Alkauskas, and Alfredo Pasquarello. Hybrid-functional calculations with plane-wave basis sets: effect of singularity correction on total energies, energy eigenvalues, and defect energy levels. <em>Phys. Rev. B</em>, 80:085114, Aug 2009. <a class="reference external" href="https://doi.org/10.1103/PhysRevB.80.085114">doi:10.1103/PhysRevB.80.085114</a>.</p>
</dd>
<dt class="bibtex label" id="sundararaman2013"><span class="brackets">3</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id6">2</a>,<a href="#id8">3</a>)</span></dt>
<dd><p>Ravishankar Sundararaman and T. A. Arias. Regularization of the coulomb singularity in exact exchange by wigner-seitz truncated interactions: towards chemical accuracy in nontrivial systems. <em>Phys. Rev. B</em>, 87:165122, Apr 2013. <a class="reference external" href="https://doi.org/10.1103/PhysRevB.87.165122">doi:10.1103/PhysRevB.87.165122</a>.</p>
</dd>
<dt class="bibtex label" id="spencer2008"><span class="brackets"><a class="fn-backref" href="#id7">4</a></span></dt>
<dd><p>James Spencer and Ali Alavi. Efficient calculation of the exact exchange energy in periodic systems using a truncated coulomb potential. <em>Phys. Rev. B</em>, 77:193110, May 2008. <a class="reference external" href="https://doi.org/10.1103/PhysRevB.77.193110">doi:10.1103/PhysRevB.77.193110</a>.</p>
</dd>
</dl>
</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="gto.html" title="Crystal structure"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Crystal structure </span>
              </div>
            </a>
          
          
            <a href="df.html" title="Density fitting for crystalline calculations"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Density fitting for crystalline calculations </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2015-2021, The PySCF Developers.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.0.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>