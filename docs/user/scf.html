
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Self-consistent field (SCF) methods &#8212; PySCF</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=92fd9be5" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pyscf-pst.css?v=ed6b5f64" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=dfec817d"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/scf';</script>
    <link rel="icon" href="../_static/favicon-32x32.png"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Density functional theory (DFT)" href="dft.html" />
    <link rel="prev" title="Crystal structure" href="pbcgto.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="2.7" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo-64x64.png" class="logo__image only-light" alt=""/>
    <img src="../_static/logo-64x64.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">PySCF</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contributor/index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../news.html">
    News
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyscf/pyscf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contributor/index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../news.html">
    News
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyscf/pyscf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="install.html">How to install PySCF</a></li>
<li class="toctree-l1"><a class="reference internal" href="using.html">How to use PySCF</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Building molecules and crystals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="gto.html">Molecular structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="pbcgto.html">Crystal structure</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Electronic structure methods</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Self-consistent field (SCF) methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="dft.html">Density functional theory (DFT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mp.html">Second-order Møller–Plesset perturbation theory (MP2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gw.html">GW approximation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci.html">Configuration interaction (CISD and FCI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="cc.html">Coupled-cluster theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="adc.html">Algebraic diagrammatic construction (ADC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="agf2.html">Auxiliary second-order Green’s function perturbation theory (AGF2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcscf.html">Multi-configuration self-consistent field (MCSCF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mrpt.html">Multi-reference perturbation theory (MRPT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tddft.html">Time-dependent Hartree-Fock and density functional theory</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other functionalities</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="solvent.html">Solvation models</a></li>
<li class="toctree-l1"><a class="reference internal" href="qmmm.html">QM/MM methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="md.html">Molecular Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="df.html">Density fitting (DF)</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="pbc.html">Periodic boundary conditions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="pbc/gto.html">Crystal structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc/scf.html">SCF and DFT methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc/df.html">Density fitting for crystalline calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc/mix_mol.html">Mixing PBC and molecular modules</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="eph.html">Electron-phonon coupling</a></li>
<li class="toctree-l1"><a class="reference internal" href="lo.html">Localized orbitals</a></li>
<li class="toctree-l1"><a class="reference internal" href="sgx.html">Seminumerical exchange (SGX)</a></li>
<li class="toctree-l1"><a class="reference internal" href="geomopt.html">Geometry optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPU Acceleration (GPU4PySCF)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extensions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Extensions</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Self-consistent field (SCF) methods</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="self-consistent-field-scf-methods">
<span id="user-scf"></span><h1>Self-consistent field (SCF) methods<a class="headerlink" href="#self-consistent-field-scf-methods" title="Link to this heading">#</a></h1>
<p><em>Modules</em>: <a class="reference internal" href="../pyscf_api_docs/pyscf.scf.html#module-pyscf.scf" title="pyscf.scf"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyscf.scf</span></code></a>, <a class="reference internal" href="../pyscf_api_docs/pyscf.pbc.scf.html#module-pyscf.pbc.scf" title="pyscf.pbc.scf"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyscf.pbc.scf</span></code></a>, <a class="reference internal" href="../pyscf_api_docs/pyscf.soscf.html#module-pyscf.soscf" title="pyscf.soscf"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyscf.soscf</span></code></a></p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Self-consistent field (SCF) methods include both Hartree-Fock (HF) theory
and Kohn-Sham (KS) density functional theory (DFT). Self-consistent
field theories only depend on the electronic density matrices, and are
the simplest level of quantum chemical models. Details that are
specific to DFT can be found in <a class="reference internal" href="dft.html#user-dft"><span class="std std-ref">Density functional theory (DFT)</span></a>.</p>
<p>In both HF and KS-DFT, the ground-state wavefunction is expressed as a
single Slater determinant <span class="math notranslate nohighlight">\(\Phi_0\)</span> of molecular orbitals (MOs)
<span class="math notranslate nohighlight">\(\psi\)</span>, <span class="math notranslate nohighlight">\(\Phi_0 = \mathcal{A}|\psi_1(1)\psi_2(2) \ldots
\psi_N(N)|\)</span>. The total electronic energy
<span class="math notranslate nohighlight">\(E=\langle\Psi_0|\hat{H}|\Psi_0\rangle\)</span> is then minimized,
subject to orbital orthogonality; this is equivalent to the
description of the electrons as independent particles that only
interact via each others’ mean field.</p>
<p>It can be shown that the minimization of the total energy within a
given basis set (see e.g. <span id="id1">[<a class="reference internal" href="reference.html#id66" title="Susi Lehtola, Frank Blockhuys, and Christian Van Alsenoy. An overview of self-consistent field calculations within finite basis sets. Molecules, 2020. doi:10.3390/molecules25051218.">1</a>]</span> or any standard
textbook on quantum chemistry like <span id="id2">[<a class="reference internal" href="reference.html#id61" title="Attila Szabo and Neil S Ostlund. Modern quantum chemistry: introduction to advanced electronic structure theory. Courier Corporation, 2012.">2</a>]</span>) leads to the
equation</p>
<div class="math notranslate nohighlight">
\[\mathbf{F} \mathbf{C} = \mathbf{S} \mathbf{C} \mathbf{E}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{C}\)</span> is the matrix of molecular orbital
coefficients, <span class="math notranslate nohighlight">\(\mathbf{E}\)</span> is a diagonal matrix of the
corresponding eigenenergies, and <span class="math notranslate nohighlight">\(\mathbf{S}\)</span> is the atomic
orbital overlap matrix. The Fock matrix <span class="math notranslate nohighlight">\(\mathbf{F}\)</span> is defined
as</p>
<div class="math notranslate nohighlight">
\[\mathbf{F} = \mathbf{T} + \mathbf{V} + \mathbf{J} + \mathbf{K}\;\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> is the kinetic energy matrix,
<span class="math notranslate nohighlight">\(\mathbf{V}\)</span> is the external potential, <span class="math notranslate nohighlight">\(\mathbf{J}\)</span> is
the Coulomb matrix, and <span class="math notranslate nohighlight">\(\mathbf{K}\)</span> is the exchange matrix.</p>
</section>
<section id="initial-guess">
<h2>Initial guess<a class="headerlink" href="#initial-guess" title="Link to this heading">#</a></h2>
<p>The Coulomb and exchange matrices depend on the occupied orbitals,
meaning that the SCF equation <span class="math notranslate nohighlight">\(\mathbf{F C}=\mathbf{S C E}\)</span>
needs to be solved self-consistently by some sort of iterative
procedure, which begins from some initial guess. The accuracy of
several initial guesses for SCF calculations has recently been
assessed in <span id="id3">[<a class="reference internal" href="reference.html#id62" title="Susi Lehtola. Assessment of initial guesses for self-consistent field calculations. Superposition of atomic potentials: simple yet efficient. J. Chem. Theory Comput., 15:1593, 2019. doi:10.1021/acs.jctc.8b01089.">3</a>]</span>, to which we refer for
detailed discussion on initial guesses.</p>
<p>Several of initial guess have been implemented in PySCF; the used
variant is controlled by the <a class="reference internal" href="../pyscf_api_docs/pyscf.scf.html#pyscf.scf.hf.SCF.init_guess" title="pyscf.scf.hf.SCF.init_guess"><code class="xref py py-attr docutils literal notranslate"><span class="pre">init_guess</span></code></a> attribute of the SCF
solver. The following values are possible</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'minao'</span></code> (default)</p>
<blockquote>
<div><p>A superposition of atomic densities
<span id="id4">[<a class="reference internal" href="reference.html#id86" title="J. Almlöf, K. Faegri Jr., and K. Korsell. Principles for a direct scf approach to lcao–mo ab-initio calculations. Journal of Computational Chemistry, 3(3):385-399, 1982. doi:https://doi.org/10.1002/jcc.540030314.">4</a>, <a class="reference internal" href="reference.html#id87" title="J. H. Van Lenthe, R. Zwaans, H. J. J. Van Dam, and M. F. Guest. Starting scf calculations by superposition of atomic densities. Journal of Computational Chemistry, 27(8):926-932, 2006. doi:https://doi.org/10.1002/jcc.20393.">5</a>]</span> technique, in
which the guess is obtained by projecting the minimal basis of the
first contracted functions in the cc-pVTZ or cc-pVTZ-PP basis set
onto the orbital basis set, and then forming the density
matrix. The guess orbitals are obtained by diagonalizing the Fock
matrix that arises from the spin-restricted guess density.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'1e'</span></code></p>
<blockquote>
<div><p>The one-electron guess, also known as the core guess, obtains the
guess orbitals from the diagonalization of the core Hamiltonian
<span class="math notranslate nohighlight">\(\mathbf{H}_0 = \mathbf{T} + \mathbf{V}\)</span>, thereby ignoring
all interelectronic interactions and the screening of nuclear
charge. The 1e guess should only be used as a last resort, because
it is so bad for molecular systems; see
<span id="id5">[<a class="reference internal" href="reference.html#id62" title="Susi Lehtola. Assessment of initial guesses for self-consistent field calculations. Superposition of atomic potentials: simple yet efficient. J. Chem. Theory Comput., 15:1593, 2019. doi:10.1021/acs.jctc.8b01089.">3</a>]</span>.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'atom'</span></code></p>
<blockquote>
<div><p>Superposition of atomic densities
<span id="id6">[<a class="reference internal" href="reference.html#id86" title="J. Almlöf, K. Faegri Jr., and K. Korsell. Principles for a direct scf approach to lcao–mo ab-initio calculations. Journal of Computational Chemistry, 3(3):385-399, 1982. doi:https://doi.org/10.1002/jcc.540030314.">4</a>, <a class="reference internal" href="reference.html#id87" title="J. H. Van Lenthe, R. Zwaans, H. J. J. Van Dam, and M. F. Guest. Starting scf calculations by superposition of atomic densities. Journal of Computational Chemistry, 27(8):926-932, 2006. doi:https://doi.org/10.1002/jcc.20393.">5</a>]</span>. Employs
spin-restricted atomic HF calculations that employ spherically
averaged fractional occupations with ground states determined with
fully numerical calculations at the complete basis set limit in
<span id="id7">[<a class="reference internal" href="reference.html#id65" title="Susi Lehtola. Fully numerical calculations on atoms with fractional occupations and range-separated exchange functionals. Phys. Rev. A, 101:012516, 2020. doi:10.1103/PhysRevA.101.012516.">6</a>]</span>.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'huckel'</span></code></p>
<blockquote>
<div><p>This is the parameter-free Hückel guess described in
<span id="id8">[<a class="reference internal" href="reference.html#id62" title="Susi Lehtola. Assessment of initial guesses for self-consistent field calculations. Superposition of atomic potentials: simple yet efficient. J. Chem. Theory Comput., 15:1593, 2019. doi:10.1021/acs.jctc.8b01089.">3</a>]</span>, which is based on on-the-fly atomic
HF calculations that are performed analogously to <code class="docutils literal notranslate"><span class="pre">'atom'</span></code>. The
spherically averaged atomic spin-restricted Hartree-Fock
calculations yield a minimal basis of atomic orbitals and orbital
energies, which are used to build a Hückel type matrix that is
diagonalized to obtain guess orbitals.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'vsap'</span></code></p>
<blockquote>
<div><p>Superposition of atomic potentials as described in
<span id="id9">[<a class="reference internal" href="reference.html#id62" title="Susi Lehtola. Assessment of initial guesses for self-consistent field calculations. Superposition of atomic potentials: simple yet efficient. J. Chem. Theory Comput., 15:1593, 2019. doi:10.1021/acs.jctc.8b01089.">3</a>]</span>. A sum of pretabulated, fully
numerical atomic potentials determined with the approach of
<span id="id10">[<a class="reference internal" href="reference.html#id65" title="Susi Lehtola. Fully numerical calculations on atoms with fractional occupations and range-separated exchange functionals. Phys. Rev. A, 101:012516, 2020. doi:10.1103/PhysRevA.101.012516.">6</a>]</span> is used to build a guess potential
on a DFT quadrature grid; this potential is then used to obtain
the orbitals. Note this option is only available for DFT
calculations in PySCF.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'chk'</span></code></p>
<blockquote>
<div><p>Read in the orbitals from the checkpoint file and use them as the
initial guess (see below for more details).</p>
</div></blockquote>
</li>
</ul>
<p>Alternatively, the user can also override the initial guess density
matrix for an SCF calculation through the <code class="docutils literal notranslate"><span class="pre">dm0</span></code> argument.  For
example, the following script first computes the HF density matrix for
the <span class="math notranslate nohighlight">\(\rm Cr^{6+}\)</span> cation, and then uses it as an initial guess
for a HF calculation of the <span class="math notranslate nohighlight">\(\rm Cr\)</span> atom.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># First calculate the Cr6+ cation</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
    <span class="n">symmetry</span> <span class="o">=</span> <span class="s1">&#39;D2h&#39;</span><span class="p">,</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Cr&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">],</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;cc-pvdz&#39;</span><span class="p">,</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">dm1</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">()</span>

<span class="c1"># Now switch to the neutral atom in the septet state</span>
<span class="n">mol</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">dm0</span><span class="o">=</span><span class="n">dm1</span><span class="p">)</span>
</pre></div>
</div>
<p>More examples can be found in
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/15-initial_guess.py">examples/scf/15-initial_guess.py</a>, and
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/31-cr_atom_rohf_tune_init_guess.py">examples/scf/31-cr_atom_rohf_tune_init_guess.py</a>.</p>
<section id="restart-from-an-old-calculation">
<h3>Restart from an old calculation<a class="headerlink" href="#restart-from-an-old-calculation" title="Link to this heading">#</a></h3>
<p>Although alike many other quantum chemistry codes, there is no
<cite>restart</cite> mechanism available in PySCF package, calculations can still
be “restarted” by reading in an earlier wave function as the initial
guess for the wave function.  The initial guess can be prepared in
many ways.  One is to read the <code class="docutils literal notranslate"><span class="pre">chkpoint</span></code> file which is generated in
the previous or other calculations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">chkfile</span> <span class="o">=</span> <span class="s1">&#39;/path/to/chkfile&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">init_guess</span> <span class="o">=</span> <span class="s1">&#39;chkfile&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">/path/to/chkfile</span></code> can be found in the output in the calculation (if
<code class="docutils literal notranslate"><span class="pre">mol.verbose</span> <span class="pre">&gt;=</span> <span class="pre">4</span></code>, the filename of the chkfile will be dumped in
the output).  If the results of the calculation are needed at a later
stage (e.g. for an eventual restart or use as an initial guess for a
larger calculation), the <code class="xref py py-attr docutils literal notranslate"><span class="pre">chkfile</span></code> attribute should be set
explicitly as the chkfile might otherwise be deleted upon successful
completion of the calculation, see comments in
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/14-restart.py">examples/scf/14-restart.py</a>.
By setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">chkfile</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">init_guess</span></code>, the
SCF module can read the molecular orbitals from the given
<code class="xref py py-attr docutils literal notranslate"><span class="pre">chkfile</span></code> and rotate them to representation of the required
basis.</p>
<p>The initial guess can also be fed in directly to the calculation. For
example, we can read in the density matrix from a checkpoint file, and
pass it directly to the SCF solver with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">hf</span><span class="o">.</span><span class="n">from_chk</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;/path/to/chkfile&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
</pre></div>
</div>
<p>This approach leads to the same result as setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">init_guess</span></code>
to <cite>chkfile</cite>.</p>
<p>N.B. The <code class="docutils literal notranslate"><span class="pre">chkfile</span></code> initial guess is not limited to calculations on
the same molecule or the same basis set. One can first do a cheaper
SCF calculation with smaller basis sets, or run an SCF calculation on
a model system (e.g. drop a few atoms or run the same system in an
easier charge/spin state), then use <code class="xref py py-func docutils literal notranslate"><span class="pre">scf.hf.from_chk()</span></code> to project
the results to the target basis sets.</p>
</section>
</section>
<section id="converging-scf-iterations">
<h2>Converging SCF iterations<a class="headerlink" href="#converging-scf-iterations" title="Link to this heading">#</a></h2>
<p>Even with a very good initial guess, making the SCF procedure converge
is sometimes challenging. PySCF implements two kinds of approaches for
SCF, namely, direct inversion in the iterative subspace (DIIS) and
second-order SCF (SOSCF).</p>
<ul>
<li><p>DIIS (default)</p>
<blockquote>
<div><p>With DIIS, the Fock matrix at each iteration is extrapolated using
Fock matrices from the previous iterations, by minimizing the norm
of the commutator <span class="math notranslate nohighlight">\([\mathbf{F},\mathbf{PS}]\)</span> where
<span class="math notranslate nohighlight">\(\mathbf{P}\)</span> is the density matrix
<span id="id11">[<a class="reference internal" href="reference.html#id68" title="Péter Pulay. Convergence acceleration of iterative sequences. The case of SCF iteration. Chem. Phys. Lett., 73:393, 1980. doi:10.1016/0009-2614(80)80396-4.">7</a>, <a class="reference internal" href="reference.html#id69" title="P. Pulay. Improved SCF convergence acceleration. J. Comput.. Chem., 3:556, 1982. doi:10.1002/jcc.540030413.">8</a>]</span>.  Two variants of DIIS
are implemented in PySCF, namely, EDIIS <span id="id12">[<a class="reference internal" href="reference.html#id70" title="Konstantin N. Kudin, Gustavo E. Scuseria, and Eric Cancès. A black-box self-consistent field convergence algorithm: One step closer. J. Chem. Phys., 116(19):8255, 2002. doi:10.1063/1.1470195.">9</a>]</span>
and ADIIS <span id="id13">[<a class="reference internal" href="reference.html#id71" title="Xiangqian Hu and Weitao Yang. Accelerating self-consistent field convergence with the augmented Roothaan–Hall energy function. J. Chem. Phys., 132:054109, 2010. doi:10.1063/1.3304922.">10</a>]</span>.  Examples of selecting
different DIIS schemes can be found in
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/24-tune_diis.py">examples/scf/24-tune_diis.py</a>.</p>
</div></blockquote>
</li>
<li><p>SOSCF</p>
<blockquote>
<div><p>To achieve quadratic convergence in the orbital optimization,
PySCF implements a general second-order solver called the
co-iterative augmented hessian (CIAH) method
<span id="id14">[<a class="reference internal" href="reference.html#id72" title="Qiming Sun. Co-iterative augmented Hessian method for orbital optimization. arXiv preprint arXiv:1610.08423, 2016.">11</a>, <a class="reference internal" href="reference.html#id73" title="Qiming Sun, Jun Yang, and Garnet Kin-Lic Chan. A general second order complete active space self-consistent-field solver for large-scale systems. Chem. Phys. Lett., 683:291, 2017. doi:10.1016/j.cplett.2017.03.004.">12</a>]</span>. This method can be invoked by
decorating the SCF objects with the <a class="reference internal" href="../pyscf_api_docs/pyscf.scf.html#pyscf.scf.newton" title="pyscf.scf.newton"><code class="xref py py-func docutils literal notranslate"><span class="pre">newton()</span></code></a> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">newton</span><span class="p">()</span>
</pre></div>
</div>
<p>More examples can be found in
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/22-newton.py">examples/scf/22-newton.py</a>.</p>
</div></blockquote>
</li>
<li><p>Damping</p>
<blockquote>
<div><p>The Fock matrix can be damped before DIIS acceleration kicks in.
This is achieved by setting the attributes <a class="reference internal" href="../pyscf_api_docs/pyscf.scf.html#pyscf.scf.hf.SCF.damp" title="pyscf.scf.hf.SCF.damp"><code class="xref py py-attr docutils literal notranslate"><span class="pre">damp</span></code></a> and
<a class="reference internal" href="../pyscf_api_docs/pyscf.scf.html#pyscf.scf.hf.SCF.diis_start_cycle" title="pyscf.scf.hf.SCF.diis_start_cycle"><code class="xref py py-attr docutils literal notranslate"><span class="pre">diis_start_cycle</span></code></a>.  For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span><span class="o">.</span><span class="n">damp</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">mf</span><span class="o">.</span><span class="n">diis_start_cycle</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>means that DIIS will start at the second cycle, and that the Fock
matrix is damped by 50% in the first cycle.</p>
</div></blockquote>
</li>
<li><p>Level shifting</p>
<blockquote>
<div><p>A level shift increases the gap between the occupied and virtual
orbitals, thereby slowing down and stabilizing the orbital update.
A level shift can help to converge SCF in the case of systems with
small HOMO-LUMO gaps. Level shifting is invoked by setting the
attribute <a class="reference internal" href="../pyscf_api_docs/pyscf.scf.html#pyscf.scf.hf.SCF.level_shift" title="pyscf.scf.hf.SCF.level_shift"><code class="xref py py-attr docutils literal notranslate"><span class="pre">level_shift</span></code></a>.  See examples in
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/03-level_shift.py">examples/scf/03-level_shift.py</a>, and
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/52-dynamically_control_level_shift.py">examples/scf/52-dynamically_control_level_shift.py</a>.</p>
</div></blockquote>
</li>
<li><p>Fractional occupations</p>
<blockquote>
<div><p>Fractional occupations can also be invoked to help the SCF
converge for small gap systems.  See the example in
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/54-fractional_occupancy.py">examples/scf/54-fractional_occupancy.py</a>.</p>
</div></blockquote>
</li>
<li><p>Smearing</p>
<blockquote>
<div><p>Smearing sets fractional occupancies according to a temperature
function. See the example <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/pbc/23-smearing.py">examples/pbc/23-smearing.py</a>.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="stability-analysis">
<span id="id15"></span><h2>Stability analysis<a class="headerlink" href="#stability-analysis" title="Link to this heading">#</a></h2>
<p>Even when the SCF converges, the wave function that is found may not
correspond to a local minimum; calculations can sometimes also
converge onto saddle points. Since saddle points are also extrema of
the energy functional, the orbital gradient vanishes and the SCF
equation <span class="math notranslate nohighlight">\(\mathbf{F C}=\mathbf{S C E}\)</span> is satisfied
<span id="id16">[<a class="reference internal" href="reference.html#id66" title="Susi Lehtola, Frank Blockhuys, and Christian Van Alsenoy. An overview of self-consistent field calculations within finite basis sets. Molecules, 2020. doi:10.3390/molecules25051218.">1</a>]</span>. However, in such cases the energy can be
decreased by perturbing the orbitals away from the saddle point, which
means that the wave function is unstable.</p>
<p>Instabilities in the wave function are conventionally classified as
either internal or external <span id="id17">[<a class="reference internal" href="reference.html#id74" title="Rolf Seeger and John A. Pople. Self-consistent molecular orbital methods. XVIII. Constraints and stability in Hartree–Fock theory. J. Chem. Phys., 66:3045, 1977. doi:10.1063/1.434318.">13</a>]</span>. External
instabilities mean that the energy can be decreased by loosening some
constraints on the wave function, such as allowing restricted
Hartree-Fock orbitals to transform into unrestricted Hartree-Fock,
whereas internal instabilities mean that the SCF has converged onto an
excited state instead of the ground state. PySCF allows detecting both
internal and external instabilities for a given SCF calculation; see
the examples in <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/17-stability.py">examples/scf/17-stability.py</a>.</p>
</section>
<section id="property-calculations">
<h2>Property calculations<a class="headerlink" href="#property-calculations" title="Link to this heading">#</a></h2>
<p>Various properties can be computed by calling the corresponding
functions, for example,</p>
<ul>
<li><p>dipole moment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span><span class="o">.</span><span class="n">dip_moment</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Mulliken population:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span><span class="o">.</span><span class="n">mulliken_pop</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>nuclear gradients:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">Gradients</span><span class="p">()</span>
<span class="n">g</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<p>Also several response properties are available in PySCF
with the <a class="reference external" href="https://github.com/pyscf/properties">properties</a> extension, see the
examples <a class="reference external" href="https://github.com/pyscf/properties/tree/master/examples">there</a>.</p>
</section>
<section id="spin-restricted-spin-unrestricted-restricted-open-shell-and-generalized-calculations">
<span id="user-scf-restrict"></span><h2>Spin-restricted, spin-unrestricted, restricted open-shell, and generalized calculations<a class="headerlink" href="#spin-restricted-spin-unrestricted-restricted-open-shell-and-generalized-calculations" title="Link to this heading">#</a></h2>
<p>The general spin-orbital used in the HF or KS-DFT wave function can be
written as</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\psi_i(1) = \phi_{i\alpha}(r)\alpha + \phi_{i\beta}(r)\beta \;,\]</div>
</div></blockquote>
<p>Four variants of the ansatz <span class="math notranslate nohighlight">\(\psi(1)\)</span> are commonly used in
quantum chemistry; they are also all available in PySCF.</p>
<ul>
<li><p>Restricted (RHF/RKS)</p>
<p>The spin-orbitals are either alpha (spin-up) or beta (spin-down),
<span class="math notranslate nohighlight">\(\psi_i =\phi_i(r)\alpha\)</span> or <span class="math notranslate nohighlight">\(\psi_i = \phi_i(r)\beta\)</span>,
and the alpha and beta orbitals share the same spatial orbital
<span class="math notranslate nohighlight">\(\phi_i(r)\)</span>. The closed-shell determinant is thus
<span class="math notranslate nohighlight">\(\Phi=\mathcal{A}|\phi_1(r_1)\alpha \phi_1(r_2)\beta \ldots
\phi_{N/2}(r_{N-1})\alpha \phi_{N/2}(r_N)\beta|\)</span> and <span class="math notranslate nohighlight">\(S=0\)</span>.</p>
</li>
<li><p>Unrestricted (UHF/UKS)</p>
<p>The orbitals can have either alpha or beta spin, but the alpha and
beta orbitals may have different spatial components. The determinant
is thus <span class="math notranslate nohighlight">\(\Phi=\mathcal{A}|\phi_1(r_1)\sigma_1
\phi_2(r_2)\sigma_2 \ldots \phi_{N}(r_N)\sigma_N|\)</span> where
<span class="math notranslate nohighlight">\(\sigma \in \{\alpha,\beta\}\)</span>.  Spin contamination is
introduced for states that don’t have maximal <span class="math notranslate nohighlight">\(S_z\)</span>.</p>
</li>
<li><p>Restricted open-shell (ROHF/ROKS)</p>
<p>Equivalent to RHF/RKS for <span class="math notranslate nohighlight">\(N_\alpha = N_\beta\)</span>.  For
<span class="math notranslate nohighlight">\(N_\alpha &gt; N_\beta\)</span>, the first <span class="math notranslate nohighlight">\(N_\beta\)</span> orbitals have
the same spatial components for both <span class="math notranslate nohighlight">\(\alpha\)</span> and
<span class="math notranslate nohighlight">\(\beta\)</span> spin. The remaining <span class="math notranslate nohighlight">\(N_\alpha - N_\beta\)</span>
orbitals are of <span class="math notranslate nohighlight">\(\alpha\)</span> spin.  <span class="math notranslate nohighlight">\(\Phi=\mathcal{A}|\phi_1
\alpha \phi_1\beta \ldots \phi_{N_\beta} \alpha \phi_{N_\beta}\beta
\phi_{N_\beta+1}\alpha \ldots \phi_{N}\alpha|\)</span> The final
wavefunction is an eigenfunction of the <span class="math notranslate nohighlight">\(\hat{S}^2\)</span> operator
with <span class="math notranslate nohighlight">\(S_z=S\)</span>.</p>
</li>
<li><p>Generalized (GHF/GKS)</p>
<p>The general form of the spin-orbital <span class="math notranslate nohighlight">\(\psi\)</span> is used. GHF/GKS
is useful when none of the previous methods provide stable solutions
(see <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/17-stability.py">examples/scf/17-stability.py</a>), or when the
Hamiltonian does not commute with <span class="math notranslate nohighlight">\(\hat{S}_z\)</span> (e.g. in the
presence of spin-orbit coupling, see
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/44-soc_ecp.py">examples/scf/44-soc_ecp.py</a>).</p>
</li>
</ul>
<p>Calculations with these methods can be invoked by creating an instance
of the corresponding class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">ROHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">GHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">ROKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">GKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>More examples can be found in
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/00-simple_hf.py">examples/scf/00-simple_hf.py</a>,
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/01-h2o.py">examples/scf/01-h2o.py</a>,
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/02-rohf_uhf.py">examples/scf/02-rohf_uhf.py</a>, and
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/02-ghf.py">examples/scf/02-ghf.py</a>.</p>
</section>
<section id="linear-dependencies">
<h2>Linear dependencies<a class="headerlink" href="#linear-dependencies" title="Link to this heading">#</a></h2>
<p>Most quantum chemistry programs solve the self-consistent field
equations</p>
<div class="math notranslate nohighlight">
\[\mathbf{F} \mathbf{C} = \mathbf{S} \mathbf{C} \mathbf{E}\]</div>
<p>in an orthonormal basis, which is formally obtained as</p>
<div class="math notranslate nohighlight">
\[\mathbf{C} = \mathbf{X} \tilde{\mathbf{C}}\]</div>
<p>where the orthogonalizing matrix <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> is typically
chosen as <span class="math notranslate nohighlight">\(\mathbf{X}=\mathbf{S}^{-1/2}\)</span>. By expressing the
orbitals in terms of the half-inverse overlap matrix, the generalized
eigenproblem <span class="math notranslate nohighlight">\(\mathbf{F} \mathbf{C} = \mathbf{S} \mathbf{C}
\mathbf{E}\)</span> can be rewritten as a regular eigenproblem
<span class="math notranslate nohighlight">\(\tilde{\mathbf{F}} \tilde{\mathbf{C}} = \tilde{\mathbf{C}}
\mathbf{E}\)</span> <span id="id18">[<a class="reference internal" href="reference.html#id66" title="Susi Lehtola, Frank Blockhuys, and Christian Van Alsenoy. An overview of self-consistent field calculations within finite basis sets. Molecules, 2020. doi:10.3390/molecules25051218.">1</a>]</span>.</p>
<p>Moreover, as the half-inverse overlap matrix <span class="math notranslate nohighlight">\(\mathbf{S}^{-1/2}\)</span>
is typically formed by the canonical orthonormalization procedure
<span id="id19">[<a class="reference internal" href="reference.html#id67" title="Per-Olov Löwdin. On the nonorthogonality problem. Adv. Quantum Chem., 5:185, 1970. doi:10.1016/S0065-3276(08)60339-1.">14</a>]</span> in which eigenvectors of the overlap matrix
with small eigenvalues are thrown out, this procedure typically
results in a better-conditioned basis since linearly dependent
combinations of the basis functions are excluded by the procedure.</p>
<p>At variance, PySCF relies on SciPy’s generalized eigenvalue solver by
default, which may fail for poorly conditioned basis sets. One can,
however, switch to the use of canonical orthonormalization by toggling
e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">remove_linear_dep_</span><span class="p">)</span>
</pre></div>
</div>
<p>In the presence of truly pathological linear dependencies, such as
those that occur in molecular calculations with multiply augmented
basis sets, and at extreme molecular geometries where two nuclei are
close to each other, also canonical orthonormalization fails.
However, the addons module also implements the partial Cholesky
orthonormalization technique
<span id="id20">[<a class="reference internal" href="reference.html#id63" title="Susi Lehtola. Curing basis set overcompleteness with pivoted cholesky decompositions. J. Chem. Phys., 151(24):241102, 2019. doi:10.1063/1.5139948.">15</a>, <a class="reference internal" href="reference.html#id64" title="Susi Lehtola. Accurate reproduction of strongly repulsive interatomic potentials. Phys. Rev. A, 101:032504, 2020. doi:10.1103/PhysRevA.101.032504.">16</a>]</span>, which has been
shown to work reliably even in the presence of such truly pathological
linear dependencies.</p>
</section>
<section id="scalar-relativistic-correction">
<span id="user-x2c"></span><h2>Scalar relativistic correction<a class="headerlink" href="#scalar-relativistic-correction" title="Link to this heading">#</a></h2>
<p>Scalar relativistic effects can be applied on the one-body operators
through spin-free eXact-2-component (SFX2C) Hamiltonian
<span id="id21">[<a class="reference internal" href="reference.html#id75" title="Kenneth G Dyall. Interfacing relativistic and nonrelativistic methods. iv. one-and two-electron scalar approximations. The Journal of Chemical Physics, 115(20):9136–9143, 2001.">17</a>]</span>.  The SFX2C Hamiltonian can be invoked by
decorating the SCF objects with the <code class="xref py py-func docutils literal notranslate"><span class="pre">x2c()</span></code> method, three other
equivalent function names are also listed below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c</span><span class="p">()</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">()</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">sfx2c</span><span class="p">()</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">sfx2c1e</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that the SFX2C Hamiltonian only changes the one-body operators,
and it only accounts for the mass-velocity effect, while picture
change effect and spin-orbit coupling are not included.  Once the SCF
object is decorated by <code class="xref py py-func docutils literal notranslate"><span class="pre">x2c()</span></code> method, the corresponding post-SCF
objects will also automatically have the SFX2C Hamiltonian applied.
To turn it off explicitly, one can do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span><span class="o">.</span><span class="n">with_x2c</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>More examples can be found in
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/scf/21-x2c.py">examples/scf/21-x2c.py</a>.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="pbcgto.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Crystal structure</p>
      </div>
    </a>
    <a class="right-next"
       href="dft.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Density functional theory (DFT)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-guess">Initial guess</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#restart-from-an-old-calculation">Restart from an old calculation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#converging-scf-iterations">Converging SCF iterations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-analysis">Stability analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#property-calculations">Property calculations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spin-restricted-spin-unrestricted-restricted-open-shell-and-generalized-calculations">Spin-restricted, spin-unrestricted, restricted open-shell, and generalized calculations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-dependencies">Linear dependencies</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scalar-relativistic-correction">Scalar relativistic correction</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/pyscf/pyscf.github.io/edit/master/source/user/scf.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, The PySCF Developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>