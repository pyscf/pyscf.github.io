
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Density functional theory (DFT) &#8212; PySCF</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pyscf.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon-32x32.png"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Second-order Møller–Plesset perturbation theory (MP2)" href="mp.html" />
    <link rel="prev" title="Self-consistent field (SCF) methods" href="scf.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=pyscf data-md-color-accent=pyscf>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#user/dft" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="PySCF"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/pyscf-logo-white.svg" height="26"
                   alt="PySCF logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">PySCF 2.1</span>
          <span class="md-header-nav__topic"> Density functional theory (DFT) </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Home</a></li>
            
            <li class="md-tabs__item"><a href="../install.html" class="md-tabs__link">Install</a></li>
            
            <li class="md-tabs__item"><a href="../quickstart.html" class="md-tabs__link">Quickstart</a></li>
            
            <li class="md-tabs__item"><a href="../user.html" class="md-tabs__link">User Guide</a></li>
            
            <li class="md-tabs__item"><a href="../develop.html" class="md-tabs__link">Developer Guide</a></li>
            
            <li class="md-tabs__item"><a href="../pyscf_api_docs/modules.html" class="md-tabs__link">API</a></li>
            
            <li class="md-tabs__item"><a href="../about.html" class="md-tabs__link">About</a></li>
          <li class="md-tabs__item"><a href="../user.html" class="md-tabs__link">User Guide</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="PySCF" class="md-nav__button md-logo">
      
        <img src="../_static/pyscf-logo-white.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="PySCF">PySCF 2.1</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../install.html" class="md-nav__link">Install</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../quickstart.html" class="md-nav__link">Quickstart</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../user.html" class="md-nav__link">User Guide</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="gto.html" class="md-nav__link">Molecular structure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="scf.html" class="md-nav__link">Self-consistent field (SCF) methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Density functional theory (DFT) </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Density functional theory (DFT)</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#user-dft--page-root" class="md-nav__link">Density functional theory (DFT)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#theory" class="md-nav__link">Theory</a>
        </li>
        <li class="md-nav__item"><a href="#predefined-xc-functionals-and-functional-aliases" class="md-nav__link">Predefined <em>xc</em> Functionals and Functional Aliases</a>
        </li>
        <li class="md-nav__item"><a href="#customizing-xc-functionals" class="md-nav__link">Customizing <em>xc</em> functionals</a>
        </li>
        <li class="md-nav__item"><a href="#numerical-integration-grids" class="md-nav__link">Numerical integration grids</a>
        </li>
        <li class="md-nav__item"><a href="#dispersion-corrections" class="md-nav__link">Dispersion corrections</a>
        </li>
        <li class="md-nav__item"><a href="#periodic-boundary-conditions" class="md-nav__link">Periodic Boundary Conditions</a>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/user/dft.rst.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mp.html" class="md-nav__link">Second-order Møller–Plesset perturbation theory (MP2)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="gw.html" class="md-nav__link">GW approximation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ci.html" class="md-nav__link">Configuration interaction (CISD and FCI)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cc.html" class="md-nav__link">Coupled-cluster theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="adc.html" class="md-nav__link">Algebraic diagrammatic construction (ADC)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="agf2.html" class="md-nav__link">Auxiliary second-order Green’s function perturbation theory (AGF2)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mcscf.html" class="md-nav__link">Multi-configuration self-consistent field (MCSCF)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mrpt.html" class="md-nav__link">Multi-reference perturbation theory (MRPT)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tddft.html" class="md-nav__link">Time-dependent Hartree-Fock and density functional theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="solvent.html" class="md-nav__link">Solvation models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="qmmm.html" class="md-nav__link">QM/MM methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="md.html" class="md-nav__link">Molecular Dynamics</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="df.html" class="md-nav__link">Density fitting (DF)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="pbc.html" class="md-nav__link">Periodic boundary conditions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="eph.html" class="md-nav__link">Electron-phonon coupling</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="lo.html" class="md-nav__link">Localized orbitals</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="sgx.html" class="md-nav__link">Seminumerical exchange (SGX)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="geomopt.html" class="md-nav__link">Geometry optimization</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../pyscf_api_docs/pyscf.html" class="md-nav__link">API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../about.html" class="md-nav__link">About</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#user-dft--page-root" class="md-nav__link">Density functional theory (DFT)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#theory" class="md-nav__link">Theory</a>
        </li>
        <li class="md-nav__item"><a href="#predefined-xc-functionals-and-functional-aliases" class="md-nav__link">Predefined <em>xc</em> Functionals and Functional Aliases</a>
        </li>
        <li class="md-nav__item"><a href="#customizing-xc-functionals" class="md-nav__link">Customizing <em>xc</em> functionals</a>
        </li>
        <li class="md-nav__item"><a href="#numerical-integration-grids" class="md-nav__link">Numerical integration grids</a>
        </li>
        <li class="md-nav__item"><a href="#dispersion-corrections" class="md-nav__link">Dispersion corrections</a>
        </li>
        <li class="md-nav__item"><a href="#periodic-boundary-conditions" class="md-nav__link">Periodic Boundary Conditions</a>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/user/dft.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="density-functional-theory-dft">
<span id="user-dft"></span><h1 id="user-dft--page-root">Density functional theory (DFT)<a class="headerlink" href="#user-dft--page-root" title="Permalink to this heading">¶</a></h1>
<p><em>Modules</em>: <code class="xref py py-mod docutils literal notranslate"><span class="pre">dft</span></code>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">pbc.dft</span></code></p>
<section id="introduction">
<span id="user-dft-intro"></span><h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>Kohn-Sham density functional theory (KS-DFT) has been implemented through derived classes of the <a class="reference internal" href="../pyscf_api_docs/pyscf.scf.html#pyscf.scf.hf.SCF" title="pyscf.scf.hf.SCF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.hf.SCF</span></code></a> parent class. As such, the methods and capabilities introduced in <a class="reference internal" href="scf.html#user-scf"><span class="std std-ref">Self-consistent field (SCF) methods</span></a> are also available to the <code class="xref py py-mod docutils literal notranslate"><span class="pre">dft</span></code> module, e.g., the efficient second-order Newton-Raphson algorithm.</p>
<p>A minimal example of using the <code class="xref py py-mod docutils literal notranslate"><span class="pre">dft</span></code> module reads, cf. <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/examples/dft/22-newton.py">dft/22-newton.py</a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">dft</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol_hf</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span> <span class="o">=</span> <span class="s1">'H 0 0 0; F 0 0 1.1'</span><span class="p">,</span> <span class="n">basis</span> <span class="o">=</span> <span class="s1">'ccpvdz'</span><span class="p">,</span> <span class="n">symmetry</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">RKS</span><span class="p">(</span><span class="n">mol_hf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">'lda,vwn'</span> <span class="c1"># default</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span> <span class="o">=</span> <span class="n">mf_hf</span><span class="o">.</span><span class="n">newton</span><span class="p">()</span> <span class="c1"># second-order algortihm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>This will run a restricted, closed-shell Kohn-Sham DFT calculation with the default LDA functional.</p>
</section>
<section id="theory">
<span id="user-dft-theory"></span><h2 id="theory">Theory<a class="headerlink" href="#theory" title="Permalink to this heading">¶</a></h2>
<p>In KS-DFT, as first proposed by Kohn and Sham <span id="id1">[]</span>, the electron density of a reference noninteracting system is used to represent the density of the true interacting system. As a result, the computational formulation of KS-DFT resembles that of Hartree-Fock (HF) theory, but with a different effective Fock potential. In KS-DFT, the total electronic energy is defined as follows:</p>
<div class="math notranslate nohighlight">
\[E = T_s + E_{\rm ext} + E_J + E_{\rm xc} \ .\]</div>
<p>Here, <span class="math notranslate nohighlight">\(T_s\)</span> is the noninteracting kinetic energy, <span class="math notranslate nohighlight">\(E_{\rm ext}\)</span> is the energy due to the external potential, <span class="math notranslate nohighlight">\(E_J\)</span> is the Coulomb energy, and
<span class="math notranslate nohighlight">\(E_{\rm xc}\)</span> is the exchange-correlation (<em>xc</em>) energy. In practice, <span class="math notranslate nohighlight">\(E_{\rm xc}\)</span> is approximated by a density functional approximation, which themselves may be divided into several classes along different rungs of Jacob’s ladder <span id="id2">[]</span>:</p>
<ul class="simple">
<li><p>local density approximations (e.g. LDA; <em>xc</em> energy depends only on the electron density, <span class="math notranslate nohighlight">\(\rho\)</span>),</p></li>
<li><p>generalized gradient approximations (GGA; <em>xc</em> energy also depends on the density gradient, <span class="math notranslate nohighlight">\(|\nabla\rho|\)</span>),</p></li>
<li><p>meta-GGAs (<em>xc</em> energy also depends on the kinetic energy density and/or the density Laplacian, <span class="math notranslate nohighlight">\(\sum_i |\nabla \psi_i|^2\)</span>, <span class="math notranslate nohighlight">\(\nabla^2\rho\)</span>; the latter is not supported in PySCF at the moment),</p></li>
<li><p>non-local correlation functionals (<em>xc</em> energy involves a double integral)</p></li>
<li><p>hybrid density functionals (a fraction of exact exchange is used), and</p></li>
<li><p>long-range corrected density functionals (exact exchange is used with a modified interaction kernel)</p></li>
</ul>
<p>Variationally minimizing the total energy with respect to the density yields the KS equations for the non-interacting reference orbitals, on par with HF theory, and these have the same general form as the Fock equations in <span class="xref std std-ref">theory_scf</span>. However, the exact exchange, <span class="math notranslate nohighlight">\(\hat{K}\)</span>, is replaced by the <em>xc</em> potential, <span class="math notranslate nohighlight">\(\hat{v}_{\rm xc}=\delta E_{\rm xc}/\delta \rho\)</span>. For hybrid and meta-GGA calculations, PySCF uses the generalized KS formalism <span id="id3">[]</span>, in which the so-called generalized KS equations minimize the total energy with respect to the orbitals themselves.</p>
</section>
<section id="predefined-xc-functionals-and-functional-aliases">
<span id="user-dft-predef-func"></span><h2 id="predefined-xc-functionals-and-functional-aliases">Predefined <em>xc</em> Functionals and Functional Aliases<a class="headerlink" href="#predefined-xc-functionals-and-functional-aliases" title="Permalink to this heading">¶</a></h2>
<p>The choice of <em>xc</em> functional is assigned via the attribute <code class="xref py py-attr docutils literal notranslate"><span class="pre">DFT.xc</span></code>. This is a comma separated string (precise grammar discussed <a class="reference internal" href="#user-dft-custom-func"><span class="std std-ref">below</span></a>, e.g., <code class="docutils literal notranslate"><span class="pre">xc</span> <span class="pre">=</span> <span class="pre">'pbe,pbe'</span></code> denotes PBE exchange plus PBE correlation. In common usage, a single name (alias) is often used to refer to the combination of a particular exchange and correlation approximation instead. To support this, PySCF will first examine a lookup table to see if <code class="xref py py-attr docutils literal notranslate"><span class="pre">DFT.xc</span></code> corresponds to a common compound name, and if so, the implementation dispatches to the appropriate exchange and correlation forms, e.g., <code class="docutils literal notranslate"><span class="pre">xc</span> <span class="pre">=</span> <span class="pre">'pbe'</span></code> directly translates to <code class="docutils literal notranslate"><span class="pre">xc</span> <span class="pre">=</span> <span class="pre">'pbe,pbe'</span></code>. However, if the name is not found in the compound functional table, and only a single string is given, it will be treated as an exchange functional only, e.g., <code class="docutils literal notranslate"><span class="pre">xc</span> <span class="pre">=</span> <span class="pre">'b86'</span></code> leads to B86 exchange only (without correlation). Please note that earlier PySCF versions (1.5.0 or earlier)
did not support compound functional aliases, and both exchange and correlation always had to be explicitly assigned.</p>
<p>PySCF supports two independent libraries of <em>xc</em> functional implementations, namely <a class="reference external" href="https://www.tddft.org/programs/libxc/">Libxc</a> and <a class="reference external" href="https://xcfun.readthedocs.io/en/latest/">XCFun</a>.
The former of these is the default, but the latter may be selected by setting <code class="docutils literal notranslate"><span class="pre">DFT._numint.libxc</span> <span class="pre">=</span> <span class="pre">dft.xcfun</span></code>, cf. <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/examples/dft/32-xcfun_as_default.py">dft/32-xcfun_as_default.py</a>.
For complete lists of the available density functional approximations, the user is referred to the <code class="docutils literal notranslate"><span class="pre">XC_CODES</span></code> dictionaries in <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/pyscf/dft/libxc.py">pyscf/dft/libxc.py</a> and <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/pyscf/dft/xcfun.py">pyscf/dft/xcfun.py</a>, respectively. The user can choose the library at runtime in order to leverage any of its exclusive features.</p>
<p>The constant maintenance and development of density functional libraries is hard work at little personal benefit, while everyone benefits from having a huge variety of density functionals in numerically stable form for use in applications. If you use Libxc in your calculations, please cite the most up-to-date work on Libxc in your paper. You can see the most up-to-date citation on the <a class="reference external" href="https://www.tddft.org/programs/libxc/">Libxc web page</a>; at the moment, this is <span id="id4">[]</span>. Likewise, if you use XCFun in your calculations, please cite the most up-to-date work on XCFun in your paper. You can find recent citations on the <a class="reference external" href="https://github.com/dftlibs/xcfun/">XCFun web page</a>; at present, this is <span id="id5">[]</span>. Please check your log files for the library used in your calculation (you may need to increase the <code class="docutils literal notranslate"><span class="pre">DFT.verbose</span></code> setting of your calculation to see this).</p>
</section>
<section id="customizing-xc-functionals">
<span id="user-dft-custom-func"></span><h2 id="customizing-xc-functionals">Customizing <em>xc</em> functionals<a class="headerlink" href="#customizing-xc-functionals" title="Permalink to this heading">¶</a></h2>
<p>The <em>xc</em> functional of choice can be customized. The simplest way to customize to achieve this is to assign a string expression to the <code class="docutils literal notranslate"><span class="pre">DFT.xc</span></code> attribute:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">HF_X</span><span class="p">,</span> <span class="n">LDA_X</span> <span class="o">=</span> <span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="o">.</span><span class="mi">08</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B88_X</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">HF_X</span> <span class="o">-</span> <span class="n">LDA_X</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">LYP_C</span> <span class="o">=</span> <span class="o">.</span><span class="mi">81</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VWN_C</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">LYP_C</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">HF_X</span><span class="si">:}</span><span class="s1"> * HF + </span><span class="si">{</span><span class="n">LDA_X</span><span class="si">:}</span><span class="s1"> * LDA + </span><span class="si">{</span><span class="n">B88_X</span><span class="si">:}</span><span class="s1"> * B88, </span><span class="si">{</span><span class="n">LYP_C</span><span class="si">:}</span><span class="s1"> * LYP + </span><span class="si">{</span><span class="n">VWN_C</span><span class="si">:}</span><span class="s1"> * VWN'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">'hf'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>The XC functional string is parsed against a set of rules, as described below.</p>
<ul class="simple">
<li><p>The given functional description must be a one-line string</p></li>
<li><p>The functional description is case-insensitive</p></li>
<li><p>The functional description string has two parts, separated by a <code class="docutils literal notranslate"><span class="pre">,</span></code>.  The first part describes the exchange functional, the second part sets the correlation functional (as for <a class="reference internal" href="#user-dft-predef-func"><span class="std std-ref">aliases</span></a>)</p>
<ul>
<li><p>If a <code class="docutils literal notranslate"><span class="pre">","</span></code> does not appear in the string, the entire string is treated as the name of a compound functional (containing both the exchange and the correlation
functional) which should be in the list of functional aliases. Again, if the string is not found in the aliased functional list, it is treated as an exchange functional</p></li>
<li><p>To input only an exchange functional (without a correlation functional), one should leave the second part blank. E.g., <code class="docutils literal notranslate"><span class="pre">slater,</span></code> implies a functional with the LDA contribution only</p></li>
<li><p>Correspondingly, to neglect the contribution of the exchange functional (i.e. to just use a correlation functional), one should leave the first part blank, e.g., <code class="docutils literal notranslate"><span class="pre">',vwn'</span></code> means a functional with VWN only</p></li>
<li><p>If a compound <em>xc</em> functional is specified, no matter whether it is in the exchange part (the string in front of the comma) or the correlation part (the string behind the comma), both exchange and correlation functionals of the compound <em>xc</em> functional will be used</p></li>
</ul>
</li>
<li><p>The functional name can be placed in an arbitrary order.  Two names need be separated by operators <code class="docutils literal notranslate"><span class="pre">+</span></code> or <code class="docutils literal notranslate"><span class="pre">-</span></code>.  Blank spaces are ignored.  NOTE the parser
only reads the operators <code class="docutils literal notranslate"><span class="pre">+,</span> <span class="pre">-,</span> <span class="pre">*</span></code>, while <code class="docutils literal notranslate"><span class="pre">/</span></code> is not supported</p></li>
<li><p>A functional name can have at most one factor.  If a factor is not given, it is set to <code class="docutils literal notranslate"><span class="pre">1</span></code>.  Compound functionals can be scaled as a unit. For example, <code class="docutils literal notranslate"><span class="pre">.5</span> <span class="pre">*</span> <span class="pre">b3lyp</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">.1</span> <span class="pre">*</span> <span class="pre">HF</span> <span class="pre">+</span> <span class="pre">.04</span> <span class="pre">*</span> <span class="pre">LDA</span> <span class="pre">+</span> <span class="pre">.36</span> <span class="pre">*</span> <span class="pre">B88,</span> <span class="pre">.405</span> <span class="pre">*</span> <span class="pre">LYP</span> <span class="pre">+</span> <span class="pre">.095</span> <span class="pre">*</span> <span class="pre">VWN</span></code></p></li>
<li><p>The string <code class="docutils literal notranslate"><span class="pre">HF</span></code> stands for exact exchange (HF K matrix). <code class="docutils literal notranslate"><span class="pre">HF</span></code> can be put in the correlation functional part (after the comma). Putting <code class="docutils literal notranslate"><span class="pre">HF</span></code> in the correlation part is the same as putting <code class="docutils literal notranslate"><span class="pre">HF</span></code> in the exchange part</p></li>
<li><p>The special string <code class="docutils literal notranslate"><span class="pre">RSH</span></code> means a range-separated operator. Its format is <code class="docutils literal notranslate"><span class="pre">RSH(omega,</span> <span class="pre">alpha,</span> <span class="pre">beta)</span></code>. Another way to input range separation is to use keywords <code class="docutils literal notranslate"><span class="pre">SR_HF</span></code> and <code class="docutils literal notranslate"><span class="pre">LR_HF</span></code>, e.g., <code class="docutils literal notranslate"><span class="pre">SR_HF(.1)</span> <span class="pre">*</span> <span class="pre">alpha_plus_beta</span></code> and <code class="docutils literal notranslate"><span class="pre">LR_HF(.1)</span> <span class="pre">*</span> <span class="pre">alpha</span></code> where the number in the parenthesis is the value of <code class="docutils literal notranslate"><span class="pre">omega</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">RSH</span></code> kernel in PySCF is based on the error function kernel; Yukawa kernels are not supported at present</p></li>
<li><p>One need in general be careful with the Libxc convention of GGA functionals, in which the LDA contribution is included</p></li>
</ul>
<p>For completeness, it’s worth mentioning that yet another way to customize <em>xc</em> functionals exists, which uses the <code class="xref py py-meth docutils literal notranslate"><span class="pre">eval_xc()</span></code> method of the numerical integral class:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">eval_xc</span><span class="p">(</span><span class="n">xc_code</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">relativity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># A fictitious functional to demonstrate the usage</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">rho0</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="n">rho</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">dz</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">exc</span> <span class="o">=</span> <span class="o">.</span><span class="mi">01</span> <span class="o">*</span> <span class="n">rho0</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="o">.</span><span class="mi">02</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">+</span> <span class="o">.</span><span class="mi">001</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">vrho</span> <span class="o">=</span> <span class="o">.</span><span class="mi">01</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rho0</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">vgamma</span> <span class="o">=</span> <span class="o">.</span><span class="mi">02</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">+</span> <span class="o">.</span><span class="mi">001</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-.</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">vlapl</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">vtau</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">vxc</span> <span class="o">=</span> <span class="p">(</span><span class="n">vrho</span><span class="p">,</span> <span class="n">vgamma</span><span class="p">,</span> <span class="n">vlapl</span><span class="p">,</span> <span class="n">vtau</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">fxc</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># 2nd-order functional derivative</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">kxc</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># 3rd-order functional derivative</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">return</span> <span class="n">exc</span><span class="p">,</span> <span class="n">vxc</span><span class="p">,</span> <span class="n">fxc</span><span class="p">,</span> <span class="n">kxc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dft</span><span class="o">.</span><span class="n">libxc</span><span class="o">.</span><span class="n">define_xc_</span><span class="p">(</span><span class="n">mf_hf</span><span class="o">.</span><span class="n">_numint</span><span class="p">,</span> <span class="n">eval_xc</span><span class="p">,</span> <span class="n">xctype</span><span class="o">=</span><span class="s1">'GGA'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>By calling the <code class="xref py py-func docutils literal notranslate"><span class="pre">dft.libxc.define_xc_()</span></code> function, the customized <code class="xref py py-func docutils literal notranslate"><span class="pre">eval_xc()</span></code> function is patched to the numerical integration class <code class="docutils literal notranslate"><span class="pre">DFT._numint</span></code> dynamically.</p>
<p>For more examples of DFT <em>xc</em> functional customization, cf. <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/examples/dft/24-custom_xc_functional.py">dft/24-custom_xc_functional.py</a> and <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/examples/dft/24-define_xc_functional.py">dft/24-define_xc_functional.py</a>.</p>
</section>
<section id="numerical-integration-grids">
<span id="user-dft-numint"></span><h2 id="numerical-integration-grids">Numerical integration grids<a class="headerlink" href="#numerical-integration-grids" title="Permalink to this heading">¶</a></h2>
<p>PySCF implements several numerical integration grids, which can be tuned in KS-DFT calculations following the examples in <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/examples/dft/11-grid_scheme.py">dft/11-grid_scheme.py</a>. For instance, predefined grids (identical to those used in <a class="reference external" href="https://www.turbomole.org/">TURBOMOLE</a>) may be set by using levels from <code class="docutils literal notranslate"><span class="pre">0</span></code> (very sparse) to <code class="docutils literal notranslate"><span class="pre">9</span></code> (very dense), with a default values of <code class="docutils literal notranslate"><span class="pre">3</span></code>, cf. <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/pyscf/dft/gen_grid.py">pyscf/dft/gen_grid.py</a> for more details. Likewise, the default integration grids use Bragg radii for atoms, Treutler-Ahlrichs radial grids, Becke partitioning for grid weights, the pruning scheme of NWChem, and mesh grids, which are all setting that may be overwritten:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">grids</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">radi_method</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">gauss_chebeshev</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">grids</span><span class="o">.</span><span class="n">prune</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># disabling pruning of grids near core regions</span>
</pre></div>
</div>
<p>In addition, these grids can be used for the general numerical evaluation of basis functions, electron densities, and integrals. Some examples of these functionalities can be found in <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/examples/dft/30-ao_value_on_grid.py">dft/30-ao_value_on_grid.py</a> and <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/examples/dft/31-xc_value_on_grid.py">dft/31-xc_value_on_grid.py</a>. For instance, the electron density may be readily obtained:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">'b3lyp'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coords</span> <span class="o">=</span> <span class="n">mf_hf</span><span class="o">.</span><span class="n">grids</span><span class="o">.</span><span class="n">coords</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights</span> <span class="o">=</span> <span class="n">mf_hf</span><span class="o">.</span><span class="n">grids</span><span class="o">.</span><span class="n">weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ao_value</span> <span class="o">=</span> <span class="n">numint</span><span class="o">.</span><span class="n">eval_ao</span><span class="p">(</span><span class="n">mol_hf</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># AO value and its gradients</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rho</span> <span class="o">=</span> <span class="n">numint</span><span class="o">.</span><span class="n">eval_rho</span><span class="p">(</span><span class="n">mol_hf</span><span class="p">,</span> <span class="n">ao_value</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">xctype</span><span class="o">=</span><span class="s1">'GGA'</span><span class="p">)</span> <span class="c1"># density &amp; density gradients</span>
</pre></div>
</div>
<p>From <code class="docutils literal notranslate"><span class="pre">rho</span></code>, the energy density and <em>xc</em> potential can be computed by calling into <code class="xref py py-func docutils literal notranslate"><span class="pre">dft.libxc.eval_xc()</span></code>.</p>
<p>A more specialized example is the following on computing the kinetic energy from the nonnegative kinetic energy density according to the formulas:</p>
<div class="math notranslate nohighlight">
\[t_s(\mathbf{r}) = \frac{1}{2} \sum_{i\in occ} |\nabla\psi_i(\mathbf{r})|^2 \;,\]</div>
<div class="math notranslate nohighlight">
\[T_s = \int d\mathbf{r} t_s(\mathbf{r}) \;.\]</div>
<p>In PySCF, the code boils down to:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">occ_orbs</span> <span class="o">=</span> <span class="n">mf_hf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,</span> <span class="n">mf_hf</span><span class="o">.</span><span class="n">mo_occ</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grids</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">gen_grid</span><span class="o">.</span><span class="n">Grids</span><span class="p">(</span><span class="n">mol_hf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grids</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">with_non0tab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">weights</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ao1</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">numint</span><span class="o">.</span><span class="n">eval_ao</span><span class="p">(</span><span class="n">mol_hf</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">non0tab</span><span class="o">=</span><span class="n">grids</span><span class="o">.</span><span class="n">non0tab</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">'xgp,pi,xgq,qi-&gt;g'</span><span class="p">,</span> <span class="n">ao1</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">occ_orbs</span><span class="p">,</span> <span class="n">ao1</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">occ_orbs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">'g,g-&gt;'</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
<p>or - as an alternative - the same may be achieved in the following way:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Ts_ao</span> <span class="o">=</span> <span class="n">mol_hf</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="s1">'int1e_kin'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Ts_analyt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">'ui,uv,vi-&gt;'</span><span class="p">,</span> <span class="n">occ_orbs</span><span class="p">,</span> <span class="n">Ts_ao</span><span class="p">,</span> <span class="n">occ_orbs</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="dispersion-corrections">
<span id="user-dft-disp-corr"></span><h2 id="dispersion-corrections">Dispersion corrections<a class="headerlink" href="#dispersion-corrections" title="Permalink to this heading">¶</a></h2>
<p>Two main ways exist for adding dispersion (van der Waals) corrections to KS-DFT calculations. One is to augment mean-field results by Grimme’s D3 corrections <span id="id6">[]</span>, which can be added through an interface to the external library <a class="reference external" href="https://github.com/cuanto/libdftd3">libdftd3</a>, cf. <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/examples/dftd3/00-hf_with_dftd3.py">dftd3/00-hf_with_dftd3.py</a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">dftd3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf_d3</span> <span class="o">=</span> <span class="n">dftd3</span><span class="o">.</span><span class="n">dftd3</span><span class="p">(</span><span class="n">dft</span><span class="o">.</span><span class="n">RKS</span><span class="p">(</span><span class="n">mol_hf</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf_d3</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>Alternatively, non-local correlation may be added through the VV10 functional <span id="id7">[]</span>, cf. <a class="reference external" href="https://github.com/pyscf/pyscf/blob/master/examples/dft/33-nlc_functionals.py">dft/33-nlc_functionals.py</a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">'wb97m_v'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">nlc</span> <span class="o">=</span> <span class="s1">'vv10'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">grids</span><span class="o">.</span><span class="n">atom_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'H'</span><span class="p">:</span> <span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="mi">590</span><span class="p">),</span> <span class="s1">'F'</span><span class="p">:</span> <span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="mi">590</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">grids</span><span class="o">.</span><span class="n">prune</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">nlcgrids</span><span class="o">.</span><span class="n">atom_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'H'</span><span class="p">:</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">194</span><span class="p">),</span> <span class="s1">'F'</span><span class="p">:</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">194</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">nlcgrids</span><span class="o">.</span><span class="n">prune</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">gen_grid</span><span class="o">.</span><span class="n">sg1_prune</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf_hf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>It’s important to keep in mind that the evaluation of the VV10 functional involves a double grid integration, so differences in grid size can make an enormous difference in time.</p>
</section>
<section id="periodic-boundary-conditions">
<span id="user-dft-pbc"></span><h2 id="periodic-boundary-conditions">Periodic Boundary Conditions<a class="headerlink" href="#periodic-boundary-conditions" title="Permalink to this heading">¶</a></h2>
<p>Besides finite-sized systems, PySCF further supports KS-DFT calculations with PBCs for performing solid-state calculations. The APIs for molecular and crystalline KS-DFT calculations have deliberately been made to align to the greatest extent possible, and an all-electron KS-DFT calculation for an initialized <code class="docutils literal notranslate"><span class="pre">Cell</span></code> object at either the <span class="math notranslate nohighlight">\(\Gamma\)</span>-point or with k-point sampling may be run through <code class="xref py py-mod docutils literal notranslate"><span class="pre">dft</span></code> and <code class="xref py py-mod docutils literal notranslate"><span class="pre">pbc.dft</span></code>, respectively. For more details on PBC functionalities, please see the dedicated sections on <a class="reference internal" href="pbc.html#user-pbc"><span class="std std-ref">PBC-KS-DFT</span></a>.</p>
</section>
<section id="references">
<h2 id="references">References<a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h2>
<span class="target" id="id8"></span></section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="scf.html" title="Self-consistent field (SCF) methods"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Self-consistent field (SCF) methods </span>
              </div>
            </a>
          
          
            <a href="mp.html" title="Second-order Møller–Plesset perturbation theory (MP2)"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Second-order Møller–Plesset perturbation theory (MP2) </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2015-2021, The PySCF Developers.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.1.1.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>