
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Second-order Møller–Plesset perturbation theory (MP2) &#8212; PySCF</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pyscf.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon-32x32.png"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GW approximation" href="gw.html" />
    <link rel="prev" title="Density functional theory (DFT)" href="dft.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=pyscf data-md-color-accent=pyscf>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#user/mp" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="PySCF"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/pyscf-logo-white.svg" height="26"
                   alt="PySCF logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">PySCF 2.1</span>
          <span class="md-header-nav__topic"> Second-order Møller–Plesset perturbation theory (MP2) </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Home</a></li>
            
            <li class="md-tabs__item"><a href="../install.html" class="md-tabs__link">Install</a></li>
            
            <li class="md-tabs__item"><a href="../quickstart.html" class="md-tabs__link">Quickstart</a></li>
            
            <li class="md-tabs__item"><a href="../user.html" class="md-tabs__link">User Guide</a></li>
            
            <li class="md-tabs__item"><a href="../develop.html" class="md-tabs__link">Developer Guide</a></li>
            
            <li class="md-tabs__item"><a href="../pyscf_api_docs/modules.html" class="md-tabs__link">API</a></li>
            
            <li class="md-tabs__item"><a href="../about.html" class="md-tabs__link">About</a></li>
          <li class="md-tabs__item"><a href="../user.html" class="md-tabs__link">User Guide</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="PySCF" class="md-nav__button md-logo">
      
        <img src="../_static/pyscf-logo-white.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="PySCF">PySCF 2.1</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../install.html" class="md-nav__link">Install</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../quickstart.html" class="md-nav__link">Quickstart</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../user.html" class="md-nav__link">User Guide</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="gto.html" class="md-nav__link">Molecular structure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="scf.html" class="md-nav__link">Self-consistent field (SCF) methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="dft.html" class="md-nav__link">Density functional theory (DFT)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Second-order Møller–Plesset perturbation theory (MP2) </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Second-order Møller–Plesset perturbation theory (MP2)</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#user-mp--page-root" class="md-nav__link">Second-order Møller–Plesset perturbation theory (MP2)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#spin-symmetry" class="md-nav__link">Spin symmetry</a>
        </li>
        <li class="md-nav__item"><a href="#properties" class="md-nav__link">Properties</a>
        </li>
        <li class="md-nav__item"><a href="#frozen-orbitals" class="md-nav__link">Frozen orbitals</a>
        </li>
        <li class="md-nav__item"><a href="#job-control" class="md-nav__link">Job control</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#avoid-t2-storage" class="md-nav__link">Avoid t2 storage</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#density-fitted-mp2-df-mp2" class="md-nav__link">Density-fitted MP2 (DF-MP2)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#background" class="md-nav__link">Background</a>
        </li>
        <li class="md-nav__item"><a href="#using-the-df-mp2-implementation" class="md-nav__link">Using the DF-MP2 implementation</a>
        </li>
        <li class="md-nav__item"><a href="#df-mp2-densities" class="md-nav__link">DF-MP2 densities</a>
        </li>
        <li class="md-nav__item"><a href="#spin-component-scaling" class="md-nav__link">Spin-component scaling</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/user/mp.rst.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="gw.html" class="md-nav__link">GW approximation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ci.html" class="md-nav__link">Configuration interaction (CISD and FCI)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cc.html" class="md-nav__link">Coupled-cluster theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="adc.html" class="md-nav__link">Algebraic diagrammatic construction (ADC)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="agf2.html" class="md-nav__link">Auxiliary second-order Green’s function perturbation theory (AGF2)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mcscf.html" class="md-nav__link">Multi-configuration self-consistent field (MCSCF)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mrpt.html" class="md-nav__link">Multi-reference perturbation theory (MRPT)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tddft.html" class="md-nav__link">Time-dependent Hartree-Fock and density functional theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="solvent.html" class="md-nav__link">Solvation models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="qmmm.html" class="md-nav__link">QM/MM methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="md.html" class="md-nav__link">Molecular Dynamics</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="df.html" class="md-nav__link">Density fitting (DF)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="pbc.html" class="md-nav__link">Periodic boundary conditions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="eph.html" class="md-nav__link">Electron-phonon coupling</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="lo.html" class="md-nav__link">Localized orbitals</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="sgx.html" class="md-nav__link">Seminumerical exchange (SGX)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="geomopt.html" class="md-nav__link">Geometry optimization</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../pyscf_api_docs/pyscf.html" class="md-nav__link">API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../about.html" class="md-nav__link">About</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#user-mp--page-root" class="md-nav__link">Second-order Møller–Plesset perturbation theory (MP2)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#spin-symmetry" class="md-nav__link">Spin symmetry</a>
        </li>
        <li class="md-nav__item"><a href="#properties" class="md-nav__link">Properties</a>
        </li>
        <li class="md-nav__item"><a href="#frozen-orbitals" class="md-nav__link">Frozen orbitals</a>
        </li>
        <li class="md-nav__item"><a href="#job-control" class="md-nav__link">Job control</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#avoid-t2-storage" class="md-nav__link">Avoid t2 storage</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#density-fitted-mp2-df-mp2" class="md-nav__link">Density-fitted MP2 (DF-MP2)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#background" class="md-nav__link">Background</a>
        </li>
        <li class="md-nav__item"><a href="#using-the-df-mp2-implementation" class="md-nav__link">Using the DF-MP2 implementation</a>
        </li>
        <li class="md-nav__item"><a href="#df-mp2-densities" class="md-nav__link">DF-MP2 densities</a>
        </li>
        <li class="md-nav__item"><a href="#spin-component-scaling" class="md-nav__link">Spin-component scaling</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/user/mp.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="second-order-mollerplesset-perturbation-theory-mp2">
<span id="user-mp2"></span><h1 id="user-mp--page-root">Second-order Møller–Plesset perturbation theory (MP2)<a class="headerlink" href="#user-mp--page-root" title="Permalink to this heading">¶</a></h1>
<p><em>Modules</em>: <code class="xref py py-mod docutils literal notranslate"><span class="pre">mp</span></code>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">pbc.mp</span></code></p>
<p>The MP2 and coupled-cluster functionalities of PySCF are similar.  See
also <a class="reference internal" href="cc.html#user-cc"><span class="std std-ref">Coupled-cluster theory</span></a>.</p>
<section id="introduction">
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>Second-order Møller–Plesset perturbation theory (MP2) <a class="bibtex reference internal" href="#moller1934" id="id1">[1]</a> is a
post-Hartree–Fock method. MP2 calculations can be performed in PySCF with or without
density fitting, depending on the initial SCF calculation.</p>
<p>Note also the existence of a <a class="reference internal" href="#dfmp2"><span class="std std-ref">native DF-MP2 implementation</span></a>, which does
not depend on the integral approximation in SCF, and which is significantly faster than the
default implementation of MP2 with density fitting.</p>
<p>A simple example (see <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mp/00-simple_mp2.py">examples/mp/00-simple_mp2.py</a>) of running
an MP2 calculation is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="sd">'''</span>
<span class="sd">A simple example to run MP2 calculation.</span>
<span class="sd">'''</span>

<span class="kn">import</span> <span class="nn">pyscf</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">'H 0 0 0; F 0 0 1.1'</span><span class="p">,</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">'ccpvdz'</span><span class="p">)</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">mf</span><span class="o">.</span><span class="n">MP2</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

</pre></div>
</div>
<p>which outputs</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">converged</span> <span class="n">SCF</span> <span class="n">energy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99.9873974403487</span>
<span class="n">E</span><span class="p">(</span><span class="n">MP2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">100.198764900659</span>  <span class="n">E_corr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.211367460310054</span>
</pre></div>
</div>
<p>namely, the Hartree–Fock energy, the MP2 energy and their difference, the
MP2 correlation energy.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The last line in the code example above could have been replaced by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyscf</span><span class="o">.</span><span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyscf</span><span class="o">.</span><span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>for the same result.</p>
</div>
</section>
<section id="spin-symmetry">
<h2 id="spin-symmetry">Spin symmetry<a class="headerlink" href="#spin-symmetry" title="Permalink to this heading">¶</a></h2>
<p>The MP2 module in PySCF supports a number of reference wavefunctions with
broken spin symmetry.  In particular, MP2 can be performed with a
spin-restricted, spin-unrestricted, and general (spin-mixed) Hartree-Fock
solution, leading to the RMP2, UMP2, and GMP2 methods.</p>
<p>The module-level <code class="docutils literal notranslate"><span class="pre">mp.MP2(mf)</span></code> constructor can infer the correct method based
on the level of symmetry-breaking in the mean-field argument.  For more explicit
control or inspection, the respective classes and functions can be found in
<code class="docutils literal notranslate"><span class="pre">mp2.py</span></code> (restricted), <code class="docutils literal notranslate"><span class="pre">ump2.py</span></code> (unrestricted), and <code class="docutils literal notranslate"><span class="pre">gmp2.py</span></code>
(general).</p>
<p>For example, a spin-unrestricted calculation on triplet oxygen can be performed
as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mp</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">'O 0 0 0; O 0 0 1.2'</span><span class="p">,</span>  <span class="c1"># in Angstrom</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">'ccpvdz'</span><span class="p">,</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">HF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c1"># this is UHF</span>
<span class="n">mymp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c1"># this is UMP2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'UMP2 total energy = '</span><span class="p">,</span> <span class="n">mymp</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="properties">
<h2 id="properties">Properties<a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<p>A number of properties are available at the MP2 level.</p>
<p>Unrelaxed 1- and 2-electron reduced density matrices can be calculated.
They are returned in the MO basis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dm1</span> <span class="o">=</span> <span class="n">mymp</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">()</span>
<span class="n">dm2</span> <span class="o">=</span> <span class="n">mymp</span><span class="o">.</span><span class="n">make_rdm2</span><span class="p">()</span>
</pre></div>
</div>
<p>Analytical nuclear gradients can be calculated <a class="bibtex reference internal" href="#pople1979" id="id2">[2]</a><a class="bibtex reference internal" href="#handy1985" id="id3">[3]</a><a class="bibtex reference internal" href="#yamaguchi2011m" id="id4">[4]</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mygrad</span> <span class="o">=</span> <span class="n">mymp</span><span class="o">.</span><span class="n">nuc_grad_method</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="frozen-orbitals">
<h2 id="frozen-orbitals">Frozen orbitals<a class="headerlink" href="#frozen-orbitals" title="Permalink to this heading">¶</a></h2>
<p>By default, MP2 calculations in PySCF correlate all electrons in all available
orbitals. To freeze the lowest-energy core orbitals, use
the <code class="docutils literal notranslate"><span class="pre">frozen</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mymp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>To freeze occupied and/or unoccupied orbitals with finer control, a
list of 0-based orbital indices can be provided as the <code class="docutils literal notranslate"><span class="pre">frozen</span></code>
keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># freeze 2 core orbitals</span>
<span class="n">mymp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># freeze 2 core orbitals and 3 unoccupied orbitals</span>
<span class="n">mymp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">])</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="job-control">
<h2 id="job-control">Job control<a class="headerlink" href="#job-control" title="Permalink to this heading">¶</a></h2>
<section id="avoid-t2-storage">
<h3 id="avoid-t2-storage">Avoid t2 storage<a class="headerlink" href="#avoid-t2-storage" title="Permalink to this heading">¶</a></h3>
<p>If the t2 amplitudes are not required after the MP2 calculation, they
don’t need to be saved in memory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mymp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
<span class="c1"># by default, with_t2=True</span>
<span class="n">mymp</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">with_t2</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="density-fitted-mp2-df-mp2">
<span id="dfmp2"></span><h2 id="density-fitted-mp2-df-mp2">Density-fitted MP2 (DF-MP2)<a class="headerlink" href="#density-fitted-mp2-df-mp2" title="Permalink to this heading">¶</a></h2>
<section id="background">
<h3 id="background">Background<a class="headerlink" href="#background" title="Permalink to this heading">¶</a></h3>
<p>MP2 can be combined to great benefit with density fitting (DF), also known as the resolution of the identity
(RI) approximation. While the formal scaling remains <span class="math notranslate nohighlight">\(O(N^5)\)</span>, the prefactor and the overall
computational cost are reduced strongly, so that calculations can be performed on much larger
molecules than with conventional MP2. Provided that a suitable auxiliary basis set is used,
the resulting DF/RI errors in reaction energies, geometries, properties etc. are negligible
compared to the intrinsic errors of MP2.</p>
<p>This implementation can calculate energies, as well as unrelaxed and relaxed one-particle
density matrices. Analytical gradients are not available yet. RHF and UHF references are supported
throughout.</p>
<p>Please note that this part of the documentation does <em>not</em> describe the older <code class="docutils literal notranslate"><span class="pre">mp.dfmp2.DFMP2</span></code>
implementation, which is still returned by the <code class="docutils literal notranslate"><span class="pre">density_fit()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">mp.mp2.MP2</span></code>
class; instead it is about the newer <code class="docutils literal notranslate"><span class="pre">DFRMP2</span></code> and <code class="docutils literal notranslate"><span class="pre">DFUMP2</span></code> classes, which need to be imported
directly from <code class="docutils literal notranslate"><span class="pre">mp.dfmp2_native</span></code> or <code class="docutils literal notranslate"><span class="pre">mp.dfump2_native</span></code> at present.</p>
</section>
<section id="using-the-df-mp2-implementation">
<h3 id="using-the-df-mp2-implementation">Using the DF-MP2 implementation<a class="headerlink" href="#using-the-df-mp2-implementation" title="Permalink to this heading">¶</a></h3>
<p>For technical reasons (incompatible algorithms), the “native” DF-MP2 implementation is not
implemented as a subclass of <code class="docutils literal notranslate"><span class="pre">mp.mp2.MP2</span></code>, but it is written as an independent class instead.
Currently, the classes <code class="docutils literal notranslate"><span class="pre">DFRMP2</span></code> (for RHF references) and <code class="docutils literal notranslate"><span class="pre">DFUMP2</span></code> (for UHF references) need to
be imported from the respective modules <code class="docutils literal notranslate"><span class="pre">mp.dfmp2_native</span></code> and <code class="docutils literal notranslate"><span class="pre">mp.dfump2_native</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.mp.dfmp2_native</span> <span class="kn">import</span> <span class="n">DFRMP2</span>
<span class="kn">from</span> <span class="nn">pyscf.mp.dfump2_native</span> <span class="kn">import</span> <span class="n">DFUMP2</span>
</pre></div>
</div>
<p>Both modules also make the respective classes available under the alias <code class="docutils literal notranslate"><span class="pre">DFMP2</span></code>. The file
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mp/10-dfmp2.py">examples/mp/10-dfmp2.py</a> contains a simple example for a DF-MP2 energy calculation.</p>
<p>There is also an older variant of DF-MP2 implemented in <code class="docutils literal notranslate"><span class="pre">mp.dfmp2</span></code>, which does not exploit the
advantages of density fitting fully, and may therefore have much higher memory demands for larger
molecules. Please note that the <code class="docutils literal notranslate"><span class="pre">density_fit()</span></code> method of the conventional <code class="docutils literal notranslate"><span class="pre">mp.mp2.MP2</span></code> class
provides an instance of the old implementation, not the new one! Currently, the “native”
implementation can only be used by importing it from <code class="docutils literal notranslate"><span class="pre">mp.dfmp2_native</span></code> or <code class="docutils literal notranslate"><span class="pre">mp.dfump2_native</span></code>
directly as shown above.</p>
<p>Unless specified by the user, an appropriate auxiliary basis set is determined automatically. Note
that there exist different auxiliary basis sets for Coulomb and exchange fitting in DF-HF on the one
hand, and for correlation fitting in MP2 or other dynamic correlation methods on the other hand.
The DF approximation in MP2 does not depend on the approximation taken for SCF. Arbitrary
auxiliary sets can be specified with the <code class="docutils literal notranslate"><span class="pre">auxbasis</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DFMP2</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">auxbasis</span><span class="o">=</span><span class="s1">'cc-pVTZ-RI'</span><span class="p">)</span>
</pre></div>
</div>
<p>In RHF-DF-MP2 calculations, orbitals can be frozen by specifying either an integer, or a list. Frozen core
UHF-DF-MP2 calculations are initiated by providing either an integer, or two lists of equal length (for the
alpha and beta orbitals):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DFRMP2</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">DFRMP2</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">DFUMP2</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">DFUMP2</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</section>
<section id="df-mp2-densities">
<h3 id="df-mp2-densities">DF-MP2 densities<a class="headerlink" href="#df-mp2-densities" title="Permalink to this heading">¶</a></h3>
<p>Relaxed and unrelaxed 1-RDMs can be calculated for the RHF and UHF variants of the “native” DF-MP2
implementation. The points below provide some advice on choosing the correct type of MP2 density.</p>
<ul class="simple">
<li><p>The relaxed density should be used to calculate properties if the MP2 method is well-behaved for
the system in question. Properties calculated thereby correspond to the correct derivative of the
MP2 energy with respect to an appropriate external perturbation. This is illustrated in
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mp/11-dfmp2-density.py">examples/mp/11-dfmp2-density.py</a>, where the dipole moment of chloromethane is calculated
much more accurately with the relaxed density than with the unrelaxed one. To calculate the
relaxed density, a set of CP-SCF type equations needs to be solved in one of the steps. In
ill-behaved systems, for example if there is multi-reference character, the MP2 natural occupation
numbers can be substantially larger than two or smaller than zero.</p></li>
<li><p>A typical use case for the unrelaxed density is to calculate starting orbitals for a CASSCF
calculation, which can be used despite the system being described poorly at MP2 level otherwise.
In contrast to the relaxed density, the natural occupation numbers of the unrelaxed density are
always between two and zero. <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mp/12-dfump2-natorbs.py">examples/mp/12-dfump2-natorbs.py</a> shows how to calculate
natural orbitals for the allyl radical, which has a significantly spin-contaminated UHF wave
function. On the other hand, the unrelaxed density will often give very poor results for
properties (such as electrostatic moments).</p></li>
</ul>
</section>
<section id="spin-component-scaling">
<h3 id="spin-component-scaling">Spin-component scaling<a class="headerlink" href="#spin-component-scaling" title="Permalink to this heading">¶</a></h3>
<p>Spin-component scaled (SCS-)MP2 calculations can be performed analogously to DF-MP2 calculations
using the classes <code class="docutils literal notranslate"><span class="pre">SCSDFRMP2</span></code> and <code class="docutils literal notranslate"><span class="pre">SCSDFUMP2</span></code>, which also have got aliases such as <code class="docutils literal notranslate"><span class="pre">SCSMP2</span></code>
inside the respective modules. The default scaling factors can be changed to arbitrary values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.mp.dfmp2_native</span> <span class="kn">import</span> <span class="n">SCSMP2</span>
<span class="n">pt</span> <span class="o">=</span> <span class="n">SCSMP2</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ps</span><span class="o">=</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="references">
<h2 id="references">References<a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h2>
<p id="bibtex-bibliography-user/mp-0"><div class="citation bibtex" id="moller1934" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a href="#id1" role="doc-backlink">1</a><span class="fn-bracket">]</span></span>
<p>C. Møller and M. S. Plesset. Note on an approximation treatment for many-electron systems. <em>Phys. Rev.</em>, 46:618, Oct 1934. <a class="reference external" href="https://doi.org/10.1103/PhysRev.46.618">doi:10.1103/PhysRev.46.618</a>.</p>
</div>
<div class="citation bibtex" id="pople1979" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a href="#id2" role="doc-backlink">2</a><span class="fn-bracket">]</span></span>
<p>J. A. Pople, R. Krishnan, H. B. Schlegel, and J. S. Binkley. Derivative studies in hartree-fock and møller-plesset theories. <em>Int. J. Quantum Chem.</em>, 16:225, 1979. <a class="reference external" href="https://doi.org/10.1002/qua.560160825">doi:10.1002/qua.560160825</a>.</p>
</div>
<div class="citation bibtex" id="handy1985" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a href="#id3" role="doc-backlink">3</a><span class="fn-bracket">]</span></span>
<p>N. C. Handy, R. D. Amos, J. F. Gaw, J. E. Rice, and E. D. Simandiras. The elimination of singularities in derivative calculations. <em>Chem. Phys. Lett.</em>, pages 151, 1985. <a class="reference external" href="https://doi.org/10.1016/0009-2614(85)87031-7">doi:10.1016/0009-2614(85)87031-7</a>.</p>
</div>
<div class="citation bibtex" id="yamaguchi2011m" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a href="#id4" role="doc-backlink">4</a><span class="fn-bracket">]</span></span>
<p>Y. Yamaguchi and H. F. Schaefer III. <em>Analytic Derivative Methods in Molecular Electronic Structure Theory: A New Dimension to Quantum Chemistry and its Applications to Spectroscopy</em>, chapter Fundamentals and Theory, pages 325. John Wiley &amp; Sons, Ltd., 2011. <a class="reference external" href="https://doi.org/10.1002/9780470749593.hrs006">doi:10.1002/9780470749593.hrs006</a>.</p>
</div>

</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="dft.html" title="Density functional theory (DFT)"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Density functional theory (DFT) </span>
              </div>
            </a>
          
          
            <a href="gw.html" title="GW approximation"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> GW approximation </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2015-2021, The PySCF Developers.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>