
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Configuration interaction (CISD and FCI) &#8212; PySCF</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=92fd9be5" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pyscf-pst.css?v=ed6b5f64" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=dfec817d"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/ci';</script>
    <link rel="icon" href="../_static/favicon-32x32.png"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Coupled-cluster theory" href="cc.html" />
    <link rel="prev" title="GW approximation" href="gw.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="2.7" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo-64x64.png" class="logo__image only-light" alt=""/>
    <img src="../_static/logo-64x64.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">PySCF</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contributor/index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../news.html">
    News
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyscf/pyscf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contributor/index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../news.html">
    News
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyscf/pyscf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="install.html">How to install PySCF</a></li>
<li class="toctree-l1"><a class="reference internal" href="using.html">How to use PySCF</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Building molecules and crystals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="gto.html">Molecular structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="pbcgto.html">Crystal structure</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Electronic structure methods</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="scf.html">Self-consistent field (SCF) methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="dft.html">Density functional theory (DFT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mp.html">Second-order Møller–Plesset perturbation theory (MP2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gw.html">GW approximation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Configuration interaction (CISD and FCI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="cc.html">Coupled-cluster theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="adc.html">Algebraic diagrammatic construction (ADC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="agf2.html">Auxiliary second-order Green’s function perturbation theory (AGF2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcscf.html">Multi-configuration self-consistent field (MCSCF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mrpt.html">Multi-reference perturbation theory (MRPT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tddft.html">Time-dependent Hartree-Fock and density functional theory</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other functionalities</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="solvent.html">Solvation models</a></li>
<li class="toctree-l1"><a class="reference internal" href="qmmm.html">QM/MM methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="md.html">Molecular Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="df.html">Density fitting (DF)</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="pbc.html">Periodic boundary conditions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="pbc/gto.html">Crystal structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc/scf.html">SCF and DFT methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc/df.html">Density fitting for crystalline calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc/mix_mol.html">Mixing PBC and molecular modules</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="eph.html">Electron-phonon coupling</a></li>
<li class="toctree-l1"><a class="reference internal" href="lo.html">Localized orbitals</a></li>
<li class="toctree-l1"><a class="reference internal" href="sgx.html">Seminumerical exchange (SGX)</a></li>
<li class="toctree-l1"><a class="reference internal" href="geomopt.html">Geometry optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPU Acceleration (GPU4PySCF)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extensions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Extensions</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Configuration interaction (CISD and FCI)</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="configuration-interaction-cisd-and-fci">
<span id="theory-ci"></span><h1>Configuration interaction (CISD and FCI)<a class="headerlink" href="#configuration-interaction-cisd-and-fci" title="Link to this heading">#</a></h1>
<p><em>Modules</em>: <a class="reference internal" href="../pyscf_api_docs/pyscf.ci.html#module-pyscf.ci" title="pyscf.ci"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyscf.ci</span></code></a>, <a class="reference internal" href="../pyscf_api_docs/pyscf.fci.html#module-pyscf.fci" title="pyscf.fci"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyscf.fci</span></code></a>, <a class="reference internal" href="../pyscf_api_docs/pyscf.pbc.ci.html#module-pyscf.pbc.ci" title="pyscf.pbc.ci"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyscf.pbc.ci</span></code></a></p>
<p>PySCF has separate molecular implementations for configuration
interaction singles and doubles (CISD) (<code class="xref py py-mod docutils literal notranslate"><span class="pre">ci</span></code>) and full
configuration interaction (FCI) (<code class="xref py py-mod docutils literal notranslate"><span class="pre">fci</span></code>). The functionalities of the
CISD implementation are similar to the functionalities of MP2
(<a class="reference internal" href="mp.html#user-mp2"><span class="std std-ref">Second-order Møller–Plesset perturbation theory (MP2)</span></a>) and CCSD (<a class="reference internal" href="cc.html#user-cc"><span class="std std-ref">Coupled-cluster theory</span></a>) in PySCF.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Configuration interaction (see e.g. <span id="id1">[<a class="reference internal" href="reference.html#id12" title="P. J. Knowles and N. C. Handy. A new determinant-based full configuration interaction method. Chem. Phys. Lett., 111(4):315, 1984. doi:10.1016/0009-2614(84)85513-X.">31</a>, <a class="reference internal" href="reference.html#id13" title="Attila Szabo and Neil S Ostlund. Modern quantum chemistry: introduction to advanced electronic structure theory. Courier Corporation, 2012.">32</a>, <a class="reference internal" href="reference.html#id14" title="T. Helgaker, P. Jørgensen, and J. Olsen. Configuration-Interaction Theory, chapter 11, pages 523. John Wiley &amp; Sons, Ltd, 2000. doi:10.1002/9781119019572.ch11.">33</a>]</span>)
is a post-Hartree–Fock method, diagonalising
the many-electron Hamiltonian matrix. FCI includes all Slater determinants of
appropriate symmetry in the eigenvector basis. CISD includes only those
that differ from the Hartree–Fock determinant by at most two occupied
spinorbitals.</p>
</section>
<section id="configuration-interaction-singles-and-doubles-cisd">
<h2>Configuration interaction singles and doubles (CISD)<a class="headerlink" href="#configuration-interaction-singles-and-doubles-cisd" title="Link to this heading">#</a></h2>
<p>A simple example (see <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/ci/00-simple_cisd.py">examples/ci/00-simple_cisd.py</a>) of running
a restricted and an unrestricted CISD calculation is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">A simple example to run CISD calculation.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">pyscf</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;H 0 0 0; F 0 0 1.1&#39;</span><span class="p">,</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;ccpvdz&#39;</span><span class="p">)</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">HF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mycc</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">CISD</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RCISD correlation energy&#39;</span><span class="p">,</span> <span class="n">mycc</span><span class="o">.</span><span class="n">e_corr</span><span class="p">)</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">UHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mycc</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">CISD</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UCISD correlation energy&#39;</span><span class="p">,</span> <span class="n">mycc</span><span class="o">.</span><span class="n">e_corr</span><span class="p">)</span>

</pre></div>
</div>
<p>which outputs</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">converged</span> <span class="n">SCF</span> <span class="n">energy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99.9873974403488</span>
<span class="n">E</span><span class="p">(</span><span class="n">RCISD</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">100.196182975762</span>  <span class="n">E_corr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2087855354132202</span>
<span class="n">RCISD</span> <span class="n">correlation</span> <span class="n">energy</span> <span class="o">-</span><span class="mf">0.2087855354132202</span>
</pre></div>
</div>
<p>namely, the (restricted) Hartree–Fock energy, the RCISD energy and their
difference, the RCISD correlation energy, as well as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">converged</span> <span class="n">SCF</span> <span class="n">energy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99.9873974403486</span>  <span class="o">&lt;</span><span class="n">S</span><span class="o">^</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">=</span> <span class="mf">5.3734794e-13</span>  <span class="mi">2</span><span class="n">S</span><span class="o">+</span><span class="mi">1</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">E</span><span class="p">(</span><span class="n">UCISD</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">100.196182975774</span>  <span class="n">E_corr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2087855354254317</span>
<span class="n">UCISD</span> <span class="n">correlation</span> <span class="n">energy</span> <span class="o">-</span><span class="mf">0.20878553542543174</span>
</pre></div>
</div>
<p>namely, the (unrestricted) Hartree–Fock energy, the UCISD energy and
their difference, the UCISD correlation energy.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mycc</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">CISD</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>could have been replaced by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myci</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">ci</span><span class="o">.</span><span class="n">CISD</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
<span class="n">myci</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myci</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">ci</span><span class="o">.</span><span class="n">CISD</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>for the same result.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Density fitting is not implemented for CISD.</p>
</div>
<section id="spin-symmetry">
<h3>Spin symmetry<a class="headerlink" href="#spin-symmetry" title="Link to this heading">#</a></h3>
<p>The CISD module in PySCF supports a number of reference wavefunctions with
broken spin symmetry.  In particular, CISD can be performed with a
spin-restricted, spin-unrestricted, and general (spin-mixed) Hartree-Fock
solution, leading to the RCISD, UCISD, and GCISD methods. The small
example above shows this for RCISD and UCISD.</p>
<p>The module-level <code class="docutils literal notranslate"><span class="pre">ci.CISD(mf)</span></code> constructor can infer the correct method based
on the level of symmetry-breaking in the mean-field argument.  For more explicit
control or inspection, the respective classes and functions can be found in
<code class="docutils literal notranslate"><span class="pre">cisd.py</span></code> (restricted), <code class="docutils literal notranslate"><span class="pre">ucisd.py</span></code> (unrestricted), and <code class="docutils literal notranslate"><span class="pre">gcisd.py</span></code>
(general).</p>
<p>For example, a spin-unrestricted calculation on triplet oxygen can be performed
as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">ci</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;O 0 0 0; O 0 0 1.2&#39;</span><span class="p">,</span>  <span class="c1"># in Angstrom</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;ccpvdz&#39;</span><span class="p">,</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">HF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c1"># this is UHF</span>
<span class="n">myci</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">CISD</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c1"># this is UCISD</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UCISD total energy = &#39;</span><span class="p">,</span> <span class="n">myci</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="properties">
<h3>Properties<a class="headerlink" href="#properties" title="Link to this heading">#</a></h3>
<p>A number of properties are available at the CISD level.</p>
<p>Unrelaxed 1- and 2-electron reduced density matrices can be calculated.
They are returned in the MO basis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dm1</span> <span class="o">=</span> <span class="n">myci</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">()</span>
<span class="n">dm2</span> <span class="o">=</span> <span class="n">myci</span><span class="o">.</span><span class="n">make_rdm2</span><span class="p">()</span>
</pre></div>
</div>
<p>Analytical nuclear gradients can be calculated
(see <span id="id2">[<a class="reference internal" href="reference.html#id10" title="Y. Osamura, Y. Yamaguchi, and H. F. Schaefer III. Generalization of analytic energy derivatives for configuration interaction wave functions. Theoret. Chim. Acta, 72(2):71, 1987. doi:10.1007/BF00528133.">34</a>, <a class="reference internal" href="reference.html#id11" title="Y. Yamaguchi and H. F. Schaefer III. Analytic Derivative Methods in Molecular Electronic Structure Theory: A New Dimension to Quantum Chemistry and its Applications to Spectroscopy, chapter Fundamentals and Theory, pages 325. John Wiley &amp; Sons, Ltd., 2011. doi:10.1002/9780470749593.hrs006.">35</a>]</span> and references therein):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mygrad</span> <span class="o">=</span> <span class="n">myci</span><span class="o">.</span><span class="n">nuc_grad_method</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="frozen-orbitals">
<h3>Frozen orbitals<a class="headerlink" href="#frozen-orbitals" title="Link to this heading">#</a></h3>
<p>By default, CISD calculations in PySCF correlate all electrons in all available
orbitals. To freeze the lowest-energy core orbitals,
use the <code class="docutils literal notranslate"><span class="pre">frozen</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myci</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">CISD</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>To freeze occupied and/or unoccupied orbitals with finer control, a list of
0-based orbital indices can be provided as the <code class="docutils literal notranslate"><span class="pre">frozen</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># freeze 2 core orbitals</span>
<span class="n">myci</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">CISD</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># freeze 2 core orbitals and 3 unoccupied orbitals</span>
<span class="n">myci</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">CISD</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">])</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="wavefunction-overlap">
<h3>Wavefunction overlap<a class="headerlink" href="#wavefunction-overlap" title="Link to this heading">#</a></h3>
<p>The following example shows how to evaluate the overlap of two different
CISD wavefunctions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Overlap of two CISD wave functions (they can be obtained from different</span>
<span class="sd">geometries).</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">ci</span>

<span class="c1">#</span>
<span class="c1"># RCISD wavefunction overlap</span>
<span class="c1">#</span>
<span class="n">myhf1</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H 0 0 0; F 0 0 1.1&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;6-31g&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">ci1</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">CISD</span><span class="p">(</span><span class="n">myhf1</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CISD energy of mol1&#39;</span><span class="p">,</span> <span class="n">ci1</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)</span>

<span class="n">myhf2</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H 0 0 0; F 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;6-31g&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">ci2</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">CISD</span><span class="p">(</span><span class="n">myhf2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CISD energy of mol2&#39;</span><span class="p">,</span> <span class="n">ci2</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)</span>

<span class="n">s12</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">intor_cross</span><span class="p">(</span><span class="s1">&#39;cint1e_ovlp_sph&#39;</span><span class="p">,</span> <span class="n">myhf1</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">myhf2</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
<span class="n">s12</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">,</span> <span class="p">(</span><span class="n">myhf1</span><span class="o">.</span><span class="n">mo_coeff</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">myhf2</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">))</span>
<span class="n">nmo</span> <span class="o">=</span> <span class="n">myhf2</span><span class="o">.</span><span class="n">mo_energy</span><span class="o">.</span><span class="n">size</span>
<span class="n">nocc</span> <span class="o">=</span> <span class="n">myhf2</span><span class="o">.</span><span class="n">mol</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">//</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;CISD-mol1|CISD-mol2&gt; = &#39;</span><span class="p">,</span> <span class="n">ci</span><span class="o">.</span><span class="n">cisd</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">ci1</span><span class="o">.</span><span class="n">ci</span><span class="p">,</span> <span class="n">ci2</span><span class="o">.</span><span class="n">ci</span><span class="p">,</span> <span class="n">nmo</span><span class="p">,</span> <span class="n">nocc</span><span class="p">,</span> <span class="n">s12</span><span class="p">))</span>

<span class="c1">#</span>
<span class="c1"># UCISD wavefunction overlap</span>
<span class="c1">#</span>
<span class="n">myhf1</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H 0 0 0; F 0 0 1.1&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;6-31g&#39;</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">ci1</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">UCISD</span><span class="p">(</span><span class="n">myhf1</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CISD energy of mol1&#39;</span><span class="p">,</span> <span class="n">ci1</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)</span>

<span class="n">myhf2</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H 0 0 0; F 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;6-31g&#39;</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">ci2</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">UCISD</span><span class="p">(</span><span class="n">myhf2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CISD energy of mol2&#39;</span><span class="p">,</span> <span class="n">ci2</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)</span>

<span class="n">s12</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">intor_cross</span><span class="p">(</span><span class="s1">&#39;cint1e_ovlp_sph&#39;</span><span class="p">,</span> <span class="n">myhf1</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">myhf2</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mo1a</span><span class="p">,</span> <span class="n">mo1b</span> <span class="o">=</span> <span class="n">myhf1</span><span class="o">.</span><span class="n">mo_coeff</span>
<span class="n">mo2a</span><span class="p">,</span> <span class="n">mo2b</span> <span class="o">=</span> <span class="n">myhf2</span><span class="o">.</span><span class="n">mo_coeff</span>
<span class="n">s12</span> <span class="o">=</span> <span class="p">(</span><span class="n">reduce</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">,</span> <span class="p">(</span><span class="n">mo1a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">mo2a</span><span class="p">)),</span>
       <span class="n">reduce</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">,</span> <span class="p">(</span><span class="n">mo1b</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">mo2b</span><span class="p">)))</span>
<span class="n">nmo</span> <span class="o">=</span> <span class="p">(</span><span class="n">myhf2</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">myhf2</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="n">nocc</span> <span class="o">=</span> <span class="n">myhf2</span><span class="o">.</span><span class="n">nelec</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;CISD-mol1|CISD-mol2&gt; = &#39;</span><span class="p">,</span> <span class="n">ci</span><span class="o">.</span><span class="n">ucisd</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">ci1</span><span class="o">.</span><span class="n">ci</span><span class="p">,</span> <span class="n">ci2</span><span class="o">.</span><span class="n">ci</span><span class="p">,</span> <span class="n">nmo</span><span class="p">,</span> <span class="n">nocc</span><span class="p">,</span> <span class="n">s12</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="full-configuration-interaction-fci">
<h2>Full configuration interaction (FCI)<a class="headerlink" href="#full-configuration-interaction-fci" title="Link to this heading">#</a></h2>
<p>A simple example (see <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/fci/00-simple-fci.py">examples/fci/00-simple-fci.py</a>) of running
a restricted and an unrestricted FCI calculation is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">A simple example to run FCI</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">pyscf</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;H 0 0 0; F 0 0 1.1&#39;</span><span class="p">,</span>  <span class="c1"># in Angstrom</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31g&#39;</span><span class="p">,</span>
    <span class="n">symmetry</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1">#</span>
<span class="c1"># create an FCI solver based on the SCF object</span>
<span class="c1">#</span>
<span class="n">cisolver</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">fci</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">myhf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E(FCI) = </span><span class="si">%.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">kernel</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1">#</span>
<span class="c1"># create an FCI solver based on the SCF object</span>
<span class="c1">#</span>
<span class="n">myuhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">UHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">cisolver</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">fci</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">myuhf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E(UHF-FCI) = </span><span class="si">%.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">kernel</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1">#</span>
<span class="c1"># create an FCI solver based on the given orbitals and the num. electrons and</span>
<span class="c1"># spin of the mol object</span>
<span class="c1">#</span>
<span class="n">cisolver</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">fci</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">myhf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E(FCI) = </span><span class="si">%.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">kernel</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>



</pre></div>
</div>
<p>The second and third FCI calculation in the example show two different ways of
running unrestricted FCI calculations.</p>
<section id="setting-spin-and-symmetry-of-wavefunction">
<h3>Setting Spin and Symmetry of Wavefunction<a class="headerlink" href="#setting-spin-and-symmetry-of-wavefunction" title="Link to this heading">#</a></h3>
<p>The following example discusses how to set the spin for an FCI calculations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Assign spin state for FCI wavefunction.</span>

<span class="sd">By default, the FCI solver will take Mole attribute spin for the spin state.</span>
<span class="sd">It can be overwritten by passing kwarg ``nelec`` to the kernel function of FCI</span>
<span class="sd">solver.  The nelec argument is a two-element tuple.  The first is the number</span>
<span class="sd">of alpha electrons; the second is the number of beta electrons.</span>

<span class="sd">If spin-contamination is observed on FCI wavefunction, we can use the</span>
<span class="sd">decoration function :func:`fci.addons.fix_spin_` to level shift the energy of</span>
<span class="sd">states which do not have the target spin.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">fci</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;Ne 0 0 0&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;631g&#39;</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">norb</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_energy</span><span class="o">.</span><span class="n">size</span>

<span class="n">fs</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E = </span><span class="si">%.12f</span><span class="s1">  2S+1 = </span><span class="si">%.7f</span><span class="s1">&#39;</span> <span class="o">%</span>
      <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">spin_square</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">nelec</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E = </span><span class="si">%.12f</span><span class="s1">  2S+1 = </span><span class="si">%.7f</span><span class="s1">&#39;</span> <span class="o">%</span>
      <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">spin_square</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))[</span><span class="mi">1</span><span class="p">]))</span>


<span class="n">fs</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">fix_spin_</span><span class="p">(</span><span class="n">fci</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">),</span> <span class="n">shift</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E = </span><span class="si">%.12f</span><span class="s1">  2S+1 = </span><span class="si">%.7f</span><span class="s1">&#39;</span> <span class="o">%</span>
      <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">spin_square</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))[</span><span class="mi">1</span><span class="p">]))</span>


<span class="c1">#</span>
<span class="c1"># Example 2:  Oxygen molecule singlet state</span>
<span class="c1">#</span>

<span class="n">nelec</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;O 0 0 0; O 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;sto3g&#39;</span><span class="p">,</span>
            <span class="n">symmetry</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mci</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">mci</span><span class="o">.</span><span class="n">wfnsym</span> <span class="o">=</span> <span class="s1">&#39;A1g&#39;</span>
<span class="n">mci</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">fix_spin_</span><span class="p">(</span><span class="n">mci</span><span class="p">,</span> <span class="n">ss</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Use keyword argument nelec to explicitly control the spin. Otherwise</span>
<span class="c1"># mol.spin is applied.</span>
<span class="n">e</span><span class="p">,</span> <span class="n">civec</span> <span class="o">=</span> <span class="n">mci</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">nelec</span><span class="o">=</span><span class="n">nelec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A1g singlet E = </span><span class="si">%.12f</span><span class="s1">  2S+1 = </span><span class="si">%.7f</span><span class="s1">&#39;</span> <span class="o">%</span>
      <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">mci</span><span class="o">.</span><span class="n">spin_square</span><span class="p">(</span><span class="n">civec</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nelec</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">mci</span><span class="o">.</span><span class="n">wfnsym</span> <span class="o">=</span> <span class="s1">&#39;A2g&#39;</span>
<span class="n">mci</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">fix_spin_</span><span class="p">(</span><span class="n">mci</span><span class="p">,</span> <span class="n">ss</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">e</span><span class="p">,</span> <span class="n">civec</span> <span class="o">=</span> <span class="n">mci</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">nelec</span><span class="o">=</span><span class="n">nelec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A2g singlet E = </span><span class="si">%.12f</span><span class="s1">  2S+1 = </span><span class="si">%.7f</span><span class="s1">&#39;</span> <span class="o">%</span>
      <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">mci</span><span class="o">.</span><span class="n">spin_square</span><span class="p">(</span><span class="n">civec</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nelec</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;O 0 0 0; O 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;sto3g&#39;</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mci</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">mci</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">fix_spin_</span><span class="p">(</span><span class="n">mci</span><span class="p">,</span> <span class="n">ss</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">e</span><span class="p">,</span> <span class="n">civec</span> <span class="o">=</span> <span class="n">mci</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">nelec</span><span class="o">=</span><span class="n">nelec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Singlet E = </span><span class="si">%.12f</span><span class="s1">  2S+1 = </span><span class="si">%.7f</span><span class="s1">&#39;</span> <span class="o">%</span>
      <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">mci</span><span class="o">.</span><span class="n">spin_square</span><span class="p">(</span><span class="n">civec</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nelec</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>


<span class="c1">#</span>
<span class="c1"># Example 3:  Triplet and Sz=0</span>
<span class="c1">#</span>
<span class="c1"># It&#39;s common that the default initial guess has no overlap with the ground</span>
<span class="c1"># state. In this example, the default initial guess is singlet. Computing</span>
<span class="c1"># multiple roots to overcome the initial guess issue.</span>
<span class="c1">#</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                  H     1  -1.      0</span>
<span class="s1">                  H     0  -1.     -1</span>
<span class="s1">                  H     0  -0.5    -0</span>
<span class="s1">                  H     0  -0.     -1</span>
<span class="s1">                  H     1  -0.5     0</span>
<span class="s1">                  H     0   1.      1&#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;sto-3g&#39;</span><span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mci</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">,</span> <span class="n">singlet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">mci</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">fix_spin_</span><span class="p">(</span><span class="n">mci</span><span class="p">,</span> <span class="n">ss</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">e</span><span class="p">,</span> <span class="n">civec</span> <span class="o">=</span> <span class="n">mci</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">nroots</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">nelec</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Triplet E = </span><span class="si">%.12f</span><span class="s1">  2S+1 = </span><span class="si">%.7f</span><span class="s1">&#39;</span> <span class="o">%</span>
      <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mci</span><span class="o">.</span><span class="n">spin_square</span><span class="p">(</span><span class="n">civec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nelec</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>


<span class="c1">#</span>
<span class="c1"># Be careful with the trick of energy penalty.  Numerical problems may be</span>
<span class="c1"># observed when function fix_spin_ was applied.</span>
<span class="c1">#</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;O 0 0 0&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;6-31G&#39;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">norb</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">nelec</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nelec</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">fix_spin_</span><span class="p">(</span><span class="n">fci</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">),</span> <span class="mf">.5</span><span class="p">)</span>
<span class="n">fs</span><span class="o">.</span><span class="n">nroots</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">e</span><span class="p">,</span> <span class="n">fcivec</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># The first 5 states should be degenerated. The degeneracy may be broken.</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fcivec</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;state = </span><span class="si">%d</span><span class="s1">, E = </span><span class="si">%.9f</span><span class="s1">, S^2=</span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span>
          <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fci</span><span class="o">.</span><span class="n">spin_op</span><span class="o">.</span><span class="n">spin_square</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">nelec</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>

</pre></div>
</div>
<p>and the next example how to set symmetry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Assign FCI wavefunction symmetry</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">fci</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">ao2mo</span><span class="p">,</span> <span class="n">symm</span><span class="p">,</span> <span class="n">mcscf</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H 0 0 0; F 0 0 1.1&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;631g&#39;</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">norb</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">nelec</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nelec</span>

<span class="n">fs</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">fs</span><span class="o">.</span><span class="n">wfnsym</span> <span class="o">=</span> <span class="s1">&#39;E1x&#39;</span>
<span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy of </span><span class="si">%s</span><span class="s1"> state </span><span class="si">%.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">wfnsym</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

<span class="c1">#</span>
<span class="c1"># Symmetry adapted FCI solver can be called with arbitrary Hamiltonian.  In the</span>
<span class="c1"># following example, you need to prepare 1-electron and 2-electron integrals,</span>
<span class="c1"># core energy shift, and the symmetry of orbitals.</span>
<span class="c1">#</span>
<span class="n">cas_idx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">core_idx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mo_cas</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,</span><span class="n">cas_idx</span><span class="p">]</span>
<span class="n">mo_core</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,</span><span class="n">core_idx</span><span class="p">]</span>
<span class="n">dm_core</span> <span class="o">=</span> <span class="n">mo_core</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mo_core</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">vhf_core</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_veff</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">dm_core</span><span class="p">)</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">mo_cas</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="n">m</span><span class="o">.</span><span class="n">get_hcore</span><span class="p">()</span> <span class="o">+</span> <span class="n">vhf_core</span> <span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mo_cas</span><span class="p">)</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">ao2mo</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mo_cas</span><span class="p">)</span>
<span class="n">ecore</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,ji&#39;</span><span class="p">,</span> <span class="n">dm_core</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">get_hcore</span><span class="p">())</span>
         <span class="o">+</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,ji&#39;</span><span class="p">,</span> <span class="n">dm_core</span><span class="p">,</span> <span class="n">vhf_core</span><span class="p">)</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">energy_nuc</span><span class="p">())</span>
<span class="n">orbsym</span> <span class="o">=</span> <span class="n">symm</span><span class="o">.</span><span class="n">label_orb_symm</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">irrep_id</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">symm_orb</span><span class="p">,</span> <span class="n">mo_cas</span><span class="p">)</span>

<span class="n">norb</span> <span class="o">=</span> <span class="n">mo_cas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ncore</span> <span class="o">=</span> <span class="n">mo_core</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">nelec</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">-</span> <span class="n">ncore</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">direct_spin0_symm</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">fs</span><span class="o">.</span><span class="n">wfnsym</span> <span class="o">=</span> <span class="s1">&#39;A2&#39;</span>
<span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">nelec</span><span class="p">,</span> <span class="n">ecore</span><span class="o">=</span><span class="n">ecore</span><span class="p">,</span> <span class="n">orbsym</span><span class="o">=</span><span class="n">orbsym</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy of </span><span class="si">%s</span><span class="s1"> state </span><span class="si">%.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">wfnsym</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

<span class="c1">#</span>
<span class="c1"># mcscf module has a function h1e_for_cas to generate 1-electron Hamiltonian and</span>
<span class="c1"># core energy.</span>
<span class="c1">#</span>
<span class="n">cas_idx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">core_idx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mo_cas</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,</span><span class="n">cas_idx</span><span class="p">]</span>
<span class="n">mo_core</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,</span><span class="n">core_idx</span><span class="p">]</span>
<span class="n">norb</span> <span class="o">=</span> <span class="n">mo_cas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ncore</span> <span class="o">=</span> <span class="n">mo_core</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">nelec</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">-</span> <span class="n">ncore</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">h1</span><span class="p">,</span> <span class="n">ecore</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">casci</span><span class="o">.</span><span class="n">h1e_for_cas</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">ncore</span><span class="p">)</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">ao2mo</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mo_cas</span><span class="p">)</span>
<span class="n">orbsym</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">hf_symm</span><span class="o">.</span><span class="n">get_orbsym</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)[</span><span class="n">cas_idx</span><span class="p">]</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">direct_spin0_symm</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">fs</span><span class="o">.</span><span class="n">wfnsym</span> <span class="o">=</span> <span class="s1">&#39;A2&#39;</span>
<span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">nelec</span><span class="p">,</span> <span class="n">ecore</span><span class="o">=</span><span class="n">ecore</span><span class="p">,</span> <span class="n">orbsym</span><span class="o">=</span><span class="n">orbsym</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy of </span><span class="si">%s</span><span class="s1"> state </span><span class="si">%.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">wfnsym</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

<span class="c1">#</span>
<span class="c1"># Using the CASCI object, initialization of 1-electron and 2-electron integrals</span>
<span class="c1"># can be further simplified.</span>
<span class="c1">#</span>
<span class="n">cas_idx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">norb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cas_idx</span><span class="p">)</span>
<span class="n">ncore</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nelec</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">-</span> <span class="n">ncore</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">nelec</span><span class="p">)</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">sort_mo</span><span class="p">(</span><span class="n">cas_idx</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">h1</span><span class="p">,</span> <span class="n">ecore</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_h1eff</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_h2eff</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
<span class="n">orbsym</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">hf_symm</span><span class="o">.</span><span class="n">get_orbsym</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)[</span><span class="n">cas_idx</span><span class="p">]</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">direct_spin0_symm</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">fs</span><span class="o">.</span><span class="n">wfnsym</span> <span class="o">=</span> <span class="s1">&#39;A2&#39;</span>
<span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">nelec</span><span class="p">,</span> <span class="n">ecore</span><span class="o">=</span><span class="n">ecore</span><span class="p">,</span> <span class="n">orbsym</span><span class="o">=</span><span class="n">orbsym</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy of </span><span class="si">%s</span><span class="s1"> state </span><span class="si">%.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">wfnsym</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>


<span class="c1">#</span>
<span class="c1"># In the following example, the default initial guess of the regular FCI</span>
<span class="c1"># solver is different to the symmetry of HF wfn.  In the symmetry adapted FCI</span>
<span class="c1"># solver, the initial guess of required wfnsym is generated.  The FCI solution</span>
<span class="c1"># has the same symmetry as the HF wfn. </span>
<span class="c1">#</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;C 0. 0. 0.; C 0. 0. 1.24253&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;6-31g&#39;</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">cas_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">norb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cas_idx</span><span class="p">)</span>
<span class="n">ncore</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nelec</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">-</span> <span class="n">ncore</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">nelec</span><span class="p">)</span>
<span class="n">h1</span><span class="p">,</span> <span class="n">ecore</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_h1eff</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">get_h2eff</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">orbsym</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">hf_symm</span><span class="o">.</span><span class="n">get_orbsym</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)[</span><span class="n">cas_idx</span><span class="p">]</span>

<span class="n">fs</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">direct_spin0</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>  <span class="c1"># Regular FCI solver</span>
<span class="n">fs</span><span class="o">.</span><span class="n">davidson_only</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">nelec</span><span class="p">,</span> <span class="n">ecore</span><span class="o">=</span><span class="n">ecore</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;Using regular FCI solver, FCI converges to</span>
<span class="s1">  wfnsym = </span><span class="si">%s</span><span class="s1">  E(FCI) = </span><span class="si">%.12f</span><span class="s1">&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fci</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">guess_wfnsym</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cas_idx</span><span class="p">),</span> <span class="n">nelec</span><span class="p">,</span> <span class="n">orbsym</span><span class="p">),</span> <span class="n">e</span><span class="p">))</span>
<span class="n">hf_as_civec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">hf_as_civec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">nelec</span><span class="p">,</span> <span class="n">ecore</span><span class="o">=</span><span class="n">ecore</span><span class="p">,</span> <span class="n">ci0</span><span class="o">=</span><span class="n">hf_as_civec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;Using HF determinant as initial guess, FCI converges to</span>
<span class="s1">  wfnsym = </span><span class="si">%s</span><span class="s1">  E(FCI) = </span><span class="si">%.12f</span><span class="s1">&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fci</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">guess_wfnsym</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cas_idx</span><span class="p">),</span> <span class="n">nelec</span><span class="p">,</span> <span class="n">orbsym</span><span class="p">),</span> <span class="n">e</span><span class="p">))</span>

<span class="n">fs</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">direct_spin0_symm</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>  <span class="c1"># Symmetry adapted FCI solver</span>
<span class="n">fs</span><span class="o">.</span><span class="n">wfnsym</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">nelec</span><span class="p">,</span> <span class="n">ecore</span><span class="o">=</span><span class="n">ecore</span><span class="p">,</span> <span class="n">orbsym</span><span class="o">=</span><span class="n">orbsym</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;Using symmetry adapted FCI solver, FCI converges to</span>
<span class="s1">  wfnsym = </span><span class="si">%s</span><span class="s1">  E(FCI) = </span><span class="si">%.12f</span><span class="s1">&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fci</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">guess_wfnsym</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cas_idx</span><span class="p">),</span> <span class="n">nelec</span><span class="p">,</span> <span class="n">orbsym</span><span class="p">),</span> <span class="n">e</span><span class="p">))</span>

</pre></div>
</div>
</section>
<section id="id3">
<h3>Properties<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>Reduced density matrices can be evaluated, see the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Compute FCI 1,2,3,4-particle density matrices</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c1">#</span>
<span class="c1"># Note: Environment variable LD_PRELOAD=...libmkl_def.so may cause this script</span>
<span class="c1"># crashing</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">fci</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;H 0 0 0; F 0 0 1.1&#39;</span><span class="p">,</span>  <span class="c1"># in Angstrom</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31g&#39;</span><span class="p">,</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">myhf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1">#</span>
<span class="c1"># First create FCI solver with function fci.FCI and solve the FCI problem</span>
<span class="c1">#</span>
<span class="n">cisolver</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">myhf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">e</span><span class="p">,</span> <span class="n">fcivec</span> <span class="o">=</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1">#</span>
<span class="c1"># Spin-traced 1-particle density matrix</span>
<span class="c1">#</span>
<span class="n">norb</span> <span class="o">=</span> <span class="n">myhf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># 6 alpha electrons, 4 beta electrons because spin = nelec_a-nelec_b = 2</span>
<span class="n">nelec_a</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">nelec_b</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">dm1</span> <span class="o">=</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">(</span><span class="n">fcivec</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>

<span class="c1">#</span>
<span class="c1"># alpha and beta 1-particle density matrices</span>
<span class="c1">#</span>
<span class="n">dm1a</span><span class="p">,</span> <span class="n">dm1b</span> <span class="o">=</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">make_rdm1s</span><span class="p">(</span><span class="n">fcivec</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">dm1a</span><span class="o">+</span><span class="n">dm1b</span><span class="p">,</span> <span class="n">dm1</span><span class="p">))</span>

<span class="c1">#</span>
<span class="c1"># Spin-traced 1 and 2-particle density matrices</span>
<span class="c1">#</span>
<span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span> <span class="o">=</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">make_rdm12</span><span class="p">(</span><span class="n">fcivec</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>

<span class="c1">#</span>
<span class="c1"># alpha and beta 1-particle density matrices</span>
<span class="c1"># For 2-particle density matrix,</span>
<span class="c1"># dm2aa corresponds to alpha spin for both 1st electron and 2nd electron</span>
<span class="c1"># dm2ab corresponds to alpha spin for 1st electron and beta spin for 2nd electron</span>
<span class="c1"># dm2bb corresponds to beta spin for both 1st electron and 2nd electron</span>
<span class="c1">#</span>
<span class="p">(</span><span class="n">dm1a</span><span class="p">,</span> <span class="n">dm1b</span><span class="p">),</span> <span class="p">(</span><span class="n">dm2aa</span><span class="p">,</span><span class="n">dm2ab</span><span class="p">,</span><span class="n">dm2bb</span><span class="p">)</span> <span class="o">=</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">make_rdm12s</span><span class="p">(</span><span class="n">fcivec</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">dm2aa</span><span class="o">+</span><span class="n">dm2ab</span><span class="o">+</span><span class="n">dm2ab</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">dm2bb</span><span class="p">,</span> <span class="n">dm2</span><span class="p">))</span>


<span class="c1">#########################################</span>
<span class="c1">#</span>
<span class="c1"># Transition density matrices</span>
<span class="c1">#</span>
<span class="c1">#########################################</span>

<span class="c1">#</span>
<span class="c1"># First generate two CI vectors, of which the transition density matrices will</span>
<span class="c1"># be computed</span>
<span class="c1">#</span>
<span class="n">cisolver</span><span class="o">.</span><span class="n">nroots</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">(</span><span class="n">e0</span><span class="p">,</span><span class="n">e1</span><span class="p">),</span> <span class="p">(</span><span class="n">fcivec0</span><span class="p">,</span><span class="n">fcivec1</span><span class="p">)</span> <span class="o">=</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1">#</span>
<span class="c1"># Spin-traced 1-particle transition density matrix</span>
<span class="c1"># &lt;0| p^+ q |1&gt;</span>
<span class="c1">#</span>
<span class="n">norb</span> <span class="o">=</span> <span class="n">myhf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">nelec_a</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">nelec_b</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">dm1</span> <span class="o">=</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">trans_rdm1</span><span class="p">(</span><span class="n">fcivec0</span><span class="p">,</span> <span class="n">fcivec1</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>

<span class="c1">#</span>
<span class="c1"># alpha and beta 1-particle transition density matrices</span>
<span class="c1">#</span>
<span class="n">dm1a</span><span class="p">,</span> <span class="n">dm1b</span> <span class="o">=</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">trans_rdm1s</span><span class="p">(</span><span class="n">fcivec0</span><span class="p">,</span> <span class="n">fcivec1</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">dm1a</span><span class="o">+</span><span class="n">dm1b</span><span class="p">,</span> <span class="n">dm1</span><span class="p">))</span>

<span class="c1">#</span>
<span class="c1"># Spin-traced 1 and 2-particle transition density matrices</span>
<span class="c1">#</span>
<span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span> <span class="o">=</span> <span class="n">cisolver</span><span class="o">.</span><span class="n">trans_rdm12</span><span class="p">(</span><span class="n">fcivec0</span><span class="p">,</span> <span class="n">fcivec1</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>

<span class="c1">#</span>
<span class="c1"># alpha and beta 1-particle transition density matrices</span>
<span class="c1"># For 2-particle density matrix,</span>
<span class="c1"># dm2aa corresponds to alpha spin for both 1st electron and 2nd electron</span>
<span class="c1"># dm2ab corresponds to alpha spin for 1st electron and beta spin for 2nd electron</span>
<span class="c1"># dm2ba corresponds to beta spin for 1st electron and alpha spin for 2nd electron</span>
<span class="c1"># dm2bb corresponds to beta spin for both 1st electron and 2nd electron</span>
<span class="c1">#</span>
<span class="p">(</span><span class="n">dm1a</span><span class="p">,</span> <span class="n">dm1b</span><span class="p">),</span> <span class="p">(</span><span class="n">dm2aa</span><span class="p">,</span> <span class="n">dm2ab</span><span class="p">,</span> <span class="n">dm2ba</span><span class="p">,</span> <span class="n">dm2bb</span><span class="p">)</span> <span class="o">=</span> \
        <span class="n">cisolver</span><span class="o">.</span><span class="n">trans_rdm12s</span><span class="p">(</span><span class="n">fcivec0</span><span class="p">,</span> <span class="n">fcivec1</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">dm2aa</span><span class="o">+</span><span class="n">dm2ab</span><span class="o">+</span><span class="n">dm2ba</span><span class="o">+</span><span class="n">dm2bb</span><span class="p">,</span> <span class="n">dm2</span><span class="p">))</span>


<span class="c1">#########################################</span>
<span class="c1">#</span>
<span class="c1"># 3 and 4-particle density matrices</span>
<span class="c1">#</span>
<span class="c1">#########################################</span>

<span class="c1">#</span>
<span class="c1"># Spin-traced 3-particle density matrix</span>
<span class="c1"># 1,2,3-pdm can be computed together.</span>
<span class="c1"># Note make_dm123 computes  dm3[p,q,r,s,t,u] = &lt;p^+ q r^+ s t^+ u&gt;  which is</span>
<span class="c1"># NOT the 3-particle density matrices.  Funciton reorder_dm123 transforms it</span>
<span class="c1"># to the true 3-particle DM  dm3[p,q,r,s,t,u] = &lt;p^+ r^+ t^+ u s q&gt; (as well</span>
<span class="c1"># as the 2-particle DM)</span>
<span class="c1">#</span>
<span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">rdm</span><span class="o">.</span><span class="n">make_dm123</span><span class="p">(</span><span class="s1">&#39;FCI3pdm_kern_sf&#39;</span><span class="p">,</span> <span class="n">fcivec0</span><span class="p">,</span> <span class="n">fcivec0</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span>
                                   <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>
<span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">rdm</span><span class="o">.</span><span class="n">reorder_dm123</span><span class="p">(</span><span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># Spin-traced 3-particle transition density matrix</span>
<span class="c1">#</span>
<span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">rdm</span><span class="o">.</span><span class="n">make_dm123</span><span class="p">(</span><span class="s1">&#39;FCI3pdm_kern_sf&#39;</span><span class="p">,</span> <span class="n">fcivec0</span><span class="p">,</span> <span class="n">fcivec1</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span>
                                   <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>
<span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">rdm</span><span class="o">.</span><span class="n">reorder_dm123</span><span class="p">(</span><span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># NOTE computing 4-pdm is very slow</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># Spin-traced 4-particle density matrix</span>
<span class="c1"># Note make_dm1234 computes  dm4[p,q,r,s,t,u,v,w] = &lt;p^+ q r^+ s t^+ u v^+ w&gt;  which is</span>
<span class="c1"># NOT the 4-particle density matrices.  Funciton reorder_dm1234 transforms it</span>
<span class="c1"># to the true 4-particle DM  dm4[p,q,r,s,t,u,v,w] = &lt;p^+ r^+ t^+ v^+ w u s q&gt;</span>
<span class="c1"># (as well as the 2-particle and 3-particle DMs)</span>
<span class="c1">#</span>
<span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span><span class="p">,</span> <span class="n">dm4</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">rdm</span><span class="o">.</span><span class="n">make_dm1234</span><span class="p">(</span><span class="s1">&#39;FCI4pdm_kern_sf&#39;</span><span class="p">,</span> <span class="n">fcivec0</span><span class="p">,</span> <span class="n">fcivec0</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span>
                                         <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>
<span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span><span class="p">,</span> <span class="n">dm4</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">rdm</span><span class="o">.</span><span class="n">reorder_dm1234</span><span class="p">(</span><span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span><span class="p">,</span> <span class="n">dm4</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># Spin-traced 4-particle transition density matrix</span>
<span class="c1">#</span>
<span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span><span class="p">,</span> <span class="n">dm4</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">rdm</span><span class="o">.</span><span class="n">make_dm1234</span><span class="p">(</span><span class="s1">&#39;FCI4pdm_kern_sf&#39;</span><span class="p">,</span> <span class="n">fcivec0</span><span class="p">,</span> <span class="n">fcivec1</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span>
                                         <span class="p">(</span><span class="n">nelec_a</span><span class="p">,</span><span class="n">nelec_b</span><span class="p">))</span>
<span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span><span class="p">,</span> <span class="n">dm4</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">rdm</span><span class="o">.</span><span class="n">reorder_dm1234</span><span class="p">(</span><span class="n">dm1</span><span class="p">,</span> <span class="n">dm2</span><span class="p">,</span> <span class="n">dm3</span><span class="p">,</span> <span class="n">dm4</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="gw.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">GW approximation</p>
      </div>
    </a>
    <a class="right-next"
       href="cc.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Coupled-cluster theory</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-interaction-singles-and-doubles-cisd">Configuration interaction singles and doubles (CISD)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spin-symmetry">Spin symmetry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#properties">Properties</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#frozen-orbitals">Frozen orbitals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wavefunction-overlap">Wavefunction overlap</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-configuration-interaction-fci">Full configuration interaction (FCI)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-spin-and-symmetry-of-wavefunction">Setting Spin and Symmetry of Wavefunction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Properties</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/pyscf/pyscf.github.io/edit/master/source/user/ci.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, The PySCF Developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>