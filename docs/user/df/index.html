
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>2.15. Density fitting &#8212; PySCF 1.7.5.2 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/material.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../../_static/favicon-32x32.png"/>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="2.16. Periodic boundary conditions" href="../pbc/" />
    <link rel="prev" title="2.14. Relativistic calculations" href="../x2c/" /> 
  
   
  
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=amber>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#user/df" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../" title="PySCF 1.7.5.2 documentation"
           class="md-header-nav__button md-logo">
          
              <img src="../../_static/pyscf-logo-white.svg" height="26"
                   alt="PySCF 1.7.5.2 documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">PySCF 1.7.5.2</span>
          <span class="md-header-nav__topic"> 2.15. Density fitting </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search/" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../"versions.json"",
        target_loc = "../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../../" class="md-tabs__link">Home</a></li>
            
            <li class="md-tabs__item"><a href="../../install/" class="md-tabs__link">Install</a></li>
            
            <li class="md-tabs__item"><a href="../" class="md-tabs__link">User Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../develop/" class="md-tabs__link">Developer Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../api_docs/modules/" class="md-tabs__link">API Docs</a></li>
            
            <li class="md-tabs__item"><a href="../../blog_wrapper/" class="md-tabs__link">Blog</a></li>
            
            <li class="md-tabs__item"><a href="../../about/" class="md-tabs__link">About</a></li>
          <li class="md-tabs__item"><a href="../" class="md-tabs__link"><span class="section-number">2. </span>User guide</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../" title="PySCF 1.7.5.2 documentation" class="md-nav__button md-logo">
      
        <img src="../../_static/pyscf-logo-white.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../"
       title="PySCF 1.7.5.2 documentation">PySCF 1.7.5.2</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../../install/" class="md-nav__link">1. Install</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../" class="md-nav__link">2. User Guide</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../gto/" class="md-nav__link">2.1. Molecular structure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../scf/" class="md-nav__link">2.2. Self-consistent field (SCF) methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../dft/" class="md-nav__link">2.3. Density functional theory (DFT)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mp/" class="md-nav__link">2.4. Second-Order Møller–Plesset Perturbation Theory (MP2)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../gw/" class="md-nav__link">2.5. GW approximation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../ci/" class="md-nav__link">2.6. Configuration interaction (CISD and FCI)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../cc/" class="md-nav__link">2.7. Coupled-cluster theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../adc/" class="md-nav__link">2.8. Algebraic diagrammatic construction (ADC) scheme</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../mcscf/" class="md-nav__link">2.9. Multi-configuration self-consistent field (MCSCF)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../tddft/" class="md-nav__link">2.10. Time-dependent Hartree-Fock and Density Functional Theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../rt/" class="md-nav__link">2.11. Real-time time-dependent density functional theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../solvent/" class="md-nav__link">2.12. Solvation models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../qmmm/" class="md-nav__link">2.13. QM/MM methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../x2c/" class="md-nav__link">2.14. Relativistic calculations</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> 2.15. Density fitting </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">2.15. Density fitting</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#user-df--page-root" class="md-nav__link">2.15. Density fitting</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">2.15.1. Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#using-df-in-calculations" class="md-nav__link">2.15.2. Using DF in calculations</a>
        </li>
        <li class="md-nav__item"><a href="#choice-of-auxiliary-basis" class="md-nav__link">2.15.3. Choice of auxiliary basis</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#general-consideration" class="md-nav__link">2.15.3.1. General consideration</a>
        </li>
        <li class="md-nav__item"><a href="#special-consideration-for-dft" class="md-nav__link">2.15.3.2. Special consideration for DFT</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#saving-and-reusing-df-integrals" class="md-nav__link">2.15.4. Saving and reusing DF integrals</a>
        </li>
        <li class="md-nav__item"><a href="#advanced-examples" class="md-nav__link">2.15.5. Advanced examples</a>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">2.15.6. References</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/user/df.rst.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../pbc/" class="md-nav__link">2.16. Periodic boundary conditions</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../develop/" class="md-nav__link">3. Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../blog_wrapper/" class="md-nav__link">4. Blog</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#user-df--page-root" class="md-nav__link">2.15. Density fitting</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">2.15.1. Introduction</a>
        </li>
        <li class="md-nav__item"><a href="#using-df-in-calculations" class="md-nav__link">2.15.2. Using DF in calculations</a>
        </li>
        <li class="md-nav__item"><a href="#choice-of-auxiliary-basis" class="md-nav__link">2.15.3. Choice of auxiliary basis</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#general-consideration" class="md-nav__link">2.15.3.1. General consideration</a>
        </li>
        <li class="md-nav__item"><a href="#special-consideration-for-dft" class="md-nav__link">2.15.3.2. Special consideration for DFT</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#saving-and-reusing-df-integrals" class="md-nav__link">2.15.4. Saving and reusing DF integrals</a>
        </li>
        <li class="md-nav__item"><a href="#advanced-examples" class="md-nav__link">2.15.5. Advanced examples</a>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">2.15.6. References</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/user/df.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
             <div class="section" id="density-fitting">
<span id="user-df"></span><h1><span class="section-number">2.15. </span>Density fitting<a class="headerlink" href="#density-fitting" title="Permalink to this headline">¶</a></h1>
<p><em>Modules</em>: <a class="reference internal" href="#module-df" title="df: Density fitting and RI approximation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">df</span></code></a>, <a class="reference internal" href="../../modules/pbc/df/#module-pbc.df" title="pbc.df: Density fitting and RI approximation with periodic boundary conditions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pbc.df</span></code></a></p>
<span class="target" id="module-df"></span><div class="section" id="introduction">
<h2><span class="section-number">2.15.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Density fitting (DF), sometimes also called the resolution of identity (RI) approximation, is a method to approximate the four-index electron repulsion integrals (ERIs) by two- and three-index tensors. <span id="id1">[<span>Dunlap00PCCP</span>]</span> It achieves so by expanding the atomic orbital (AO) pair density in a second, auxiliary Gaussian basis set. PySCF has extensive supports for using DF in both molecular and crystalline calculations. This section of the user document covers the basic usage of DF in molecular applications. See <span class="xref std std-ref">theory_pbc_df</span> for the use of DF in periodic calculations.</p>
</div>
<div class="section" id="using-df-in-calculations">
<h2><span class="section-number">2.15.2. </span>Using DF in calculations<a class="headerlink" href="#using-df-in-calculations" title="Permalink to this headline">¶</a></h2>
<p>DF is not used by default when initializing a <code class="xref py py-class docutils literal notranslate"><span class="pre">SCF</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">MCSCF</span></code> object, but can be invoked via the <code class="xref py py-func docutils literal notranslate"><span class="pre">density_fit()</span></code> method as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mcscf</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;N 0 0 0; N 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;def2-tzvp&#39;</span><span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Alternatively, one can initialize a <code class="xref py py-class docutils literal notranslate"><span class="pre">DF</span></code> object and overwrite the <code class="xref py py-attr docutils literal notranslate"><span class="pre">with_df</span></code> attribute of the <code class="xref py py-class docutils literal notranslate"><span class="pre">SCF</span></code> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">df</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;N 0 0 0; N 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;def2-tzvp&#39;</span><span class="p">)</span>
<span class="n">mydf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">DF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span>
<span class="n">mf</span><span class="o">.</span><span class="n">with_df</span> <span class="o">=</span> <span class="n">mydf</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>Setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">with_df</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code> turns DF off.</p>
<p>Once the SCF calculations using DF are done, all post-SCF methods will use DF automatically. The example below performs a TDDFT/TDA calculation using DF:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">dft</span><span class="p">,</span> <span class="n">tddft</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;N 0 0 0; N 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;def2-tzvp&#39;</span><span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">RKS</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="s2">&quot;b3lyp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">td</span> <span class="o">=</span> <span class="n">tddft</span><span class="o">.</span><span class="n">TDA</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="choice-of-auxiliary-basis">
<span id="choice-of-auxbasis"></span><h2><span class="section-number">2.15.3. </span>Choice of auxiliary basis<a class="headerlink" href="#choice-of-auxiliary-basis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general-consideration">
<h3><span class="section-number">2.15.3.1. </span>General consideration<a class="headerlink" href="#general-consideration" title="Permalink to this headline">¶</a></h3>
<p>The choice of auxiliary basis depends on the AO basis.
By default, PySCF uses the pre-defined auxiliary basis set optimized for the AO basis set if the former exists.
This includes many commonly used AO basis sets in electronic structure calculations, e.g., the Ahlrichs’ <cite>def2</cite> family, <span id="id2">[<span>Hellweg07TCA</span><span>Weigend98CPL</span>]</span> the Dunning’s <cite>cc</cite> family, <span id="id3">[<span>Weigend02PCCP</span>]</span> etc.</p>
<p>When pre-defined auxiliary basis set is not available, an even-tempered basis (ETB) set is generated by the following rule</p>
<div class="math notranslate nohighlight">
\[\begin{split}\varphi &amp;= r^l \exp(-\zeta_{il} r^2), \quad i = 0, 1, \cdots, n \\
\zeta_{il} &amp;= \alpha_l \times \beta^i\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha_l\)</span> and <span class="math notranslate nohighlight">\(N\)</span> are inferred automatically from the AO basis, and <span class="math notranslate nohighlight">\(\beta = 2.0\)</span> by default.</p>
<p>The user can overwrite the default choice by setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">auxbasis</span></code> upon initialization or at a later stage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">df</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;N 0 0 0; N 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;cc-pvdz&#39;</span><span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">(</span><span class="n">auxbasis</span><span class="o">=</span><span class="s2">&quot;weigend&quot;</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span> <span class="c1"># -108.910953335055</span>
<span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="o">.</span><span class="n">auxbasis</span> <span class="o">=</span> <span class="s2">&quot;cc-pvdz-jkfit&quot;</span>   <span class="c1"># this is the default</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span> <span class="c1"># -108.913710743723</span>
<span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="o">.</span><span class="n">auxbasis</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">aug_etb</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.7</span><span class="p">)</span> <span class="c1"># ETB with beta = 1.7</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span> <span class="c1"># -108.914059329528</span>
</pre></div>
</div>
<p>The user can check what auxiliary basis set is used at any time by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="o">.</span><span class="n">auxmol</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
</pre></div>
</div>
<p>More examples on using customized auxiliary basis can be found in <a href="#id4"><span class="problematic" id="id5">:source:`examples/df/01-auxbasis.py`</span></a>.</p>
</div>
<div class="section" id="special-consideration-for-dft">
<h3><span class="section-number">2.15.3.2. </span>Special consideration for DFT<a class="headerlink" href="#special-consideration-for-dft" title="Permalink to this headline">¶</a></h3>
<p>For DFT calculations with pure exchange-correlation functionals (i.e., LDA and GGA), the default auxiliary basis, which is designed for fitting both the Coulomb and the Hartree-Fock exchange integrals, may be unnecessarily too large. We recommend using the <code class="docutils literal notranslate"><span class="pre">weigend</span></code> family <span id="id6">[<span>Weigend06PCCP</span>]</span> for a more cost-effective choice as shown in the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">dft</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;N 0 0 0; N 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;def2-tzvpp&#39;</span><span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">RKS</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="s2">&quot;pbe&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c1"># -109.432329411505</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="o">.</span><span class="n">auxmol</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>                  <span class="c1"># default: def2-tzvpp-jkfit</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="o">.</span><span class="n">auxmol</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">())</span>               <span class="c1"># 154 aux basis functions</span>
<span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="o">.</span><span class="n">auxbasis</span> <span class="o">=</span> <span class="s2">&quot;weigend&quot;</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>                                     <span class="c1"># -109.432334646585</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="o">.</span><span class="n">auxmol</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">())</span>               <span class="c1"># 98 aux basis functions</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="saving-and-reusing-df-integrals">
<span id="save-reuse-df-integrals"></span><h2><span class="section-number">2.15.4. </span>Saving and reusing DF integrals<a class="headerlink" href="#saving-and-reusing-df-integrals" title="Permalink to this headline">¶</a></h2>
<p>By default, the DF integrals are discarded after the calculations are done. Sometimes it is beneficial to save those integrals on disk and re-use them for later calculations. This can be done by specifying a HDF5 file where the DF integrals will be saved via setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">_cderi_to_save</span></code> either at the SCF stage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span>
<span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="o">.</span><span class="n">_cderi_to_save</span> <span class="o">=</span> <span class="s1">&#39;saved_cderi.h5&#39;</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>or initializing a <code class="xref py py-class docutils literal notranslate"><span class="pre">DF</span></code> object separately:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mydf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">DF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mydf</span><span class="o">.</span><span class="n">auxbasis</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">make_auxbasis</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mydf</span><span class="o">.</span><span class="n">_cderi_to_save</span> <span class="o">=</span> <span class="s1">&#39;saved_cderi.h5&#39;</span>
<span class="n">mydf</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>The save integrals can be used later by setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">_cderi</span></code> to the HDF5 file holding the DF integrals:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span>
<span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="o">.</span><span class="n">_cderi</span> <span class="o">=</span> <span class="s1">&#39;saved_cderi.h5&#39;</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>More examples on saving and using DF integrals can be found in <a href="#id7"><span class="problematic" id="id8">:source:`examples/df/10-access_df_integrals.py`</span></a>, <a href="#id9"><span class="problematic" id="id10">:source:`examples/df/11-access_df_tensor.py`</span></a>, and <a href="#id11"><span class="problematic" id="id12">:source:`examples/df/40-precompute_df_integrals.py`</span></a>.</p>
</div>
<div class="section" id="advanced-examples">
<h2><span class="section-number">2.15.5. </span>Advanced examples<a class="headerlink" href="#advanced-examples" title="Permalink to this headline">¶</a></h2>
<p>More examples on advanced topic of using the <a class="reference internal" href="#module-df" title="df: Density fitting and RI approximation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">df</span></code></a> module include</p>
<ul class="simple">
<li><p>Computing the <span class="math notranslate nohighlight">\(\mathbf{J}\)</span>-matrix of DFT in an I/O-free manner: <a href="#id13"><span class="problematic" id="id14">:source:`examples/df/11-get_j_io_free.py`</span></a>.</p></li>
<li><p>Using DF integrals to define the Hamiltonian of a CASSCF calculation: <a href="#id15"><span class="problematic" id="id16">:source:`examples/df/40-custom_df_hamiltonian.py`</span></a>.</p></li>
<li><p>Generating analytical gradients for DF integrals: <a href="#id17"><span class="problematic" id="id18">:source:`examples/df/41-df_integrals_gradients.py`</span></a>.</p></li>
<li><p>Customize the <code class="xref py py-func docutils literal notranslate"><span class="pre">get_jk()</span></code> method of a SCF class using DF: <a href="#id19"><span class="problematic" id="id20">:source:`examples/df/42-overwrite_get_jk.py`</span></a>.</p></li>
</ul>
</div>
<div class="section" id="references">
<h2><span class="section-number">2.15.6. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<span class="target" id="id21"></span></div>
</div>

<div class="section">
   
</div>

          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="../x2c/" title="2.14. Relativistic calculations"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> <span class="section-number">2.14. </span>Relativistic calculations </span>
              </div>
            </a>
          
          
            <a href="../pbc/" title="2.16. Periodic boundary conditions"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> <span class="section-number">2.16. </span>Periodic boundary conditions </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2015-2021, The PySCF Developers.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>