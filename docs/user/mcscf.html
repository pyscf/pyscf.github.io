
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Multi-configuration self-consistent field (MCSCF) &#8212; PySCF</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=92fd9be5" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pyscf-pst.css?v=ed6b5f64" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=69ff2ef9"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/mcscf';</script>
    <link rel="icon" href="../_static/favicon-32x32.png"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multi-reference perturbation theory (MRPT)" href="mrpt.html" />
    <link rel="prev" title="Auxiliary second-order Green’s function perturbation theory (AGF2)" href="agf2.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="2.8" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo-64x64.png" class="logo__image only-light" alt=""/>
    <img src="../_static/logo-64x64.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">PySCF</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contributor/index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about.html">
    About
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyscf/pyscf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contributor/index.html">
    Contributor Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about.html">
    About
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyscf/pyscf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="install.html">How to install PySCF</a></li>
<li class="toctree-l1"><a class="reference internal" href="using.html">How to use PySCF</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Building molecules and crystals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="gto.html">Molecular structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="pbcgto.html">Crystal structure</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Electronic structure methods</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="scf.html">Self-consistent field (SCF) methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="dft.html">Density functional theory (DFT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mp.html">Second-order Møller–Plesset perturbation theory (MP2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gw.html">GW approximation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci.html">Configuration interaction (CISD and FCI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="cc.html">Coupled-cluster theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="adc.html">Algebraic diagrammatic construction (ADC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="agf2.html">Auxiliary second-order Green’s function perturbation theory (AGF2)</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Multi-configuration self-consistent field (MCSCF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mrpt.html">Multi-reference perturbation theory (MRPT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tddft.html">Time-dependent Hartree-Fock and density functional theory</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other functionalities</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="solvent.html">Solvation models</a></li>
<li class="toctree-l1"><a class="reference internal" href="qmmm.html">QM/MM methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="md.html">Molecular Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="df.html">Density fitting (DF)</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="pbc.html">Periodic boundary conditions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="pbc/gto.html">Crystal structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc/scf.html">SCF and DFT methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc/df.html">Density fitting for crystalline calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc/mix_mol.html">Mixing PBC and molecular modules</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="eph.html">Electron-phonon coupling</a></li>
<li class="toctree-l1"><a class="reference internal" href="lo.html">Localized orbitals</a></li>
<li class="toctree-l1"><a class="reference internal" href="sgx.html">Seminumerical exchange (SGX)</a></li>
<li class="toctree-l1"><a class="reference internal" href="geomopt.html">Geometry optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPU Acceleration (GPU4PySCF)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extensions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Extensions</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Multi-configuration self-consistent field (MCSCF)</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="multi-configuration-self-consistent-field-mcscf">
<span id="user-mcscf"></span><h1>Multi-configuration self-consistent field (MCSCF)<a class="headerlink" href="#multi-configuration-self-consistent-field-mcscf" title="Link to this heading">#</a></h1>
<p><em>Modules</em>: <a class="reference internal" href="../pyscf_api_docs/pyscf.mcscf.html#module-pyscf.mcscf" title="pyscf.mcscf"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyscf.mcscf</span></code></a></p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Multiconfigurational self-consistent field (MCSCF) methods go beyond the single-determinant Hartree-Fock (HF) method by allowing the wave function to become a linear combination of multiple determinants.
While the configurations i.e. determinants can in principle be chosen in an arbitrary number of ways, PySCF focuses on the complete active space (CAS) family of methods, where the set of electron configurations is defined in terms of a given set of active orbitals, also known as the “active space”.
The CAS method generates all possible electron configurations that can be formed from the set of the active orbitals, and is therefore equivalent to an FCI procedure on a subset of the molecular orbitals; please see <a class="reference internal" href="ci.html#theory-ci"><span class="std std-ref">Configuration interaction (CISD and FCI)</span></a> for a discussion on the FCI method.
The use of MCSCF methods is crucial for reliable modeling of systems that exhibit nearly degenerate orbitals i.e. static correlation, such as transition metal complexes.
For a general discussion of MCSCF methods, we direct the reader to References <span id="id1">[<a class="reference internal" href="reference.html#id46" title="Trygve Helgaker, Poul Jorgensen, and Jeppe Olsen. Molecular Electronic-Structure Theory. Wiley, 2013. ISBN 9781118531471.">44</a>]</span> and <span id="id2">[<a class="reference internal" href="reference.html#id47" title="Esqc lectures 2019. URL: http://www.esqc.org/?page=lectures.">45</a>]</span>, and for specific details about PySCF’s implementation of CASSCF see <span id="id3">[<a class="reference internal" href="reference.html#id48" title="Qiming Sun, Jun Yang, and Garnet Kin-lic Lic Chan. A general second order complete active space self-consistent-field solver for large-scale systems. Chemical Physics Letters, 683:291–299, 2017. arXiv:1610.08394, doi:10.1016/j.cplett.2017.03.004.">46</a>]</span>.</p>
<p>The MCSCF module has two main flavors: CASCI and CASSCF.
In CASCI, the wave function is written as a linear combination of Slater determinants, and the expansion coefficients are solved in a variational procedure.
The orbitals are fixed in a CASCI calculation.
In contrast, in a CASSCF calculation, the orbitals are relaxed to minimize the resulting CASCI energy.
This means performing multiple CASCI steps followed by updates to the molecular orbitals, in analogy to Hartree-Fock calculations which also relies on iterative algorithms to minimize the HF energy with respect to the orbitals.</p>
<p>Minimal examples for each type of calculations are shown below.</p>
<section id="casci">
<h3>CASCI<a class="headerlink" href="#casci" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">mcscf</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;O 0 0 0; O 0 0 1.2&#39;</span><span class="p">,</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;ccpvdz&#39;</span><span class="p">,</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># Use MP2 natural orbitals to define the active space for the single-point CAS-CI calculation</span>
<span class="n">mymp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">UMP2</span><span class="p">(</span><span class="n">myhf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">noons</span><span class="p">,</span> <span class="n">natorbs</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">make_natural_orbitals</span><span class="p">(</span><span class="n">mymp</span><span class="p">)</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">natorbs</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="casscf">
<h3>CASSCF<a class="headerlink" href="#casscf" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyscf</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;O 0 0 0; O 0 0 1.2&#39;</span><span class="p">,</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;ccpvdz&#39;</span><span class="p">,</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
 <span class="c1"># We can also run CAS calculations starting from the Hartree-Fock orbitals.</span>
 <span class="n">mycas</span> <span class="o">=</span> <span class="n">myhf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Like many other modules in PySCF, <code class="xref py py-mod docutils literal notranslate"><span class="pre">mcscf</span></code> works with density-fitting (<a class="reference internal" href="df.html#user-df"><span class="std std-ref">Density fitting (DF)</span></a>) and x2c (<a class="reference internal" href="scf.html#user-x2c"><span class="std std-ref">Scalar relativistic correction</span></a>).
It can also be used in its unrestricted formulation, please see <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/60-uhf_based_ucasscf.py">examples/mcscf/60-uhf_based_ucasscf.py</a> for an example.
An important feature of <code class="xref py py-mod docutils literal notranslate"><span class="pre">mcscf</span></code> is that it can interface with external CI solver such as DMRG, FCIQMC, or selected CI methods, see the external projects for more details.
You can even use MP2 or CC methods as solvers!
Check out <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master//examples/cc/42-as_casci_fcisolver.py">/examples/cc/42-as_casci_fcisolver.py</a> for a working example.</p>
</section>
</section>
<section id="picking-an-active-space">
<h2>Picking an Active Space<a class="headerlink" href="#picking-an-active-space" title="Link to this heading">#</a></h2>
<p>In general, selecting an active space can be cumbersome and PySCF offers severals ways to facilitate this process.
There are several strategies and they all contain two main components:</p>
<ul class="simple">
<li><p>Specify the number of electrons and orbitals in the active space.</p></li>
<li><p>(Optional) Specify the which orbitals are “active”</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We always advise users to visualize their chosen active orbitals before starting large/expensive calculations.
This involves dumping the MO coefficients to a <code class="docutils literal notranslate"><span class="pre">molden</span></code> file (see example <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/tools/02-molden.py">examples/tools/02-molden.py</a>) and visualizing with your chosen program.
While there are many great softwares available to visualize orbitals, <a class="reference external" href="http://jmol.sourceforge.net/">JMol</a> is one of the easiest to use and is recommended for less experienced users.</p>
</div>
<p>Below is a list of several general strategies one could employ to pick active space orbitals:</p>
<ol class="arabic simple">
<li><p>(Default) Specifying no additional information.</p></li>
</ol>
<blockquote>
<div><p>This is the most minimal strategy for selecting an active space and chooses orbitals (and electrons) around the Fermi level that match the number of orbitals and electrons specified by the user.
In most circumstances, this is not an ideal strategy and will lead to poor convergence or none at all.</p>
<p>For example:</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">myhf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Hartree-Fock orbitals are often poor for systems with significant static correlation.
In such cases, orbitals from density functional calculations often yield better starting points for CAS calculations.</p>
</div>
<ol class="arabic simple" start="2">
<li><p>Specifying the active space orbitals as a list of molecular orbital (MO) indices.
This is often useful combined with a visual analysis of localized orbitals (see the section on localized orbitals).</p></li>
</ol>
<blockquote>
<div><p>The user can select the MO orbital indices “manually” and pass them to the <code class="docutils literal notranslate"><span class="pre">sort_mo</span></code> function. NB! The orbitals are numbered from 1, not 0.
See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/10-define_cas_space.py">examples/mcscf/10-define_cas_space.py</a> and <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/34-init_guess_localization.py">examples/mcscf/34-init_guess_localization.py</a> for more details.</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># Note sort_mo by default take the 1-based orbital indices.</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">mycas</span><span class="o">.</span><span class="n">sort_mo</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
<p>3) Specifying the number of orbitals in each symmetry group.
This strategy is often helpful when the system has a high degree of symmetry, or when there is no physically evident best choise for the active orbitals.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">ncore</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A1g&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;A1u&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
<span class="n">ncas</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A1g&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;A1u&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;E1ux&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E1uy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E1gx&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E1gy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;E2ux&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E2uy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E2gx&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E2gy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">sort_mo_by_irrep</span><span class="p">(</span><span class="n">mycas</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
<p>A similar approach where we specify the number of electrons in each irreducible representation is also possible by setting <code class="docutils literal notranslate"><span class="pre">mycas.fcisolver.irrep_nelec</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">fcisolver</span><span class="o">.</span><span class="n">irrep_nelec</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A1g&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;A1u&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;E1ux&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;E1uy&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This strategy is often combined with calculations at a lower level of theory.
For instance, MP2 or CISD natural orbitals and their occupation numbers can be used determine the suitable active space in each symmetry block.
Natural orbitals with occupations close to 2 are strongly occupied, and can be frozen in the CAS calculation.
Natural orbitals with small occupation numbers can likewise be omitted from the active space.</p>
</div>
<p>4) Use automated strategies (<code class="docutils literal notranslate"><span class="pre">avas</span></code> and <code class="docutils literal notranslate"><span class="pre">dmet_cas</span></code>) to pick an active space based on AO orbitals you’re targeting.
For more details, see <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-avas.py">examples/mcscf/43-avas.py</a> and <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-dmet_cas.py">examples/mcscf/43-dmet_cas.py</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">avas</span>
<span class="n">ao_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Fe 3d&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe 4d&#39;</span><span class="p">,</span> <span class="s1">&#39;C 2pz&#39;</span><span class="p">]</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">orbs</span> <span class="o">=</span> <span class="n">avas</span><span class="o">.</span><span class="n">avas</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ao_labels</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">dmet_cas</span>
<span class="n">ao_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Fe 3d&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe 4d&#39;</span><span class="p">,</span> <span class="s1">&#39;C 2pz&#39;</span><span class="p">]</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">mo</span> <span class="o">=</span> <span class="n">dmet_cas</span><span class="o">.</span><span class="n">guess_cas</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">(),</span> <span class="n">ao_labels</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="frozen-orbital-mcscf">
<h2>Frozen-orbital MCSCF<a class="headerlink" href="#frozen-orbital-mcscf" title="Link to this heading">#</a></h2>
<p>Orbitals can be frozen in the orbital optimization to e.g. reduce the computational effort of CASSCF calculations.
The orbitals will remain fixed throughout the optimization.</p>
<p>Users can specify the number of lowest orbitals to freeze:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">frozen</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>Users can also specify a list of orbital indices (0-based).
These may be occupied, virtual, or active orbitals.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">frozen</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">27</span><span class="p">]</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/19-frozen_orbital.py">examples/mcscf/19-frozen_orbital.py</a> for a complete example.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>frozen</cite> keyword of the CASSCF optimizer should not be confused with the <cite>frozen</cite> keyword of the FCI solver, which controls the number of orbitals that are constrained to be doubly occupied.</p>
</div>
</section>
<section id="spin-state-of-cas-wavefunction">
<h2>Spin state of CAS wavefunction<a class="headerlink" href="#spin-state-of-cas-wavefunction" title="Link to this heading">#</a></h2>
<p>Multiconfigurational wavefunction provided by the
the <cite>pyscf.fci</cite> solver is typically spin-adapted, but there is no direct
control of the spin multiplicity (i.e. S^2 value). It is, nevertheless, possible
to define the spin projection Sz of the obtained WF, which helps to fix the spin
multiplicity in most of the cases. By default, the MCSCF uses the setting in
<code class="xref py py-attr docutils literal notranslate"><span class="pre">mol.spin</span></code> for the value of 2*Sz.</p>
<p>You can change the number of alpha and beta electrons in the active space.
The Sz value of the MCSCF wavefunction can differ from <code class="xref py py-attr docutils literal notranslate"><span class="pre">mol.spin</span></code>.</p>
<p>For example, you can start from <cite>Sz=0</cite> RHF calculations, and then change the
number of alpha and beta electrons in the active space to solve higher
spin states, such as the triplet state.```</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># 5 alpha electrons, 3 beta electrons</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>Another common scenario to adjust the spin settings is the caulations of
transition-metal systems. For transition-metal system with open d shell, one can
start with single-reference maximum-Sz state and then switch to more complicated
low-spin states in CASSCF.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">ROHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>It may happen that a wave function of correct Sz is achieved while
S^2 is wrong. This issue may either be caused by convergence onto
another spin state, or spin contamination in the CAS wave function.</p>
<p>Such issues can be circumvented with the <code class="xref py py-func docutils literal notranslate"><span class="pre">fix_spin_()</span></code> method
of the CASCI/CASSCF class, which is able to correct the spin state
by biasing the calculation towards the wanted state.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># Targeting triplet state with Sz=0</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">fix_spin_</span><span class="p">(</span><span class="n">ss</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">fix_spin_()</span></code> is an energy-penalty method. It may affect the efficiency and
accuracy of the CASCI and CASSCF algorithms. It should not be used unless
the MCSCF program has difficulties in finding the wanted spin state.</p>
<p>In example <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/02-cas_space_spin.py">examples/mcscf/02-cas_space_spin.py</a> and
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/18-spatial_spin_symmetry.py.py">examples/mcscf/18-spatial_spin_symmetry.py.py</a>, you can find the
complete scripts to tune spin states of the CASCI/CASSCF wavefunctions.</p>
</section>
<section id="state-averaged-calculations">
<h2>State-Averaged Calculations<a class="headerlink" href="#state-averaged-calculations" title="Link to this heading">#</a></h2>
<p>When your system has states that are close-by in energy, their ordering may change during the orbital optimization and result in non-convergence of the CASSCF optimization.
In such cases it is often helpful to optimize the orbitals for a state average.
The <code class="docutils literal notranslate"><span class="pre">state_average_</span></code> function (note the hanging underscore) is a member function of <code class="docutils literal notranslate"><span class="pre">CASCI</span></code>/<code class="docutils literal notranslate"><span class="pre">CASSCF</span></code> objects and takes the weights of the states as input.
The weights can be any normalized and non-negative array of values, but equal weights are typically used.
See Section 12.7.2 in Ref. <span id="id4">[<a class="reference internal" href="reference.html#id46" title="Trygve Helgaker, Poul Jorgensen, and Jeppe Olsen. Molecular Electronic-Structure Theory. Wiley, 2013. ISBN 9781118531471.">44</a>]</span> for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n_states</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_states</span><span class="p">)</span><span class="o">/</span><span class="n">n_states</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">state_average_</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/15-state_average.py">examples/mcscf/15-state_average.py</a> for a complete example.</p>
<p>By default, only a single spin and/or point group symmetry is targeted, but it is possible to target a mixture of both:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">]</span>
<span class="n">solver1</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">direct_spin1_symm</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">solver1</span><span class="o">.</span><span class="n">wfnsym</span><span class="o">=</span> <span class="s1">&#39;A1&#39;</span>
<span class="n">solver1</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">solver2</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">direct_spin1_symm</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">solver2</span><span class="o">.</span><span class="n">wfnsym</span><span class="o">=</span> <span class="s1">&#39;A2&#39;</span>
<span class="n">solver2</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">mcscf</span><span class="o">.</span><span class="n">state_average_mix_</span><span class="p">(</span><span class="n">mycas</span><span class="p">,</span> <span class="p">[</span><span class="n">solver1</span><span class="p">,</span> <span class="n">solver2</span><span class="p">],</span> <span class="n">weights</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/41-state_average.py">examples/mcscf/41-state_average.py</a> for a complete example.</p>
</section>
<section id="job-control">
<h2>Job Control<a class="headerlink" href="#job-control" title="Link to this heading">#</a></h2>
<section id="optimization-settings">
<h3>Optimization Settings<a class="headerlink" href="#optimization-settings" title="Link to this heading">#</a></h3>
<p>For CASSCF calculations, users may want to modify several of the convergence thresholds such as the energy (<code class="docutils literal notranslate"><span class="pre">conv_tol</span></code>), the orbital gradient (<code class="docutils literal notranslate"><span class="pre">conv_tol_grad</span></code>), and the maximum number of MCSCF iterations (<code class="docutils literal notranslate"><span class="pre">max_cycle_macro</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">conv_tol</span> <span class="o">=</span> <span class="mf">1e-12</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">conv_tol_grad</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">max_cycle_macro</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="initial-guess">
<h3>Initial Guess<a class="headerlink" href="#initial-guess" title="Link to this heading">#</a></h3>
<p>Initial guess orbitals for the CASSCF calculation (starting orbitals) may be passed to the <code class="docutils literal notranslate"><span class="pre">kernel</span></code> member function of an MCSCF object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">my_custom_mos</span><span class="p">)</span>
</pre></div>
</div>
<p>CI coefficients from a previous calculation can also be passed as an initial guess to expedite the calculation:</p>
<p>Examples:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/14-project_init_guess.py">examples/mcscf/14-project_init_guess.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/31-cr2_scan/cr2-scan.py">examples/mcscf/31-cr2_scan/cr2-scan.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/34-init_guess_localization.py">examples/mcscf/34-init_guess_localization.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-avas.py">examples/mcscf/43-avas.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-dmet_cas.py">examples/mcscf/43-dmet_cas.py</a></p></li>
</ul>
</section>
<section id="restarting">
<h3>Restarting<a class="headerlink" href="#restarting" title="Link to this heading">#</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When running large calculations, it’s always recommended that you specify a checkpoint file for your calculation.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span><span class="o">.</span><span class="n">chkfile</span> <span class="o">=</span> <span class="s2">&quot;casscf.chk&quot;</span>
</pre></div>
</div>
<p>Much like <code class="xref py py-mod docutils literal notranslate"><span class="pre">scf</span></code>, if a job is interrupted, users can restart the MCSCF calculations using checkpoint files from a crashed calculation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.lib</span> <span class="kn">import</span> <span class="n">chkfile</span>
<span class="n">old_chk_file</span> <span class="o">=</span> <span class="s2">&quot;old_casscf.chk&quot;</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">chkfile</span> <span class="o">=</span> <span class="s2">&quot;restarted_casscf.chk&quot;</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">chkfile</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">old_chk_file</span><span class="p">,</span> <span class="s1">&#39;mcscf/mo_coeff&#39;</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/13-restart.py">examples/mcscf/13-restart.py</a> for a complete example.</p>
<p>Restarting calculations can be also be useful when using results from a smaller active space to speed up calculations on a larger one.</p>
</section>
</section>
<section id="observables-and-properties">
<h2>Observables and Properties<a class="headerlink" href="#observables-and-properties" title="Link to this heading">#</a></h2>
<section id="wave-function-analysis">
<h3>Wave Function Analysis<a class="headerlink" href="#wave-function-analysis" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">analyze</span></code> member functions of MCSCF objects prints many useful properties to <code class="docutils literal notranslate"><span class="pre">stdout</span></code> when the verbosity is &gt;=4.</p>
<ol class="arabic simple">
<li><p>Natural orbital occupancies</p></li>
<li><p>Natural orbital AO expansions</p></li>
<li><p>Overlap between canonical MCSCF orbitals and the initial guess orbitals.</p></li>
<li><p>Analysis of the CI coefficients, i.e. the leading configurations and their weights</p></li>
<li><p>AO populations</p></li>
<li><p>Atomic populations</p></li>
<li><p>AO spin densities (if applicable)</p></li>
<li><p>Atomic spin densities (if applicable)</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">myhf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">analyze</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="natural-orbitals">
<h3>Natural Orbitals<a class="headerlink" href="#natural-orbitals" title="Link to this heading">#</a></h3>
<p>The CAS wave function is invariant under orbital rotation within the inactive core, active, and inactive virtual spaces.
The inactive core and virtual orbitals are by default canonicalized, i.e., they are transformed by block-diagonalizing the generalized Fock matrix within the inactive core and virtual subblocks.
This also yields energy eigenvalues for the inactive core and virtual orbitals.
In contrast, no energy or electron occupation can be assigned to the active orbitals, strictly speaking.
The user may request the active orbitals to be transformed to the so-called natural representation, in which the reduced one-body density matrix is diagonal, and the formal natural orbital occupation numbers can be found on its diagonal.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When <code class="docutils literal notranslate"><span class="pre">mycas.natorb</span></code> is set, the natural orbitals may NOT be sorted by the active space occupancy.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">natorb</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="agf2.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Auxiliary second-order Green’s function perturbation theory (AGF2)</p>
      </div>
    </a>
    <a class="right-next"
       href="mrpt.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Multi-reference perturbation theory (MRPT)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#casci">CASCI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#casscf">CASSCF</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#picking-an-active-space">Picking an Active Space</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frozen-orbital-mcscf">Frozen-orbital MCSCF</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spin-state-of-cas-wavefunction">Spin state of CAS wavefunction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#state-averaged-calculations">State-Averaged Calculations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#job-control">Job Control</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimization-settings">Optimization Settings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-guess">Initial Guess</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#restarting">Restarting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#observables-and-properties">Observables and Properties</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wave-function-analysis">Wave Function Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#natural-orbitals">Natural Orbitals</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/pyscf/pyscf.github.io/edit/master/source/user/mcscf.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, The PySCF Developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>