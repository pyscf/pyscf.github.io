
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Auxiliary second-order Green’s function perturbation theory (AGF2) &#8212; PySCF 2.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/material.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../../_static/favicon-32x32.png"/>
    <link rel="author" title="About these documents" href="../../about/" />
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" /> 
  
   
  
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=amber>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#develop/agf2_developer" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../" title="PySCF 2.0.0 documentation"
           class="md-header-nav__button md-logo">
          
              <img src="../../_static/pyscf-logo-white.svg" height="26"
                   alt="PySCF 2.0.0 documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">PySCF 2.0</span>
          <span class="md-header-nav__topic"> Auxiliary second-order Green’s function perturbation theory (AGF2) </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search/" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../"versions.json"",
        target_loc = "../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../../" class="md-tabs__link">Home</a></li>
            
            <li class="md-tabs__item"><a href="../../overview/" class="md-tabs__link">Overview</a></li>
            
            <li class="md-tabs__item"><a href="../../install/" class="md-tabs__link">Install</a></li>
            
            <li class="md-tabs__item"><a href="../../quickstart/" class="md-tabs__link">Quickstart</a></li>
            
            <li class="md-tabs__item"><a href="../../user/" class="md-tabs__link">User Guide</a></li>
            
            <li class="md-tabs__item"><a href="../../pyscf_api_docs/modules/" class="md-tabs__link">API</a></li>
            
            <li class="md-tabs__item"><a href="../../about/" class="md-tabs__link">About</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../" title="PySCF 2.0.0 documentation" class="md-nav__button md-logo">
      
        <img src="../../_static/pyscf-logo-white.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../"
       title="PySCF 2.0.0 documentation">PySCF 2.0</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../../overview/" class="md-nav__link">1. Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../install/" class="md-nav__link">2. Install</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../quickstart/" class="md-nav__link">3. Quickstart</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../user/" class="md-nav__link">4. User Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../pyscf_api_docs/pyscf/" class="md-nav__link">5. API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../interface/" class="md-nav__link">6. Interface</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../../about/" class="md-nav__link">7. About</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#develop-agf2-developer--page-root" class="md-nav__link">Auxiliary second-order Green’s function perturbation theory (AGF2)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#overview" class="md-nav__link">Overview</a>
        </li>
        <li class="md-nav__item"><a href="#auxiliary-space-objects" class="md-nav__link">Auxiliary space objects</a>
        </li>
        <li class="md-nav__item"><a href="#fock-loop" class="md-nav__link">Fock loop</a>
        </li>
        <li class="md-nav__item"><a href="#memory-requirements" class="md-nav__link">Memory requirements</a>
        </li>
        <li class="md-nav__item"><a href="#arbitrary-order-moment-calculations" class="md-nav__link">Arbitrary order moment calculations</a>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../../_sources/develop/agf2_developer.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
             <div class="section" id="auxiliary-second-order-green-s-function-perturbation-theory-agf2">
<span id="developer-agf2"></span><h1>Auxiliary second-order Green’s function perturbation theory (AGF2)<a class="headerlink" href="#auxiliary-second-order-green-s-function-perturbation-theory-agf2" title="Permalink to this headline">¶</a></h1>
<p><em>Modules</em>: <code class="xref py py-mod docutils literal notranslate"><span class="pre">agf2</span></code></p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The function <code class="xref py py-func docutils literal notranslate"><span class="pre">pyscf.agf2.AGF2()</span></code> will direct the method to one of the
following classes, depending on the nature of the Hartree–Fock object passed as
an argument</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.ragf2.RAGF2</span></code></p></td>
<td><p>RHF</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.uagf2.UAGF2</span></code></p></td>
<td><p>UHF</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.dfragf2.DFRAGF2</span></code></p></td>
<td><p>RHF with density fitting</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.dfuagf2.DFUAGF2</span></code></p></td>
<td><p>UHF with density fitting</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.ragf2_slow.RAGF2</span></code></p></td>
<td><p>RHF with arbitrary moment orders</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.uagf2_slow.UAGF2</span></code></p></td>
<td><p>UHF with arbitrary moment orders</p></td>
</tr>
</tbody>
</table>
<p>The key attributes of the AGF2 classes include</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">mo_coeff</span></code></p></td>
<td><p>saved MO coefficients</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">mo_energy</span></code></p></td>
<td><p>saved MO energies</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">mo_occ</span></code></p></td>
<td><p>saved MO occupations</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">diis</span></code></p></td>
<td><p>DIIS method</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">se</span></code></p></td>
<td><p>SelfEnergy object</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">gf</span></code></p></td>
<td><p>GreensFunction object</p></td>
</tr>
</tbody>
</table>
<p>The AGF2 calculation is dispatched via the <a class="reference internal" href="../ao2mo_developer/#kernel" title="kernel"><code class="xref py py-func docutils literal notranslate"><span class="pre">kernel()</span></code></a> function, which
carries out the following steps:</p>
<blockquote>
<div><ul class="simple">
<li><p>generate the MO basis integrals – <a class="reference internal" href="../../modules/ao2mo/#module-ao2mo" title="ao2mo: transformations from AO to MO integrals for various permutational and spin symmetries."><code class="xref py py-func docutils literal notranslate"><span class="pre">ao2mo()</span></code></a></p></li>
<li><p>build the zeroth-order Green’s function via the Hartree–Fock states – <code class="xref py py-func docutils literal notranslate"><span class="pre">init_gf()</span></code></p></li>
<li><p>build the MP2 self-energy – <code class="xref py py-func docutils literal notranslate"><span class="pre">build_se()</span></code></p></li>
<li><p>run the Fock loop (updates the self-energy and Green’s function) – <code class="xref py py-func docutils literal notranslate"><span class="pre">fock_loop()</span></code></p></li>
<li><p>update the 1-body energy – <code class="xref py py-func docutils literal notranslate"><span class="pre">energy_1body()</span></code></p></li>
<li><p>update the self-energy – <code class="xref py py-func docutils literal notranslate"><span class="pre">build_se()</span></code></p></li>
<li><p>update the 2-body energy – <code class="xref py py-func docutils literal notranslate"><span class="pre">energy_2body()</span></code></p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="auxiliary-space-objects">
<h2>Auxiliary space objects<a class="headerlink" href="#auxiliary-space-objects" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-attr docutils literal notranslate"><span class="pre">se</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">gf</span></code> attributes are both derived from the
<code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.aux.AuxiliarySpace</span></code> object, and are used as
containers for the poles and residues of the self-energy and Green’s function.
The classes contained in <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/pyscf/agf2/aux.py">pyscf/agf2/aux.py</a> are</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.aux.AuxiliarySpace</span></code></p></td>
<td><p>base class for auxiliary spaces</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.aux.SelfEnergy</span></code></p></td>
<td><p>self-energy</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.aux.GreensFunction</span></code></p></td>
<td><p>Green’s function</p></td>
</tr>
</tbody>
</table>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">AuxiliarySpace</span></code> contains most of the attributes and functions
common to both <code class="xref py py-class docutils literal notranslate"><span class="pre">SelfEnergy</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">GreensFunction</span></code>. The key
attributes are</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">energy</span></code></p></td>
<td><p>array of energies (positions) of the poles</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coupling</span></code></p></td>
<td><p>array of couplings of the poles to a physical space</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">chempot</span></code></p></td>
<td><p>position of the Fermi energy</p></td>
</tr>
</tbody>
</table>
<p>Key methods are</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">get_occupied</span></code></p></td>
<td><p>get a copy of the object with only occupied poles</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">get_virtual</span></code></p></td>
<td><p>get a copy of the object with only virtual poles</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">get_array</span></code></p></td>
<td><p>get a dense representation of the Hamiltonian coupling to a physical space</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">dot</span></code></p></td>
<td><p>perform a dot-product of the result of <code class="xref py py-attr docutils literal notranslate"><span class="pre">get_array</span></code> with a vector via the sparse representation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">moment</span></code></p></td>
<td><p>return the <span class="math notranslate nohighlight">\(n\)</span>-th spectral moment of the auxiliaries</p></td>
</tr>
</tbody>
</table>
<p>Methods specific to the <code class="xref py py-class docutils literal notranslate"><span class="pre">SelfEnergy</span></code> are</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">compress</span></code></p></td>
<td><p>compress the self-energy via the AGF2 compression algorithms</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">get_greens_function</span></code></p></td>
<td><p>diagonalise the self-energy along with a physical space matrix to get a <code class="xref py py-attr docutils literal notranslate"><span class="pre">GreensFunction</span></code></p></td>
</tr>
</tbody>
</table>
<p>Methods specific to the <code class="xref py py-class docutils literal notranslate"><span class="pre">GreensFunction</span></code> are</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 79%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">make_rdm1</span></code></p></td>
<td><p>get the associated one-particle reduced density matrix</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">real_freq_spectrum</span></code></p></td>
<td><p>express the Green’s function as a spectrum on a real-valued frequency grid, with a broadening factor</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="fock-loop">
<h2>Fock loop<a class="headerlink" href="#fock-loop" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">fock_loop()</span></code> function is used to solve the self-consistent
Hartree–Fock-like iterations on the correlated density matrix.
This step also simultaneously ensures that there is a correct number of electrons in the
physical space.
The chemical potential is first optimised by minimising the metric (in the
restricted case)</p>
<div class="math notranslate nohighlight">
\[x(\mu) = \Big( N_\mathrm{elec} -
               2 \sum_{p}^{n_\mathrm{MO}}
                 \sum_{i}^{n_\mathrm{QMO}^\mathrm{occ}}
                 \phi_{pi} \phi_{pi}^*
         \Big)^{2},\]</div>
<p>where the chemical potential (<span class="math notranslate nohighlight">\(\mu\)</span>) adjusts the positions of the poles of
the self-energy before diagonalisation, thereby adjusting the weight of the
occupied QMOs on the physical space and in turn the trace of the one-particle
density matrix.
The gradient of <span class="math notranslate nohighlight">\(x\)</span> with respect to the chemical potential
<span class="math notranslate nohighlight">\(\frac{\partial x(\mu)}{\partial \mu}\)</span> is also implemented such that a
truncated Newton algorithm can be used via <code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.optimize.minimize()</span></code>.
The functions required to handle this step are contained in
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/pyscf/agf2/chempot.py">pyscf/agf2/chempot.py</a>.</p>
</div>
<div class="section" id="memory-requirements">
<h2>Memory requirements<a class="headerlink" href="#memory-requirements" title="Permalink to this headline">¶</a></h2>
<p>Due to the renormalisation of the second-order diagrams, the MO basis integrals
must be transformed into the QMO basis at subsequent iterations.
This requires the combinations <span class="math notranslate nohighlight">\((xo|ov)\)</span> and <span class="math notranslate nohighlight">\((xv|vo)\)</span>, where
<span class="math notranslate nohighlight">\(x\)</span> are general MOs, <span class="math notranslate nohighlight">\(o\)</span> are occupied QMOs and <span class="math notranslate nohighlight">\(v\)</span> are virtual
QMOs.
The occupied QMOs number <span class="math notranslate nohighlight">\(n_\mathrm{MO} + n_\mathrm{MO}^\mathrm{occ}\)</span>, and
virtual <span class="math notranslate nohighlight">\(n_\mathrm{MO} + n_\mathrm{MO}^\mathrm{vir}\)</span>, and so these arrays
become prohibitively expensive with increasing system size.
This necessitates the use of density fitting for large system sizes, which
provides lower scaling memory requirements.
The density fitting implementation still requires the four-centre integrals to
be built in order to compute the moments of the self-energy, but they may be
computed block-wise in order that the memory overhead remains low.</p>
</div>
<div class="section" id="arbitrary-order-moment-calculations">
<h2>Arbitrary order moment calculations<a class="headerlink" href="#arbitrary-order-moment-calculations" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.ragf2_slow.RAGF2</span></code> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.agf2.uagf2_slow.UAGF2</span></code> classes support AGF2 calculations beyond
the standard efficient AGF2(1,0) implementation.
These classes are largely unoptimised and do not support density fitting, and
are intended for developmental use only.
For a discussion of the order of the moments required as parameters to these
methods, please refer to our paper <a class="bibtex reference internal" href="#backhouse2020a" id="id1">[1]</a>.
An example of higher-order AGF2 calculations can be found in
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/pyscf/examples/agf2/05-agf2_moments.py">pyscf/examples/agf2/05-agf2_moments.py</a>, with a connection to the
algebraic diagrammatic construction method.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p id="bibtex-bibliography-develop/agf2_developer-0"><dl class="citation">
<dt class="bibtex label" id="backhouse2020a"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Oliver J. Backhouse, Max Nusspickel, and George H. Booth. Wave function perspective and efficient truncation of renormalized second-order perturbation theory. <em>J. Chem. Theory Comput.</em>, 16(2):1090–1104, 2020. <a class="reference external" href="https://doi.org/10.1021/acs.jctc.9b01182">doi:10.1021/acs.jctc.9b01182</a>.</p>
</dd>
<dt class="bibtex label" id="backhouse2020b"><span class="brackets">2</span></dt>
<dd><p>Oliver J. Backhouse and George H. Booth. Efficient excitations and spectra within a perturbative renormalization approach. <em>J. Chem. Theory Comput.</em>, 16(10):6294–6304, 2020. <a class="reference external" href="https://doi.org/10.1021/acs.jctc.0c00701">doi:10.1021/acs.jctc.0c00701</a>.</p>
</dd>
</dl>
</p>
</div>
</div>

<div class="section">
   
</div>

          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2015-2021, The PySCF Developers.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>